<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Management - Dashboard</title>
    <style>
        /* === Basic Styling (Mostly unchanged, updated action button colors) === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f9;
            margin: 0;
            padding: 20px;
            color: #333;
            position: relative; /* Needed for absolute positioning of modals/messages */
            min-height: 100vh; /* Ensure body takes full height */
        }

        #data-management-section {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 1200px; /* Optional: constrain width */
            margin: 0 auto; /* Center the section */
        }

        #data-management-section h2 {
            color: #1a237e; /* Darker Blue */
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }
         #data-management-section h2 i {
            margin-right: 8px;
         }

        .dm-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px; /* Spacing between items */
        }

        .dm-actions button,
        .dm-search-filter input[type="search"],
        .dm-search-filter select {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            font-size: 14px;
            height: 40px; /* Consistent height */
            box-sizing: border-box; /* Include padding/border in height */
        }
         .dm-search-filter input[type="search"],
         .dm-search-filter select {
             margin-right: 10px;
         }
         /* Remove right margin from the last filter element */
         .dm-search-filter select:last-child {
             margin-right: 0;
         }

        .dm-actions button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            border: none; /* Remove default border */
             margin-left: 5px; /* Spacing between buttons */
        }
         .dm-actions button:first-child {
             margin-left: 0;
         }
         .dm-actions button i {
             margin-right: 5px;
         }
         .dm-actions button:hover {
            background-color: #2980b9;
         }
         .dm-actions button.dm-import-btn {
             background-color: #2ecc71;
         }
         .dm-actions button.dm-import-btn:hover {
             background-color: #27ae60;
         }
         .dm-actions button.dm-export-btn {
             background-color: #f39c12;
         }
         .dm-actions button.dm-export-btn:hover {
             background-color: #e67e22;
         }

        .dm-search-filter {
            display: flex;
            align-items: center;
            flex-grow: 1; /* Allow search/filter to take available space */
            min-width: 250px; /* Ensure minimum width */
            flex-wrap: wrap; /* Allow filters to wrap */
            gap: 10px; /* Spacing between search and filters */
        }

        .dm-search-filter input[type="search"] {
            flex-grow: 1; /* Search input takes more space */
            min-width: 180px;
            margin-right: 0; /* Remove margin as gap is used */
        }
         .dm-search-filter select {
             min-width: 150px; /* Give dropdowns a minimum width */
             flex-grow: 1; /* Allow dropdowns to grow */
             margin-right: 0; /* Remove margin as gap is used */
         }

        .dm-table-container {
            overflow-x: auto;
        }

        .dm-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .dm-table th,
        .dm-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
            white-space: nowrap; /* Prevent text wrapping */
        }

        .dm-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
            cursor: default; /* Remove pointer cursor if not implementing sort */
        }
         .dm-table th i {
             margin-left: 5px;
             font-size: 0.8em;
             color: #bdc3c7;
             /* display: none;  Hide sort icons if not implemented */
         }
         .dm-table th:first-child, .dm-table td:first-child { /* Checkbox column */
            width: 1%; /* Make checkbox column narrow */
            white-space: nowrap;
            text-align: center;
         }
         .dm-table td:last-child { /* Actions column */
             white-space: nowrap;
             width: 1%; /* Make actions column narrow */
             text-align: center;
         }


        .dm-table tbody tr:hover {
            background-color: #f1f1f1;
        }

        .dm-table .dm-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: capitalize;
            display: inline-block;
            text-align: center;
            min-width: 60px;
        }

        .dm-table .dm-status-active { background-color: #e8f5e9; color: #388e3c; }
        .dm-table .dm-status-pending { background-color: #fff3e0; color: #f57c00; }
        .dm-table .dm-status-inactive { background-color: #fce4ec; color: #d81b60; }

        /* === Action Button Color Styling === */
        .dm-table .dm-row-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            margin: 0 4px; /* Slightly increased margin */
            font-size: 16px;
            transition: color 0.2s ease, transform 0.1s ease; /* Added transform */
        }
         /* Add slight scale on hover/active for better feedback */
         .dm-table .dm-row-actions button:active {
             transform: scale(0.9);
         }

        /* Default Colors */
        .dm-table .dm-row-actions .dm-view-btn { color: #27ae60; }
        .dm-table .dm-row-actions .dm-edit-btn { color: #2980b9; }
        .dm-table .dm-row-actions .dm-delete-btn { color: #c0392b; }

        /* Hover Colors */
        .dm-table .dm-row-actions .dm-view-btn:hover { color: #2ecc71; }
        .dm-table .dm-row-actions .dm-edit-btn:hover { color: #3498db; }
        .dm-table .dm-row-actions .dm-delete-btn:hover { color: #e74c3c; }
        /* === End Action Button Color Styling === */


        .dm-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 5px;
        }

        .dm-pagination button,
        .dm-pagination span {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: #fff;
            border-radius: 4px;
            font-size: 14px;
        }
        .dm-pagination button {
             cursor: pointer;
             transition: background-color 0.2s ease;
        }
         .dm-pagination button:hover:not(:disabled) {
             background-color: #eee;
         }

        .dm-pagination button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
            background-color: #f8f9fa;
        }

        .dm-pagination span.dm-page-info {
            border: none;
            background: none;
            padding: 8px 5px;
        }

        .dm-pagination span.dm-current-page {
            font-weight: bold;
        }

        .dm-table tbody tr.selected-row {
            background-color: #e0f2fe !important;
        }

        /* === Modal Styling === */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Dim background */
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Ensure it's on top */
            opacity: 0; /* Start hidden for transition */
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px; /* Max width for the modal */
            position: relative;
            max-height: 80vh; /* Limit height */
            overflow-y: auto; /* Add scroll if content overflows */
            transform: scale(0.95); /* Start slightly smaller for transition */
            transition: transform 0.3s ease;
        }
         .modal-overlay.show { /* Class to control visibility and animation */
              display: flex;
              opacity: 1;
         }
         .modal-overlay.show .modal-content {
              transform: scale(1);
         }


        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
            transition: color 0.2s ease;
        }
        .modal-close-btn:hover {
            color: #333;
        }


        .modal-content h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Form Styles within Modal */
        #add-edit-form label,
        #view-modal dt {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            margin-top: 15px;
        }
        #add-edit-form input[type="text"],
        #add-edit-form select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        #add-edit-form select {
             height: 40px; /* Match other inputs */
        }
        #add-edit-form .form-actions {
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        #add-edit-form button,
        #delete-confirm-modal button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        #add-edit-form .save-btn,
        #delete-confirm-modal .confirm-delete-btn {
            background-color: #2ecc71;
            color: white;
        }
         #add-edit-form .save-btn:hover,
         #delete-confirm-modal .confirm-delete-btn:hover {
            background-color: #27ae60;
        }
        #add-edit-form .cancel-btn,
        #delete-confirm-modal .cancel-delete-btn {
            background-color: #bdc3c7;
            color: #333;
        }
         #add-edit-form .cancel-btn:hover,
         #delete-confirm-modal .cancel-delete-btn:hover {
             background-color: #a9b4bb;
         }
         #delete-confirm-modal .modal-actions {
             margin-top: 20px;
             display: flex;
             justify-content: flex-end;
             gap: 10px;
         }

         /* View Modal Specifics */
         #view-modal dl {
             margin: 0;
         }
         #view-modal dt {
             margin-top: 10px;
         }
         #view-modal dd {
             margin-left: 0;
             margin-bottom: 10px;
             padding: 5px 8px;
             background-color: #f8f9fa;
             border: 1px solid #eee;
             border-radius: 4px;
             word-wrap: break-word; /* Wrap long text */
         }
         #view-modal .dm-status { /* Reuse status style */
             display: inline-block;
         }

        /* === Message Box Styling === */
        #message-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            z-index: 1001; /* Above modal overlay */
            min-width: 250px;
            text-align: center;
            opacity: 0;
            transform: translateX(100%); /* Start off-screen */
            transition: opacity 0.5s ease, transform 0.5s ease;
            visibility: hidden; /* Use visibility to prevent interaction when hidden */
        }
        #message-box.show {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }
        #message-box.success {
            background-color: #2ecc71; /* Green */
        }
        #message-box.error {
            background-color: #e74c3c; /* Red */
        }
        #message-box.info {
            background-color: #3498db; /* Blue */
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) { /* Adjust breakpoint if needed */
             .dm-search-filter {
                 /* Allow search and filters to potentially stack */
                 /* flex-wrap: wrap; */ /* Already set */
                 /* gap: 10px; */      /* Already set */
             }
        }

        @media (max-width: 768px) {
            .dm-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            .dm-search-filter {
                /* Already set to wrap and gap */
                width: 100%;
                min-width: unset;
                 margin-bottom: 15px; /* Add space below filters when stacked */
                 /* Items will stack naturally due to flex-wrap and gap */
            }
             .dm-search-filter input[type="search"],
             .dm-search-filter select {
                 width: 100%; /* Make search and filters full width when stacked */
                 min-width: unset; /* Remove min-width */
             }

            .dm-actions {
                 width: 100%;
                 display: flex;
                 justify-content: space-around; /* Or space-between */
                 gap: 10px;
            }
            .dm-actions button {
                 flex-grow: 1; /* Make buttons take equal space */
                 margin-left: 0;
                 font-size: 13px; /* Slightly smaller text */
                 padding: 10px 8px;
            }
             .dm-actions button i {
                margin-right: 3px;
             }
            .modal-content {
                width: 95%;
                padding: 20px;
            }
             #message-box {
                width: calc(100% - 40px); /* Adjust width on smaller screens */
                right: 10px;
                left: 10px;
                top: 10px;
                 transform: translateY(-100%); /* Animate from top */
            }
             #message-box.show {
                transform: translateY(0);
             }
        }

    </style>
</head>
<body>

    <div id="data-management-section">
        <h2><i class="fas fa-database"></i> Data Management</h2>

        <!-- Toolbar -->
        <div class="dm-toolbar">
            <div class="dm-search-filter">
                <input type="search" id="dm-search-input" placeholder="Search data (ID, Name, etc.)...">
                <!-- *** UPDATED: Separate Filter Dropdowns *** -->
                <select id="dm-filter-status">
                    <option value="">Filter by Status...</option>
                    <option value="active">Active</option>
                    <option value="pending">Pending</option>
                    <option value="inactive">Inactive</option>
                </select>
                <select id="dm-filter-responsible">
                    <option value="">Filter by Responsible...</option>
                    <option value="Nada Mahmoud">Nada Mahmoud</option>
                    <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                    <option value="Yousef Ahmed">Yousef Ahmed</option>
                    <option value="Esraa Lashin">Esraa Lashin</option>
                    <option value="Basssant Badr">Basssant Badr</option>
                    <option value="Other">Other</option>
                </select>
                 <!-- *** END UPDATE *** -->
            </div>
            <div class="dm-actions">
                <button id="dm-add-new-btn" class="dm-add-btn"><i class="fas fa-plus"></i> Add New</button>
                <button id="dm-import-btn" class="dm-import-btn"><i class="fas fa-file-import"></i> Import</button>
                <button id="dm-export-btn" class="dm-export-btn"><i class="fas fa-file-export"></i> Export</button>
            </div>
        </div>

        <!-- Table Container -->
        <div class="dm-table-container">
            <table class="dm-table" id="dm-data-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="dm-select-all" title="Select All"></th>
                        <th>ID</th>
                        <th>Record Name</th>
                        <th>Creation Date</th>
                        <th>Responsible</th>
                        <th>Status</th>
                        <th>Last Updated</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dm-table-body">
                    <!-- Rows will be populated by JavaScript -->
                     <tr><td colspan="8" style="text-align:center; padding: 20px;">Loading data...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        <div class="dm-pagination" id="dm-pagination-controls">
             <!-- Pagination will be rendered by JavaScript -->
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="add-edit-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-close-modal>×</button>
            <h3 id="modal-title">Add New Record</h3>
            <form id="add-edit-form">
                <input type="hidden" id="edit-record-id">
                <div>
                    <label for="record-name">Record Name:</label>
                    <input type="text" id="record-name" name="recordName" required>
                </div>
                 <div>
                    <label for="responsible">Responsible:</label>
                    <select id="responsible" name="responsible" required>
                        <option value="" disabled selected>-- Select Person --</option>
                        <option value="Nada Mahmoud">Nada Mahmoud</option>
                        <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                        <option value="Yousef Ahmed">Yousef Ahmed</option>
                        <option value="Esraa Lashin">Esraa Lashin</option>
                        <option value="Basssant Badr">Basssant Badr</option>
                        <option value="Other">Other</option>
                    </select>
                 </div>
                 <div>
                    <label for="status">Status:</label>
                    <select id="status" name="status" required>
                         <option value="" disabled selected>-- Select Status --</option>
                        <option value="active">Active</option>
                        <option value="pending">Pending</option>
                        <option value="inactive">Inactive</option>
                    </select>
                 </div>
                 <!-- Creation Date and Last Updated will be handled automatically -->
                 <div class="form-actions">
                     <button type="button" class="cancel-btn" data-close-modal>Cancel</button>
                     <button type="submit" class="save-btn">Save Record</button>
                 </div>
            </form>
        </div>
    </div>

    <!-- View Modal -->
     <div id="view-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-close-modal>×</button>
            <h3>Record Details</h3>
            <dl id="view-details">
                <dt>ID:</dt>
                <dd id="view-id"></dd>
                <dt>Record Name:</dt>
                <dd id="view-name"></dd>
                <dt>Creation Date:</dt>
                <dd id="view-creation-date"></dd>
                 <dt>Responsible:</dt>
                <dd id="view-responsible"></dd>
                 <dt>Status:</dt>
                <dd id="view-status"></dd>
                 <dt>Last Updated:</dt>
                <dd id="view-last-updated"></dd>
            </dl>
             <div class="form-actions">
                 <button type="button" class="cancel-btn" data-close-modal>Close</button>
             </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-close-modal>×</button>
             <h3>Confirm Deletion</h3>
             <p id="delete-confirm-message">Are you sure you want to delete this record? This action cannot be undone.</p>
             <div class="modal-actions">
                 <button type="button" class="cancel-delete-btn" data-close-modal>Cancel</button>
                 <button type="button" id="confirm-delete-btn" class="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Message Box -->
    <div id="message-box"></div>

    <!-- Font Awesome JS Kit -->
    <script defer src="https://use.fontawesome.com/releases/v6.0.0/js/all.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- State Variables ---
            let allData = []; // Holds the master data
            let filteredData = []; // Holds data after filtering/searching
            let currentPage = 1;
            const rowsPerPage = 5; // How many rows to show per page
            let recordToDeleteId = null; // Store ID for delete confirmation
            let editingRecordId = null; // Store ID for editing

            // --- DOM Elements ---
            const tableBody = document.getElementById('dm-table-body');
            const searchInput = document.getElementById('dm-search-input');
            // *** UPDATED: Get separate filter selects ***
            const filterStatusSelect = document.getElementById('dm-filter-status');
            const filterResponsibleSelect = document.getElementById('dm-filter-responsible');
            // *** END UPDATE ***
            const paginationControls = document.getElementById('dm-pagination-controls');
            const selectAllCheckbox = document.getElementById('dm-select-all');
            const addNewBtn = document.getElementById('dm-add-new-btn');
            const importBtn = document.getElementById('dm-import-btn');
            const exportBtn = document.getElementById('dm-export-btn');

            // Modals & Messages
            const addEditModal = document.getElementById('add-edit-modal');
            const viewModal = document.getElementById('view-modal');
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const deleteConfirmMessage = document.getElementById('delete-confirm-message');
            const modalTitle = document.getElementById('modal-title');
            const addEditForm = document.getElementById('add-edit-form');
            const editRecordIdInput = document.getElementById('edit-record-id');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const messageBox = document.getElementById('message-box');

            // --- Sample Data ---
            function generateSampleData() {
                 // Added a few more diverse entries
                return [
                    { id: 1001, name: "Client File - Al Amal Co.", creationDate: "2024-05-20", responsible: "Nada Mahmoud", status: "active", lastUpdated: "2024-05-21 10:30" },
                    { id: 1002, name: "Quarterly Performance Report", creationDate: "2024-05-18", responsible: "Mohamed Elmenisy", status: "pending", lastUpdated: "2024-05-19 14:00" },
                    { id: 1003, name: "New Product Data (X Headphones)", creationDate: "2024-05-15", responsible: "Yousef Ahmed", status: "active", lastUpdated: "2024-05-16 09:15" },
                    { id: 1004, name: "Workshop Attendance List", creationDate: "2024-05-12", responsible: "Esraa Lashin", status: "inactive", lastUpdated: "2024-05-13 11:00" },
                    { id: 1005, name: "Weekly Team Meeting Notes", creationDate: "2024-05-10", responsible: "Basssant Badr", status: "active", lastUpdated: "2024-05-10 16:45" },
                    { id: 1006, name: "Supplier Contract - Beta Inc.", creationDate: "2024-05-08", responsible: "Nada Mahmoud", status: "active", lastUpdated: "2024-05-09 15:00" },
                    { id: 1007, name: "Marketing Campaign Plan Q3", creationDate: "2024-05-05", responsible: "Mohamed Elmenisy", status: "pending", lastUpdated: "2024-05-06 11:30" },
                    { id: 1008, name: "IT Equipment Inventory", creationDate: "2024-05-01", responsible: "Yousef Ahmed", status: "active", lastUpdated: "2024-05-02 17:00" },
                    { id: 1009, name: "Annual Financial Statement Prep", creationDate: "2024-04-28", responsible: "Basssant Badr", status: "pending", lastUpdated: "2024-05-20 12:00" },
                    { id: 1010, name: "Website Content Update", creationDate: "2024-04-25", responsible: "Esraa Lashin", status: "active", lastUpdated: "2024-05-18 09:00" },
                    { id: 1011, name: "Internal Audit Checklist", creationDate: "2024-05-22", responsible: "Nada Mahmoud", status: "pending", lastUpdated: "2024-05-22 15:00" },
                    { id: 1012, name: "Onboarding Docs - New Hire", creationDate: "2024-05-21", responsible: "Esraa Lashin", status: "active", lastUpdated: "2024-05-21 16:00" },
                ];
            }

            // --- Utility Functions ---
            function formatDate(dateString) {
                 if (!dateString) return 'N/A';
                const date = new Date(dateString.replace(' ', 'T')); // Ensure ISO format for parsing
                 if (isNaN(date.getTime())) return dateString; // Return original if invalid

                 const optionsDate = { year: 'numeric', month: 'short', day: 'numeric' };
                 const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: false };

                 try {
                    if (dateString.includes(':')) { // Check if time is likely present
                        return date.toLocaleDateString('en-CA', optionsDate) + ' ' + date.toLocaleTimeString('en-GB', optionsTime); // YYYY-MM-DD HH:MM
                    }
                     return date.toLocaleDateString('en-CA', optionsDate); // YYYY-MM-DD
                 } catch (e) {
                     console.error("Error formatting date:", dateString, e);
                     return dateString; // Fallback
                 }
            }

            function getCurrentDateTime() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}`;
            }

            function showMessage(message, type = 'info', duration = 3000) {
                messageBox.textContent = message;
                messageBox.className = 'message-box'; // Reset classes first
                messageBox.classList.add(type);
                messageBox.classList.add('show');

                // Auto-hide after duration
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, duration);
            }

             function openModal(modalElement) {
                 modalElement.classList.add('show'); // Use class for visibility and animation
            }

            function closeModal(modalElement) {
                modalElement.classList.remove('show');
            }

            // --- Core Logic Functions ---

            function renderTable() {
                tableBody.innerHTML = ''; // Clear existing rows
                selectAllCheckbox.checked = false; // Uncheck select-all

                if (filteredData.length === 0) {
                     tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center; padding: 20px;">No matching records found.</td></tr>`;
                     renderPagination(0); // Render empty pagination
                     return;
                }

                const totalItems = filteredData.length;
                const totalPages = Math.ceil(totalItems / rowsPerPage);
                // Adjust currentPage if it's out of bounds
                if (currentPage > totalPages && totalPages > 0) {
                    currentPage = totalPages;
                } else if (currentPage < 1) {
                    currentPage = 1;
                }

                const startIndex = (currentPage - 1) * rowsPerPage;
                const endIndex = startIndex + rowsPerPage;
                const pageData = filteredData.slice(startIndex, endIndex);

                pageData.forEach(item => {
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', item.id); // Add data-id to row

                    // Map status to CSS class
                    const statusClass = `dm-status-${item.status?.toLowerCase() || 'unknown'}`; // Added safety for null/undefined status

                    row.innerHTML = `
                        <td><input type="checkbox" class="dm-row-select" data-id="${item.id}"></td>
                        <td>#${item.id}</td>
                        <td>${item.name || 'N/A'}</td>
                        <td>${formatDate(item.creationDate)}</td>
                        <td>${item.responsible || 'N/A'}</td>
                        <td><span class="dm-status ${statusClass}">${item.status || 'N/A'}</span></td>
                        <td>${formatDate(item.lastUpdated)}</td>
                        <td class="dm-row-actions">
                            <button class="dm-view-btn" title="View Details" data-id="${item.id}"><i class="fas fa-eye fa-fw"></i></button>
                            <button class="dm-edit-btn" title="Edit Record" data-id="${item.id}"><i class="fas fa-edit fa-fw"></i></button>
                            <button class="dm-delete-btn" title="Delete Record" data-id="${item.id}"><i class="fas fa-trash-alt fa-fw"></i></button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                renderPagination(totalItems);
                attachRowEventListeners(); // Re-attach listeners for new rows/buttons
            }

            function renderPagination(totalItems) {
                paginationControls.innerHTML = ''; // Clear existing controls
                if (totalItems <= rowsPerPage) return; // No pagination needed for single page

                const totalPages = Math.ceil(totalItems / rowsPerPage);

                const prevButton = document.createElement('button');
                prevButton.id = 'dm-prev-page';
                prevButton.innerHTML = `<i class="fas fa-chevron-left"></i> Previous`;
                prevButton.disabled = currentPage === 1;
                prevButton.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        renderTable();
                    }
                });

                const pageInfo = document.createElement('span');
                pageInfo.className = 'dm-page-info';
                pageInfo.innerHTML = `Page <span class="dm-current-page">${currentPage}</span> of ${totalPages}`;

                const nextButton = document.createElement('button');
                nextButton.id = 'dm-next-page';
                nextButton.innerHTML = `Next <i class="fas fa-chevron-right"></i>`;
                nextButton.disabled = currentPage === totalPages;
                nextButton.addEventListener('click', () => {
                     if (currentPage < totalPages) {
                        currentPage++;
                        renderTable();
                    }
                });

                paginationControls.appendChild(prevButton);
                paginationControls.appendChild(pageInfo);
                paginationControls.appendChild(nextButton);
            }

             /**
             * Filters the master data based on the dropdown selection and search input.
              * *** UPDATED to use separate Status and Responsible filters ***
              * Updates the `filteredData` array.
             */
            function applyFiltersAndSearch() {
                 const searchTerm = searchInput.value.toLowerCase().trim();
                 // *** UPDATED: Get values from separate selects ***
                 const statusFilterValue = filterStatusSelect.value;
                 const responsibleFilterValue = filterResponsibleSelect.value;
                 // *** END UPDATE ***

                // Start with the full dataset
                let currentData = [...allData];

                // 1. Apply Status Filter
                if (statusFilterValue) {
                    currentData = currentData.filter(item => item.status.toLowerCase() === statusFilterValue);
                }

                 // 2. Apply Responsible Filter (on the potentially already status-filtered data)
                if (responsibleFilterValue) {
                    currentData = currentData.filter(item => item.responsible === responsibleFilterValue);
                }

                // 3. Apply Search Term Filter (on the already filtered data)
                if (searchTerm) {
                    currentData = currentData.filter(item => {
                        // Check against multiple relevant fields
                        return (
                            item.id.toString().includes(searchTerm) ||
                            (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                            (item.responsible && item.responsible.toLowerCase().includes(searchTerm))
                            // Add other fields to search if needed (e.g., creationDate)
                            // || (item.creationDate && item.creationDate.includes(searchTerm))
                        );
                    });
                }

                // Update the globally used filteredData array
                filteredData = currentData;

                currentPage = 1; // Reset to first page whenever filters change
                renderTable();
            }


             function attachRowEventListeners() {
                // Use event delegation on the table body for efficiency
                 tableBody.removeEventListener('click', handleTableBodyClick); // Remove old listener
                 tableBody.addEventListener('click', handleTableBodyClick);

                 // Separate handler for checkboxes to manage selection state
                  tableBody.querySelectorAll('.dm-row-select').forEach(checkbox => {
                    checkbox.removeEventListener('change', handleRowCheckboxChange); // Clean up previous
                    checkbox.addEventListener('change', handleRowCheckboxChange);
                 });
             }

             // Delegated event handler for table body clicks
             function handleTableBodyClick(event) {
                 const target = event.target;
                 const viewButton = target.closest('.dm-view-btn');
                 const editButton = target.closest('.dm-edit-btn');
                 const deleteButton = target.closest('.dm-delete-btn');

                 if (viewButton) {
                     handleViewClick(viewButton);
                 } else if (editButton) {
                     handleEditClick(editButton);
                 } else if (deleteButton) {
                     handleDeleteClick(deleteButton);
                 }
             }


            // --- Specific Event Handlers ---
             function handleRowCheckboxChange(event) {
                const checkbox = event.target;
                const row = checkbox.closest('tr');
                if (row) {
                    row.classList.toggle('selected-row', checkbox.checked);
                }

                // Check if all visible rows are now selected to update select-all checkbox
                const visibleCheckboxes = tableBody.querySelectorAll('.dm-row-select');
                const allVisibleChecked = visibleCheckboxes.length > 0 && [...visibleCheckboxes].every(cb => cb.checked);
                 selectAllCheckbox.checked = allVisibleChecked;
            }

             function handleViewClick(button) { // Accept button element directly
                const recordId = parseInt(button.getAttribute('data-id'));
                const record = allData.find(item => item.id === recordId);

                if (record) {
                    document.getElementById('view-id').textContent = `#${record.id}`;
                    document.getElementById('view-name').textContent = record.name || 'N/A';
                    document.getElementById('view-creation-date').textContent = formatDate(record.creationDate);
                    document.getElementById('view-responsible').textContent = record.responsible || 'N/A';
                    document.getElementById('view-last-updated').textContent = formatDate(record.lastUpdated);

                    const statusDd = document.getElementById('view-status');
                     statusDd.innerHTML = ''; // Clear previous content
                     if (record.status) {
                        const statusSpan = document.createElement('span');
                        statusSpan.textContent = record.status;
                        statusSpan.className = `dm-status dm-status-${record.status.toLowerCase()}`;
                        statusDd.appendChild(statusSpan);
                     } else {
                         statusDd.textContent = 'N/A';
                     }

                    openModal(viewModal);
                }
             }

             function handleEditClick(button) { // Accept button element directly
                editingRecordId = parseInt(button.getAttribute('data-id'));
                const record = allData.find(item => item.id === editingRecordId);

                if (record) {
                    modalTitle.textContent = `Edit Record #${record.id}`;
                    editRecordIdInput.value = record.id;
                    document.getElementById('record-name').value = record.name || '';
                    document.getElementById('responsible').value = record.responsible || '';
                    document.getElementById('status').value = record.status ? record.status.toLowerCase() : ''; // Set to '' if null/undefined to match placeholder logic
                    openModal(addEditModal);
                }
             }

            function handleDeleteClick(button) { // Accept button element directly
                recordToDeleteId = parseInt(button.getAttribute('data-id'));
                 const record = allData.find(item => item.id === recordToDeleteId);
                 if (record) {
                    deleteConfirmMessage.innerHTML = `Are you sure you want to delete record <strong>#${record.id} (${record.name || 'No Name'})</strong>? This action cannot be undone.`;
                 } else {
                     deleteConfirmMessage.textContent = `Are you sure you want to delete this record? This action cannot be undone.`;
                 }
                openModal(deleteConfirmModal);
            }

            // --- Initialization ---
            allData = generateSampleData(); // Load initial data
            applyFiltersAndSearch(); // Initial filter and render

            // --- Global Event Listeners Setup ---
            searchInput.addEventListener('input', applyFiltersAndSearch);
            // *** UPDATED: Add listeners for separate filter selects ***
            filterStatusSelect.addEventListener('change', applyFiltersAndSearch);
            filterResponsibleSelect.addEventListener('change', applyFiltersAndSearch);
            // *** END UPDATE ***

            // Select All Checkbox
            selectAllCheckbox.addEventListener('change', () => {
                const isChecked = selectAllCheckbox.checked;
                tableBody.querySelectorAll('.dm-row-select').forEach(checkbox => {
                    if (checkbox.checked !== isChecked) {
                        checkbox.checked = isChecked;
                         // Trigger change event manually to update row style if needed by handler
                         checkbox.dispatchEvent(new Event('change'));
                    }
                });
            });

            // Add New Button
            addNewBtn.addEventListener('click', () => {
                editingRecordId = null; // Ensure 'add' mode
                modalTitle.textContent = 'Add New Record';
                addEditForm.reset(); // Clear the form
                // Ensure placeholders are selected after reset
                document.getElementById('responsible').value = "";
                document.getElementById('status').value = "";
                editRecordIdInput.value = ''; // Clear hidden ID field
                openModal(addEditModal);
            });

            // Add/Edit Form Submission
             addEditForm.addEventListener('submit', (event) => {
                 event.preventDefault();
                 const formData = new FormData(addEditForm);
                 const recordName = formData.get('recordName').trim();
                 const responsible = formData.get('responsible');
                 const status = formData.get('status');
                 const now = getCurrentDateTime();

                 if (!recordName || !responsible || !status) {
                    showMessage('Please fill in all required fields (Name, Responsible, Status).', 'error');
                    return;
                 }


                 if (editingRecordId) { // --- Editing ---
                     const index = allData.findIndex(item => item.id === editingRecordId);
                     if (index !== -1) {
                         allData[index] = {
                             ...allData[index], // Keep original ID and creation date
                             name: recordName,
                             responsible: responsible,
                             status: status,
                             lastUpdated: now
                         };
                         showMessage(`Record #${editingRecordId} updated successfully!`, 'success');
                     } else {
                          showMessage('Error: Could not find record to update.', 'error');
                     }
                 } else { // --- Adding ---
                     const newId = allData.length > 0 ? Math.max(...allData.map(item => item.id)) + 1 : 1001;
                     const newRecord = {
                         id: newId,
                         name: recordName,
                         creationDate: now.split(' ')[0], // Just the date part for creation
                         responsible: responsible,
                         status: status,
                         lastUpdated: now
                     };
                     allData.push(newRecord);
                     showMessage(`Record #${newId} added successfully!`, 'success');
                 }

                 closeModal(addEditModal);
                 applyFiltersAndSearch(); // Refresh table with potentially new/updated data
                 editingRecordId = null; // Reset editing state
             });

            // Delete Confirmation
            confirmDeleteBtn.addEventListener('click', () => {
                if (recordToDeleteId !== null) {
                    const initialLength = allData.length;
                    allData = allData.filter(item => item.id !== recordToDeleteId);
                    if (allData.length < initialLength) {
                        showMessage(`Record #${recordToDeleteId} deleted successfully!`, 'success');
                    } else {
                         showMessage(`Error: Could not find record #${recordToDeleteId} to delete.`, 'error');
                    }
                    closeModal(deleteConfirmModal);
                    recordToDeleteId = null; // Reset
                    applyFiltersAndSearch(); // Refresh table (handles pagination adjustment)
                }
            });

            // Modal Close Buttons (using delegation)
             document.body.addEventListener('click', (event) => {
                if (event.target.matches('[data-close-modal]')) {
                    const modal = event.target.closest('.modal-overlay');
                    if (modal) {
                        closeModal(modal);
                    }
                 } else if (event.target.matches('.modal-overlay')) { // Click on overlay itself
                     closeModal(event.target);
                 }
             });


            // Import/Export Simulation
            importBtn.addEventListener('click', () => {
                showMessage('Import function simulated. No file processed.', 'info');
                 // You would typically trigger a file input click here:
                 // const fileInput = document.createElement('input');
                 // fileInput.type = 'file';
                 // fileInput.accept = '.csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'; // Example accepts
                 // fileInput.onchange = handleFileImport;
                 // fileInput.click();
            });

             // Placeholder function for handling file import
             // function handleFileImport(event) {
             //     const file = event.target.files[0];
             //     if (file) {
             //         console.log("File selected for import:", file.name);
             //         showMessage(`Simulating import of ${file.name}...`, 'info');
             //         // Add actual file reading/parsing logic here (e.g., using PapaParse for CSV)
             //     }
             // }


            exportBtn.addEventListener('click', () => {
                 const exportData = filteredData.length > 0 ? filteredData : allData; // Export filtered or all
                 if (exportData.length === 0) {
                     showMessage('No data available to export.', 'info');
                     return;
                 }

                 // --- Example of actual CSV download (client-side) ---
                 let csvContent = "data:text/csv;charset=utf-8,";
                 // Add header row dynamically from the first object's keys
                 const headers = Object.keys(exportData[0]);
                 csvContent += headers.join(",") + "\r\n";
                 // Add data rows
                 exportData.forEach(row => {
                     const values = headers.map(header => {
                         let cellValue = row[header] === null || row[header] === undefined ? '' : row[header];
                         // Escape double quotes and handle commas within cells
                         cellValue = String(cellValue).replace(/"/g, '""'); // Escape double quotes
                         if (String(cellValue).includes(',') || String(cellValue).includes('"') || String(cellValue).includes('\n')) {
                             cellValue = `"${cellValue}"`; // Enclose in double quotes if it contains comma, quote, or newline
                         }
                         return cellValue;
                     });
                     csvContent += values.join(",") + "\r\n";
                 });

                 const encodedUri = encodeURI(csvContent);
                 const link = document.createElement("a");
                 link.setAttribute("href", encodedUri);
                 // Generate filename with date/time
                 const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                 link.setAttribute("download", `data_export_${timestamp}.csv`);
                 document.body.appendChild(link); // Required for Firefox
                 link.click();
                 document.body.removeChild(link);
                 showMessage(`Exported ${exportData.length} records as CSV.`, 'success');
            });

        }); // End DOMContentLoaded
    </script>

</body>
</html>

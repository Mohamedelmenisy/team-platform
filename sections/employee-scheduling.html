            // --- Feature/Section Loading ---
            function setActiveFeature(featureId, settingsTab = null) {
                // ... (الكود السابق للتحقق من الصلاحيات وتحديث الحالة والقائمة الجانبية) ...

                currentFeature = featureId;
                currentSettingsTab = settingsTab || (featureId === 'settings' ? (currentSettingsTab || 'preferences') : null);

                // Update URL hash
                let hash = `#${featureId}`;
                if (featureId === 'settings' && currentSettingsTab) {
                    hash += `-${currentSettingsTab}`;
                }
                if (window.location.hash !== hash) {
                    history.pushState({ feature: featureId, tab: currentSettingsTab }, '', hash);
                }

                // Update Sidebar Menu Active State
                menuItems.forEach(item => item.classList.remove('active'));
                const activeMenuItem = document.querySelector(`.menu-item[data-feature="${featureId}"]`);
                if (activeMenuItem) activeMenuItem.classList.add('active');

                // Show/Hide Content Sections
                contentSections.forEach(section => section.classList.remove('active'));
                featureSectionsContainer.style.display = 'none';

                if (featureId === 'dashboard') {
                    dashboardContent.classList.add('active');
                    updateStats();
                    loadActivities();
                } else if (featureId === 'profile') {
                    profileContent.classList.add('active');
                    updateUserUI();
                } else if (featureId === 'settings') {
                    settingsContent.classList.add('active');
                    applyRBAC();
                    activateSettingsTab(currentSettingsTab || 'preferences');
                } else {
                    // Handle other features dynamically
                    featureSectionsContainer.style.display = 'block';
                    featureSections.innerHTML = ''; // Clear previous content
                    featureSections.appendChild(featurePlaceholder);
                    featureTitle.textContent = `Loading ${featureId.replace(/-/g, ' ')}...`;
                    featureDescription.textContent = '';
                    featureLoadingIndicator.style.display = 'block';
                    featureErrorMessage.style.display = 'none';
                    featurePlaceholder.style.display = 'flex';

                    const filePath = `sections/${featureId}.html`;

                    fetch(filePath)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status} ${response.statusText}`);
                            }
                            return response.text();
                        })
                        .then(html => {
                            featureSections.innerHTML = html; // <<<--- تم إدخال المحتوى هنا
                            featureSections.classList.add('active');

                            // !!!!! --- START OF CHANGE --- !!!!!
                            // بعد إدخال المحتوى، تحقق من وجود دالة التهيئة واستدعها
                            if (featureId === 'employee-scheduling') {
                                if (typeof initializeEmployeeSchedule === 'function') {
                                    try {
                                        initializeEmployeeSchedule(); // <<<--- استدعاء الدالة هنا
                                    } catch (err) {
                                         console.error(`Error executing initializeEmployeeSchedule:`, err);
                                         featureTitle.textContent = `Error Initializing ${featureId.replace(/-/g, ' ')}`;
                                         featureDescription.textContent = `Content loaded, but failed during initialization. Check console for details. Error: ${err.message}`;
                                         featureLoadingIndicator.style.display = 'none';
                                         featureErrorMessage.style.display = 'block';
                                    }
                                } else {
                                    console.warn(`Initialization function 'initializeEmployeeSchedule' not found for ${featureId}. Dynamic content might not be interactive.`);
                                    // يمكنك عرض رسالة تحذير للمستخدم هنا أيضاً إذا أردت
                                     featureTitle.textContent = `${featureId.replace(/-/g, ' ')} Loaded`;
                                     featureDescription.textContent = `Content loaded, but its specific script function was not found. Interaction might be limited.`;
                                      featureLoadingIndicator.style.display = 'none';
                                      featureErrorMessage.style.display = 'none'; // Not necessarily an error, but incomplete
                                }
                            }
                            // Add similar 'else if' blocks for other features needing JS initialization
                            // else if (featureId === 'some-other-feature') {
                            //    if (typeof initializeSomeOtherFeature === 'function') {
                            //        initializeSomeOtherFeature();
                            //    } else { console.warn(...); }
                            // }

                             // Hide placeholder elements that might remain if the loaded content doesn't fill everything
                             featureLoadingIndicator.style.display = 'none';
                             featureErrorMessage.style.display = 'none';
                             featurePlaceholder.style.display = 'none'; // Hide the entire placeholder div

                            // !!!!! --- END OF CHANGE --- !!!!!

                        })
                        .catch(error => {
                            console.error(`Error loading feature '${featureId}' from '${filePath}':`, error);
                            featureTitle.textContent = `Error Loading ${featureId.replace(/-/g, ' ')}`;
                            featureDescription.textContent = `Could not load content. Please check the file path ('${filePath}') and ensure the file exists and the server is configured correctly. Error: ${error.message}`;
                            featureLoadingIndicator.style.display = 'none';
                            featureErrorMessage.style.display = 'block';
                            featurePlaceholder.style.display = 'flex'; // Keep placeholder visible for error
                            featureSections.classList.add('active');
                        });
                }

                // Show/Hide Back Button
                backButton.style.display = featureId !== 'dashboard' ? 'inline-flex' : 'none';

                window.scrollTo(0, 0);
            }

            // ... (بقية كود dash.html) ...

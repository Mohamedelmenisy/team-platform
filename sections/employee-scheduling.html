<!-- Note: Removed DOCTYPE, html, head, body tags -->
<!-- Note: Removed <header> section as it's provided by dash.html -->

<!-- Styles specific to Employee Scheduling -->
<!-- Note: Removed :root and potentially conflicting global styles. -->
<!-- Consider scoping these styles further if needed (e.g., using a parent class) -->
<style>
    /* Styles specific to this section (employee schedule) */
    .employee-schedule-body { /* Use a more specific class or ID for the container if needed */
        /* background-color: var(--light); Applied by dash.html */
        /* color: var(--dark); Applied by dash.html */
        /* Add padding if needed, though dash.html's .content-section likely provides it */
    }

    /* Main Content Styling Adjustments */
    .employee-schedule-body .main-container {
        max-width: 100%; /* Take full width within the dashboard content area */
        margin: 0; /* Reset margin */
        padding: 0; /* Reset padding, rely on dash.html's .content-section */
    }

    .employee-schedule-body .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem; /* Adjusted margin */
        flex-wrap: wrap;
        gap: 1rem;
    }

    .employee-schedule-body .page-title {
        font-size: 1.5rem; /* Adjusted size */
        color: var(--primary-dark);
        font-weight: 600; /* Adjusted weight */
    }

    /* Schedule Controls */
    .employee-schedule-body .schedule-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        background-color: var(--white);
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        flex-wrap: wrap;
        gap: 1rem;
    }

    .employee-schedule-body .week-navigation {
        display: flex;
        align-items: center;
        gap: 0.75rem; /* Adjusted gap */
    }

    .employee-schedule-body .week-display {
        font-weight: 600;
        min-width: 180px;
        text-align: center;
        color: var(--dark); /* Ensure text color matches theme */
    }

    /* Use button styles from main dashboard (.btn, .btn-primary, etc.) */
    /* No need to redefine .btn styles here if dash.html defines them globally */

    /* Schedule Table */
    .employee-schedule-body .schedule-container {
        background-color: var(--white);
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
    }

    .employee-schedule-body .schedule-table {
        width: 100%;
        border-collapse: separate; /* Changed from collapse for spacing */
        border-spacing: 0 0px; /* Add spacing between rows */
        margin-top: 0px; /* Add space above table */
    }

    .employee-schedule-body .schedule-table thead th {
        padding: 0.8rem 0.5rem; /* Adjusted padding */
        text-align: center;
        background-color: var(--primary); /* Use dashboard variable */
        color: white;
        font-weight: 600;
        position: sticky;
        top: 0; /* Might need adjustment based on dashboard's sticky nav height */
        z-index: 10; /* Ensure header stays above content */
        border-bottom: 2px solid var(--primary-dark); /* Add bottom border */
    }
    /* Add top borders to first row headers */
    .employee-schedule-body .schedule-table thead tr:first-child th:first-child { border-top-left-radius: 8px; }
    .employee-schedule-body .schedule-table thead tr:first-child th:last-child { border-top-right-radius: 8px; }


    .employee-schedule-body .schedule-table tbody td {
        padding: 0.75rem 0.5rem; /* Adjusted padding */
        text-align: center;
        background-color: var(--white); /* Use variable */
        border: none; /* Remove individual cell borders */
        border-bottom: 1px solid var(--light-gray); /* Add bottom border for row separation */
        color: var(--dark); /* Ensure text color */
        vertical-align: middle; /* Align content vertically */
    }

    .employee-schedule-body .schedule-table tbody tr:last-child td {
        border-bottom: none; /* Remove bottom border for last row */
    }
     /* Add left/right borders to first/last cell */
     .employee-schedule-body .schedule-table tbody td:first-child { border-left: 1px solid var(--light-gray); }
     .employee-schedule-body .schedule-table tbody td:last-child { border-right: 1px solid var(--light-gray); }
     /* Round corners for first/last cell of last row */
     .employee-schedule-body .schedule-table tbody tr:last-child td:first-child { border-bottom-left-radius: 8px; }
     .employee-schedule-body .schedule-table tbody tr:last-child td:last-child { border-bottom-right-radius: 8px; }


    .employee-schedule-body .employee-name {
        font-weight: 500; /* Adjusted weight */
        text-align: left;
        position: sticky;
        left: 0;
        background-color: var(--white); /* Ensure sticky header has background */
        padding: 0.75rem 1rem; /* Adjusted padding */
        white-space: nowrap;
        z-index: 5; /* Lower than header */
        border-right: 1px solid var(--light-gray); /* Separator line */
    }

    /* Employee name colors - These can stay as they are specific */
    .employee-schedule-body .employee-1 { color: #3b82f6; }
    .employee-schedule-body .employee-2 { color: #10b981; }
    .employee-schedule-body .employee-3 { color: #8b5cf6; }
    .employee-schedule-body .employee-4 { color: #ec4899; }
    .employee-schedule-body .employee-5 { color: #f59e0b; }
    .employee-schedule-body .employee-6 { color: #14b8a6; }

    /* Shift Styles */
    .employee-schedule-body .shift {
        padding: 0.3rem 0.6rem; /* Adjusted padding */
        border-radius: 4px;
        font-size: 0.8rem; /* Adjusted size */
        font-weight: 500;
        white-space: nowrap;
        display: inline-block; /* Ensure it takes space */
    }

    .employee-schedule-body .shift-morning { background-color: #dbeafe; color: #1e40af; }
    .employee-schedule-body .shift-afternoon { background-color: #e0f2fe; color: #0c4a6e; }
    .employee-schedule-body .shift-night { background-color: #ede9fe; color: #5b21b6; }
    .employee-schedule-body .day-off { background-color: #f0fdf4; color: #166534; }
    .employee-schedule-body .sick-leave { background-color: #fee2e2; color: #991b1b; }
    .employee-schedule-body .vacation { background-color: #ffedd5; color: #9a3412; }

    /* Compact day headers */
    .employee-schedule-body .day-header {
        display: flex;
        flex-direction: column;
        gap: 0.15rem; /* Adjusted gap */
        align-items: center; /* Center header content */
    }

    .employee-schedule-body .day-name {
        font-weight: 600;
        font-size: 0.85rem; /* Adjusted size */
    }

    .employee-schedule-body .day-date {
        font-size: 0.75rem; /* Adjusted size */
        opacity: 0.8; /* Adjusted opacity */
    }

    /* Modal Styles (Rely on dash.html modals if possible, otherwise prefix IDs) */
    /* Example prefixing: #schedule-employeeModal, #schedule-shiftModal */
    .employee-schedule-body .modal { /* If using separate modals */
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6); /* Darker backdrop */
        z-index: 1050; /* Ensure above dashboard content */
        justify-content: center;
        align-items: center;
    }

    .employee-schedule-body .modal-content {
        background-color: var(--white);
        width: 90%;
        max-width: 500px; /* Slightly smaller max-width */
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        padding: 1.5rem; /* Adjusted padding */
        max-height: 90vh;
        overflow-y: auto;
    }

    .employee-schedule-body .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem; /* Add padding */
        border-bottom: 1px solid var(--light-gray); /* Add separator */
    }

    .employee-schedule-body .modal-title {
        font-size: 1.25rem; /* Adjusted size */
        font-weight: 600;
        color: var(--dark); /* Use theme color */
    }

    .employee-schedule-body .close-modal {
        background: none;
        border: none;
        font-size: 1.75rem; /* Larger close button */
        cursor: pointer;
        color: var(--gray);
        line-height: 1;
        padding: 0;
    }
     .employee-schedule-body .close-modal:hover {
         color: var(--dark);
     }

    .employee-schedule-body .form-group {
        margin-bottom: 1rem; /* Adjusted margin */
    }

    .employee-schedule-body .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--dark);
        font-size: 0.9rem; /* Smaller label */
    }

    .employee-schedule-body .form-control {
        width: 100%;
        padding: 0.6rem 0.75rem; /* Adjusted padding */
        border: 1px solid var(--light-gray);
        border-radius: 6px;
        font-size: 0.95rem; /* Adjusted size */
        background-color: var(--white); /* Theme support */
        color: var(--dark); /* Theme support */
    }
    .employee-schedule-body .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
     .employee-schedule-body .form-control[readonly] {
         background-color: var(--light-gray);
         cursor: not-allowed;
     }
     .employee-schedule-body textarea.form-control {
         min-height: 80px;
     }

    .employee-schedule-body .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem; /* Adjusted gap */
        margin-top: 1.5rem; /* Adjusted margin */
        padding-top: 1rem; /* Add padding */
        border-top: 1px solid var(--light-gray); /* Add separator */
    }

    /* Admin Controls */
    .employee-schedule-body .admin-controls {
        position: relative; /* Keep for positioning edit button if needed */
        padding: 0.75rem 0.5rem; /* Match cell padding */
        display: flex; /* Use flex for alignment */
        flex-direction: column; /* Stack shift and edit button */
        align-items: center;
        justify-content: center;
        min-height: 50px; /* Ensure minimum height */
    }

    .employee-schedule-body .edit-shift {
        cursor: pointer;
        color: var(--primary);
        font-size: 0.75rem; /* Smaller edit text */
        display: none; /* Hide by default, shown on hover by JS if admin */
        margin-top: 0.25rem;
        opacity: 0.7;
        transition: opacity 0.2s;
    }
     .employee-schedule-body .edit-shift:hover {
         opacity: 1;
         text-decoration: underline;
     }

    /* Show edit button on cell hover if admin */
    .employee-schedule-body .admin-controls:hover .edit-shift.admin-visible {
        display: inline;
    }


    /* Confirmation Dialog (Rely on dash.html's #confirmModal if possible) */
    .employee-schedule-body .confirmation-dialog { /* If using separate dialog */
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 1100; /* Above modals */
        justify-content: center;
        align-items: center;
    }

    .employee-schedule-body .dialog-content {
        background-color: var(--white);
        width: 90%;
        max-width: 380px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        padding: 1.5rem; /* Adjusted padding */
        text-align: center;
    }

    .employee-schedule-body .dialog-message {
        margin-bottom: 1.5rem;
        font-size: 1rem; /* Adjusted size */
        color: var(--dark);
        line-height: 1.5;
    }

    .employee-schedule-body .dialog-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    /* Responsive Design Adjustments */
    @media (max-width: 768px) {
        .employee-schedule-body .schedule-controls {
            flex-direction: column;
            gap: 1rem;
            align-items: stretch; /* Stretch items */
        }
         .employee-schedule-body .week-navigation {
             justify-content: space-between; /* Space out nav buttons */
             width: 100%;
         }
         .employee-schedule-body .schedule-controls > .btn-primary {
             width: 100%; /* Full width save button */
             justify-content: center;
         }

        .employee-schedule-body .page-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem; /* Reduced gap */
            margin-bottom: 1.5rem;
        }
         .employee-schedule-body .page-header > div { /* Button container */
             width: 100%;
             display: flex;
             gap: 0.5rem;
         }
          .employee-schedule-body .page-header > div > .btn {
              flex-grow: 1; /* Make buttons share space */
              justify-content: center;
          }

        .employee-schedule-body .employee-name {
            position: static; /* Unstick on mobile */
            border-right: none;
            border-bottom: 1px solid var(--light-gray); /* Add bottom border */
            text-align: center;
            font-weight: 600;
             background-color: #f8fafc; /* Slight background difference */
        }
        .employee-schedule-body .schedule-table tbody td:first-child {
            border-left: none;
        }
         .employee-schedule-body .schedule-table tbody td {
             display: block; /* Stack cells vertically */
             width: 100%;
             text-align: right; /* Align content to the right */
             padding-left: 50%; /* Create space for label */
             position: relative;
             border-bottom: 1px solid var(--light-gray);
         }
          .employee-schedule-body .schedule-table tbody td:last-child {
              border-bottom: 2px solid var(--dark); /* Thicker border after last day */
          }
         .employee-schedule-body .schedule-table tbody td::before {
             content: attr(data-label); /* Use data-label for day */
             position: absolute;
             left: 10px;
             width: calc(50% - 20px);
             padding-right: 10px;
             white-space: nowrap;
             text-align: left;
             font-weight: bold;
             color: var(--gray);
         }
          .employee-schedule-body .schedule-table tbody td.employee-name {
              display: table-cell; /* Keep name cell normal */
              width: auto;
              text-align: left;
              padding-left: 1rem;
              position: sticky; /* Try keeping name sticky if possible */
              left:0;
              background-color: var(--light);
              z-index: 5;
          }
         .employee-schedule-body .schedule-table tbody td.employee-name::before {
             content: none; /* Remove pseudo-label */
         }
         /* Hide the table header on mobile */
         .employee-schedule-body .schedule-table thead {
             display: none;
         }
          /* Adjust admin controls for stacked view */
         .employee-schedule-body .admin-controls {
             min-height: auto;
             padding: 0.5rem 10px 0.5rem 50%; /* Adjust padding */
             flex-direction: row; /* Place shift and edit side-by-side */
             justify-content: flex-end; /* Align to the right */
             align-items: center;
             gap: 0.5rem;
         }
         .employee-schedule-body .edit-shift {
             margin-top: 0;
         }

    }
    @media (max-width: 480px) {
         .employee-schedule-body .page-title {
             font-size: 1.3rem;
         }
         .employee-schedule-body .shift {
             font-size: 0.75rem;
             padding: 0.2rem 0.4rem;
         }
          .employee-schedule-body .edit-shift {
              font-size: 0.7rem;
          }
          .employee-schedule-body .modal-content {
              padding: 1rem;
          }
           .employee-schedule-body .form-actions {
               flex-direction: column;
               gap: 0.5rem;
           }
            .employee-schedule-body .form-actions .btn {
                width: 100%;
                justify-content: center;
            }
    }
</style>

<!-- This container will be inserted into dash.html's #featureSections -->
<div class="employee-schedule-body">
    <!-- Main Content (Removed header) -->
    <div class="main-container">
        <div class="page-header">
            <h1 class="page-title">Employee Schedule</h1>
            <div>
                <!-- Buttons might be controlled by dash.html permissions -->
                <button class="btn btn-primary" id="schedule-addEmployeeBtn"> <!-- Prefixed ID -->
                    <i class="fas fa-plus"></i> Add Employee
                </button>
                <button class="btn btn-secondary" id="schedule-sendRemindersBtn" style="background-color: var(--secondary);"> <!-- Prefixed ID -->
                    <i class="fas fa-envelope"></i> Send Reminders
                </button>
            </div>
        </div>

        <!-- Schedule Controls -->
        <div class="schedule-controls">
            <div class="week-navigation">
                <button class="btn btn-outline" id="schedule-prevWeekBtn"> <!-- Prefixed ID -->
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="week-display" id="schedule-weekDisplay">Loading...</div> <!-- Prefixed ID -->
                <button class="btn btn-outline" id="schedule-nextWeekBtn"> <!-- Prefixed ID -->
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <button class="btn btn-primary" id="schedule-saveScheduleBtn"> <!-- Prefixed ID -->
                <i class="fas fa-save"></i> Save Schedule
            </button>
        </div>

        <!-- Schedule Table -->
        <div class="schedule-container">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <!-- Headers will be populated by JS -->
                        <th>Employee</th>
                        <th>Mon</th>
                        <th>Tue</th>
                        <th>Wed</th>
                        <th>Thu</th>
                        <th>Fri</th>
                        <th>Sat</th>
                        <th>Sun</th>
                    </tr>
                </thead>
                <tbody id="schedule-table-body"> <!-- Added ID for JS targeting -->
                    <!-- Employee rows will be populated by JS -->
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">Loading schedule...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <!-- Consider using the main dashboard's modal system if possible -->
    <div class="modal" id="schedule-employeeModal"> <!-- Prefixed ID -->
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Employee</h2>
                <button class="close-modal" id="schedule-closeEmployeeModal">×</button> <!-- Prefixed ID -->
            </div>
            <form id="schedule-employeeForm"> <!-- Prefixed ID -->
                <div class="form-group">
                    <label for="schedule-empName">Full Name</label>
                    <input type="text" id="schedule-empName" class="form-control" required> <!-- Prefixed ID -->
                </div>
                <div class="form-group">
                    <label for="schedule-empEmail">Email</label>
                    <input type="email" id="schedule-empEmail" class="form-control" required> <!-- Prefixed ID -->
                </div>
                <!-- Removed Position and Role as these might come from main user data -->
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" id="schedule-cancelEmployeeBtn">Cancel</button> <!-- Prefixed ID -->
                    <button type="submit" class="btn btn-primary">Add Employee</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Shift Modal -->
    <div class="modal" id="schedule-shiftModal"> <!-- Prefixed ID -->
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Shift</h2>
                <button class="close-modal" id="schedule-closeShiftModal">×</button> <!-- Prefixed ID -->
            </div>
            <form id="schedule-shiftForm"> <!-- Prefixed ID -->
                <div class="form-group">
                    <label for="schedule-shiftEmployee">Employee</label>
                    <input type="text" id="schedule-shiftEmployee" class="form-control" readonly> <!-- Prefixed ID -->
                </div>
                <div class="form-group">
                    <label for="schedule-shiftDate">Date</label>
                    <input type="date" id="schedule-shiftDate" class="form-control" required> <!-- Prefixed ID -->
                </div>
                <div class="form-group">
                    <label for="schedule-shiftType">Shift Type</label>
                    <select id="schedule-shiftType" class="form-control" required> <!-- Prefixed ID -->
                        <option value="morning">Morning (9AM-5PM)</option>
                        <option value="afternoon">Afternoon (12PM-8PM)</option>
                        <option value="night">Night (5PM-1AM)</option>
                        <option value="day-off">Day Off</option>
                        <option value="sick-leave">Sick Leave</option>
                        <option value="vacation">Vacation</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group" id="schedule-customShiftGroup" style="display: none;"> <!-- Prefixed ID -->
                    <label for="schedule-customShift">Custom Shift Times</label>
                    <input type="text" id="schedule-customShift" class="form-control" placeholder="e.g., 10AM-6PM"> <!-- Prefixed ID -->
                </div>
                <div class="form-group">
                    <label for="schedule-shiftNotes">Notes</label>
                    <textarea id="schedule-shiftNotes" class="form-control" rows="3"></textarea> <!-- Prefixed ID -->
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="schedule-deleteShiftBtn">Delete Shift</button> <!-- Prefixed ID -->
                    <button type="button" class="btn btn-outline" id="schedule-cancelShiftBtn">Cancel</button> <!-- Prefixed ID -->
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <!-- Use dash.html's #confirmModal instead -->
    <!-- <div class="confirmation-dialog" id="schedule-confirmationDialog"> ... </div> -->

</div> <!-- End of .employee-schedule-body -->


<script>
    // Wrap all code in an initialization function
    // NOW ACCEPTS ARGUMENTS: dashboardCurrentUser, dashboardTeamMembers
    function initializeEmployeeSchedule(dashboardCurrentUser, dashboardTeamMembers) {
        console.log("Initializing Employee Schedule Section with passed data...");
        console.log("Received User:", dashboardCurrentUser);
        console.log("Received Team Members:", dashboardTeamMembers);

        const scheduleContainer = document.querySelector('.employee-schedule-body');
        if (!scheduleContainer) {
            console.error("Employee Schedule container not found!");
            return;
        }

        // DOM Elements (Use querySelector within the container for better scoping)
        const employeeModal = scheduleContainer.querySelector('#schedule-employeeModal');
        const shiftModal = scheduleContainer.querySelector('#schedule-shiftModal');
        // Use the main dashboard's confirmation modal
        // Ensure these IDs exist in dash.html
        const confirmationDialog = document.getElementById('confirmModal');
        const dialogTitle = document.getElementById('confirmTitle');
        const dialogMessage = document.getElementById('confirmMessage');
        const confirmBtn = document.getElementById('confirmBtn');
        const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
        // Also need main dashboard's success message element and hide function
        const successMessageEl = document.getElementById('successMessage'); // Assuming this exists in dash.html
        const hideConfirmModal = window.hideConfirmModal; // Assuming dash.html defines this globally
        const showConfirmModalFromDash = window.showConfirmModal; // Assuming dash.html defines this globally
        const showSuccessMessageFromDash = window.showSuccessMessage; // Assuming dash.html defines this globally


        // Find schedule-specific elements using the container
        const addEmployeeBtn = scheduleContainer.querySelector('#schedule-addEmployeeBtn');
        const sendRemindersBtn = scheduleContainer.querySelector('#schedule-sendRemindersBtn');
        const closeEmployeeModal = scheduleContainer.querySelector('#schedule-closeEmployeeModal');
        const closeShiftModal = scheduleContainer.querySelector('#schedule-closeShiftModal');
        const cancelEmployeeBtn = scheduleContainer.querySelector('#schedule-cancelEmployeeBtn');
        const cancelShiftBtn = scheduleContainer.querySelector('#schedule-cancelShiftBtn');
        const employeeForm = scheduleContainer.querySelector('#schedule-employeeForm');
        const shiftForm = scheduleContainer.querySelector('#schedule-shiftForm');
        const shiftTypeSelect = scheduleContainer.querySelector('#schedule-shiftType');
        const customShiftGroup = scheduleContainer.querySelector('#schedule-customShiftGroup');
        const customShiftInput = scheduleContainer.querySelector('#schedule-customShift');
        const deleteShiftBtn = scheduleContainer.querySelector('#schedule-deleteShiftBtn');
        const prevWeekBtn = scheduleContainer.querySelector('#schedule-prevWeekBtn');
        const nextWeekBtn = scheduleContainer.querySelector('#schedule-nextWeekBtn');
        const weekDisplay = scheduleContainer.querySelector('#schedule-weekDisplay');
        const saveScheduleBtn = scheduleContainer.querySelector('#schedule-saveScheduleBtn');
        const scheduleTableBody = scheduleContainer.querySelector('#schedule-table-body');
        const shiftEmployeeInput = scheduleContainer.querySelector('#schedule-shiftEmployee');
        const shiftDateInput = scheduleContainer.querySelector('#schedule-shiftDate');
        const shiftNotesInput = scheduleContainer.querySelector('#schedule-shiftNotes');

        // State variables for the schedule section
        // ** Use the passed arguments directly **
        let scheduleCurrentUser = dashboardCurrentUser || { role: 'employee' }; // Use passed or default
        let scheduleEmployees = Array.isArray(dashboardTeamMembers) ? dashboardTeamMembers : []; // Use passed or empty array
        let scheduleCurrentWeekStart = new Date();
        let scheduleSavedData = {};

        const scheduleMinDate = new Date(2025, 4, 1); // May 1, 2025
        const scheduleMaxDate = new Date(2025, 4, 31); // May 31, 2025

        // --- Helper Functions ---

        function formatDateKey(date) {
             if (!(date instanceof Date)) { date = new Date(date); }
             if (isNaN(date.getTime())) { console.error("Invalid date:", date); return null; }
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Wrapper for showing confirmation using the dashboard's system
        function showScheduleConfirmation(config) {
            if (typeof showConfirmModalFromDash === 'function') {
                // Directly call the dashboard's function, passing the config
                // It should handle setting title, message, buttons, callbacks, and showing the modal
                showConfirmModalFromDash(config);
            } else {
                 console.warn("Dashboard confirmation modal function 'showConfirmModal' not found. Using basic confirm.");
                 if (confirm(config.message)) { // Basic confirm dialog
                     if (config.onConfirm) config.onConfirm();
                 } else {
                     if (config.onCancel) config.onCancel();
                 }
            }
        }

        // Wrapper for showing success messages using the dashboard's system
         function showScheduleSuccess(message) {
              if (typeof showSuccessMessageFromDash === 'function') {
                  showSuccessMessageFromDash(message);
              } else {
                  alert(message); // Fallback
              }
         }

        // --- UI Update Functions ---
        function updateWeekDisplayUI() {
            const weekEnd = new Date(scheduleCurrentWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);

            const options = { month: 'short', day: 'numeric' };
            const startStr = scheduleCurrentWeekStart.toLocaleDateString('en-US', options);
            const endStr = weekEnd.toLocaleDateString('en-US', options);
            const year = scheduleCurrentWeekStart.getFullYear();

            if(weekDisplay) weekDisplay.textContent = `${startStr} - ${endStr}, ${year}`;

            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const headerRow = scheduleContainer.querySelector('.schedule-table thead tr');
            if (!headerRow) { console.error("Schedule header row not found!"); return; }
            headerRow.innerHTML = '<th>Employee</th>';

            const tempDate = new Date(scheduleCurrentWeekStart);
            days.forEach(dayName => {
                const th = document.createElement('th');
                const dateStr = tempDate.toLocaleDateString('en-US', { day: 'numeric' });
                const monthStr = tempDate.toLocaleDateString('en-US', { month: 'short' });
                th.innerHTML = `
                    <div class="day-header">
                        <span class="day-name">${dayName}</span>
                        <span class="day-date">${monthStr} ${dateStr}</span>
                    </div>
                `;
                headerRow.appendChild(th);
                tempDate.setDate(tempDate.getDate() + 1);
            });

            const prevWeek = new Date(scheduleCurrentWeekStart);
            prevWeek.setDate(prevWeek.getDate() - 7);
            if(prevWeekBtn) prevWeekBtn.disabled = prevWeek < scheduleMinDate;

            const nextWeekEnd = new Date(scheduleCurrentWeekStart);
            nextWeekEnd.setDate(nextWeekEnd.getDate() + 7);
             if(nextWeekBtn) nextWeekBtn.disabled = nextWeekEnd > scheduleMaxDate;
        }

        function renderScheduleTable() {
             if (!scheduleTableBody) { console.error("scheduleTableBody not found!"); return; }
            scheduleTableBody.innerHTML = '';

            console.log("Rendering table with employees:", scheduleEmployees);

            if (!Array.isArray(scheduleEmployees) || scheduleEmployees.length === 0) {
                 scheduleTableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">No employees found. Use Team Management to add members.</td></tr>`;
                 return;
            }

            const isAdminOrSupervisor = scheduleCurrentUser.role === 'admin' || scheduleCurrentUser.role === 'supervisor';
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

            scheduleEmployees.forEach((employee, index) => {
                 if (!employee || typeof employee !== 'object' || !employee.id || !employee.name) {
                    console.warn("Skipping invalid employee data:", employee);
                    return;
                 }

                const tr = document.createElement('tr');
                // Use a unique class based on the loop index for potential styling needs
                tr.innerHTML = `<td class="employee-name employee-${(index % 6) + 1}">${employee.name}</td>`; // Cycle through 6 colors

                const tempDate = new Date(scheduleCurrentWeekStart);
                days.forEach((day, dayIndex) => {
                    const td = document.createElement('td');
                    td.classList.add('admin-controls'); // Keep class for potential styling/JS hooks
                    const dateKey = formatDateKey(tempDate);

                    if (!dateKey) {
                         console.error("Failed to generate dateKey for date:", tempDate);
                         td.textContent = 'Error';
                         tr.appendChild(td);
                         tempDate.setDate(tempDate.getDate() + 1);
                         return;
                    }
                    td.dataset.label = `${days[dayIndex].toUpperCase()} (${tempDate.toLocaleDateString('en-us', {month:'short', day:'numeric'})})`;

                    const empKey = `emp-${employee.id}`;
                    let shiftText = '';
                    let shiftClass = '';
                    let notes = '';

                    // Check saved data first
                    if (scheduleSavedData[empKey] && scheduleSavedData[empKey][dateKey]) {
                        const shiftData = scheduleSavedData[empKey][dateKey];
                        shiftText = shiftData.text;
                        shiftClass = shiftData.class;
                        notes = shiftData.notes || '';
                    } else if (scheduleCurrentWeekStart.getTime() === new Date(2025, 4, 5).getTime()) {
                        // Fallback to hardcoded default shifts ONLY for the specific first week (May 5th, 2025)
                         // This matches the original static HTML for the first week view
                         const defaultShifts = {
                            1: ["9AM-5PM","9AM-5PM","12PM-8PM","9AM-5PM","OFF","5PM-1AM","5PM-1AM"], // Mohamed
                            2: ["12PM-8PM","9AM-5PM","9AM-5PM","12PM-8PM","9AM-5PM","OFF","OFF"], // Yousef
                            3: ["5PM-1AM","5PM-1AM","OFF","9AM-5PM","12PM-8PM","9AM-5PM","SICK"], // Esraa
                            4: ["VAC","VAC","9AM-5PM","5PM-1AM","5PM-1AM","OFF","9AM-5PM"] // Bassant
                         };
                         const defaultShiftClasses = {
                             "9AM-5PM": "shift-morning", "12PM-8PM": "shift-afternoon", "5PM-1AM": "shift-night",
                             "OFF": "day-off", "SICK": "sick-leave", "VAC": "vacation"
                         };
                         if(defaultShifts[employee.id] && defaultShifts[employee.id][dayIndex]) {
                             shiftText = defaultShifts[employee.id][dayIndex];
                             shiftClass = defaultShiftClasses[shiftText] || 'shift-morning'; // Default style
                         }
                    }


                    if (shiftText && shiftClass) {
                        const shiftDiv = document.createElement('div');
                        shiftDiv.className = `shift ${shiftClass}`;
                        shiftDiv.textContent = shiftText;
                        shiftDiv.title = notes; // Add notes as tooltip
                         td.appendChild(shiftDiv); // Append the shift div first
                    }

                    // Add edit button/span only if admin/supervisor
                    if (isAdminOrSupervisor) {
                        const editSpan = document.createElement('span');
                        editSpan.className = 'edit-shift admin-visible';
                        editSpan.dataset.emp = employee.id;
                        editSpan.dataset.dayIndex = dayIndex;
                        editSpan.textContent = '(edit)';
                        editSpan.onclick = handleEditShiftClick; // Attach listener
                        td.appendChild(editSpan); // Append the edit span after the shift div
                    }

                    tr.appendChild(td);
                    tempDate.setDate(tempDate.getDate() + 1);
                });
                scheduleTableBody.appendChild(tr);
            });
        }


        function updateShiftDisplayUI(empId, dateKey, shiftText, shiftClass, notes = '') {
             if (!dateKey || typeof dateKey !== 'string' || !dateKey.match(/^\d{4}-\d{2}-\d{2}$/)) {
                  console.error("Invalid dateKey:", dateKey); return;
             }
             const dateObj = new Date(dateKey + 'T00:00:00');
             if (isNaN(dateObj.getTime())) { console.error("Invalid date:", dateKey); return; }

             const weekStart = new Date(scheduleCurrentWeekStart);
             const diffTime = dateObj.getTime() - weekStart.getTime();
             const dayIndex = Math.round(diffTime / (1000 * 60 * 60 * 24));

             if (dayIndex >= 0 && dayIndex <= 6) {
                  // Find the row corresponding to the employee ID more reliably
                  const employeeRow = Array.from(scheduleTableBody.querySelectorAll('tr')).find(row => {
                       const editBtn = row.querySelector(`.edit-shift[data-emp="${empId}"]`);
                       return !!editBtn; // Check if any edit button for this emp exists
                   });

                  if (employeeRow) {
                       const shiftCell = employeeRow.cells[dayIndex + 1]; // +1 because first cell is name
                       const editButton = shiftCell ? shiftCell.querySelector(`.edit-shift[data-emp="${empId}"][data-day-index="${dayIndex}"]`) : null;

                       if (shiftCell && editButton) {
                             const existingShift = shiftCell.querySelector('.shift');
                             if (existingShift) { existingShift.remove(); }

                             if (shiftText && shiftClass) {
                                 const shiftDiv = document.createElement('div');
                                 shiftDiv.className = `shift ${shiftClass}`;
                                 shiftDiv.textContent = shiftText;
                                 shiftDiv.title = notes || '';
                                 shiftCell.insertBefore(shiftDiv, editButton);
                             }
                        } else { console.warn(`Shift cell/edit button not found: emp ${empId}, day ${dayIndex}.`); }
                   } else { console.warn(`Employee row not found: emp ${empId}.`); }
            }
        }


        function loadShiftsForCurrentWeekUI() {
            console.log("Running loadShiftsForCurrentWeekUI()...");
            renderScheduleTable();
        }

        // --- Event Handlers ---
        function handleWeekChange(direction) {
             const newWeekStart = new Date(scheduleCurrentWeekStart);
             newWeekStart.setDate(newWeekStart.getDate() + (direction * 7));

             const checkStart = new Date(newWeekStart);
             const checkEnd = new Date(newWeekStart); checkEnd.setDate(checkEnd.getDate()+6);

             // Ensure the START of the week is within the allowed range
             if (checkStart < scheduleMinDate || checkStart > scheduleMaxDate) {
                 console.log("Navigation blocked: Week start out of allowed range.");
                 return;
             }

             scheduleCurrentWeekStart = newWeekStart;
             updateWeekDisplayUI();
             loadShiftsForCurrentWeekUI();
        }

        function handleAddEmployeeClick() {
            if (!employeeModal) return;
             employeeForm.reset();
            employeeModal.style.display = 'flex';
        }

        function handleSendRemindersClick() {
             const subject = encodeURIComponent('Upcoming Work Schedule Reminder');
             let body = `Dear Team Member,\n\nThis is a reminder of your upcoming work schedule for the week of ${weekDisplay ? weekDisplay.textContent : 'this week'}.\n\n`;
             body += `\nPlease review your shifts and let us know if you have any conflicts.\n\nBest regards,\nManagement`;
             const encodedBody = encodeURIComponent(body);

             let emails = scheduleEmployees.map(e => e.email).filter(Boolean).join(',');
             if (emails) {
                 const mailtoLink = `mailto:${emails}?subject=${subject}&body=${encodedBody}`;
                 if (mailtoLink.length > 2000) {
                    showScheduleConfirmation({
                        title: "Too Many Recipients",
                        message: "Cannot open email for all employees at once due to length limitations. Please send reminders individually or in smaller groups.",
                        confirmText: "OK",
                        confirmClass: "btn-primary"
                    });
                    return;
                 }
                 try {
                    const newWindow = window.open(mailtoLink, '_blank');
                    if(!newWindow || newWindow.closed || typeof newWindow.closed=='undefined') {
                        showScheduleConfirmation({
                            title: "Email Client Blocked?",
                            message: "Could not automatically open your email client. Please check your popup blocker settings.",
                             confirmText: "OK",
                             confirmClass: "btn-warning"
                        });
                    } else { showScheduleSuccess("Email client opened with reminders prepared."); }
                } catch (e) {
                     console.error("Error opening mailto link:", e);
                      showScheduleConfirmation({
                            title: "Email Error", message: "An error occurred while trying to open your email client.",
                             confirmText: "OK", confirmClass: "btn-danger" });
                }
             } else { showScheduleSuccess("No employee emails found."); }
        }

        function handleSaveScheduleClick() {
            showScheduleSuccess("Schedule is automatically saved after each edit.");
        }

        function handleEmployeeFormSubmit(e) {
            e.preventDefault();
            if (!employeeModal || !employeeForm) return;

            const nameInput = scheduleContainer.querySelector('#schedule-empName');
            const emailInput = scheduleContainer.querySelector('#schedule-empEmail');
            const name = nameInput.value.trim();
            const email = emailInput.value.trim();

             if (!name || !email) { alert("Please fill in both name and email."); return; }

            const newEmployee = { id: Date.now(), name: name, email: email };
            scheduleEmployees.push(newEmployee);

             if (typeof teamMembers !== 'undefined' && Array.isArray(teamMembers)) {
                  teamMembers.push(newEmployee);
                  // Try to call the main save function if it exists globally
                  if (typeof window.saveData === 'function') {
                       window.saveData();
                       console.log("Called global saveData after adding employee.");
                  } else {
                       console.warn("Global saveData function not found in dash.html.");
                  }
             }

            loadShiftsForCurrentWeekUI();
            employeeModal.style.display = 'none';
            showScheduleSuccess(`Employee ${name} added to the schedule view.`);
        }

         function handleEditShiftClick(event) {
             const target = event.target;
             const empId = parseInt(target.dataset.emp);
             const dayIndex = parseInt(target.dataset.dayIndex);

             const employee = scheduleEmployees.find(e => e.id === empId);

             if (employee && dayIndex >= 0 && dayIndex <= 6 && shiftModal) {
                 const shiftDate = new Date(scheduleCurrentWeekStart);
                 shiftDate.setDate(shiftDate.getDate() + dayIndex);
                 const dateKey = formatDateKey(shiftDate);

                 if (!dateKey) { console.error("Invalid date for edit modal:", shiftDate); return; }

                 if(shiftEmployeeInput) shiftEmployeeInput.value = employee.name;
                 if(shiftDateInput) {
                     shiftDateInput.value = dateKey;
                     shiftDateInput.min = formatDateKey(scheduleMinDate);
                     shiftDateInput.max = formatDateKey(scheduleMaxDate);
                 }

                 const empKey = `emp-${employee.id}`;
                 const savedShift = scheduleSavedData[empKey]?.[dateKey];

                 if (savedShift) {
                     if(shiftTypeSelect) shiftTypeSelect.value = savedShift.type;
                     if(customShiftGroup) customShiftGroup.style.display = savedShift.type === 'custom' ? 'block' : 'none';
                     if(customShiftInput) {
                          customShiftInput.value = savedShift.type === 'custom' ? savedShift.text : '';
                          customShiftInput.required = (savedShift.type === 'custom');
                     }
                     if(shiftNotesInput) shiftNotesInput.value = savedShift.notes || '';
                 } else {
                     if(shiftTypeSelect) shiftTypeSelect.value = 'day-off';
                     if(customShiftGroup) customShiftGroup.style.display = 'none';
                     if(customShiftInput) {
                         customShiftInput.value = '';
                         customShiftInput.required = false;
                     }
                      if(shiftNotesInput) shiftNotesInput.value = '';
                 }

                 if(shiftForm) {
                    shiftForm.dataset.empId = empId;
                    shiftForm.dataset.dateKey = dateKey;
                 }

                 shiftModal.style.display = 'flex';
             } else { console.error("Data/Elements missing for edit modal."); }
         }

        function handleShiftFormSubmit(e) {
            e.preventDefault();
            if (!shiftModal || !shiftForm) return;

            const empId = parseInt(shiftForm.dataset.empId);
            const dateKey = shiftForm.dataset.dateKey;
            const employee = scheduleEmployees.find(e => e.id === empId);

            if (!employee || !dateKey || !shiftTypeSelect || !customShiftInput || !shiftNotesInput) {
                console.error("Missing data/elements for shift form submit.");
                shiftModal.style.display = 'none'; return;
            }

            const shiftTypeValue = shiftTypeSelect.value;
            const customShiftText = customShiftInput.value.trim();
            const notes = shiftNotesInput.value.trim();
            let shiftText = '', shiftClass = '';

            switch(shiftTypeValue) {
                 case 'morning': shiftText = '9AM-5PM'; shiftClass = 'shift-morning'; break;
                 case 'afternoon': shiftText = '12PM-8PM'; shiftClass = 'shift-afternoon'; break;
                 case 'night': shiftText = '5PM-1AM'; shiftClass = 'shift-night'; break;
                 case 'day-off': shiftText = 'OFF'; shiftClass = 'day-off'; break;
                 case 'sick-leave': shiftText = 'SICK'; shiftClass = 'sick-leave'; break;
                 case 'vacation': shiftText = 'VAC'; shiftClass = 'vacation'; break;
                 case 'custom':
                     if (!customShiftText) { alert('Please enter custom shift times.'); customShiftInput.focus(); return; }
                     shiftText = customShiftText; shiftClass = 'shift-morning'; break;
                 default: console.warn("Unknown shift type:", shiftTypeValue); shiftModal.style.display = 'none'; return;
            }

            const empKey = `emp-${empId}`;
            if (!scheduleSavedData[empKey]) { scheduleSavedData[empKey] = {}; }
            scheduleSavedData[empKey][dateKey] = { type: shiftTypeValue, text: shiftText, class: shiftClass, notes: notes };
            localStorage.setItem('employeeSchedule', JSON.stringify(scheduleSavedData));

            updateShiftDisplayUI(empId, dateKey, shiftText, shiftClass, notes);

            shiftModal.style.display = 'none';
             const displayDate = new Date(dateKey + 'T00:00:00');
            showScheduleSuccess(`Shift updated for ${employee.name} on ${displayDate.toLocaleDateString()}.`);
        }

        function handleDeleteShiftClick() {
            if (!shiftModal || !shiftForm) return;

            const empId = parseInt(shiftForm.dataset.empId);
            const dateKey = shiftForm.dataset.dateKey;
            const employee = scheduleEmployees.find(e => e.id === empId);

            if (!employee || !dateKey) { console.error("Missing data for delete."); shiftModal.style.display = 'none'; return; }

            const displayDate = new Date(dateKey + 'T00:00:00');
            if (isNaN(displayDate.getTime())) { console.error("Invalid dateKey for delete:", dateKey); shiftModal.style.display = 'none'; return; }
            const formattedDate = displayDate.toLocaleDateString();

            showScheduleConfirmation({
                title: 'Delete Shift?',
                message: `Are you sure you want to delete the shift for <strong>${employee.name}</strong> on ${formattedDate}?`,
                confirmText: 'Delete',
                confirmClass: 'btn-danger',
                onConfirm: () => {
                    const empKey = `emp-${empId}`;
                    if (scheduleSavedData[empKey] && scheduleSavedData[empKey][dateKey]) {
                        delete scheduleSavedData[empKey][dateKey];
                        localStorage.setItem('employeeSchedule', JSON.stringify(scheduleSavedData));
                        updateShiftDisplayUI(empId, dateKey, '', '');
                        showScheduleSuccess(`Shift deleted for ${employee.name} on ${formattedDate}.`);
                    } else { showScheduleSuccess(`No shift found to delete for ${employee.name} on ${formattedDate}.`); }
                    // No need to hide shiftModal here, confirm modal handler hides itself
                     // shiftModal.style.display = 'none'; // Don't hide the edit modal, let user close it
                }
            });
        }

        // --- Event Listener Setup ---
        function setupScheduleEventListeners() {
            console.log("Setting up schedule event listeners...");
             if(!prevWeekBtn || !nextWeekBtn || !addEmployeeBtn || !sendRemindersBtn || !saveScheduleBtn || !employeeModal || !shiftModal) {
                 console.error("One or more essential elements for event listeners not found!");
                 return;
             }

             prevWeekBtn.addEventListener('click', () => handleWeekChange(-1));
             nextWeekBtn.addEventListener('click', () => handleWeekChange(1));

             if (scheduleCurrentUser.role === 'admin' || scheduleCurrentUser.role === 'supervisor') {
                 addEmployeeBtn.style.display = 'inline-flex';
                 sendRemindersBtn.style.display = 'inline-flex';
                 saveScheduleBtn.style.display = 'inline-flex';
                 addEmployeeBtn.addEventListener('click', handleAddEmployeeClick);
                 sendRemindersBtn.addEventListener('click', handleSendRemindersClick);
                 saveScheduleBtn.addEventListener('click', handleSaveScheduleClick);
             } else {
                 addEmployeeBtn.style.display = 'none';
                 sendRemindersBtn.style.display = 'none';
                 saveScheduleBtn.style.display = 'none';
             }

            // Modals
            if(closeEmployeeModal) closeEmployeeModal.addEventListener('click', () => employeeModal.style.display = 'none');
            if(cancelEmployeeBtn) cancelEmployeeBtn.addEventListener('click', () => employeeModal.style.display = 'none');
            if(employeeForm) employeeForm.addEventListener('submit', handleEmployeeFormSubmit);
             employeeModal.addEventListener('click', (event) => { if (event.target === employeeModal) employeeModal.style.display = 'none'; });

             if(closeShiftModal) closeShiftModal.addEventListener('click', () => shiftModal.style.display = 'none');
             if(cancelShiftBtn) cancelShiftBtn.addEventListener('click', () => shiftModal.style.display = 'none');
             if(shiftForm) shiftForm.addEventListener('submit', handleShiftFormSubmit);
             if(deleteShiftBtn) deleteShiftBtn.addEventListener('click', handleDeleteShiftClick);
             if(shiftTypeSelect) shiftTypeSelect.addEventListener('change', function() {
                 if(customShiftGroup) customShiftGroup.style.display = this.value === 'custom' ? 'block' : 'none';
                 if(customShiftInput) customShiftInput.required = (this.value === 'custom');
             });
             shiftModal.addEventListener('click', (event) => { if (event.target === shiftModal) shiftModal.style.display = 'none'; });

            console.log("Schedule event listeners attached.");
        }


        // --- Main Initialization Logic for this Section ---
        try {
            // 1. Load saved schedule data
            scheduleSavedData = JSON.parse(localStorage.getItem('employeeSchedule')) || {};
            console.log("Loaded saved schedule data:", scheduleSavedData);

            // 2. Set initial week (Clamped to May 2025)
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            let potentialWeekStart = new Date(new Date().setDate(diff));

             if (potentialWeekStart < scheduleMinDate) {
                 let may1Date = new Date(scheduleMinDate);
                 let may1Day = may1Date.getDay();
                 let may1Diff = may1Date.getDate() - may1Day + (may1Day === 0 ? -6 : 1);
                 scheduleCurrentWeekStart = new Date(may1Date.setDate(may1Diff));
                  if(scheduleCurrentWeekStart < scheduleMinDate) { scheduleCurrentWeekStart.setDate(scheduleCurrentWeekStart.getDate() + 7); }
             } else if (potentialWeekStart > scheduleMaxDate) {
                 let may31Date = new Date(scheduleMaxDate);
                 let may31Day = may31Date.getDay();
                 let may31Diff = may31Date.getDate() - may31Day + (may31Day === 0 ? -6 : 1);
                 scheduleCurrentWeekStart = new Date(may31Date.setDate(may31Diff));
             } else { scheduleCurrentWeekStart = potentialWeekStart; }
            console.log("Initial week start date:", scheduleCurrentWeekStart);


            // 3. Initial UI setup
            updateWeekDisplayUI();
            loadShiftsForCurrentWeekUI();
            setupScheduleEventListeners();

            console.log("Employee Schedule Section Initialized Successfully.");

        } catch (error) {
             console.error("Error during employee schedule initialization:", error);
             if(scheduleTableBody) {
                  scheduleTableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--danger);">Error initializing schedule. Check console.</td></tr>`;
             }
        }

    } // End of initializeEmployeeSchedule function
</script>

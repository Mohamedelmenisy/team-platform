<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">
    <!-- <link rel="manifest" href="/site.webmanifest"> --> <!-- Removed: Causes 404 if file doesn't exist -->
    <meta name="theme-color" content="#1e3a8a"> <!-- Theme color for browser UI -->

    <!-- Bootstrap 5 CSS (Needed for some Features like File Sharing) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- SweetAlert2 CSS (for Data Management, File Sharing confirm actions) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- Chart.js Library (REQUIRED for Deadline Tracker, Reports) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS Library (REQUIRED for Deadline Tracker Excel Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- PDF Export Libraries (Optional - Uncomment if implementing for Deadline Tracker, Reports) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script> -->


    <style>
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb; /* Blue 600 */
            --primary-dark: #1e3a8a; /* Blue 900 */
            --primary-light: #dbeafe; /* Blue 100 */
            --secondary: #475569; /* Slate 600 */
            --secondary-dark: #1e293b; /* Slate 800 */
            --secondary-light: #e2e8f0; /* Slate 200 */
            --success: #10b981; /* Emerald 500 */
            --success-dark: #047857; /* Emerald 700 */
            --success-light: #a7f3d0; /* Emerald 200 */
            --danger: #ef4444; /* Red 500 */
            --danger-dark: #b91c1c; /* Red 700 */
            --danger-light: #fee2e2; /* Red 100 */
            --warning: #f59e0b; /* Amber 500 */
            --warning-dark: #b45309; /* Amber 700 */
            --warning-light: #fef3c7; /* Amber 100 */
            --info: #0ea5e9; /* Sky 500 */
            --info-dark: #0369a1; /* Sky 700 */
            --info-light: #bae6fd; /* Sky 200 */

            --dark: #1e293b;  /* Default Text Color (Dark in Light Mode) */
            --light: #f8fafc; /* Light Gray 50 */
            --gray: #64748b; /* Slate 500 */
            --light-gray: #e2e8f0; /* Slate 200 */
            --white: #ffffff;

            --sidebar-width: 280px;
            --sidebar-bg: var(--primary-dark);
            --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1);
            --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1);

            --input-bg: var(--white);
            --input-border: var(--light-gray);
            --input-focus-border: var(--primary);
            --input-focus-shadow: rgba(37, 99, 235, 0.1);
            --input-text: var(--dark);
            --placeholder-text: var(--gray);

            --card-bg: var(--white);
            --card-border: var(--light-gray);
            --card-shadow: rgba(0, 0, 0, 0.05);
            --card-hover-shadow: rgba(0, 0, 0, 0.08);
            --card-radius: 8px;

            --table-header-bg: var(--light);
            --table-header-text: var(--gray);
            --table-border-color: var(--light-gray);
            --table-row-hover-bg: var(--primary-light);

            --compact-padding: 0.5rem;
            --normal-padding: 1rem;
            --spacious-padding: 1.5rem;

            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); /* Light Blue */
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); /* Light Green */
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); /* Light Yellow */
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); /* Light Red */

            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1); /* Default welcome bg */
            --dashboard-header-bg: linear-gradient(90deg, hsla(217, 91%, 60%, 1) 0%, hsla(245, 100%, 70%, 1) 100%); /* Fancy Header Gradient */

            /* High Contrast Variables */
            --hc-text: #000000;
            --hc-background: #ffffff;
            --hc-primary: #0000ff;
            --hc-secondary: #008000;
            --hc-link: #0000ee;
            --hc-border: #000000;

            /* Text Color Variable */
            --text-color: var(--dark);
            --text-muted: var(--gray);
            --heading-color: var(--dark); /* Changed from primary-dark for better consistency */

             /* Schedule specific */
             --schedule-weekend-bg: #f3f4f6;
             --schedule-weekend-text: #9ca3af;
             --shift-morning-bg: #dbeafe; --shift-morning-text: #1e40af; --shift-morning-border: #bfdbfe;
             --shift-afternoon-bg: #e0f2fe; --shift-afternoon-text: #0c4a6e; --shift-afternoon-border: #bae6fd;
             --shift-night-bg: #ede9fe; --shift-night-text: #5b21b6; --shift-night-border: #ddd6fe;
             --shift-off-bg: #f0fdf4; --shift-off-text: #166534; --shift-off-border: #bbf7d0;
             --shift-sick-bg: #fee2e2; --shift-sick-text: #991b1b; --shift-sick-border: #fecaca;
             --shift-vacation-bg: #ffedd5; --shift-vacation-text: #9a3412; --shift-vacation-border: #fed7aa;

            /* Status Badge Generic Colors */
            --status-completed-bg: var(--success-light); --status-completed-text: var(--success-dark);
            --status-inprogress-bg: var(--info-light); --status-inprogress-text: var(--info-dark);
            --status-overdue-bg: var(--danger-light); --status-overdue-text: var(--danger-dark);
            --status-pending-bg: var(--warning-light); --status-pending-text: var(--warning-dark);
            --status-active-bg: var(--info-light); --status-active-text: var(--info-dark); /* Alias */
            --status-inactive-bg: #f1f5f9; --status-inactive-text: #475569; /* Slate */
            --status-rejected-bg: var(--danger-light); --status-rejected-text: var(--danger-dark); /* Alias */
            --status-under-review-bg: var(--primary-light); --status-under-review-text: var(--primary-dark);
            --status-implemented-bg: var(--success-light); --status-implemented-text: var(--success-dark); /* Alias */
            --status-delayed-bg: var(--warning-light); --status-delayed-text: var(--warning-dark); /* Alias */

            /* Priority Badge Generic Colors */
            --priority-high-bg: var(--danger-light); --priority-high-text: var(--danger-dark);
            --priority-medium-bg: var(--warning-light); --priority-medium-text: var(--warning-dark);
            --priority-low-bg: var(--success-light); --priority-low-text: var(--success-dark);

            /* Chart Colors (Simplified) */
            --chart-color-1: var(--primary);
            --chart-color-2: var(--success);
            --chart-color-3: var(--warning);
            --chart-color-4: var(--danger);
            --chart-color-5: var(--info);
            --chart-color-6: var(--secondary);
            --chart-color-7: #a855f7; /* Purple */
        }

        /* --- Dark Theme --- */
        body.dark-theme {
            --primary: #60a5fa; /* Blue 400 */
            --primary-dark: #2563eb; /* Blue 600 */
            --primary-light: #1e3a8a; /* Blue 900 */
            --secondary: #94a3b8; /* Slate 400 */
            --secondary-dark: #e2e8f0; /* Slate 200 */
            --secondary-light: #334155; /* Slate 700 */
            --success: #4ade80; /* Green 400 */
            --success-dark: #bbf7d0; /* Green 200 */
            --success-light: #15803d; /* Green 700 */
            --danger: #f87171; /* Red 400 */
            --danger-dark: #fecaca; /* Red 200 */
            --danger-light: #b91c1c; /* Red 700 */
            --warning: #facc15; /* Yellow 400 */
            --warning-dark: #fef08a; /* Yellow 200 */
            --warning-light: #b45309; /* Amber 700 */
            --info: #38bdf8; /* Sky 400 */
            --info-dark: #bae6fd; /* Sky 200 */
            --info-light: #0369a1; /* Sky 700 */

            --dark: #e2e8f0; /* Slate 200 */
            --light: #1e293b; /* Slate 800 */
            --gray: #94a3b8; /* Slate 400 */
            --light-gray: #475569; /* Slate 600 */
            --white: #0f172a; /* Slate 900 */

            --sidebar-bg: var(--white); /* Darker sidebar */
            --sidebar-text: rgba(226, 232, 240, 0.8); /* Lighter text */
            --sidebar-hover: rgba(226, 232, 240, 0.05);
            --sidebar-active: rgba(226, 232, 240, 0.1);
            --sidebar-divider: var(--light-gray);

            --input-bg: var(--light);
            --input-border: var(--light-gray);
            --input-focus-border: var(--primary);
            --input-focus-shadow: rgba(96, 165, 250, 0.1);
            --input-text: var(--dark);
            --placeholder-text: var(--gray);

            --card-bg: var(--light);
            --card-border: var(--light-gray);
            --card-shadow: rgba(0, 0, 0, 0.1);
            --card-hover-shadow: rgba(0, 0, 0, 0.15);

            --table-header-bg: #334155; /* Slate 700 */
            --table-header-text: var(--gray);
            --table-border-color: var(--light-gray);
            --table-row-hover-bg: #475569; /* Slate 600 */

            --text-color: var(--dark);
            --text-muted: var(--gray);
            --heading-color: var(--dark);

             /* Schedule specific Dark */
             --schedule-weekend-bg: #262f3e; --schedule-weekend-text: #6b7280;
             --shift-morning-bg: #1e3a8a; --shift-morning-text: #dbeafe; --shift-morning-border: #2563eb;
             --shift-afternoon-bg: #0e7490; --shift-afternoon-text: #ecfeff; --shift-afternoon-border: #22d3ee;
             --shift-night-bg: #581c87; --shift-night-text: #f3e8ff; --shift-night-border: #a855f7;
             --shift-off-bg: #064e3b; --shift-off-text: #d1fae5; --shift-off-border: #34d399;
             --shift-sick-bg: #881337; --shift-sick-text: #fecdd3; --shift-sick-border: #fb7185;
             --shift-vacation-bg: #7c2d12; --shift-vacation-text: #ffedd5; --shift-vacation-border: #fb923c;

            /* Status Badge Dark Colors */
            --status-completed-bg: var(--success-light); --status-completed-text: var(--success-dark);
            --status-inprogress-bg: var(--info-light); --status-inprogress-text: var(--info-dark);
            --status-overdue-bg: var(--danger-light); --status-overdue-text: var(--danger-dark);
            --status-pending-bg: var(--warning-light); --status-pending-text: var(--warning-dark);
            --status-active-bg: var(--info-light); --status-active-text: var(--info-dark);
            --status-inactive-bg: var(--secondary-light); --status-inactive-text: var(--secondary-dark);
            --status-rejected-bg: var(--danger-light); --status-rejected-text: var(--danger-dark);
            --status-under-review-bg: var(--primary-light); --status-under-review-text: var(--primary-dark);
            --status-implemented-bg: var(--success-light); --status-implemented-text: var(--success-dark);
            --status-delayed-bg: var(--warning-light); --status-delayed-text: var(--warning-dark);

            /* Priority Badge Dark Colors */
            --priority-high-bg: var(--danger-light); --priority-high-text: var(--danger-dark);
            --priority-medium-bg: var(--warning-light); --priority-medium-text: var(--warning-dark);
            --priority-low-bg: var(--success-light); --priority-low-text: var(--success-dark);

            /* Chart Dark */
            --chart-background: var(--light);

            background-color: var(--white); /* Dark bg for body */
        }

        /* --- High Contrast Mode --- */
        body.high-contrast {
             --text-color: var(--hc-text);
             --text-muted: var(--hc-text);
             --heading-color: var(--hc-text);
             --light: var(--hc-background);
             --white: var(--hc-background);
             --dark: var(--hc-text);
             --gray: var(--hc-text);
             --light-gray: var(--hc-border);
             --primary: var(--hc-primary);
             --primary-dark: var(--hc-primary);
             --primary-light: #e0e0ff;
             --secondary: var(--hc-secondary);
             --success: var(--hc-secondary);
             --warning: #ffa500;
             --danger: #ff0000;
             --info: var(--hc-primary);

             --sidebar-bg: var(--hc-background); --sidebar-text: var(--hc-text); --sidebar-hover: #e0e0e0; --sidebar-active: #c0c0c0; --sidebar-divider: var(--hc-border);
             --input-bg: var(--hc-background); --input-border: var(--hc-border); --input-text: var(--hc-text); --placeholder-text: var(--hc-text);
             --card-bg: var(--hc-background); --card-border: var(--hc-border); --card-shadow: none; --card-hover-shadow: none;
             --table-header-bg: var(--hc-background); --table-header-text: var(--hc-text); --table-border-color: var(--hc-border); --table-row-hover-bg: #e0e0e0;

             --schedule-weekend-bg: #dddddd; --schedule-weekend-text: var(--hc-text);
             --shift-morning-bg: var(--hc-background); --shift-morning-text: var(--hc-text); --shift-morning-border: var(--hc-border);
             --shift-afternoon-bg: var(--hc-background); --shift-afternoon-text: var(--hc-text); --shift-afternoon-border: var(--hc-border);
             --shift-night-bg: var(--hc-background); --shift-night-text: var(--hc-text); --shift-night-border: var(--hc-border);
             --shift-off-bg: var(--hc-background); --shift-off-text: var(--hc-text); --shift-off-border: var(--hc-border);
             --shift-sick-bg: var(--hc-background); --shift-sick-text: var(--hc-text); --shift-sick-border: var(--hc-border);
             --shift-vacation-bg: var(--hc-background); --shift-vacation-text: var(--hc-text); --shift-vacation-border: var(--hc-border);

             /* Status/Priority Badges HC */
             --status-completed-bg: transparent; --status-completed-text: var(--hc-secondary);
             --status-inprogress-bg: transparent; --status-inprogress-text: var(--hc-primary);
             --status-overdue-bg: transparent; --status-overdue-text: var(--danger);
             --status-pending-bg: transparent; --status-pending-text: var(--hc-text);
             --status-active-bg: transparent; --status-active-text: var(--hc-primary);
             --status-inactive-bg: transparent; --status-inactive-text: var(--hc-text);
             --status-rejected-bg: transparent; --status-rejected-text: var(--danger);
             --status-under-review-bg: transparent; --status-under-review-text: var(--hc-primary);
             --status-implemented-bg: transparent; --status-implemented-text: var(--hc-secondary);
             --status-delayed-bg: transparent; --status-delayed-text: var(--warning);
             --priority-high-bg: transparent; --priority-high-text: var(--danger);
             --priority-medium-bg: transparent; --priority-medium-text: var(--warning);
             --priority-low-bg: transparent; --priority-low-text: var(--hc-secondary);

             --chart-background: var(--hc-background);

             background-color: var(--hc-background);
        }
        /* Specific High Contrast Overrides */
        body.high-contrast .welcome-section,
        body.high-contrast .stat-card,
        body.high-contrast .top-nav,
        body.high-contrast .sidebar,
        body.high-contrast .activity-section,
        body.high-contrast .content-section,
        body.high-contrast .modal-content,
        body.high-contrast .confirm-container,
        body.high-contrast .notifications-container,
        body.high-contrast #featureSectionsContainer .card,
        body.high-contrast #featureSectionsContainer .filters-section,
        body.high-contrast #featureSectionsContainer .upload-area,
        body.high-contrast #featureSectionsContainer .chart-container,
        body.high-contrast #featureSectionsContainer .pt-reminders,
        body.high-contrast #featureSectionsContainer .pt-table-container,
        body.high-contrast #featureSectionsContainer .ra-table-container,
        body.high-contrast #featureSectionsContainer .team-members-section,
        body.high-contrast #featureSectionsContainer .team-member-card,
        body.high-contrast #featureSectionsContainer .team-content-area,
        body.high-contrast #featureSectionsContainer .projects-title-wrapper,
        body.high-contrast #featureSectionsContainer .project-controls,
        body.high-contrast #featureSectionsContainer .project-card,
        body.high-contrast #featureSectionsContainer .schedule-container,
        body.high-contrast #featureSectionsContainer .schedule-controls,
        body.high-contrast #featureSectionsContainer .submission-form-container,
        body.high-contrast #featureSectionsContainer .suggestion-card,
        body.high-contrast #featureSectionsContainer .calendar-header,
        body.high-contrast #featureSectionsContainer .page-title-container,
        body.high-contrast #featureSectionsContainer .calendar-main-content,
        body.high-contrast #featureSectionsContainer .dm-fancy-title,
        body.high-contrast #featureSectionsContainer #data-management-section,
        body.high-contrast #featureSectionsContainer .tracker-header,
        body.high-contrast #featureSectionsContainer .task-input-container.card,
        body.high-contrast #featureSectionsContainer .chart-container.card,
        body.high-contrast #featureSectionsContainer .tracker-controls.card,
        body.high-contrast #featureSectionsContainer .tasks-display-area {
            background: var(--hc-background) !important;
            border: 1px solid var(--hc-border) !important;
            color: var(--text-color) !important;
            box-shadow: none !important;
        }
        body.high-contrast .team-members-section-header,
        body.high-contrast .card-header,
        body.high-contrast .modal-header,
        body.high-contrast .calendar-header { /* Add calendar header */
             background: var(--hc-background) !important;
             border-color: var(--hc-border) !important;
             color: var(--text-color) !important;
        }
        body.high-contrast .btn,
        body.high-contrast .form-control,
        body.high-contrast .form-select,
        body.high-contrast .search-bar input,
        body.high-contrast .project-search-input,
        body.high-contrast .project-filter-select,
        body.high-contrast .team-filter input,
        body.high-contrast .pt-pagination button,
        body.high-contrast .btn-group label.btn,
        body.high-contrast #dm-search-input, /* Data management inputs */
        body.high-contrast #dm-filter-status,
        body.high-contrast #dm-filter-responsible {
            border: 1px solid var(--hc-border) !important;
            background: var(--hc-background) !important;
            color: var(--text-color) !important;
        }
        body.high-contrast .project-filter-select,
        body.high-contrast .form-select,
        body.high-contrast #dm-filter-status,
        body.high-contrast #dm-filter-responsible { /* HC Select Arrow */
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23000000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e") !important;
        }
        body.high-contrast .btn-primary,
        body.high-contrast .swal2-confirm { background-color: var(--hc-primary) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-danger,
        body.high-contrast .swal2-cancel,
        body.high-contrast .btn-confirm-delete,
        body.high-contrast .button-pdf { background-color: var(--danger) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-warning,
        body.high-contrast .dm-export-btn { background-color: var(--warning) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-success,
        body.high-contrast .button-export,
        body.high-contrast .dm-import-btn { background-color: var(--hc-secondary) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-secondary,
        body.high-contrast .btn-cancel-delete { background-color: var(--hc-background) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important;}
        body.high-contrast .btn-outline,
        body.high-contrast .btn-outline-secondary { background: var(--hc-background) !important; color: var(--hc-primary) !important; border: 1px solid var(--hc-primary) !important; }
        body.high-contrast .btn-outline-danger { background: var(--hc-background) !important; color: var(--danger) !important; border: 1px solid var(--danger) !important;}
        body.high-contrast .btn-outline-success { background: var(--hc-background) !important; color: var(--hc-secondary) !important; border: 1px solid var(--hc-secondary) !important;}
        body.high-contrast .btn-outline-info { background: var(--hc-background) !important; color: var(--hc-primary) !important; border: 1px solid var(--hc-primary) !important;}
        body.high-contrast .logo { color: var(--text-color) !important; }
        body.high-contrast .logo-icon { color: var(--hc-primary) !important; }
        body.high-contrast .menu-item { color: var(--text-color) !important; border-left-color: transparent !important; }
        body.high-contrast .menu-item.active { background-color: #c0c0c0 !important; border-left-color: var(--hc-primary) !important; color: var(--hc-text) !important; }
        body.high-contrast .stat-card { border-left-width: 3px !important; background: var(--hc-background) !important; }
        body.high-contrast .welcome-section .user-info-title { color: var(--hc-text) !important; }
        body.high-contrast .badge,
        body.high-contrast .status-badge,
        body.high-contrast .priority-badge,
        body.high-contrast .member-role,
        body.high-contrast .project-status,
        body.high-contrast .suggestion-status,
        body.high-contrast .shift,
        body.high-contrast .dm-status,
        body.high-contrast .event { border: 1px solid var(--hc-border) !important; color: var(--hc-text) !important; background: none !important; padding: 3px 8px !important; font-weight: bold; }
        body.high-contrast .progress-bar { border: 1px solid var(--hc-border) !important; color: var(--hc-text) !important; background: none !important; font-weight: bold; }
        body.high-contrast .progress,
        body.high-contrast .progress-bar-container { background: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .project-participants span,
        body.high-contrast .assigned-team span { border: 1px solid var(--hc-border) !important; color: var(--hc-text) !important; background: none !important; }
        body.high-contrast .theme-preview { border: 2px solid var(--hc-border) !important; background: var(--hc-background) !important; }
        body.high-contrast .theme-option.selected .theme-preview { border-color: var(--hc-primary) !important; }
        body.high-contrast .switch .slider { background-color: #999 !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .switch input:checked + .slider { background-color: var(--hc-primary) !important; }
        body.high-contrast .switch .slider:before { background-color: var(--hc-text) !important; }
        body.high-contrast .table thead,
        body.high-contrast .schedule-table thead th,
        body.high-contrast .dm-table th,
        body.high-contrast #tasks-table thead th,
        body.high-contrast .feature-table thead th { background: var(--hc-background) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .table tbody td,
        body.high-contrast .schedule-table tbody td,
        body.high-contrast .dm-table td,
        body.high-contrast #tasks-table tbody td,
        body.high-contrast .feature-table tbody td { border: 1px solid var(--hc-border) !important; background: var(--hc-background) !important; }
        body.high-contrast .employee-name { background: var(--hc-background) !important; border-right: 2px solid var(--hc-border) !important; }
        body.high-contrast .day-name,
        body.high-contrast .day-date { color: var(--hc-text) !important; }
        body.high-contrast .shift-weekend-off { border: none !important; font-style: normal !important; }
        body.high-contrast .task-card { border: 1px solid var(--hc-border) !important; border-left-width: 3px !important; }
        body.high-contrast .file-icon { color: var(--hc-text) !important; }
        body.high-contrast .fancy-header-title,
        body.high-contrast .pt-fancy-title,
        body.high-contrast .ra-fancy-title,
        body.high-contrast .dm-fancy-title { background: var(--hc-primary) !important; color: var(--hc-background) !important; }
        body.high-contrast canvas { border: 1px dashed var(--hc-border); }
        body.high-contrast .supervisor-reply { background-color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important;}
        body.high-contrast .calendar-day.today .day-number { border: 2px solid var(--hc-text) !important; background-color: var(--hc-background) !important; color: var(--hc-text) !important;}


        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--primary-light); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* --- Sidebar Styles --- */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; text-decoration: none;}
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .connection-status span { font-weight: 600; } /* Added bold */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--input-border); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--input-bg); color: var(--input-text); }
        .search-bar input::placeholder { color: var(--placeholder-text); }
        .search-bar input:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; }
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--text-color); }
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; }
        .dropdown-item:hover { background-color: var(--light); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; } /* Adjusted height */
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section {
            background: var(--welcome-bg-current); /* Use variable */
            color: var(--white); /* Welcome section text is white by design */
            padding: 2rem;
            border-radius: var(--card-radius);
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; /* Smooth background transition */
        }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--danger); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--success); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card {
            background: var(--card-bg); /* Default */
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: 0 2px 5px var(--card-shadow);
            transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 5px solid var(--primary); /* Colored border */
            color: var(--text-color); /* Ensure text inside uses appropriate theme color */
        }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--success); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }

        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px var(--card-hover-shadow); }
        .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        .stat-card:nth-child(1) .stat-value { color: #1e40af; } /* Blue 800 */
        .stat-card:nth-child(2) .stat-value { color: #065f46; } /* Emerald 800 */
        .stat-card:nth-child(3) .stat-value { color: #b45309; } /* Amber 700 */
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; } /* Red 700 */

        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--success-dark); }
        .trend-down { color: var(--danger-dark); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; border: 1px solid var(--card-border); }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--heading-color); }
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: var(--danger-dark); text-decoration: underline; background-color: var(--danger-light); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; } /* Added max-height and scroll */
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--table-border-color); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--text-color); }
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--text-muted); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        .delete-activity { color: var(--danger); cursor: pointer; opacity: 0.6; transition: opacity 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .activity-item:hover .delete-activity { opacity: 1; }
        .delete-activity:hover { opacity: 1; background-color: var(--danger-light); }

        /* --- Profile & Settings Sections Styles --- */
        .content-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; border: 1px solid var(--card-border); } /* Hidden by default */
        .content-section.active { display: block; } /* Shown when active */
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 1rem;} /* Added wrap and gap */
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--heading-color); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--text-muted); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; } /* Hide the button, use avatar click */

        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; }
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control, .form-select {
            width: 100%; padding: 0.75rem; border: 1px solid var(--input-border); border-radius: 6px; font-size: 1rem; background-color: var(--input-bg); color: var(--input-text); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        body.compact .form-control, body.compact .form-select { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control, body.spacious .form-select { padding: 1rem; }
        .form-control:focus, .form-select:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
        .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; }
        .form-select { /* Style select dropdown arrow */
             appearance: none;
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); /* Default arrow */
             background-repeat: no-repeat;
             background-position: right 0.75rem center;
             background-size: 16px 12px;
             padding-right: 2.5rem; /* Space for arrow */
        }
        body.dark-theme .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); /* Lighter arrow */
        }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }

        /* Button Base Styles */
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; text-decoration: none; line-height: 1.5; vertical-align: middle; }
        body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--dark); } /* Darker text on yellow */
        .btn-warning:hover:not(:disabled) { background-color: var(--warning-dark); }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: var(--danger-dark); }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: var(--success-dark); }
        .btn-secondary { background-color: var(--secondary); color: white; }
        .btn-secondary:hover:not(:disabled) { background-color: var(--secondary-dark); }
        .btn-info { background-color: var(--info); color: white; }
        .btn-info:hover:not(:disabled) { background-color: var(--info-dark); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-sm { padding: 0.3rem 0.6rem !important; font-size: 0.8rem !important; }
        .btn-outline-secondary { background-color: transparent; border: 1px solid var(--gray); color: var(--gray); }
        .btn-outline-secondary:hover:not(:disabled) { background-color: var(--light-gray); }
        .btn-outline-success { background-color: transparent; border: 1px solid var(--success); color: var(--success); }
        .btn-outline-success:hover:not(:disabled) { background-color: rgba(16, 185, 129, 0.1); }
        .btn-outline-danger { background-color: transparent; border: 1px solid var(--danger); color: var(--danger); }
        .btn-outline-danger:hover:not(:disabled) { background-color: rgba(239, 68, 68, 0.1); }
        .btn-outline-info { background-color: transparent; border: 1px solid var(--info); color: var(--info); }
        .btn-outline-info:hover:not(:disabled) { background-color: rgba(13, 202, 240, 0.1); }

        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--text-muted); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; }
        @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        /* Settings Sub-section */
        .settings-subsection { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray); }
        .settings-subsection:first-child { margin-top: 0; padding-top: 0; border-top: none; }
        .settings-subsection h4 { font-size: 1.1rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 1rem; }
        body.dark-theme .settings-subsection h4 { color: var(--primary); } /* Lighter heading in dark mode */
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; } /* Added wrap */
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; /* Default: Label takes full width */ }
        @media (min-width: 768px) { .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; } }
        .setting-item-label { font-weight: 500; color: var(--text-color); }
        .setting-item-description { font-size: 0.9rem; color: var(--text-muted); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
        @media (max-width: 767px) { .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; } }

        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--heading-color); margin-bottom: 1rem; }
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        /* Settings Panel Team Member Card Style */
        #settingsContent .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--card-border); border-radius: var(--card-radius); margin-bottom: 1rem; transition: all 0.2s; background-color: var(--card-bg); }
        body.compact #settingsContent .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious #settingsContent .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        #settingsContent .team-member-card:hover { box-shadow: 0 2px 4px var(--card-shadow); border-color: var(--primary); }
        #settingsContent .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact #settingsContent .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        #settingsContent .member-details { flex: 1; min-width: 0; }
        #settingsContent .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-name { font-size: 0.9rem; }
        #settingsContent .member-email { font-size: 0.9rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-email { font-size: 0.8rem; }
        #settingsContent .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; }
        body.compact #settingsContent .member-role { font-size: 0.7rem; margin: 0 0.75rem; }
        #settingsContent .role-admin { background-color: var(--danger-light); color: var(--danger-dark); }
        #settingsContent .role-senior { background-color: var(--success-light); color: var(--success-dark); }
        #settingsContent .role-supervisor { background-color: var(--warning-light); color: var(--warning-dark); }
        #settingsContent .role-member { background-color: var(--secondary-light); color: var(--secondary); }
        #settingsContent .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        #settingsContent .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }

        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; /* Make spinner visible when inside button */ }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span.btn-text { /* Existing btn-text */ margin-left: 0.5rem; } /* Space between spinner and text */
        .btn.loading span.loading-text { /* New class for "Loading..." */ display: inline; margin-left: 0.5rem; }
        .btn:not(.loading) span.loading-text { display: none; }

        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }

        /* --- Notifications Modal, Confirm Modal, Utils --- */
        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; }
        .notifications-modal.active { display: flex; }
        .notifications-container { width: 400px; max-width: 100%; background-color: var(--card-bg); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; border: 1px solid var(--card-border);}
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; }
        .notifications-title { font-size: 1.25rem; font-weight: 600; }
        .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; }
        .notifications-body { flex-grow: 1; overflow-y: auto; }
        .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--table-border-color); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; cursor: pointer; position: relative; }
        .notification-list-item:hover { background-color: var(--table-row-hover-bg); }
        .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); }
        .notification-list-item:last-child { border-bottom: none; }
        .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: var(--primary);}
        .notification-content { flex: 1; min-width: 0; }
        .notification-message { margin-bottom: 0.25rem; color: var(--text-color); line-height: 1.4; }
        .notification-time { font-size: 0.8rem; color: var(--text-muted); }
        .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--card-bg); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .notification-list-item:hover .delete-notification { opacity: 0.6; }
        .delete-notification:hover { opacity: 1; background: var(--danger-light); }
        .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); }
        .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--light); flex-wrap: wrap; gap: 0.5rem; }
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .confirm-modal.active { display: flex; }
        .confirm-container { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; border: 1px solid var(--card-border);}
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--heading-color); }
        .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--text-muted); }
        .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-message.show { transform: translateX(0); }
        .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); }
        .back-button i { transition: transform 0.2s; font-size: 0.8rem; }
        .back-button:hover i { transform: translateX(-3px); }
        /* #notificationSound { display: none; } */ /* Commented out as file doesn't exist */
        .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--light-gray); border-radius: 8px; margin-top: 2rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; }
        .placeholder-content h2 { color: var(--heading-color); margin-bottom: 1rem; }
        .placeholder-content p { color: var(--text-muted); }
        .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; }
        .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: var(--danger-light); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }


        /* --- Generic Modal Styles (Add/Edit Member, Project, etc.) --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); z-index: 1050;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: var(--card-bg); width: 100%; max-width: 550px;
            border-radius: var(--card-radius); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out;
            color: var(--text-color); border: 1px solid var(--card-border);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--light-gray);
        }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--heading-color); }
        body.dark-theme .modal-title { color: var(--primary); }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;}
        .close-modal:hover { color: var(--danger); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- Checkbox Group --- */
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid var(--light-gray); border-radius: 6px; }
        .checkbox-group label { display: flex; align-items: center; gap: 0.5rem; font-weight: normal; font-size: 0.9rem; margin-bottom: 0; color: var(--text-color); }
        .checkbox-group input[type="checkbox"] { width: auto; margin-right: 0.25rem; }
        .settings-link { color: var(--primary); text-decoration: none; cursor: pointer; }
        .settings-link:hover { text-decoration: underline; color: var(--primary-dark); }

        /* --- Toast --- */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; }
        .toast.show { opacity: 1; bottom: 30px; }
        .toast.success { background-color: var(--success); }
        .toast.error { background-color: var(--danger); }

        /* --- Feature Specific Styles (Shared / Common) --- */
        .feature-content {
            /* Now applied directly to feature containers like #data-management-section */
            /* Ensure feature containers have appropriate padding/margin */
            padding: 1.5rem; /* Example default padding */
        }
        .feature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            background-color: var(--card-bg);
            border-radius: var(--card-radius) var(--card-radius) 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .feature-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--heading-color);
            margin: 0;
        }
        .feature-actions { display: flex; gap: 0.75rem; align-items: center; }

        /* Generic Feature Table Styles (apply to tables in features) */
        .feature-table {
            width: 100%;
            margin-bottom: 1rem;
            color: var(--text-color);
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .feature-table thead th {
            padding: 0.85rem 0.75rem;
            text-align: left;
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            border-bottom: 2px solid var(--table-border-color);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            white-space: nowrap; /* Prevent header wrapping */
        }
        .feature-table tbody td {
            padding: 0.85rem 0.75rem;
            vertical-align: middle;
            border-bottom: 1px solid var(--table-border-color);
        }
        .feature-table tbody tr:hover td {
            background-color: var(--table-row-hover-bg);
        }
        .feature-table .text-center { text-align: center !important; }
        .feature-table .text-end { text-align: right !important; }
        .feature-table .action-buttons .btn {
             margin: 0 2px; /* Tighter spacing */
        }
        .feature-table .file-icon, .feature-table .dm-status i { /* Consistent icons */
             width: 20px;
             text-align: center;
             margin-right: 0.5rem;
        }
        /* Generic Badge Styles */
        .status-badge, .priority-badge, .dm-status, .member-role, .suggestion-status, .shift {
             display: inline-block;
             padding: 0.3em 0.7em;
             font-size: 0.75rem;
             font-weight: 600;
             border-radius: 10px; /* Pill shape */
             text-transform: capitalize;
             white-space: nowrap;
             line-height: 1.3;
             text-align: center;
             min-width: 70px;
             border: 1px solid transparent; /* Add base border */
        }
        /* Apply specific status colors using CSS variables */
        .status-completed, .status-implemented { background-color: var(--status-completed-bg); color: var(--status-completed-text); border-color: var(--status-completed-text);}
        .status-inprogress, .status-active, .status-under-review { background-color: var(--status-inprogress-bg); color: var(--status-inprogress-text); border-color: var(--status-inprogress-text); }
        .status-overdue, .status-rejected { background-color: var(--status-overdue-bg); color: var(--status-overdue-text); border-color: var(--status-overdue-text); }
        .status-pending, .status-delayed { background-color: var(--status-pending-bg); color: var(--status-pending-text); border-color: var(--status-pending-text); }
        .status-inactive { background-color: var(--status-inactive-bg); color: var(--status-inactive-text); border-color: var(--status-inactive-text); }
        /* Apply specific priority colors */
        .priority-high { background-color: var(--priority-high-bg); color: var(--priority-high-text); border-color: var(--priority-high-text); }
        .priority-medium { background-color: var(--priority-medium-bg); color: var(--priority-medium-text); border-color: var(--priority-medium-text); }
        .priority-low { background-color: var(--priority-low-bg); color: var(--priority-low-text); border-color: var(--priority-low-text); }
         /* Shift Specific (Example - uses shift variables) */
         .shift-morning { background-color: var(--shift-morning-bg); color: var(--shift-morning-text); border-color: var(--shift-morning-border); }
         .shift-afternoon { background-color: var(--shift-afternoon-bg); color: var(--shift-afternoon-text); border-color: var(--shift-afternoon-border); }
         .shift-night { background-color: var(--shift-night-bg); color: var(--shift-night-text); border-color: var(--shift-night-border); }
         .shift-off { background-color: var(--shift-off-bg); color: var(--shift-off-text); border-color: var(--shift-off-border); }
         .shift-sick { background-color: var(--shift-sick-bg); color: var(--shift-sick-text); border-color: var(--shift-sick-border); }
         .shift-vacation { background-color: var(--shift-vacation-bg); color: var(--shift-vacation-text); border-color: var(--shift-vacation-border); }


        /* --- Container for Feature Sections --- */
        #featureSectionsContainer {
            display: none; /* Initially hidden */
            background-color: transparent; /* Let inner content handle bg */
            padding: 0; /* Remove padding, handled by inner content */
            box-shadow: none; /* No shadow on container */
            border: none;
            border-radius: 0;
        }
        #featureSectionsContainer.active {
             display: block; /* Show when active */
             /* Ensure feature content takes necessary height */
             min-height: calc(100vh - 150px); /* Adjust based on top-nav/footer */
             display: flex; /* Use flex for better height mgmt */
             flex-direction: column;
        }
         /* Make direct children of feature container stretch */
        #featureSectionsContainer > *:first-child {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }


        /* --- Responsive --- */
        @media (max-width: 992px) {
             .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; }
             .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
             .main-content { margin-left: 0; }
             .search-bar { width: 250px; }
             .main-content.sidebar-active { margin-left: 250px; }
             .sidebar-toggle { display: block; position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
             .top-nav { padding-left: 60px; }
             #featureSectionsContainer.projects-feature .projects-header { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper { width: auto; }
             #featureSectionsContainer.projects-feature .project-controls { justify-content: flex-start; }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-main-content { flex-direction: column; } /* Stack chart/form */
             #featureSectionsContainer.deadline-tracker-feature .chart-container { grid-column: span 12; }
             #featureSectionsContainer.deadline-tracker-feature .task-input-container { grid-column: span 12; }
        }
        @media (min-width: 993px) { .sidebar-toggle { display: none; } }
        @media (max-width: 768px) {
             .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; }
             .search-bar { width: 100%; order: 2; }
             .user-menu { width: 100%; justify-content: space-between; order: 1; }
             .content-area { padding: 1.5rem; }
             .data-form { grid-template-columns: 1fr; }
             .form-actions { grid-column: span 1; }
             .user-info { flex-direction: column; text-align: center; }
             .user-info-avatar { margin-bottom: 1rem; }
             .stats-section { grid-template-columns: 1fr; }
             .settings-tabs { flex-wrap: nowrap; overflow-x: auto; }
             .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; }
             .confirm-container { width: 90%; }
             #settingsContent .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
             #settingsContent .member-role { margin: 0.5rem 0; }
             #settingsContent .member-actions { margin-top: 0.5rem; width: 100%; justify-content: flex-end; }
             .profile-avatar-section { margin-bottom: 1.5rem; }
             #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; }
             .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; }
             .add-member-form .data-form > div { margin-bottom: 1rem; }
             .add-member-form .data-form > div:last-child { margin-top: 0; }
             .modal-content { width: 95%; padding: 1.5rem;}
             .notifications-container { width: 100%; max-width: 100%; }
             .sidebar-toggle { top: 10px; left: 10px; }
             .top-nav { padding-top: 60px; }
             /* Feature Specific Responsive */
             #featureSectionsContainer.employee-scheduling .schedule-controls { flex-direction: column; gap: 1rem; align-items: stretch; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .week-nav { justify-content: space-between; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions { margin-left: 0; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions .btn { width: 100%; justify-content: center; }
             #featureSectionsContainer.employee-scheduling .schedule-page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
             #featureSectionsContainer.employee-scheduling .employee-name { position: sticky !important; left: 0; z-index: 5 !important; border-right: 1px solid var(--table-border-color); background-color: var(--card-bg); }
             #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { position: sticky !important; left: 0; z-index: 11 !important; background-color: var(--primary); }
             #featureSectionsContainer.task-management-feature .task-list { grid-template-columns: 1fr; }
             #featureSectionsContainer.task-management-feature .controls { flex-direction: column; align-items: stretch; gap: 10px; }
             #featureSectionsContainer.team-members-feature .team-members-section-header { flex-direction: column; align-items: flex-start;}
             #featureSectionsContainer.team-members-feature .team-filter { max-width: none; }
             #featureSectionsContainer.projects-feature .project-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select, #featureSectionsContainer.projects-feature .add-project-btn { width: 100%; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-header h1 { font-size: 1.5rem; }
             #featureSectionsContainer.deadline-tracker-feature #task-form { grid-template-columns: 1fr; }
             #featureSectionsContainer.deadline-tracker-feature #task-form button[type="submit"] { grid-column: 1 / -1; justify-self: stretch; width: 100%; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.deadline-tracker-feature .export-buttons { margin-left: 0; margin-top: 1rem; justify-content: flex-start; width: 100%; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-main-content, #featureSectionsContainer.deadline-tracker-feature .deadline-tracker-container { display: flex; flex-direction: column; }
             #featureSectionsContainer.innovation-hub-feature .hub-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.innovation-hub-feature .form-row { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.data-management-feature .dm-toolbar { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.data-management-feature .dm-search-filter { width: 100%; }
             #featureSectionsContainer.data-management-feature .dm-actions { width: 100%; justify-content: space-around; }
             #featureSectionsContainer.calendar-feature .calendar-header { padding: 0.5rem 1rem; gap: 0.5rem; flex-wrap: wrap; }
             #featureSectionsContainer.calendar-feature .current-month-year { font-size: 1.2rem; margin-right: 0; order: 1; }
             #featureSectionsContainer.calendar-feature .add-event-button { order: 2; margin-left: auto; }
             #featureSectionsContainer.project-tracking-feature .card-header { flex-direction: column; align-items: flex-start; }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section .row > div { margin-bottom: 10px; }
             #featureSectionsContainer.reports-analytics-feature .card-header { flex-direction: column; align-items: flex-start; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .d-flex { flex-direction: column; align-items: stretch !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons { margin-top: 10px; width: 100%; text-align: right; }
        }
        @media (max-width: 480px) {
             .section-header > div { justify-content: center; width: 100%; }
             .welcome-section { padding: 1.5rem; }
             .stats-section { gap: 0.75rem; }
             .stat-card { padding: 1rem; }
             .user-menu { gap: 1rem; }
             .user-name { display: none; }
             .user-status { margin-left: 0; }
             .notifications-footer { flex-direction: column; gap: 0.5rem; }
             .notifications-footer .btn { width: 100%; justify-content: center; }
             /* Feature Specific Responsive */
             #featureSectionsContainer.task-management-feature .modal-content { padding: 20px 15px; }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: 1fr; gap: 15px; }
             #featureSectionsContainer.projects-feature .project-actions .btn { flex-grow: 1; justify-content: center; }
             #featureSectionsContainer.deadline-tracker-feature #tasks-table th, #featureSectionsContainer.deadline-tracker-feature #tasks-table td { padding: 0.8rem; font-size: 0.9rem; }
             #featureSectionsContainer.innovation-hub-feature .hub-header { padding: 1rem 1.5rem; }
             #featureSectionsContainer.data-management-feature .dm-actions button { flex-grow: 1; font-size: 13px; }
             #featureSectionsContainer.calendar-feature .calendar-header { flex-wrap: wrap; justify-content: space-between; }
             #featureSectionsContainer.calendar-feature .current-month-year { order: 1; flex-basis: 100%; text-align: center; margin-top: 0.5rem; }
             #featureSectionsContainer.calendar-feature .add-event-button span { display: none; }
             #featureSectionsContainer.calendar-feature .add-event-button { order: 2; margin-left: 0; }
        }

    </style>
</head>
<body class=""> <!-- JS applies theme -->

    <!-- <audio id="notificationSound" preload="auto"> -->
        <!-- <source src="assets/notification.mp3" type="audio/mpeg"> --> <!-- Removed: Causes 404 -->
        <!-- Your browser does not support the audio element. -->
    <!-- </audio> -->

    <!-- Hamburger Menu Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Toast/Success Messages -->
    <div class="toast" id="toastMessage">Toast message</div>
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Action successful!</span> </div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="#dashboard" class="logo" data-feature="dashboard">
                <i class="fas fa-users-cog logo-icon"></i>
                <span>TeamFlow</span>
            </a>
             <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar" style="display: none;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>

             <div class="menu-title">Core Features</div>
             <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a>
             <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <a href="#deadline-tracker" class="menu-item" data-feature="deadline-tracker"><i class="fas fa-calendar-check"></i><span>Deadline Tracker</span></a>

             <div class="menu-title">Team Tools</div>
             <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
             <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>

             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
         <div class="connection-status">
             <div class="status-dot"></div>
             <span>Online</span>
         </div>
    </aside>

    <main class="main-content" id="mainContent">
         <nav class="top-nav">
             <div class="search-bar">
                 <i class="fas fa-search search-icon"></i>
                 <input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off">
                 <div class="search-results" id="searchResults"></div>
             </div>
             <div class="user-menu">
                 <div class="notification-icon" id="notificationIcon">
                     <i class="fas fa-bell"></i>
                     <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                 </div>
                 <div class="user-profile" id="userProfileContainer">
                     <div class="user-avatar" id="userAvatar">ME</div>
                     <div class="user-profile-details">
                         <span class="user-name" id="userName">Loading...</span>
                         <span class="user-status"> • Connected</span>
                     </div>
                     <div class="user-dropdown" id="userDropdown">
                         <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a>
                         <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a>
                         <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                     </div>
                 </div>
             </div>
         </nav>

         <div class="content-area">
             <!-- Back Button -->
             <div class="back-button" id="backButton" style="display: none;">
                 <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span>
             </div>

             <!-- Dashboard Content -->
             <div id="dashboardContent" class="content-section active">
                 <div class="welcome-section" id="welcomeSection">
                     <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2>
                     <p class="welcome-subtitle">Here's what's happening with your team today.</p>
                     <div class="user-info">
                         <div class="user-info-avatar" id="profileAvatar">U</div>
                         <div class="user-info-details">
                             <div class="user-info-name" id="userInfoName">Loading User...</div>
                             <div class="user-info-title" id="userInfoRoleTitle">Loading Role...</div>
                             <div class="user-info-email">
                                 <i class="fas fa-envelope"></i> <span id="userEmail">loading@email.com</span>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="stats-section" id="statsSection">
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                 </div>
                 <div class="activity-section">
                     <div class="section-header">
                         <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3>
                         <div>
                             <span class="view-all" id="viewAllActivity">Show All</span>
                             <span class="delete-all" id="deleteAllActivity">Delete All</span>
                         </div>
                     </div>
                     <ul class="activity-list" id="activityList">
                         <li style="text-align: center; padding: 2rem; color: var(--gray);"> Loading activities... </li>
                     </ul>
                 </div>
             </div>

             <!-- Profile Content -->
             <div class="content-section" id="profileContent">
                 <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Your personal information and account security settings.</p>
                 <div class="profile-avatar-section">
                     <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color);">Avatar</label>
                     <div id="profileAvatarLarge" title="Click to upload photo">ME</div>
                     <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                 </div>
                 <form class="data-form" id="profileForm">
                     <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control" value=""> </div>
                     <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control" value=""> </div>
                     <div class="form-actions">
                         <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button>
                         <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                            <span class="btn-text">Save Changes</span>
                            <span class="spinner" style="display: none;"></span>
                         </button>
                     </div>
                 </form>
             </div>

             <!-- Settings Content -->
             <div class="content-section" id="settingsContent">
                 <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                 <div class="settings-tabs">
                     <div class="settings-tab active" data-tab="preferences">Preferences</div>
                     <div class="settings-tab" data-tab="account">Account</div>
                     <div class="settings-tab" data-tab="security">Security</div>
                     <div class="settings-tab" data-tab="notifications">Notifications</div>
                     <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div>
                     <div class="settings-tab" data-tab="collaboration">Collaboration</div>
                     <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div>
                 </div>

                 <!-- Preferences Panel -->
                 <div class="settings-panel active" id="preferencesPanel">
                      <div class="settings-subsection">
                         <h4>Appearance</h4>
                         <div class="form-group">
                             <label class="settings-label">Theme</label>
                             <div class="theme-options-container">
                                 <div class="theme-option" data-theme="light"> <div class="theme-preview light-preview"><i class="fas fa-sun"></i></div> <span class="theme-label">Light</span> </div>
                                 <div class="theme-option" data-theme="dark"> <div class="theme-preview dark-preview"><i class="fas fa-moon"></i></div> <span class="theme-label">Dark</span> </div>
                                 <div class="theme-option" data-theme="system"> <div class="theme-preview system-preview"><i class="fas fa-desktop"></i></div> <span class="theme-label">System</span> </div>
                             </div>
                         </div>
                         <div class="setting-item">
                            <div> <span class="setting-item-label">High Contrast Mode</span> <p class="setting-item-description">Increase text visibility for accessibility.</p> </div>
                            <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="highContrastToggle"> <span class="slider round"></span> </label> </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Localization</h4>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group"> <label for="languageSelect">Language</label> <select id="languageSelect" class="form-control form-select"> <option value="en">English (US)</option> <option value="ar">العربية (Arabic)</option> <option value="es">Español (Spanish)</option> </select> </div>
                             <div class="form-group"> <label for="regionSelect">Region / Timezone</label> <select id="regionSelect" class="form-control form-select"> <option value="utc">UTC</option> <option value="est">EST (UTC-5)</option> <option value="pst">PST (UTC-8)</option> <option value="cet">CET (UTC+1)</option> <option value="eet">EET (UTC+2)</option> <option value="ast">AST (UTC+3) - Riyadh</option> </select> </div>
                         </div>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group"> <label for="timeFormatSelect">Time Format</label> <select id="timeFormatSelect" class="form-control form-select"> <option value="12h">12-hour (e.g., 3:00 PM)</option> <option value="24h">24-hour (e.g., 15:00)</option> </select> </div>
                              <div class="form-group"> <label for="dateFormatSelect">Date Format</label> <select id="dateFormatSelect" class="form-control form-select"> <option value="MM/DD/YYYY">MM/DD/YYYY</option> <option value="DD/MM/YYYY">DD/MM/YYYY</option> <option value="YYYY-MM-DD">YYYY-MM-DD</option> <option value="Month D, YYYY">Month D, YYYY</option> </select> </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Messages & Sounds</h4>
                         <div class="setting-item">
                             <div> <span class="setting-item-label">Enable Toast Notifications</span> <p class="setting-item-description">Show brief confirmation messages for actions.</p> </div>
                             <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="toastToggle" checked> <span class="slider round"></span> </label> </div>
                         </div>
                         <div class="setting-item">
                             <div> <span class="setting-item-label">Enable Sound Notifications</span> <p class="setting-item-description">Play a sound for new notifications and activities.</p> </div>
                             <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="soundToggle" checked> <span class="slider round"></span> </label> </div>
                         </div>
                         <div class="form-group"> <label for="notificationToneSelect">Notification Tone</label> <select id="notificationToneSelect" class="form-control form-select" disabled> <option value="default">Default</option> <option value="tone1">Tone 1 (Placeholder)</option> <option value="tone2">Tone 2 (Placeholder)</option> </select> <p class="setting-item-description">Select the sound to play for notifications (Requires enabling sound).</p> </div>
                         <div class="form-group"> <label class="settings-label">Keyboard Shortcuts</label> <p class="setting-item-description">View or customize keyboard shortcuts (Feature placeholder).</p> <button class="btn btn-outline btn-sm" disabled>View Shortcuts</button> </div>
                     </div>
                     <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="savePreferencesBtn">Save Preferences</button> </div>
                 </div>

                 <!-- Account Panel -->
                 <div class="settings-panel" id="accountPanel">
                    <div class="settings-subsection">
                         <h4>Account Information</h4>
                         <div class="data-form">
                             <div class="form-group"> <label for="accountEmail">Current Email</label> <input type="email" id="accountEmail" class="form-control" value="" readonly> </div>
                             <div class="form-group"> <label for="changeEmail">New Email Address</label> <input type="email" id="changeEmail" class="form-control" placeholder="Enter new email" disabled> <p class="setting-item-description">Changing email requires backend verification.</p> </div>
                             <div class="form-group" style="grid-column: span 2;"> <label for="accountConfirmPassword">Confirm Password (to change email)</label> <input type="password" id="accountConfirmPassword" class="form-control" placeholder="Enter current password" disabled> </div>
                            <div class="form-actions" style="grid-column: span 2;"> <button type="button" class="btn btn-primary" id="saveAccountEmailBtn" disabled>Change Email Address</button> </div>
                         </div>
                         <p style="margin-top: 1rem;">Note: Password changes are managed under the <a href="#settings-security" data-feature="settings" data-tab-target="security" class="settings-link">Security Tab</a>.</p>
                     </div>
                     <div class="settings-subsection">
                         <h4>Account Notifications</h4>
                         <div class="setting-item">
                             <div> <span class="setting-item-label">Enable Account Notifications</span> <p class="setting-item-description">Receive email alerts for important account activities (e.g., password changes, new logins).</p> </div>
                             <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="accountNotificationsToggle" checked> <span class="slider round"></span> </label> </div>
                         </div>
                     </div>
                     <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveAccountSettingsBtn">Save Account Settings</button> </div>
                 </div>

                 <!-- Security Panel -->
                 <div class="settings-panel" id="securityPanel">
                      <div class="settings-subsection">
                         <h4>Password</h4>
                         <form class="data-form" id="changePasswordForm">
                             <div class="form-group"> <label for="currentPassword">Current Password</label> <input type="password" id="currentPassword" class="form-control"> </div>
                             <div class="form-group"> <label for="newPassword">New Password</label> <input type="password" id="newPassword" class="form-control"> </div>
                             <div class="form-group"> <label for="confirmPassword">Confirm New Password</label> <input type="password" id="confirmPassword" class="form-control"> </div>
                             <div class="form-actions"> <button type="submit" class="btn btn-primary">Change Password</button> </div>
                         </form>
                     </div>
                     <div class="settings-subsection">
                         <h4>Two-Factor Authentication (2FA)</h4>
                         <div class="two-fa-status" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;"> <span class="status-indicator disabled" id="twoFaStatusIndicator" style="width: 10px; height: 10px; border-radius: 50%; display: inline-block; background-color: var(--gray); transition: background-color 0.3s;"></span> <span id="twoFaStatusText" style="font-weight: 500;">2FA is currently Disabled</span> </div>
                         <p class="setting-item-description">Add an extra layer of security to your account using an authenticator app or SMS.</p>
                         <div id="twoFaSetupSection" style="display: block; margin-top: 1rem;">
                             <button class="btn btn-primary" id="enable2faBtn">Enable 2FA</button>
                             <div class="two-fa-setup" id="twoFaSetupOptions" style="display:none; margin-top: 1rem;">
                                 <h5 style="margin-bottom: 0.75rem; font-size: 1rem;">Choose Setup Method:</h5>
                                 <div class="two-fa-actions" style="display: flex; gap: 1rem; margin-bottom: 1.5rem;"> <button class="btn btn-outline" id="setupAuthAppBtn"><i class="fas fa-mobile-alt"></i> Authenticator App</button> <button class="btn btn-outline" id="setupSmsBtn"><i class="fas fa-sms"></i> SMS Message</button> </div>
                                 <div id="authAppSetup" style="display: none; margin-top: 1.5rem;"> <p>1. Scan this QR code with your authenticator app (e.g., Google Authenticator, Authy).</p> <div class="qr-code-placeholder" style="width: 150px; height: 150px; border: 1px solid var(--light-gray); display: flex; align-items: center; justify-content: center; color: var(--gray); margin: 1rem auto;">QR Placeholder</div> <p>2. Enter the 6-digit code generated by your app below.</p> <div class="form-group" style="max-width: 200px;"> <label for="authCode">Verification Code</label> <input type="text" id="authCode" class="form-control" placeholder="123456" maxlength="6"> </div> <button class="btn btn-primary" id="verifyAuthCodeBtn">Verify & Enable</button> </div>
                                 <div id="smsSetup" style="display: none; margin-top: 1.5rem;"> <p>1. We'll send a verification code via SMS to your registered phone number (<span id="userPhoneNumberForSms"></span>).</p> <button class="btn btn-primary" id="sendSmsCodeBtn">Send Code</button> <div class="form-group" style="margin-top: 1rem; display: none;" id="smsCodeInputGroup"> <label for="smsCode">SMS Verification Code</label> <input type="text" id="smsCode" class="form-control" placeholder="123456" maxlength="6" style="max-width: 200px;"> </div> <button class="btn btn-primary" id="verifySmsCodeBtn" style="display: none;">Verify & Enable</button> </div>
                             </div>
                         </div>
                         <div id="twoFaManagementSection" style="display: none; margin-top: 1rem;"> <p>2FA is enabled. You can manage recovery codes or disable 2FA.</p> <div class="two-fa-actions" style="display: flex; gap: 1rem;"> <button class="btn btn-outline" disabled>View Recovery Codes</button> <button class="btn btn-danger" id="disable2faBtn">Disable 2FA</button> </div> </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Session Management</h4>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group"> <label for="sessionDuration">Session Duration (minutes)</label> <input type="number" id="sessionDuration" class="form-control" value="60" min="15"> <p class="setting-item-description">Set how long a login session remains active.</p> </div>
                            <div class="form-group"> <label for="idleTimeout">Idle Timeout (minutes)</label> <input type="number" id="idleTimeout" class="form-control" value="15" min="5"> <p class="setting-item-description">Automatically logout after inactivity.</p> </div>
                         </div>
                         <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveSessionSettingsBtn">Save Session Settings</button> </div>
                     </div>
                 </div>

                 <!-- Notifications Panel -->
                 <div class="settings-panel" id="notificationsPanel">
                     <div class="settings-subsection">
                         <h4>Notification Delivery</h4>
                         <div class="setting-item"> <div> <span class="setting-item-label">Enable Email Notifications</span> <p class="setting-item-description">Receive summaries and important alerts via email.</p> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="emailNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div>
                         <div class="setting-item"> <div> <span class="setting-item-label">Enable In-App Notifications</span> <p class="setting-item-description">Show notifications within the TeamFlow interface (bell icon).</p> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="inAppNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div>
                         <div class="setting-item"> <div> <span class="setting-item-label">Enable Push Notifications (Mobile/Desktop)</span> <p class="setting-item-description">Receive notifications even when the app isn't open (Requires browser/OS support & backend).</p> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="pushNotificationsToggle" disabled> <span class="slider round"></span> </label> </div> </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Notification Types</h4>
                         <p class="setting-item-description">Choose which types of notifications you want to receive (Settings apply to In-App & Email if enabled). Backend needed to manage these.</p>
                         <div class="checkbox-group"> <label><input type="checkbox" name="notificationType" value="task_assigned" checked> Task Assigned</label> <label><input type="checkbox" name="notificationType" value="task_comment" checked> Task Comment/Mention</label> <label><input type="checkbox" name="notificationType" value="project_update" checked> Project Update</label> <label><input type="checkbox" name="notificationType" value="deadline_reminder" checked> Deadline Reminder</label> <label><input type="checkbox" name="notificationType" value="file_shared"> File Shared</label> <label><input type="checkbox" name="notificationType" value="system_announcement" checked> System Announcement</label> </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Sound & Priority (Linked to Preferences)</h4>
                         <p class="setting-item-description">Sound settings are managed under the <a href="#settings-preferences" data-feature="settings" data-tab-target="preferences" class="settings-link">Preferences Tab</a>.</p>
                         <div class="form-group"> <label for="notificationPriority">Minimum Notification Priority</label> <select id="notificationPriority" class="form-control form-select" disabled> <option value="low">Low</option> <option value="medium">Medium</option> <option value="high">High</option> </select> <p class="setting-item-description">Only show notifications above a certain priority level (Feature placeholder).</p> </div>
                     </div>
                      <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveNotificationSettingsBtn">Save Notification Settings</button> </div>
                 </div>

                 <!-- Team Management Panel -->
                 <div class="settings-panel" id="teamPanel">
                      <div class="team-management">
                         <div class="settings-subsection">
                             <h4>Team Members</h4>
                             <div class="team-list" id="teamList"> <p>Loading team members...</p> </div>
                             <div class="add-member-form">
                                 <h4>Invite New Member</h4>
                                 <form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;">
                                    <div class="form-group"> <label for="inviteEmail">Email</label> <input type="email" id="inviteEmail" class="form-control" required> </div>
                                    <div class="form-group"> <label for="inviteRole">Role</label> <select id="inviteRole" class="form-control form-select" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                                    <button type="submit" class="btn btn-primary">Invite</button>
                                 </form>
                             </div>
                             <!-- Admin Action: Delete All -->
                             <div class="mt-4 pt-3 border-top" id="deleteAllUsersSection" style="display: none;">
                                 <h5 class="text-danger">Bulk Actions</h5>
                                 <div class="d-flex justify-content-between align-items-center">
                                     <div>
                                         <p class="mb-0">Delete all non-administrator users.</p>
                                         <small class="text-muted">This action cannot be undone.</small>
                                     </div>
                                     <button class="btn btn-danger" id="deleteAllNonAdminUsersBtn"> <i class="fas fa-users-slash"></i> Delete Non-Admins </button>
                                 </div>
                             </div>
                         </div>
                         <div class="settings-subsection">
                             <h4>Custom Role Permissions</h4>
                             <p class="setting-item-description">Define specific permissions for different roles within your team (Feature placeholder - requires backend).</p>
                             <button class="btn btn-outline" disabled>Manage Permissions</button>
                         </div>
                     </div>
                 </div>

                 <!-- Collaboration Panel -->
                 <div class="settings-panel" id="collaborationPanel">
                      <div class="settings-subsection">
                         <h4>External Integrations</h4>
                         <p class="setting-item-description">Connect TeamFlow with other applications (Requires backend setup).</p>
                         <div class="integration-list" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;"> <button class="btn btn-outline" disabled><i class="fab fa-slack"></i> Connect Slack</button> <button class="btn btn-outline" disabled><i class="fab fa-google-drive"></i> Connect Google Drive</button> <button class="btn btn-outline" disabled><i class="fab fa-github"></i> Connect GitHub</button> </div>
                     </div>
                      <div class="settings-subsection">
                         <h4>Sharing & Invitations</h4>
                         <p class="setting-item-description">Manage how projects and tasks can be shared externally (Feature placeholder).</p>
                         <div class="setting-item"> <div> <span class="setting-item-label">Allow External Sharing Links</span> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="externalSharingToggle" disabled> <span class="slider round"></span> </label> </div> </div>
                         <button class="btn btn-outline" disabled>Manage Pending Invites</button>
                      </div>
                      <div class="settings-subsection">
                         <h4>Collaboration Permissions</h4>
                         <p class="setting-item-description">Set default permissions for collaboration features like comments and file sharing (Feature placeholder).</p>
                         <button class="btn btn-outline" disabled>Set Default Permissions</button>
                     </div>
                 </div>

                 <!-- Danger Zone Panel (Refined) -->
                 <div class="settings-panel" id="dangerPanel">
                     <h3 class="section-title" style="color: var(--danger); margin-bottom: 0.5rem;">Danger Zone</h3>
                     <p style="color: var(--text-muted); margin-bottom: 1.5rem;">These actions are permanent and cannot be undone. Proceed with caution.</p>

                     <div class="danger-zone-item">
                         <div>
                            <h5>Logout From All Devices</h5>
                            <p>This will log you out of all active sessions on other computers and mobile devices.</p>
                         </div>
                         <button class="btn btn-warning" id="logoutAllDevicesBtn">Logout Everywhere</button>
                     </div>

                     <div class="danger-zone-item">
                         <div>
                            <h5>Delete Account</h5>
                            <p>Permanently delete your account and all associated data. This action cannot be reversed.</p>
                         </div>
                         <button class="btn btn-danger" id="deleteAccountBtn">Delete My Account</button>
                     </div>
                 </div>
             </div>

             <!-- Container for other feature sections -->
             <div id="featureSectionsContainer" class="content-section">
                 <div class="placeholder-content" id="featurePlaceholder">
                     <h2 id="featureTitle">Feature Content Area</h2>
                     <p id="featureDescription">Select a feature from the sidebar.</p>
                     <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                     <div class="error-message" style="display: none;"> Failed to load content. </div>
                 </div>
             </div>
         </div>
    </main>

    <!-- Notification Modal -->
    <div class="notifications-modal" id="notificationsModal">
         <div class="notifications-container">
             <div class="notifications-header">
                 <h3 class="notifications-title">Notifications</h3>
                 <button class="close-notifications" id="closeNotifications" aria-label="Close Notifications">×</button>
             </div>
             <div class="notifications-body" id="notificationsBody">
                 <div class="no-notifications-message" id="noNotificationsMessage">Loading notifications...</div>
             </div>
             <div class="notifications-footer">
                 <button class="btn btn-outline btn-sm" id="markAllReadBtn">Mark All as Read</button>
                 <button class="btn btn-danger btn-sm" id="deleteAllNotificationsBtn">Delete All</button>
             </div>
         </div>
    </div>

    <!-- Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
         <div class="confirm-container">
             <h3 class="confirm-title" id="confirmTitle">Confirm Action</h3>
             <div class="confirm-message" id="confirmMessage">Are you sure you want to proceed?</div>
             <div class="confirm-actions">
                 <button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button>
                 <button class="btn btn-danger" id="confirmBtn">Confirm</button>
             </div>
         </div>
    </div>

    <!-- Member Add/Edit Modal -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header"> <h3 class="modal-title" id="memberModalTitle">Member Details</h3> <button class="close-modal" data-close-modal>×</button> </div>
            <form id="memberForm">
                <input type="hidden" id="memberId">
                 <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                     <div class="form-group"> <label for="memberFirstName">First Name</label> <input type="text" id="memberFirstName" class="form-control" required> </div>
                     <div class="form-group"> <label for="memberLastName">Last Name</label> <input type="text" id="memberLastName" class="form-control" required> </div>
                     <div class="form-group"> <label for="memberEmail">Email</label> <input type="email" id="memberEmail" class="form-control" required> </div>
                     <div class="form-group"> <label for="memberRole">Role</label> <select id="memberRole" class="form-control form-select" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                      <div class="form-group"> <label for="memberTitle">Job Title</label> <input type="text" id="memberTitle" class="form-control"> </div>
                      <div class="form-group"> <label for="memberDepartment">Department</label> <input type="text" id="memberDepartment" class="form-control"> </div>
                 </div>
                <div class="form-actions" style="grid-column: span 2;"> <button type="button" class="btn btn-outline" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="saveMemberBtn">Save Changes</button> </div>
            </form>
        </div>
    </div>

    <!-- Project Add/Edit Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header"> <h3 class="modal-title" id="projectModalTitle">Project Details</h3> <button class="close-modal" data-close-modal>×</button> </div>
            <form id="projectForm">
                <input type="hidden" id="projectId">
                <div class="data-form" style="grid-template-columns: 1fr;">
                    <div class="form-group"> <label for="projectName">Project Name</label> <input type="text" id="projectName" class="form-control" required> </div>
                    <div class="form-group"> <label for="projectDescription">Description</label> <textarea id="projectDescription" class="form-control" rows="3"></textarea> </div>
                     <div class="form-group"> <label for="projectParticipantsInput">Participants (Separate with | )</label> <input type="text" id="projectParticipantsInput" class="form-control" placeholder="e.g., John D.|Jane S."> </div>
                    <div class="form-group"> <label for="projectImageInput">Image URL (Optional)</label> <input type="url" id="projectImageInput" class="form-control" placeholder="https://..."> </div>
                     <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                         <div class="form-group"> <label for="projectStartDate">Start Date</label> <input type="date" id="projectStartDate" class="form-control"> </div>
                        <div class="form-group"> <label for="projectDueDate">Due Date</label> <input type="date" id="projectDueDate" class="form-control"> </div>
                         <div class="form-group"> <label for="projectStatus">Status</label> <select id="projectStatus" class="form-control form-select" required> <option value="pending">Pending</option> <option value="active">Active</option> <option value="in-progress">In Progress</option> <option value="completed">Completed</option> </select> </div>
                        <div class="form-group"> <label for="projectProgress">Progress (%)</label> <input type="number" id="projectProgress" class="form-control" min="0" max="100" value="0"> </div>
                    </div>
                 </div>
                <div class="form-actions" style="grid-column: span 1;"> <button type="button" class="btn btn-outline" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="saveProjectBtn">Save Project</button> </div>
            </form>
        </div>
    </div>

    <!-- Add Event Modal (for Calendar) -->
    <div class="modal" id="calendarEventModal">
         <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="eventModalTitle">Add New Event</h2>
                <button class="close-modal" data-close-modal>×</button>
            </div>
            <div class="modal-body">
                <form id="add-event-form">
                    <div class="form-group"><label for="event-title">Event Title</label><input type="text" id="event-title" class="form-control" name="event-title" required></div>
                    <div class="form-group"><label for="event-employee">Assignee</label><select id="event-employee" class="form-control form-select" name="event-employee"><option value="">Select Employee...</option><option value="Mohamed Elmenisy">Mohamed Elmenisy</option><option value="Nada Mahmoud">Nada Mahmoud</option><option value="Yousef Ahmed">Yousef Ahmed</option><option value="Esraa Lashin">Esraa Lashin</option><option value="Bassant Badr">Bassant Badr</option><option value="Team">Team / General</option></select></div>
                    <div class="form-group"><label for="event-date">Date</label><input type="date" id="event-date" class="form-control" name="event-date" required></div>
                    <div class="form-group"><label for="event-time">Time (Optional)</label><input type="time" id="event-time" class="form-control" name="event-time"></div>
                    <div class="form-group"><label for="event-type">Event Type</label><select id="event-type" class="form-control form-select" name="event-type"><option value="meeting">Meeting</option><option value="deadline">Deadline</option><option value="task">Task</option><option value="personal">Personal</option></select></div>
                    <div class="form-group"><label for="event-description">Description (Optional)</label><textarea id="event-description" class="form-control" name="event-description" rows="3"></textarea></div>
                    <div class="form-group"><label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" id="event-important" name="event-important" style="width: auto;"> Mark as Important</label></div>
                </form>
            </div>
            <div class="modal-footer form-actions" style="grid-column: span 1;">
                <button type="button" id="cancel-modal-button" class="btn btn-outline" data-close-modal>Cancel</button>
                <button type="submit" id="save-event-button" form="add-event-form" class="btn btn-primary">Save Event</button>
            </div>
        </div>
    </div>

    <!-- View Record Modal (for Data Management) -->
    <div class="modal" id="dmViewModal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">Record Details</h3>
               <button class="close-modal" data-close-modal>×</button>
           </div>
           <dl id="view-details" style="font-size: 0.9rem;">
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">ID:</dt><dd id="view-id" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Record Name:</dt><dd id="view-name" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Creation Date:</dt><dd id="view-creation-date" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Responsible:</dt><dd id="view-responsible" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Status:</dt><dd id="view-status" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Last Updated:</dt><dd id="view-last-updated" style="margin-left: 0; margin-bottom: 10px;"></dd>
           </dl>
           <div class="form-actions" style="grid-column: span 1;">
               <button type="button" class="btn btn-outline" data-close-modal>Close</button>
           </div>
       </div>
   </div>

    <!-- Add/Edit Record Modal (for Data Management) -->
   <div class="modal" id="dmAddEditModal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title" id="dmModalTitle">Add New Record</h3>
               <button class="close-modal" data-close-modal>×</button>
           </div>
           <form id="dmAddEditForm">
               <input type="hidden" id="dmEditRecordId">
               <div class="form-group">
                   <label for="dmRecordName">Record Name:</label>
                   <input type="text" id="dmRecordName" name="recordName" class="form-control" required>
               </div>
               <div class="form-group">
                   <label for="dmResponsible">Responsible:</label>
                   <select id="dmResponsible" name="responsible" class="form-control form-select" required>
                       <option value="" disabled selected>-- Select Person --</option>
                       <option value="Nada Mahmoud">Nada Mahmoud</option>
                       <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                       <option value="Yousef Ahmed">Yousef Ahmed</option>
                       <option value="Esraa Lashin">Esraa Lashin</option>
                       <option value="Basssant Badr">Basssant Badr</option>
                       <option value="Other">Other</option>
                   </select>
               </div>
               <div class="form-group">
                   <label for="dmStatus">Status:</label>
                   <select id="dmStatus" name="status" class="form-control form-select" required>
                       <option value="" disabled selected>-- Select Status --</option>
                       <option value="active">Active</option>
                       <option value="pending">Pending</option>
                       <option value="inactive">Inactive</option>
                   </select>
               </div>
               <div class="form-actions" style="grid-column: span 1;">
                   <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                   <button type="submit" class="btn btn-primary save-btn">Save Record</button>
               </div>
           </form>
       </div>
   </div>

    <!-- Delete Confirmation Modal (for Deadline Tracker) -->
    <div class="modal" id="dtDeleteConfirmModal">
        <div class="modal-content" style="max-width: 450px;">
             <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
                  <h3 class="modal-title" style="color: var(--danger);"><i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion</h3>
                  <button class="close-modal" data-close-modal>×</button>
             </div>
            <p id="dtDeleteConfirmMessage" style="margin: 1.5rem 0; color: var(--text-muted);">Are you sure you want to delete this task?</p>
            <div class="form-actions" style="grid-column: span 1; justify-content: center;">
                <button id="dtConfirmDeleteNo" class="btn btn-outline" data-close-modal>No <i class="fas fa-times ms-1"></i></button>
                <button id="dtConfirmDeleteYes" class="btn btn-danger">Yes <i class="fas fa-check ms-1"></i></button>
            </div>
        </div>
    </div>

    <!-- Edit Shift Modal (for Employee Scheduling) -->
    <div class="modal" id="editShiftModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="editShiftModalTitle">Edit Shift</h3>
                <button class="close-modal" data-close-modal>×</button>
            </div>
            <form id="editShiftForm">
                <input type="hidden" id="editShiftEmployeeId">
                <input type="hidden" id="editShiftDayIndex">
                <input type="hidden" id="editShiftWeekOffset">
                <div class="form-group">
                    <label for="shiftType">Shift Type</label>
                    <select id="shiftTypeSelect" class="form-control form-select"> <!-- Changed ID -->
                        <option value="morning">Morning (9AM-5PM)</option>
                        <option value="afternoon">Afternoon (12PM-8PM)</option>
                        <option value="night">Night (8PM-4AM)</option>
                        <option value="off">Day Off</option>
                        <option value="sick">Sick Leave</option>
                        <option value="vacation">Vacation</option>
                    </select>
                </div>
                <div class="form-actions" style="grid-column: span 1;">
                    <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Shift</button>
                </div>
            </form>
        </div>
    </div>


    <!-- ========= Feature Templates ========= -->

    <!-- Template: Placeholder for Features Not Implemented Yet -->
    <template id="placeholderAssets">
        <div class="placeholder-content">
            <h2 id="featureTitle">Feature Name</h2>
            <p id="featureDescription">Content for this feature will be loaded here.</p>
             <!-- You can add a spinner or specific message if needed -->
        </div>
    </template>

    <!-- Template: Team Members Feature -->
    <template id="teamMembersAssets">
        <style id="injected-team-members-view-styles">
             /* Scoped Team Member Styles */
            #featureSectionsContainer.team-members-view-feature .team-members-section {
                 background-color: var(--card-bg); /* Use dashboard card bg */
                 border-radius: var(--card-radius);
                 max-width: none; /* Allow full width */
                 margin: 0; /* Remove auto margin */
                 box-shadow: 0 1px 3px var(--card-shadow);
                 overflow: hidden;
                 border: 1px solid var(--card-border);
            }
            #featureSectionsContainer.team-members-view-feature .team-members-section-header {
                 display: flex; justify-content: space-between; align-items: center;
                 flex-wrap: wrap; gap: 1rem;
                 background-color: var(--light); /* Use light bg for header */
                 color: var(--heading-color);
                 margin: 0; padding: 1.1rem 1.5rem;
                 font-weight: 600; text-align: left;
                 border-bottom: 1px solid var(--card-border);
             }
             body.dark-theme #featureSectionsContainer.team-members-view-feature .team-members-section-header {
                 background-color: var(--light); /* Dark theme card bg */
                 border-bottom-color: var(--light-gray);
             }
             #featureSectionsContainer.team-members-view-feature .team-members-section-header h2 {
                 font-size: 1.5rem; margin: 0; color: var(--heading-color); /* Use dashboard heading */
             }
             #featureSectionsContainer.team-members-view-feature .team-content-area { padding: 1.5rem; }
             #featureSectionsContainer.team-members-view-feature .team-filter { margin-bottom: 1.5rem; max-width: 400px; }
             #featureSectionsContainer.team-members-view-feature .team-filter input[type="text"] {
                 width: 100%; padding: 0.75rem 1rem;
                 border: 1px solid var(--input-border); border-radius: 6px;
                 background-color: var(--input-bg); color: var(--input-text);
                 box-sizing: border-box; font-size: 0.95rem;
                 transition: border-color 0.2s ease, box-shadow 0.2s ease;
             }
             #featureSectionsContainer.team-members-view-feature .team-filter input[type="text"]::placeholder { color: var(--placeholder-text); }
             #featureSectionsContainer.team-members-view-feature .team-filter input[type="text"]:focus {
                 outline: none; border-color: var(--input-focus-border);
                 box-shadow: 0 0 0 3px var(--input-focus-shadow);
             }
             #featureSectionsContainer.team-members-view-feature .team-members-list {
                 display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                 gap: 1.5rem; /* Use dashboard gap */
             }
             #featureSectionsContainer.team-members-view-feature .team-member-card {
                 display: flex; flex-direction: column; align-items: flex-start;
                 background-color: var(--card-bg); border: 1px solid var(--card-border);
                 border-radius: var(--card-radius); padding: 1.25rem;
                 box-shadow: 0 3px 8px var(--card-shadow);
                 transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out;
                 overflow: hidden;
             }
             #featureSectionsContainer.team-members-view-feature .team-member-card:hover {
                 transform: translateY(-3px); box-shadow: 0 6px 12px var(--card-hover-shadow);
                 border-color: var(--gray);
             }
             #featureSectionsContainer.team-members-view-feature .member-info { width: 100%; }
             #featureSectionsContainer.team-members-view-feature .member-name {
                 font-size: 1.15rem; font-weight: 600; color: var(--heading-color);
                 margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
             }
             #featureSectionsContainer.team-members-view-feature .member-email {
                 font-size: 0.88rem; color: var(--text-muted);
                 margin: 0 0 14px 0; word-break: break-all; line-height: 1.4;
             }
             #featureSectionsContainer.team-members-view-feature .member-role { /* Uses generic badge */ margin: 0; }
             #featureSectionsContainer.team-members-view-feature .member-role.role-admin { background-color: var(--danger); color: white; border-color: var(--danger-dark); }
             #featureSectionsContainer.team-members-view-feature .member-role.role-supervisor { background-color: var(--warning); color: var(--dark); border-color: var(--warning-dark); }
             #featureSectionsContainer.team-members-view-feature .member-role.role-senior { background-color: var(--success); color: white; border-color: var(--success-dark);}
             #featureSectionsContainer.team-members-view-feature .member-role.role-member { background-color: var(--secondary); color: white; border-color: var(--secondary-dark);}
             #featureSectionsContainer.team-members-view-feature .team-member-card.hidden-by-filter { display: none; }
        </style>
        <script>
             function initializeTeamMembersFeature(container) { // Renamed function
                console.log("Initializing Team Members Feature...");
                const searchInput = container.querySelector('#teamSearchInputFeature');
                const teamListContainer = container.querySelector('#teamListContainerFeature');
                const addMemberBtn = container.querySelector('.add-team-member-btn');

                let listeners = [];
                const addListener = (element, event, handler, options = {}) => { if (!element) return; element.addEventListener(event, handler, options); listeners.push({ element, event, handler, options }); };

                function filterTeamMembers() {
                    const filterText = searchInput.value.toLowerCase().trim();
                    const memberCards = teamListContainer.querySelectorAll('.team-member-card');
                    let hasVisible = false;
                    memberCards.forEach(card => {
                        const name = (card.dataset.name || '').toLowerCase();
                        const role = (card.dataset.role || '').toLowerCase();
                        const email = (card.dataset.email || '').toLowerCase();
                        const isMatch = name.includes(filterText) || role.includes(filterText) || email.includes(filterText);
                        card.classList.toggle('hidden-by-filter', !isMatch);
                        if(isMatch) hasVisible = true;
                    });
                     let noResultsEl = teamListContainer.querySelector('.no-results-message');
                     if (!hasVisible) { if (!noResultsEl) { noResultsEl = document.createElement('p'); noResultsEl.className = 'no-results-message'; noResultsEl.textContent = 'No members found matching your search.'; noResultsEl.style.gridColumn = '1 / -1'; noResultsEl.style.textAlign = 'center'; noResultsEl.style.color = 'var(--text-muted)'; noResultsEl.style.padding = '2rem'; teamListContainer.appendChild(noResultsEl); } } else if (noResultsEl) { noResultsEl.remove(); }
                }

                loadTeamMembers(container); // Load members into the feature view
                addListener(searchInput, 'input', filterTeamMembers);
                addListener(addMemberBtn, 'click', () => window.openMemberModal()); // Use global function

                const cleanup = () => { console.log("Cleaning up Team Members feature listeners..."); listeners.forEach(({ element, event, handler, options }) => { element?.removeEventListener(event, handler, options); }); listeners = []; };
                return { cleanup };
            }
        </script>
        <!-- HTML Structure -->
        <div class="team-members-section">
            <div class="team-members-section-header">
               <h2>Team Members</h2>
               <!-- Add Member button is dynamically added by JS if admin -->
                ${window.currentUser?.role === 'admin' ? `<button class="btn btn-primary add-team-member-btn"><i class="fas fa-user-plus"></i> Add Member</button>` : ''}
            </div>
            <div class="team-content-area">
                <div class="team-filter">
                    <input type="text" id="teamSearchInputFeature" placeholder="Search team by name, email, or role..." aria-label="Search team members">
                </div>
                <div class="team-members-list team-list-display" id="teamListContainerFeature">
                    <p style="color: var(--gray);">Loading team members...</p>
                </div>
            </div>
        </div>
    </template>

    <!-- Template: Projects Feature -->
    <template id="projectsAssets">
         <style id="injected-projects-styles">
             #featureSectionsContainer.projects-feature #projects-section { width: 100%; max-width: none; margin: 0; padding: 1.5rem; background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); }
             #featureSectionsContainer.projects-feature .projects-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem; border-bottom: 1px solid var(--card-border); padding-bottom: 1rem; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper { background-color: transparent; padding: 0; border-radius: 0; box-shadow: none; flex-grow: 1; border-left: none; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper h2 { color: var(--heading-color); margin: 0; font-weight: 600; font-size: 1.5rem; }
             #featureSectionsContainer.projects-feature .project-controls { display: flex; flex-wrap: wrap; align-items: center; gap: 0.75rem; padding: 0; background-color: transparent; border-radius: 0; box-shadow: none; }
             #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select { padding: 0.6rem 1rem; border: 1px solid var(--input-border); border-radius: 6px; font-size: 0.9em; background-color: var(--input-bg); color: var(--input-text); transition: border-color 0.2s ease, box-shadow 0.2s ease; min-width: 150px; }
             #featureSectionsContainer.projects-feature .project-search-input:focus, #featureSectionsContainer.projects-feature .project-filter-select:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
             #featureSectionsContainer.projects-feature .project-filter-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px; padding-right: 2.5rem; }
             body.dark-theme #featureSectionsContainer.projects-feature .project-filter-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); }
             #featureSectionsContainer.projects-feature .add-project-btn { /* Uses .btn styles */ }
             #featureSectionsContainer.projects-feature .projects-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; }
             #featureSectionsContainer.projects-feature .project-card { background-color: var(--card-bg); border-radius: var(--card-radius); border: 1px solid var(--card-border); box-shadow: 0 4px 8px var(--card-shadow); overflow: hidden; display: flex; flex-direction: column; transition: transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out; }
             #featureSectionsContainer.projects-feature .project-card:hover { transform: translateY(-5px) scale(1.01); box-shadow: 0 8px 16px var(--card-hover-shadow); }
             #featureSectionsContainer.projects-feature .project-card-image { height: 160px; background-size: cover; background-position: center; }
             #featureSectionsContainer.projects-feature .project-card-body { padding: 1.25rem; display: flex; flex-direction: column; flex-grow: 1; }
             #featureSectionsContainer.projects-feature .project-name { font-size: 1.25em; font-weight: 600; color: var(--heading-color); margin-top: 0; margin-bottom: 0.75rem; }
             #featureSectionsContainer.projects-feature .progress-bar-container { width: 100%; height: 8px; background-color: var(--light-gray); border-radius: 4px; overflow: hidden; margin-bottom: 1rem; }
             #featureSectionsContainer.projects-feature .progress-bar { height: 100%; border-radius: 4px; transition: width 0.4s ease; text-align: center; color: white; font-size: 0.7em; font-weight: 500; line-height: 8px; display: flex; align-items: center; justify-content: center; }
             #featureSectionsContainer.projects-feature .project-card[data-status='completed'] .progress-bar { background-color: var(--success); }
             #featureSectionsContainer.projects-feature .project-card[data-status='in-progress'] .progress-bar { background-color: var(--warning); color: var(--dark); }
             #featureSectionsContainer.projects-feature .project-card[data-status='active'] .progress-bar { background-color: var(--info); }
             #featureSectionsContainer.projects-feature .project-card[data-status='pending'] .progress-bar { background-color: var(--secondary); }
             #featureSectionsContainer.projects-feature .project-info { font-size: 0.85em; color: var(--text-muted); margin-bottom: 0.75rem; line-height: 1.5; display: flex; align-items: flex-start; }
             #featureSectionsContainer.projects-feature .project-info i { margin-right: 8px; color: var(--text-muted); width: 16px; text-align: center; margin-top: 3px; }
             #featureSectionsContainer.projects-feature .project-participants span { display: inline-block; background-color: var(--light); color: var(--text-color); padding: 3px 8px; border-radius: 10px; font-size: 0.75em; margin-right: 4px; margin-bottom: 4px; white-space: nowrap; border: 1px solid var(--card-border); }
             body.dark-theme #featureSectionsContainer.projects-feature .project-participants span { background-color: var(--light); color: var(--text-color); border-color: var(--light-gray); }
             #featureSectionsContainer.projects-feature .project-participants .participant-list { flex: 1; }
             #featureSectionsContainer.projects-feature .project-status { /* Uses generic status badge */ margin-bottom: 1rem; align-self: flex-start; }
             #featureSectionsContainer.projects-feature .project-actions { margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--card-border); display: flex; gap: 0.5rem; flex-wrap: wrap; }
             #featureSectionsContainer.projects-feature .project-actions .btn { font-size: 0.8em; }
             #featureSectionsContainer.projects-feature .project-actions .btn i { font-size: 0.9em; }
             #featureSectionsContainer.projects-feature .btn-view { background-color: var(--primary); color: white; }
             #featureSectionsContainer.projects-feature .btn-edit { background-color: var(--warning); color: var(--dark); }
             #featureSectionsContainer.projects-feature .btn-delete { background-color: var(--danger); color: white; }
             #featureSectionsContainer.projects-feature .btn:disabled { background-color: var(--secondary); color: var(--text-muted); opacity: 0.7; cursor: not-allowed; }
        </style>
        <script>
            function initializeProjectsFeature(container) {
                 console.log("Initializing Projects Feature...");
                 const searchInput = container.querySelector('#projectSearchInputFeature');
                 const filterSelect = container.querySelector('#projectFilterSelectFeature');
                 const projectsListContainer = container.querySelector('#projectsListContainerFeature');
                 const addProjectBtn = container.querySelector('#addProjectBtnFeature');

                 let listeners = [];
                 const addListener = (element, event, handler, options = {}) => { if (!element) return; element.addEventListener(event, handler, options); listeners.push({ element, event, handler, options }); };

                 // Use global renderProjects defined in main script
                 window.renderProjects(container);

                 const filterHandler = () => window.renderProjects(container);
                 const actionHandler = (event) => {
                     const target = event.target.closest('.btn'); if (!target) return;
                     const projectId = target.dataset.projectId; if (!projectId) return;
                     if (target.classList.contains('btn-view')) { window.showToast(`Placeholder: View details for Project ID ${projectId}`); }
                     else if (target.classList.contains('btn-edit')) { window.openProjectModal(projectId); }
                     else if (target.classList.contains('btn-delete')) { window.handleDeleteProject(projectId); }
                 };
                 const addHandler = () => { window.openProjectModal(); };

                 addListener(searchInput, 'input', filterHandler);
                 addListener(filterSelect, 'change', filterHandler);
                 addListener(projectsListContainer, 'click', actionHandler);
                 addListener(addProjectBtn, 'click', addHandler);

                 const cleanup = () => { console.log("Cleaning up Projects feature listeners..."); listeners.forEach(({ element, event, handler, options }) => { element?.removeEventListener(event, handler, options); }); listeners = []; };
                 return { cleanup };
             }
        </script>
        <!-- HTML Structure -->
        <section id="projects-section" class="feature-content">
             <div class="projects-header">
                 <div class="projects-title-wrapper"><h2>Projects</h2></div>
                 <div class="project-controls">
                     <input type="search" placeholder="Search Projects..." class="project-search-input" id="projectSearchInputFeature">
                     <select class="project-filter-select form-select form-select-sm" id="projectFilterSelectFeature">
                         <option value="all">All Statuses</option>
                         <option value="active">Active</option>
                         <option value="in-progress">In Progress</option>
                         <option value="completed">Completed</option>
                         <option value="pending">Pending</option>
                     </select>
                     ${(window.currentUser?.role === 'admin' || window.currentUser?.role === 'supervisor') ? `<button class="btn btn-primary add-project-btn" id="addProjectBtnFeature"> <i class="fas fa-plus-circle"></i> Add Project </button>` : ''}
                 </div>
             </div>
            <div class="projects-list" id="projectsListContainerFeature">
                <p style="color: var(--gray); grid-column: 1 / -1; text-align: center; padding: 2rem;">Loading projects...</p>
            </div>
        </section>
    </template>

    <!-- Template: Employee Scheduling Feature -->
    <template id="employeeSchedulingAssets">
        <style id="injected-employee-scheduling-styles">
            /* Styles already in main CSS, scoped selectors used in template */
        </style>
        <script>
             // Logic already in main JS (initializeEmployeeScheduleLogic)
        </script>
        <!-- HTML structure generated by JS -->
        <div id="employee-schedule-content">
            <!-- Header, controls, table container will be inserted here by JS -->
        </div>
    </template>

    <!-- Template: Data Management Feature -->
    <template id="dataManagementAssets">
        <style id="injected-data-management-styles">
             /* Styles already in main CSS, scoped selectors used in template */
        </style>
        <script>
             // Logic already in main JS (initializeDataManagementFeature)
        </script>
        <!-- HTML Structure -->
        <div id="data-management-section" class="feature-content">
            <h2 class="dm-fancy-title"><i class="fas fa-database"></i> Data Management</h2>
            <div class="dm-toolbar">
                <div class="dm-search-filter">
                    <input type="search" id="dm-search-input" placeholder="Search data (ID, Name, etc.)..." class="form-control form-control-sm">
                    <select id="dm-filter-status" class="form-select form-select-sm"> <option value="">Filter by Status...</option> <option value="active">Active</option> <option value="pending">Pending</option> <option value="inactive">Inactive</option> </select>
                    <select id="dm-filter-responsible" class="form-select form-select-sm"> <option value="">Filter by Responsible...</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Basssant Badr">Basssant Badr</option> <option value="Other">Other</option> </select>
                </div>
                <div class="dm-actions">
                    <button id="dm-add-new-btn" class="dm-add-btn btn btn-sm btn-primary"><i class="fas fa-plus"></i> Add New</button>
                    <button id="dm-import-btn" class="dm-import-btn btn btn-sm btn-success"><i class="fas fa-file-import"></i> Import</button>
                    <button id="dm-export-btn" class="dm-export-btn btn btn-sm btn-warning"><i class="fas fa-file-export"></i> Export</button>
                </div>
            </div>
            <div class="dm-table-container table-responsive">
                <table class="dm-table feature-table" id="dm-data-table">
                    <thead> <tr> <th><input type="checkbox" id="dm-select-all" title="Select All"></th> <th>ID</th> <th>Record Name</th> <th>Creation Date</th> <th>Responsible</th> <th>Status</th> <th>Last Updated</th> <th>Actions</th> </tr> </thead>
                    <tbody id="dm-table-body"> <tr><td colspan="8" style="text-align:center; padding: 20px;">Loading data...</td></tr> </tbody>
                </table>
            </div>
            <div class="dm-pagination" id="dm-pagination-controls"></div>
        </div>
    </template>

    <!-- Template: Deadline Tracker Feature -->
    <template id="deadlineTrackerAssets">
        <style id="injected-deadline-tracker-styles">
             /* Styles already in main CSS, scoped selectors used in template */
        </style>
        <script>
             // Logic already in main JS (initializeDeadlineTrackerFeature)
        </script>
         <!-- HTML Structure -->
         <div class="deadline-tracker-container feature-content"> <!-- Use feature-content padding -->
             <header class="tracker-header"> <h1><i class="fas fa-calendar-check"></i> Deadline Tracker</h1> </header>
             <div class="tracker-main-content">
                  <section class="task-input-container card">
                      <h2>Add New Task</h2>
                      <form id="task-form">
                          <div class="form-group"> <label for="task-name">Task Name:</label> <input type="text" id="task-name" class="form-control" name="task-name" required placeholder="Task description..."> </div>
                          <div class="form-group"> <label for="assignee-select">Assignee:</label> <select id="assignee-select" class="form-select" name="assignee" required> <option value="" disabled selected>-- Assignee --</option> </select> </div>
                          <div class="form-group"> <label for="start-date">Start Date:</label> <input type="date" id="start-date" class="form-control" name="start-date" required> </div>
                          <div class="form-group"> <label for="deadline-date">Deadline:</label> <input type="date" id="deadline-date" class="form-control" name="deadline" required> </div>
                          <button type="submit" class="btn btn-primary">Add Task</button>
                      </form>
                  </section>
                  <section class="chart-container card">
                      <h2>Task Status Overview</h2> <canvas id="task-status-chart"></canvas>
                  </section>
             </div>
             <section class="tracker-controls card">
                  <div class="control-group"> <label for="sort-by">Sort By:</label> <select id="sort-by" class="form-select"> <option value="deadline-asc">Deadline (Soonest)</option> <option value="deadline-desc">Deadline (Latest)</option> <option value="start-date-asc">Start Date (Oldest)</option> <option value="assignee-asc">Assignee (A-Z)</option> <option value="status-asc">Status</option> </select> </div>
                  <div class="control-group"> <label for="filter-assignee">Filter Assignee:</label> <select id="filter-assignee" class="form-select"> <option value="All">All Assignees</option> </select> </div>
                  <div class="control-group"> <label for="filter-status">Filter Status:</label> <select id="filter-status" class="form-select"> <option value="All">All Statuses</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> <option value="Overdue">Overdue</option> </select> </div>
                  <div class="export-buttons"> <button id="export-excel" class="button-export btn btn-sm" title="Download Excel Report"><i class="fas fa-file-excel"></i> Excel</button> <button id="export-pdf" class="button-pdf btn btn-sm" title="Download PDF Report"><i class="fas fa-file-pdf"></i> PDF</button> </div>
             </section>
             <section class="tasks-display-area card"> <!-- Added card -->
                 <div class="table-responsive">
                     <table id="tasks-table" class="feature-table">
                         <thead> <tr> <th>Task Name</th> <th>Assignee</th> <th>Start Date</th> <th>Deadline</th> <th>Duration</th> <th>Status</th> <th>Actions</th> </tr> </thead>
                         <tbody id="tasks-tbody"> <!-- Rows generated by JS --> </tbody>
                     </table>
                 </div>
             </section>
         </div>
    </template>

    <!-- Template: Innovation Hub Feature -->
    <template id="innovationHubAssets">
         <style id="injected-innovation-hub-styles">
             /* Styles already in main CSS, scoped selectors used in template */
         </style>
         <script>
             // Logic already in main JS (initializeInnovationHubFeature)
         </script>
        <!-- HTML Structure -->
        <div class="innovation-hub-container feature-content">
             <header class="hub-header"> <h1>💡 Innovation Hub — Share Your Ideas & Improve Our Workplace</h1> </header>
             <section class="submission-form-container card">
                 <h2>Submit a New Suggestion</h2>
                 <form id="suggestion-form">
                     <div class="form-group"> <label for="suggestion-text">Your Idea / Suggestion:</label> <textarea id="suggestion-text" name="suggestion-text" class="form-control" rows="4" required placeholder="Describe your innovative idea..."></textarea> </div>
                     <div class="form-row">
                          <div class="form-group"> <label for="employee-select">Submitted By:</label> <select id="employee-select" name="employee" class="form-control form-select" required> <option value="" disabled selected>-- Select Your Name --</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> <option value="Nada Mahmoud">Nada Mahmoud</option> </select> </div>
                          <button type="submit" class="btn btn-primary">Submit Idea</button>
                     </div>
                 </form>
             </section>
             <section class="hub-controls">
                  <div class="form-group"> <label for="filter-status">Filter by Status:</label> <select id="filter-status" class="form-control form-select"> <option value="All">All Statuses</option> <option value="Under Review">Under Review</option> <option value="Implemented">Implemented</option> <option value="Rejected">Rejected</option> </select> </div>
                  <div class="form-group"> <label for="filter-author">Filter by Author:</label> <select id="filter-author" class="form-control form-select"> <option value="All">All Authors</option> </select> </div>
                  <button id="my-ideas-toggle" class="btn btn-outline">Show My Ideas Only</button>
             </section>
             <section id="suggestions-list"> <!-- Suggestion cards inserted here --> </section>
         </div>
    </template>

    <!-- Template: Team Calendar Feature -->
    <template id="teamCalendarAssets">
        <style id="injected-team-calendar-styles">
            /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.team-calendar-feature .calendar-page-container { height: calc(100% - 0px); /* Let feature container handle height */}
        </style>
        <script>
            // Logic already in main JS (initializeTeamCalendarFeature)
        </script>
         <!-- HTML Structure -->
        <div class="calendar-page-container feature-content" style="padding: 0; display: flex; flex-direction: column; height: 100%;">
             <header class="calendar-header">
                 <button class="nav-button btn btn-sm btn-outline" id="calendar-prev-month" aria-label="Previous Month"><i class="fas fa-chevron-left"></i></button>
                 <button class="nav-button btn btn-sm btn-outline" id="calendar-next-month" aria-label="Next Month"><i class="fas fa-chevron-right"></i></button>
                 <h2 class="current-month-year" id="calendar-current-month-year">May 2025</h2>
                 <button class="add-event-button btn btn-sm btn-primary" id="calendar-add-event"><i class="fas fa-plus"></i> <span>Add Event</span></button>
             </header>
             <main class="calendar-main-content">
                 <div id="calendar-container">
                     <div class="calendar-grid-placeholder">
                         <div class="calendar-day other-month"><span class="day-number">27</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">28</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">29</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">30</span><div class="event-list"></div></div>
                         <div class="calendar-day current-month"><span class="day-number">1</span><div class="event-list"><div class="event event-meeting"><span>Team Sync</span><span class="employee-name">Nada M.</span></div><div class="event event-deadline important"><span>Project Alpha Due</span><span class="event-badge">!</span></div></div></div>
                         <div class="calendar-day current-month today"><span class="day-number">2</span><div class="event-list"><div class="event event-task"><span>Design Review</span><span class="employee-name">Yousef A.</span></div></div></div>
                         <div class="calendar-day current-month"><span class="day-number">3</span><div class="event-list"><div class="event event-personal"><span>Doc Appointment</span></div></div></div>
                         <div class="calendar-day current-month"><span class="day-number">4</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">5</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">6</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">7</span><div class="event-list"><div class="event event-meeting"><span>Client Call</span><span class="employee-name">Esraa L.</span></div></div></div> <div class="calendar-day current-month"><span class="day-number">8</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">9</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">10</span><div class="event-list"><div class="event event-task"><span>Deploy Staging</span><span class="employee-name">Mohamed E.</span></div></div></div> <div class="calendar-day current-month"><span class="day-number">11</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">12</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">13</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">14</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">15</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">16</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">17</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">18</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">19</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">20</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">21</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">22</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">23</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">24</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">25</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">26</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">27</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">28</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">29</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">30</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">31</span><div class="event-list"></div></div>
                         <div class="calendar-day other-month"><span class="day-number">1</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">2</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">3</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">4</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">5</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">6</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">7</span><div class="event-list"></div></div>
                     </div>
                 </div>
             </main>
         </div>
    </template>

    <!-- ========= END Feature Templates ========= -->


    <!-- JS Libraries (Bootstrap, Chart.js, SweetAlert2, jsPDF, jsPDF-AutoTable) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Chart.js already included -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- jsPDF and AutoTable included conditionally or make sure they are loaded -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script> -->

    <script>
        // Main Dashboard Logic (including fixes and integrations)
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements ---
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.menu-item');
            const contentSections = document.querySelectorAll('.content-area > .content-section');
            const dashboardContent = document.getElementById('dashboardContent');
            const profileContent = document.getElementById('profileContent');
            const settingsContent = document.getElementById('settingsContent');
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureTitleEl = document.getElementById('featureTitle');
            const featureDescEl = document.getElementById('featureDescription');
            const featureLoadingEl = featurePlaceholder.querySelector('.loading-indicator');
            const featureErrorEl = featurePlaceholder.querySelector('.error-message');
            const backButton = document.getElementById('backButton');
            const backButtonText = document.getElementById('backButtonText');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const searchInput = document.getElementById('searchInput');
            const searchResultsContainer = document.getElementById('searchResults');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationBadge = document.getElementById('notificationBadge');
            const notificationsModal = document.getElementById('notificationsModal');
            const closeNotifications = document.getElementById('closeNotifications');
            const notificationsBody = document.getElementById('notificationsBody');
            const noNotificationsMessage = document.getElementById('noNotificationsMessage');
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn');
            // const notificationSound = document.getElementById('notificationSound'); // Removed: Causes 404
            const activityList = document.getElementById('activityList');
            const viewAllActivity = document.getElementById('viewAllActivity');
            const deleteAllActivity = document.getElementById('deleteAllActivity');
            const statsSection = document.getElementById('statsSection');
            const welcomeSection = document.getElementById('welcomeSection');
            // Profile Elements
            const profileForm = document.getElementById('profileForm');
            const profileAvatarLarge = document.getElementById('profileAvatarLarge');
            const profileAvatarInput = document.getElementById('profileAvatarInput');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const fullNameDisplay = document.getElementById('fullNameDisplay');
            const jobTitleInput = document.getElementById('jobTitle');
            const emailDisplay = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const departmentInput = document.getElementById('department');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const cancelProfileBtn = document.getElementById('cancelProfileBtn');
            // Settings Elements
            const themeOptions = document.querySelectorAll('.theme-option');
            const highContrastToggle = document.getElementById('highContrastToggle');
            const languageSelect = document.getElementById('languageSelect');
            const regionSelect = document.getElementById('regionSelect');
            const timeFormatSelect = document.getElementById('timeFormatSelect');
            const dateFormatSelect = document.getElementById('dateFormatSelect');
            const toastToggle = document.getElementById('toastToggle');
            const soundToggle = document.getElementById('soundToggle');
            const notificationToneSelect = document.getElementById('notificationToneSelect');
            const savePreferencesBtn = document.getElementById('savePreferencesBtn');
            // Account Settings
            const accountEmailDisplay = document.getElementById('accountEmail');
            const changeEmailInput = document.getElementById('changeEmail');
            const accountConfirmPasswordInput = document.getElementById('accountConfirmPassword');
            const saveAccountEmailBtn = document.getElementById('saveAccountEmailBtn');
            const accountNotificationsToggle = document.getElementById('accountNotificationsToggle');
            const saveAccountSettingsBtn = document.getElementById('saveAccountSettingsBtn');
            // Security Settings
            const changePasswordForm = document.getElementById('changePasswordForm');
            const enable2faBtn = document.getElementById('enable2faBtn');
            const twoFaSetupSection = document.getElementById('twoFaSetupSection');
            const twoFaManagementSection = document.getElementById('twoFaManagementSection');
            const twoFaStatusIndicator = document.getElementById('twoFaStatusIndicator');
            const twoFaStatusText = document.getElementById('twoFaStatusText');
            const twoFaSetupOptions = document.getElementById('twoFaSetupOptions');
            const setupAuthAppBtn = document.getElementById('setupAuthAppBtn');
            const setupSmsBtn = document.getElementById('setupSmsBtn');
            const authAppSetup = document.getElementById('authAppSetup');
            const smsSetup = document.getElementById('smsSetup');
            const verifyAuthCodeBtn = document.getElementById('verifyAuthCodeBtn');
            const userPhoneNumberForSms = document.getElementById('userPhoneNumberForSms');
            const sendSmsCodeBtn = document.getElementById('sendSmsCodeBtn');
            const smsCodeInputGroup = document.getElementById('smsCodeInputGroup');
            const verifySmsCodeBtn = document.getElementById('verifySmsCodeBtn');
            const disable2faBtn = document.getElementById('disable2faBtn');
            const saveSessionSettingsBtn = document.getElementById('saveSessionSettingsBtn');
            // Danger Zone
            const logoutAllDevicesBtn = document.getElementById('logoutAllDevicesBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            // Notification Settings Panel
            const emailNotificationsToggle = document.getElementById('emailNotificationsToggle');
            const inAppNotificationsToggle = document.getElementById('inAppNotificationsToggle');
            const pushNotificationsToggle = document.getElementById('pushNotificationsToggle');
            const notificationTypeCheckboxes = document.querySelectorAll('input[name="notificationType"]');
            const saveNotificationSettingsBtn = document.getElementById('saveNotificationSettingsBtn');
            // Modals & Messages
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const successMessage = document.getElementById('successMessage');
            const successMessageText = document.getElementById('successMessageText');
            const toastMessage = document.getElementById('toastMessage');
            const memberModal = document.getElementById('memberModal');
            const memberForm = document.getElementById('memberForm');
            const memberModalTitle = document.getElementById('memberModalTitle');
            const saveMemberBtn = document.getElementById('saveMemberBtn');
            const projectModal = document.getElementById('projectModal');
            const projectForm = document.getElementById('projectForm');
            const projectModalTitle = document.getElementById('projectModalTitle');
            const saveProjectBtn = document.getElementById('saveProjectBtn');
            // Logout Link
            const logoutLink = document.getElementById('logoutLink');

            // --- State Variables ---
            let currentUser = null; let currentFeature = 'dashboard'; let currentSettingsTab = 'preferences'; let notifications = []; let activities = []; let activityIntervalId = null; let notificationIntervalId = null; let statsIntervalId = null; let welcomeBgIntervalId = null; let confirmCallback = null; let maxActivitiesToShow = 5; let showingAllActivities = false; let userDropdownOpen = false; let showToasts = true; let playSounds = true; let currentScheduleWeekOffset = 0; let scheduleMinWeekOffset = 0; let mockScheduleData = {}; let currentFeatureCleanup = null; let MOCK_PROJECTS_DATA = []; let MOCK_TASKS = [];

            // --- Mock Data ---
            let MOCK_USERS = [ { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin', twoFaEnabled: false }, { id: 2, name: 'Nada Mahmoud', email: 'n.mahmoud@thechefz.co', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'NM', role: 'supervisor', twoFaEnabled: false }, { id: 3, name: 'Yousef Ahmed', email: 'y.abbas@thechefz.co', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'YA', role: 'senior', twoFaEnabled: true }, { id: 4, name: 'Esraa Lashin', email: 'e.lasheen@thechefz.co', title: 'Member', department: 'Design', phone: '+20155444333', avatar: '', initials: 'EL', role: 'member', twoFaEnabled: false }, { id: 5, name: 'Bassant Badr', email: 'b.badr@thechefz.co', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'BB', role: 'member', twoFaEnabled: false }, ];
            const MOCK_PROJECTS = [ { id: 101, name: 'Project Alpha', status: 'Active' }, { id: 102, name: 'Project Beta', status: 'Planning' }, { id: 103, name: 'Project Gamma', status: 'Completed' }, { id: 104, name: 'Zeus Initiative', status: 'Active' }, ];
            function initializeMockTasks() { MOCK_TASKS = [ { id: 201, name: 'Design Homepage Mockup', status: 'Completed', project: 101, description: 'Create mockups for main pages using Figma.', links: "https://figma.com", assignedBy: "Yousef", assignedTo: "Esraa Lashin", startDate: "2024-07-21", dueDate: "2024-07-25", priority: "Medium", completionDate: "2024-07-24" }, { id: 202, name: 'Develop API Endpoints', status: 'In Progress', project: 101, description: 'Build RESTful APIs for core features.', links: "", assignedBy: "Nada", assignedTo: "Yousef Ahmed", startDate: "2024-07-23", dueDate: "2024-07-30", priority: "High", completionDate: null }, { id: 203, name: 'User Testing Phase 1', status: 'Pending', project: 102, description: 'Conduct usability tests with target group.', links: "", assignedBy: "Nada", assignedTo: "Bassant Badr", startDate: "2024-08-01", dueDate: "2024-08-05", priority: "Medium", completionDate: null }, { id: 204, name: 'Create Task Management Feature', status: 'In Progress', project: 104, description: 'Integrate the task management component.', links: "#task-management", assignedBy: "Mohamed Elmenisy", assignedTo: "Mohamed Elmenisy", startDate: "2024-07-28", dueDate: "2024-08-10", priority: "High", completionDate: null }, { id: 205, name: 'Fix Login Bug (JIRA-123)', description: "Special characters issue in password field.", links: "jira-123", assignedBy: "Yousef Ahmed", assignedTo: "Yousef Ahmed", startDate: "2024-07-15", dueDate: "2024-07-18", priority: "High", status: "Completed", completionDate: "2024-07-17" }, { id: 206, name: 'Prepare Q4 Budget Proposal', description: "Draft budget for next quarter.", links: "", assignedBy: "Nada Mahmoud", assignedTo: "Mohamed Elmenisy", startDate: "2024-08-05", dueDate: "2024-08-15", priority: "Medium", status: "Pending", completionDate: null }, ]; }

            // --- Initialization ---
            function initDashboard() { currentUser = { ...MOCK_USERS[0] }; window.currentUser = currentUser; console.log("Initializing dashboard for:", currentUser.name); applyStoredPreferences(); updateUserUI(); setupEventListeners(); initializeMockTasks(); loadInitialData(); handleInitialNavigation(); startDynamicUpdates(); setupResponsiveSidebar(); }

            // --- Global Utility Functions ---
            window.timeAgo = function(timestamp) { if (!timestamp) return ''; if (!(timestamp instanceof Date)) { const date = new Date(timestamp); if (isNaN(date.getTime())) return ''; timestamp = date; } const now = new Date(); const secondsPast = (now.getTime() - timestamp.getTime()) / 1000; if (secondsPast < 10) { return 'Just now'; } if (secondsPast < 60) { return parseInt(secondsPast) + 's ago'; } if (secondsPast < 3600) { return parseInt(secondsPast / 60) + 'm ago'; } if (secondsPast < 3600 * 24) { return parseInt(secondsPast / 3600) + 'h ago'; } return formatDateForDisplay(timestamp); }
            window.formatDateForDisplay = function(date) { if (!date) return 'N/A'; if (!(date instanceof Date)) { const parsedDate = new Date(date); if (isNaN(parsedDate.getTime())) return ''; date = parsedDate; } const dateFormat = localStorage.getItem('dateFormat') || 'MM/DD/YYYY'; const year = date.getFullYear(); const month = date.getMonth() + 1; const day = date.getDate(); const monthPadded = String(month).padStart(2, '0'); const dayPadded = String(day).padStart(2, '0'); const monthName = date.toLocaleDateString(undefined, { month: 'short' }); try { switch (dateFormat) { case 'DD/MM/YYYY': return `${dayPadded}/${monthPadded}/${year}`; case 'YYYY-MM-DD': return `${year}-${monthPadded}-${dayPadded}`; case 'Month D, YYYY': return `${monthName} ${day}, ${year}`; case 'MM/DD/YYYY': default: return `${monthPadded}/${dayPadded}/${year}`; } } catch (e) { console.error("Error formatting date:", e); return `${String(month).padStart(2, '0')}/${String(day).padStart(2, '0')}/${year}`; } }
            window.formatFullDateTime = function(date) { if (!date) return 'N/A'; if (!(date instanceof Date)) { const parsedDate = new Date(date); if (isNaN(parsedDate.getTime())) return ''; date = parsedDate; } const formattedDate = formatDateForDisplay(date); const timeFormat = localStorage.getItem('timeFormat') || '12h'; const options = { hour: 'numeric', minute: 'numeric', hour12: timeFormat === '12h' }; try { const formattedTime = date.toLocaleTimeString(undefined, options); return `${formattedDate}, ${formattedTime}`; } catch (e) { console.error("Error formatting time:", e); return formattedDate; } }
            window.generateMockActivities = function(count, baseTimestampMillis) { const nowMillis=baseTimestampMillis||Date.now(); const newActivities=[]; let users=MOCK_USERS.map(u=>u.name.split(' ')[0]); if(users.length===0)users.push('System'); const actions=['updated profile','completed task','added project','commented on task','uploaded file','joined team']; const icons=['fa-user-edit','fa-check-circle','fa-plus-circle','fa-comment','fa-upload','fa-user-plus']; const tasks=MOCK_TASKS.map(t=>`'${t.name.substring(0,20)}...'`); const projects=MOCK_PROJECTS_DATA.map(p=>`'${p.name}'`); const files=['doc.pdf','img.png','sheet.xlsx','pres.pptx']; for(let i=0;i<count;i++){ const user=users[Math.floor(Math.random()*users.length)]; const actionIndex=Math.floor(Math.random()*actions.length); let message=`${user} ${actions[actionIndex]}`; if(actions[actionIndex].includes('task')&&tasks.length>0){message+=` ${tasks[Math.floor(Math.random()*tasks.length)]}`;}else if(actions[actionIndex].includes('project')&&projects.length>0){message+=` ${projects[Math.floor(Math.random()*projects.length)]}`;}else if(actions[actionIndex].includes('file')&&files.length>0){message+=` ${files[Math.floor(Math.random()*files.length)]}`;} let timestampMillis; if(count===1){timestampMillis=nowMillis-Math.random()*1000*10;}else{timestampMillis=nowMillis-(Math.random()*1000*3600*(i+1)*1.5+300000);} timestampMillis=Math.min(timestampMillis,nowMillis); newActivities.push({id:nowMillis+i+Math.floor(Math.random()*1000),icon:icons[actionIndex],message:message,timestamp:new Date(timestampMillis),isNew:false});} return count>1?newActivities.sort((a,b)=>b.timestamp-a.timestamp):newActivities; }
            window.generateMockNotifications = function(count, baseTimestampMillis) { const nowMillis=baseTimestampMillis||Date.now(); const newNotifications=[]; const types=[{msg:'New task assigned:',icon:'fa-tasks',type:'task'},{msg:'Project deadline approaching:',icon:'fa-clock',type:'project'},{msg:'Mentioned you:',icon:'fa-comment-dots',type:'comment'},{msg:'System update:',icon:'fa-info-circle',type:'system'},{msg:'File shared:',icon:'fa-file-alt',type:'file'},]; const tasks=MOCK_TASKS.map(t=>`'${t.name.substring(0,20)}...'`); const projects=MOCK_PROJECTS_DATA.map(p=>`'${p.name}'`); let users=MOCK_USERS.map(u=>u.name.split(' ')[0]); if(users.length===0)users.push('System'); const files=['report.docx','logo.svg','data.csv']; for(let i=0;i<count;i++){ const typeInfo=types[Math.floor(Math.random()*types.length)]; let message=typeInfo.msg; if(typeInfo.type==='task'&&tasks.length>0)message+=` ${tasks[Math.floor(Math.random()*tasks.length)]}`;else if(typeInfo.type==='project'&&projects.length>0)message+=` ${projects[Math.floor(Math.random()*projects.length)]}`;else if(typeInfo.type==='comment'&&users.length>0)message+=` by ${users[Math.floor(Math.random()*users.length)]}`;else if(typeInfo.type==='file'&&files.length>0&&users.length>0)message+=` ${files[Math.floor(Math.random()*files.length)]} by ${users[Math.floor(Math.random()*users.length)]}`; let timestampMillis; if(count===1){timestampMillis=nowMillis-Math.random()*1000*15;}else{timestampMillis=nowMillis-(Math.random()*1000*3600*(i+1)*1.8+180000);} timestampMillis=Math.min(timestampMillis,nowMillis); newNotifications.push({id:nowMillis+i+10000+Math.floor(Math.random()*1000),icon:typeInfo.icon,message:message,timestamp:new Date(timestampMillis),unread:count===1?true:Math.random()>0.3});} return count>1?newNotifications.sort((a,b)=>b.timestamp-a.timestamp):newNotifications; }
            window.showConfirmModal = function(title, message, onConfirm, buttonClass = 'btn-danger') { confirmTitle.textContent = title; confirmMessage.innerHTML = message; confirmCallback = onConfirm; confirmBtn.className = 'btn'; confirmBtn.classList.add(buttonClass); confirmModal.classList.add('active'); }
            function hideConfirmModal() { confirmModal.classList.remove('active'); confirmCallback = null; }
            window.showSuccessMessage = function(message) { successMessageText.textContent = message; successMessage.classList.add('show'); setTimeout(() => { successMessage.classList.remove('show'); }, 3000); }
            window.showToast = function(message, type = 'info') { if (!showToasts && type !== 'error') { console.log("Toast suppressed:", message); return; } toastMessage.textContent = message; toastMessage.className = 'toast'; if (type === 'success') { toastMessage.classList.add('success'); } else if (type === 'error') { toastMessage.classList.add('error'); } toastMessage.classList.add('show'); setTimeout(() => { toastMessage.classList.remove('show'); }, 3000); }
            window.getCurrentDate = function() { const now = new Date(); return now.toISOString().split('T')[0]; };
            window.getCurrentDateTime = function() { const now = new Date(); return now.toISOString().replace('T', ' ').substring(0, 16); };
            window.getCssVar = function(varName) { return getComputedStyle(document.documentElement).getPropertyValue(varName).trim(); };

             // Define globally needed functions from features if they weren't already
            window.loadTeamMembers = loadTeamMembers;
            window.openMemberModal = openMemberModal;
            window.handleRemoveMember = handleRemoveMember;
            window.handleSaveMember = handleSaveMember;
            window.renderProjects = renderProjects;
            window.handleDeleteProject = handleDeleteProject;
            window.openProjectModal = openProjectModal;
            window.handleSaveProject = handleSaveProject;
            window.initializeEmployeeScheduleLogic = initializeEmployeeScheduleLogic;
            window.handleSendReminders = handleSendReminders;
            window.renderSchedule = function() { /* Placeholder - real function is in init */ console.warn("renderSchedule called globally, should be instance method."); }; // Placeholder


            // --- UI Updates ---
            // ... (All UI update functions) ...
             updateUserUI(); // Call after defining functions

            // --- Preferences & Settings Logic ---
            // ... (All preference functions) ...
            applyStoredPreferences(); // Call after defining functions

            // --- Navigation & Content Loading ---
            // ... (All navigation functions) ...
            handleInitialNavigation(); // Call after defining functions

            // --- Data Loading & Simulation ---
            // ... (All data loading functions) ...
            loadInitialData(); // Call after defining functions

            // --- Dynamic Updates Simulation ---
            // ... (startDynamicUpdates, changeWelcomeBackground) ...
            startDynamicUpdates(); // Call after defining functions

            // --- Event Listeners ---
            // ... (All event listener setup) ...
            setupEventListeners(); // Call after defining functions

            // --- Specific Feature Logic ---
            // ... (Feature specific logic, mostly moved to templates now) ...
            setupResponsiveSidebar(); // Call after defining functions

            // --- Team Management Logic ---
            // ... (All team management functions) ...

            // --- Projects Feature Logic (Global helpers) ---
            // ... (renderProjects, handleDeleteProject, openProjectModal, handleSaveProject defined globally for access) ...

            // --- Employee Scheduling (Global helpers) ---
            // ... (getWeekDates, getShiftText defined globally for access) ...

            console.log("Dashboard Initialized Successfully.");

        }); // End DOMContentLoaded
    </script>

</body>
</html>

الأكيد، سأقوم بمراجعة الكود بالكامل مرة أخرى مع التركيز الشديد على النقاط التي ذكرتها لحل المشاكل المتبقية وضمان عمل الداشبورد بشكل متكامل وسليم.

**التعديلات التي تم إجراؤها:**

1.  **`loadTeamMembers is not defined` Error:** تم التأكد من تعريف الدالة `loadTeamMembers` بشكل صحيح وجعلها متاحة عند الحاجة إليها، خاصة عند التبديل إلى تبويب "Team Management" في الإعدادات أو عرض قسم "Team Members".
2.  **`renderProjects is not defined` Error:** تم التأكد من أن دالة `renderProjects` معرفة ضمن نطاق الدالة `initializeProjectsFeature` ويتم استدعاؤها بشكل صحيح بعد تحميل البيانات أو عند تغيير الفلاتر.
3.  **`aria-hidden` on `<body>`:** تمت مراجعة منطق فتح وإغلاق الـ Modals (خاصة Bootstrap modals إذا كانت مستخدمة). هذا الخطأ يحدث غالبًا بسبب مكتبات خارجية تضيف هذا الـ attribute. الكود الحالي يتجنب إضافته يدويًا. تأكد من عدم وجود تعارض مع إضافات المتصفح لديك.
4.  **تحميل الجداول:** من المفترض أن حل أخطاء JavaScript (مثل `loadTeamMembers` و `renderProjects`) يسمح الآن بتنفيذ بقية الشيفرة وتحميل البيانات في الجداول. تم التأكد من أن الدوال المسؤولة عن عرض البيانات (`renderTable`, `renderTasks`, `renderProjects`, `renderEmployeeSummaryTable`...إلخ) يتم استدعاؤها بعد جلب البيانات (المحاكاة حاليًا).
5.  **عرض الاسم والرول:** تم التأكد من أن دالة `updateUserUI` تعمل بشكل صحيح وأن `currentUser` يتم تعيينه قبل استدعائها. يجب أن تظهر البيانات الآن.
6.  **رفع الصور:** مع حل أخطاء JavaScript، يجب أن تعمل الآن event listeners الخاصة برفع الصورة (`profileAvatarLarge` و `profileAvatarInput`).
7.  **أزرار الإجراءات في الجداول:** تم مراجعة event listeners المرفقة بالجداول (مثل `handleTableBodyClick`) للتأكد من أن المحددات (selectors) صحيحة وأن الدوال المرتبطة بها (`handleEditClick`, `handleDeleteClick`, إلخ) معرفة وتعمل.
8.  **الرسوم البيانية:** تم التأكد من وجود العناصر (`canvas`) وأن مكتبة Chart.js تم تحميلها بشكل صحيح. الدوال المسؤولة عن إنشاء الرسوم البيانية (`renderTaskCompletionChart`, `renderProjectStatusPieChart`, إلخ) يتم استدعاؤها بعد تحميل البيانات اللازمة.
9.  **التنسيق Dark/Light:** تم إجراء مراجعة شاملة لأنماط CSS الخاصة بكل ميزة داخل قوالب الـ `<template>`، مع التأكيد على استخدام متغيرات CSS الرئيسية للداشبورد (`var(--card-bg)`, `var(--text-color)`) لضمان التناسق. تم إضافة قواعد `!important` عند الضرورة في وضع التباين العالي.
10. **التنقل بين الصفحات:** تم مراجعة منطق `setActiveFeature` لضمان إزالة محتوى وأنماط الميزة السابقة بشكل كامل قبل تحميل الميزة الجديدة باستخدام `currentFeatureCleanup`.
11. **ملفات 404:** الروابط لملفات `notification.mp3` و `site.webmanifest` بقيت معلقة.
12. **الكود الكامل:** تم تضمين جميع القوالب والوظائف اللازمة في الكود أدناه.

**الكود الكامل والمراجع:**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">
    <!-- <link rel="manifest" href="/site.webmanifest"> --> <!-- Removed: Causes 404 if file doesn't exist -->
    <meta name="theme-color" content="#1e3a8a"> <!-- Theme color for browser UI -->

    <!-- Bootstrap 5 CSS (Needed for some Features like File Sharing) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- SweetAlert2 CSS (for Data Management, File Sharing confirm actions) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- Chart.js Library (REQUIRED for Deadline Tracker, Reports, Project Tracking) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS Library (REQUIRED for Deadline Tracker Excel Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- PDF Export Libraries (Optional - Uncomment if implementing for Deadline Tracker, Reports) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script> -->


    <style>
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb; /* Blue 600 */
            --primary-dark: #1e3a8a; /* Blue 900 */
            --primary-light: #dbeafe; /* Blue 100 */
            --secondary: #475569; /* Slate 600 */
            --secondary-dark: #1e293b; /* Slate 800 */
            --secondary-light: #e2e8f0; /* Slate 200 */
            --success: #10b981; /* Emerald 500 */
            --success-dark: #047857; /* Emerald 700 */
            --success-light: #a7f3d0; /* Emerald 200 */
            --danger: #ef4444; /* Red 500 */
            --danger-dark: #b91c1c; /* Red 700 */
            --danger-light: #fee2e2; /* Red 100 */
            --warning: #f59e0b; /* Amber 500 */
            --warning-dark: #b45309; /* Amber 700 */
            --warning-light: #fef3c7; /* Amber 100 */
            --info: #0ea5e9; /* Sky 500 */
            --info-dark: #0369a1; /* Sky 700 */
            --info-light: #bae6fd; /* Sky 200 */

            --dark: #1e293b;  /* Default Text Color (Dark in Light Mode) */
            --light: #f8fafc; /* Light Gray 50 */
            --gray: #64748b; /* Slate 500 */
            --light-gray: #e2e8f0; /* Slate 200 */
            --white: #ffffff;

            --sidebar-width: 280px;
            --sidebar-bg: var(--primary-dark);
            --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1);
            --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1);

            --input-bg: var(--white);
            --input-border: var(--light-gray);
            --input-focus-border: var(--primary);
            --input-focus-shadow: rgba(37, 99, 235, 0.1);
            --input-text: var(--dark);
            --placeholder-text: var(--gray);

            --card-bg: var(--white);
            --card-border: var(--light-gray);
            --card-shadow: rgba(0, 0, 0, 0.05);
            --card-hover-shadow: rgba(0, 0, 0, 0.08);
            --card-radius: 8px;

            --table-header-bg: var(--light);
            --table-header-text: var(--gray);
            --table-border-color: var(--light-gray);
            --table-row-hover-bg: var(--primary-light);

            --compact-padding: 0.5rem;
            --normal-padding: 1rem;
            --spacious-padding: 1.5rem;

            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); /* Light Blue */
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); /* Light Green */
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); /* Light Yellow */
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); /* Light Red */

            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1); /* Default welcome bg */
            --dashboard-header-bg: linear-gradient(90deg, hsla(217, 91%, 60%, 1) 0%, hsla(245, 100%, 70%, 1) 100%); /* Fancy Header Gradient */

            /* High Contrast Variables */
            --hc-text: #000000;
            --hc-background: #ffffff;
            --hc-primary: #0000ff;
            --hc-secondary: #008000;
            --hc-link: #0000ee;
            --hc-border: #000000;

            /* Text Color Variable */
            --text-color: var(--dark);
            --text-muted: var(--gray);
            --heading-color: var(--dark);

             /* Schedule specific */
             --schedule-weekend-bg: #f3f4f6;
             --schedule-weekend-text: #9ca3af;
             --shift-morning-bg: #dbeafe; --shift-morning-text: #1e40af; --shift-morning-border: #bfdbfe;
             --shift-afternoon-bg: #e0f2fe; --shift-afternoon-text: #0c4a6e; --shift-afternoon-border: #bae6fd;
             --shift-night-bg: #ede9fe; --shift-night-text: #5b21b6; --shift-night-border: #ddd6fe;
             --shift-off-bg: #f0fdf4; --shift-off-text: #166534; --shift-off-border: #bbf7d0;
             --shift-sick-bg: #fee2e2; --shift-sick-text: #991b1b; --shift-sick-border: #fecaca;
             --shift-vacation-bg: #ffedd5; --shift-vacation-text: #9a3412; --shift-vacation-border: #fed7aa;

            /* Status Badge Generic Colors */
            --status-completed-bg: var(--success-light); --status-completed-text: var(--success-dark);
            --status-inprogress-bg: var(--info-light); --status-inprogress-text: var(--info-dark);
            --status-overdue-bg: var(--danger-light); --status-overdue-text: var(--danger-dark);
            --status-pending-bg: var(--warning-light); --status-pending-text: var(--warning-dark);
            --status-active-bg: var(--info-light); --status-active-text: var(--info-dark); /* Alias */
            --status-inactive-bg: #f1f5f9; --status-inactive-text: #475569; /* Slate */
            --status-rejected-bg: var(--danger-light); --status-rejected-text: var(--danger-dark); /* Alias */
            --status-under-review-bg: var(--primary-light); --status-under-review-text: var(--primary-dark);
            --status-implemented-bg: var(--success-light); --status-implemented-text: var(--success-dark); /* Alias */
            --status-delayed-bg: var(--warning-light); --status-delayed-text: var(--warning-dark); /* Alias */

            /* Priority Badge Generic Colors */
            --priority-high-bg: var(--danger-light); --priority-high-text: var(--danger-dark);
            --priority-medium-bg: var(--warning-light); --priority-medium-text: var(--warning-dark);
            --priority-low-bg: var(--success-light); --priority-low-text: var(--success-dark);

            /* Chart Colors (Simplified) */
            --chart-color-1: var(--primary);
            --chart-color-2: var(--success);
            --chart-color-3: var(--warning);
            --chart-color-4: var(--danger);
            --chart-color-5: var(--info);
            --chart-color-6: var(--secondary);
            --chart-color-7: #a855f7; /* Purple */
        }

        /* --- Dark Theme --- */
        body.dark-theme {
            --primary: #60a5fa; /* Blue 400 */
            --primary-dark: #2563eb; /* Blue 600 */
            --primary-light: #1e3a8a; /* Blue 900 */
            --secondary: #94a3b8; /* Slate 400 */
            --secondary-dark: #e2e8f0; /* Slate 200 */
            --secondary-light: #334155; /* Slate 700 */
            --success: #4ade80; /* Green 400 */
            --success-dark: #bbf7d0; /* Green 200 */
            --success-light: #15803d; /* Green 700 */
            --danger: #f87171; /* Red 400 */
            --danger-dark: #fecaca; /* Red 200 */
            --danger-light: #b91c1c; /* Red 700 */
            --warning: #facc15; /* Yellow 400 */
            --warning-dark: #fef08a; /* Yellow 200 */
            --warning-light: #b45309; /* Amber 700 */
            --info: #38bdf8; /* Sky 400 */
            --info-dark: #bae6fd; /* Sky 200 */
            --info-light: #0369a1; /* Sky 700 */

            --dark: #e2e8f0; /* Slate 200 */
            --light: #1e293b; /* Slate 800 */
            --gray: #94a3b8; /* Slate 400 */
            --light-gray: #475569; /* Slate 600 */
            --white: #0f172a; /* Slate 900 */

            --sidebar-bg: var(--white); /* Darker sidebar */
            --sidebar-text: rgba(226, 232, 240, 0.8); /* Lighter text */
            --sidebar-hover: rgba(226, 232, 240, 0.05);
            --sidebar-active: rgba(226, 232, 240, 0.1);
            --sidebar-divider: var(--light-gray);

            --input-bg: var(--light);
            --input-border: var(--light-gray);
            --input-focus-border: var(--primary);
            --input-focus-shadow: rgba(96, 165, 250, 0.1);
            --input-text: var(--dark);
            --placeholder-text: var(--gray);

            --card-bg: var(--light);
            --card-border: var(--light-gray);
            --card-shadow: rgba(0, 0, 0, 0.1);
            --card-hover-shadow: rgba(0, 0, 0, 0.15);

            --table-header-bg: #334155; /* Slate 700 */
            --table-header-text: var(--gray);
            --table-border-color: var(--light-gray);
            --table-row-hover-bg: #475569; /* Slate 600 */

            --text-color: var(--dark);
            --text-muted: var(--gray);
            --heading-color: var(--dark);

             /* Schedule specific Dark */
             --schedule-weekend-bg: #262f3e; --schedule-weekend-text: #6b7280;
             --shift-morning-bg: #1e3a8a; --shift-morning-text: #dbeafe; --shift-morning-border: #2563eb;
             --shift-afternoon-bg: #0e7490; --shift-afternoon-text: #ecfeff; --shift-afternoon-border: #22d3ee;
             --shift-night-bg: #581c87; --shift-night-text: #f3e8ff; --shift-night-border: #a855f7;
             --shift-off-bg: #064e3b; --shift-off-text: #d1fae5; --shift-off-border: #34d399;
             --shift-sick-bg: #881337; --shift-sick-text: #fecdd3; --shift-sick-border: #fb7185;
             --shift-vacation-bg: #7c2d12; --shift-vacation-text: #ffedd5; --shift-vacation-border: #fb923c;

            /* Status Badge Dark Colors */
            --status-completed-bg: var(--success-light); --status-completed-text: var(--success-dark);
            --status-inprogress-bg: var(--info-light); --status-inprogress-text: var(--info-dark);
            --status-overdue-bg: var(--danger-light); --status-overdue-text: var(--danger-dark);
            --status-pending-bg: var(--warning-light); --status-pending-text: var(--warning-dark);
            --status-active-bg: var(--info-light); --status-active-text: var(--info-dark);
            --status-inactive-bg: var(--secondary-light); --status-inactive-text: var(--secondary-dark);
            --status-rejected-bg: var(--danger-light); --status-rejected-text: var(--danger-dark);
            --status-under-review-bg: var(--primary-light); --status-under-review-text: var(--primary-dark);
            --status-implemented-bg: var(--success-light); --status-implemented-text: var(--success-dark);
            --status-delayed-bg: var(--warning-light); --status-delayed-text: var(--warning-dark);

            /* Priority Badge Dark Colors */
            --priority-high-bg: var(--danger-light); --priority-high-text: var(--danger-dark);
            --priority-medium-bg: var(--warning-light); --priority-medium-text: var(--warning-dark);
            --priority-low-bg: var(--success-light); --priority-low-text: var(--success-dark);

            /* Chart Dark */
            --chart-background: var(--light);

            background-color: var(--white); /* Dark bg for body */
        }

        /* --- High Contrast Mode --- */
        body.high-contrast {
             --text-color: var(--hc-text);
             --text-muted: var(--hc-text);
             --heading-color: var(--hc-text);
             --light: var(--hc-background);
             --white: var(--hc-background);
             --dark: var(--hc-text);
             --gray: var(--hc-text);
             --light-gray: var(--hc-border);
             --primary: var(--hc-primary);
             --primary-dark: var(--hc-primary);
             --primary-light: #e0e0ff;
             --secondary: var(--hc-secondary);
             --success: var(--hc-secondary);
             --warning: #ffa500;
             --danger: #ff0000;
             --info: var(--hc-primary);

             --sidebar-bg: var(--hc-background); --sidebar-text: var(--hc-text); --sidebar-hover: #e0e0e0; --sidebar-active: #c0c0c0; --sidebar-divider: var(--hc-border);
             --input-bg: var(--hc-background); --input-border: var(--hc-border); --input-text: var(--hc-text); --placeholder-text: var(--hc-text);
             --card-bg: var(--hc-background); --card-border: var(--hc-border); --card-shadow: none; --card-hover-shadow: none;
             --table-header-bg: var(--hc-background); --table-header-text: var(--hc-text); --table-border-color: var(--hc-border); --table-row-hover-bg: #e0e0e0;

             --schedule-weekend-bg: #dddddd; --schedule-weekend-text: var(--hc-text);
             --shift-morning-bg: var(--hc-background); --shift-morning-text: var(--hc-text); --shift-morning-border: var(--hc-border);
             --shift-afternoon-bg: var(--hc-background); --shift-afternoon-text: var(--hc-text); --shift-afternoon-border: var(--hc-border);
             --shift-night-bg: var(--hc-background); --shift-night-text: var(--hc-text); --shift-night-border: var(--hc-border);
             --shift-off-bg: var(--hc-background); --shift-off-text: var(--hc-text); --shift-off-border: var(--hc-border);
             --shift-sick-bg: var(--hc-background); --shift-sick-text: var(--hc-text); --shift-sick-border: var(--hc-border);
             --shift-vacation-bg: var(--hc-background); --shift-vacation-text: var(--hc-text); --shift-vacation-border: var(--hc-border);

             /* Status/Priority Badges HC */
             --status-completed-bg: transparent; --status-completed-text: var(--hc-secondary);
             --status-inprogress-bg: transparent; --status-inprogress-text: var(--hc-primary);
             --status-overdue-bg: transparent; --status-overdue-text: var(--danger);
             --status-pending-bg: transparent; --status-pending-text: var(--hc-text);
             --status-active-bg: transparent; --status-active-text: var(--hc-primary);
             --status-inactive-bg: transparent; --status-inactive-text: var(--hc-text);
             --status-rejected-bg: transparent; --status-rejected-text: var(--danger);
             --status-under-review-bg: transparent; --status-under-review-text: var(--hc-primary);
             --status-implemented-bg: transparent; --status-implemented-text: var(--hc-secondary);
             --status-delayed-bg: transparent; --status-delayed-text: var(--warning);
             --priority-high-bg: transparent; --priority-high-text: var(--danger);
             --priority-medium-bg: transparent; --priority-medium-text: var(--warning);
             --priority-low-bg: transparent; --priority-low-text: var(--hc-secondary);

             --chart-background: var(--hc-background);

             background-color: var(--hc-background);
        }
        /* Specific High Contrast Overrides */
        body.high-contrast .welcome-section,
        body.high-contrast .stat-card,
        body.high-contrast .top-nav,
        body.high-contrast .sidebar,
        body.high-contrast .activity-section,
        body.high-contrast .content-section,
        body.high-contrast .modal-content,
        body.high-contrast .confirm-container,
        body.high-contrast .notifications-container,
        body.high-contrast #featureSectionsContainer .card,
        body.high-contrast #featureSectionsContainer .filters-section,
        body.high-contrast #featureSectionsContainer .upload-area,
        body.high-contrast #featureSectionsContainer .chart-container,
        body.high-contrast #featureSectionsContainer .pt-reminders,
        body.high-contrast #featureSectionsContainer .pt-table-container,
        body.high-contrast #featureSectionsContainer .ra-table-container,
        body.high-contrast #featureSectionsContainer .team-members-section,
        body.high-contrast #featureSectionsContainer .team-member-card,
        body.high-contrast #featureSectionsContainer .team-content-area,
        body.high-contrast #featureSectionsContainer .projects-title-wrapper,
        body.high-contrast #featureSectionsContainer .project-controls,
        body.high-contrast #featureSectionsContainer .project-card,
        body.high-contrast #featureSectionsContainer .schedule-container,
        body.high-contrast #featureSectionsContainer .schedule-controls,
        body.high-contrast #featureSectionsContainer .submission-form-container,
        body.high-contrast #featureSectionsContainer .suggestion-card,
        body.high-contrast #featureSectionsContainer .calendar-header,
        body.high-contrast #featureSectionsContainer .page-title-container,
        body.high-contrast #featureSectionsContainer .calendar-main-content,
        body.high-contrast #featureSectionsContainer .dm-fancy-title,
        body.high-contrast #featureSectionsContainer #data-management-section,
        body.high-contrast #featureSectionsContainer .tracker-header,
        body.high-contrast #featureSectionsContainer .task-input-container.card,
        body.high-contrast #featureSectionsContainer .chart-container.card,
        body.high-contrast #featureSectionsContainer .tracker-controls.card,
        body.high-contrast #featureSectionsContainer .tasks-display-area {
            background: var(--hc-background) !important;
            border: 1px solid var(--hc-border) !important;
            color: var(--text-color) !important;
            box-shadow: none !important;
        }
        body.high-contrast .team-members-section-header,
        body.high-contrast .card-header,
        body.high-contrast .modal-header,
        body.high-contrast .calendar-header, /* Add calendar header */
        body.high-contrast .notifications-header { /* Add notification header */
             background: var(--hc-background) !important;
             border-color: var(--hc-border) !important;
             color: var(--text-color) !important;
        }
         body.high-contrast .notifications-header, /* Specific override for notif header */
         body.high-contrast .close-notifications {
             background: var(--hc-primary) !important; /* Use primary for contrast */
             color: var(--hc-background) !important;
             border-color: var(--hc-border) !important;
         }
        body.high-contrast .btn,
        body.high-contrast .form-control,
        body.high-contrast .form-select,
        body.high-contrast .search-bar input,
        body.high-contrast .project-search-input,
        body.high-contrast .project-filter-select,
        body.high-contrast .team-filter input,
        body.high-contrast .pt-pagination button,
        body.high-contrast .btn-group label.btn,
        body.high-contrast #dm-search-input, /* Data management inputs */
        body.high-contrast #dm-filter-status,
        body.high-contrast #dm-filter-responsible {
            border: 1px solid var(--hc-border) !important;
            background: var(--hc-background) !important;
            color: var(--text-color) !important;
        }
        body.high-contrast .project-filter-select,
        body.high-contrast .form-select,
        body.high-contrast #dm-filter-status,
        body.high-contrast #dm-filter-responsible { /* HC Select Arrow */
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23000000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e") !important;
        }
        body.high-contrast .btn-primary,
        body.high-contrast .swal2-confirm { background-color: var(--hc-primary) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-danger,
        body.high-contrast .swal2-cancel,
        body.high-contrast .btn-confirm-delete,
        body.high-contrast .button-pdf { background-color: var(--danger) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-warning,
        body.high-contrast .dm-export-btn { background-color: var(--warning) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-success,
        body.high-contrast .button-export,
        body.high-contrast .dm-import-btn { background-color: var(--hc-secondary) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-secondary,
        body.high-contrast .btn-cancel-delete { background-color: var(--hc-background) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important;}
        body.high-contrast .btn-outline,
        body.high-contrast .btn-outline-secondary { background: var(--hc-background) !important; color: var(--hc-primary) !important; border: 1px solid var(--hc-primary) !important; }
        body.high-contrast .btn-outline-danger { background: var(--hc-background) !important; color: var(--danger) !important; border: 1px solid var(--danger) !important;}
        body.high-contrast .btn-outline-success { background: var(--hc-background) !important; color: var(--hc-secondary) !important; border: 1px solid var(--hc-secondary) !important;}
        body.high-contrast .btn-outline-info { background: var(--hc-background) !important; color: var(--hc-primary) !important; border: 1px solid var(--hc-primary) !important;}
        body.high-contrast .logo { color: var(--text-color) !important; }
        body.high-contrast .logo-icon { color: var(--hc-primary) !important; }
        body.high-contrast .menu-item { color: var(--text-color) !important; border-left-color: transparent !important; }
        body.high-contrast .menu-item.active { background-color: #c0c0c0 !important; border-left-color: var(--hc-primary) !important; color: var(--hc-text) !important; }
        body.high-contrast .stat-card { border-left-width: 3px !important; background: var(--hc-background) !important; }
        body.high-contrast .welcome-section .user-info-title { color: var(--hc-text) !important; }
        body.high-contrast .badge,
        body.high-contrast .status-badge,
        body.high-contrast .priority-badge,
        body.high-contrast .member-role,
        body.high-contrast .project-status,
        body.high-contrast .suggestion-status,
        body.high-contrast .shift,
        body.high-contrast .dm-status,
        body.high-contrast .event,
        body.high-contrast .event-badge { border: 1px solid var(--hc-border) !important; color: var(--hc-text) !important; background: none !important; padding: 3px 8px !important; font-weight: bold !important; }
        body.high-contrast .progress-bar { border: 1px solid var(--hc-border) !important; color: var(--hc-text) !important; background: none !important; font-weight: bold; }
        body.high-contrast .progress,
        body.high-contrast .progress-bar-container { background: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .project-participants span,
        body.high-contrast .assigned-team span,
        body.high-contrast .dm-table .dm-status { border: 1px solid var(--hc-border) !important; color: var(--hc-text) !important; background: none !important; }
        body.high-contrast .theme-preview { border: 2px solid var(--hc-border) !important; background: var(--hc-background) !important; }
        body.high-contrast .theme-option.selected .theme-preview { border-color: var(--hc-primary) !important; }
        body.high-contrast .switch .slider { background-color: #999 !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .switch input:checked + .slider { background-color: var(--hc-primary) !important; }
        body.high-contrast .switch .slider:before { background-color: var(--hc-text) !important; }
        body.high-contrast .table thead,
        body.high-contrast .schedule-table thead th,
        body.high-contrast .dm-table th,
        body.high-contrast #tasks-table thead th,
        body.high-contrast .feature-table thead th { background: var(--hc-background) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .table tbody td,
        body.high-contrast .schedule-table tbody td,
        body.high-contrast .dm-table td,
        body.high-contrast #tasks-table tbody td,
        body.high-contrast .feature-table tbody td { border: 1px solid var(--hc-border) !important; background: var(--hc-background) !important; }
        body.high-contrast .employee-name { background: var(--hc-background) !important; border-right: 2px solid var(--hc-border) !important; }
        body.high-contrast .day-name,
        body.high-contrast .day-date { color: var(--hc-text) !important; }
        body.high-contrast .shift-weekend-off { border: none !important; font-style: normal !important; }
        body.high-contrast .task-card { border: 1px solid var(--hc-border) !important; border-left-width: 3px !important; }
        body.high-contrast .file-icon { color: var(--hc-text) !important; }
        body.high-contrast .fancy-header-title,
        body.high-contrast .pt-fancy-title,
        body.high-contrast .ra-fancy-title,
        body.high-contrast .dm-fancy-title { background: var(--hc-primary) !important; color: var(--hc-background) !important; }
        body.high-contrast canvas { border: 1px dashed var(--hc-border); }
        body.high-contrast .supervisor-reply { background-color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important;}
        body.high-contrast .calendar-day.today .day-number { border: 2px solid var(--hc-text) !important; background-color: var(--hc-background) !important; color: var(--hc-text) !important;}
        body.high-contrast .calendar-day { border: 1px solid var(--hc-border) !important;}
        body.high-contrast .calendar-grid-placeholder { background-color: var(--hc-border) !important; border-color: var(--hc-border) !important;}

        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--primary-light); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* --- Sidebar Styles --- */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; text-decoration: none;}
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .connection-status span { font-weight: 600; } /* Added bold */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--input-border); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--input-bg); color: var(--input-text); }
        .search-bar input::placeholder { color: var(--placeholder-text); }
        .search-bar input:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; }
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--text-color); }
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; }
        .dropdown-item:hover { background-color: var(--light); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; } /* Adjusted height */
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section {
            background: var(--welcome-bg-current); /* Use variable */
            color: var(--white); /* Welcome section text is white by design */
            padding: 2rem;
            border-radius: var(--card-radius);
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; /* Smooth background transition */
        }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--danger); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--success); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card {
            background: var(--card-bg); /* Default */
            border-radius: var(--card-radius);
            padding: 1.5rem;
            box-shadow: 0 2px 5px var(--card-shadow);
            transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 5px solid var(--primary); /* Colored border */
            color: var(--text-color); /* Ensure text inside uses appropriate theme color */
        }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--success); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }

        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px var(--card-hover-shadow); }
        .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        .stat-card:nth-child(1) .stat-value { color: #1e40af; } /* Blue 800 */
        .stat-card:nth-child(2) .stat-value { color: #065f46; } /* Emerald 800 */
        .stat-card:nth-child(3) .stat-value { color: #b45309; } /* Amber 700 */
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; } /* Red 700 */

        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--success-dark); }
        .trend-down { color: var(--danger-dark); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; border: 1px solid var(--card-border); }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--heading-color); }
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: var(--danger-dark); text-decoration: underline; background-color: var(--danger-light); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; } /* Added max-height and scroll */
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--table-border-color); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--text-color); }
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--text-muted); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        .delete-activity { color: var(--danger); cursor: pointer; opacity: 0.6; transition: opacity 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .activity-item:hover .delete-activity { opacity: 1; }
        .delete-activity:hover { opacity: 1; background-color: var(--danger-light); }

        /* --- Profile & Settings Sections Styles --- */
        .content-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; border: 1px solid var(--card-border); } /* Hidden by default */
        .content-section.active { display: block; } /* Shown when active */
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 1rem;} /* Added wrap and gap */
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--heading-color); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--text-muted); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; } /* Hide the button, use avatar click */

        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; }
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control, .form-select {
            width: 100%; padding: 0.75rem; border: 1px solid var(--input-border); border-radius: 6px; font-size: 1rem; background-color: var(--input-bg); color: var(--input-text); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        body.compact .form-control, body.compact .form-select { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control, body.spacious .form-select { padding: 1rem; }
        .form-control:focus, .form-select:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
        .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; }
        .form-select { /* Style select dropdown arrow */
             appearance: none;
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); /* Default arrow */
             background-repeat: no-repeat;
             background-position: right 0.75rem center;
             background-size: 16px 12px;
             padding-right: 2.5rem; /* Space for arrow */
        }
        body.dark-theme .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); /* Lighter arrow */
        }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }

        /* Button Base Styles */
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; text-decoration: none; line-height: 1.5; vertical-align: middle; }
        body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--dark); } /* Darker text on yellow */
        .btn-warning:hover:not(:disabled) { background-color: var(--warning-dark); }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: var(--danger-dark); }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: var(--success-dark); }
        .btn-secondary { background-color: var(--secondary); color: white; }
        .btn-secondary:hover:not(:disabled) { background-color: var(--secondary-dark); }
        .btn-info { background-color: var(--info); color: white; }
        .btn-info:hover:not(:disabled) { background-color: var(--info-dark); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-sm { padding: 0.3rem 0.6rem !important; font-size: 0.8rem !important; }
        .btn-outline-secondary { background-color: transparent; border: 1px solid var(--gray); color: var(--gray); }
        .btn-outline-secondary:hover:not(:disabled) { background-color: var(--light-gray); }
        .btn-outline-success { background-color: transparent; border: 1px solid var(--success); color: var(--success); }
        .btn-outline-success:hover:not(:disabled) { background-color: rgba(16, 185, 129, 0.1); }
        .btn-outline-danger { background-color: transparent; border: 1px solid var(--danger); color: var(--danger); }
        .btn-outline-danger:hover:not(:disabled) { background-color: rgba(239, 68, 68, 0.1); }
        .btn-outline-info { background-color: transparent; border: 1px solid var(--info); color: var(--info); }
        .btn-outline-info:hover:not(:disabled) { background-color: rgba(13, 202, 240, 0.1); }

        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--text-muted); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; }
        @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        /* Settings Sub-section */
        .settings-subsection { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray); }
        .settings-subsection:first-child { margin-top: 0; padding-top: 0; border-top: none; }
        .settings-subsection h4 { font-size: 1.1rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 1rem; }
        body.dark-theme .settings-subsection h4 { color: var(--primary); } /* Lighter heading in dark mode */
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; } /* Added wrap */
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; /* Default: Label takes full width */ }
        @media (min-width: 768px) { .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; } }
        .setting-item-label { font-weight: 500; color: var(--text-color); }
        .setting-item-description { font-size: 0.9rem; color: var(--text-muted); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
        @media (max-width: 767px) { .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; } }

        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--heading-color); margin-bottom: 1rem; }
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        /* Settings Panel Team Member Card Style */
        #settingsContent .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--card-border); border-radius: var(--card-radius); margin-bottom: 1rem; transition: all 0.2s; background-color: var(--card-bg); }
        body.compact #settingsContent .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious #settingsContent .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        #settingsContent .team-member-card:hover { box-shadow: 0 2px 4px var(--card-shadow); border-color: var(--primary); }
        #settingsContent .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact #settingsContent .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        #settingsContent .member-details { flex: 1; min-width: 0; }
        #settingsContent .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-name { font-size: 0.9rem; }
        #settingsContent .member-email { font-size: 0.9rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-email { font-size: 0.8rem; }
        #settingsContent .member-role { /* Uses generic badge */ margin: 0 1rem; flex-shrink: 0; }
        #settingsContent .role-admin { background-color: var(--danger-light); color: var(--danger-dark); border-color: var(--danger-dark); }
        #settingsContent .role-senior { background-color: var(--success-light); color: var(--success-dark); border-color: var(--success-dark); }
        #settingsContent .role-supervisor { background-color: var(--warning-light); color: var(--warning-dark); border-color: var(--warning-dark); }
        #settingsContent .role-member { background-color: var(--secondary-light); color: var(--secondary); border-color: var(--secondary); }
        #settingsContent .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        #settingsContent .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }

        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; /* Make spinner visible when inside button */ }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span.btn-text { /* Existing btn-text */ display: none; } /* Hide text when loading */
        .btn.loading span.loading-text { /* New class for "Loading..." */ display: inline; margin-left: 0.5rem; }
        .btn:not(.loading) span.loading-text { display: none; }

        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }

        /* --- Notifications Modal, Confirm Modal, Utils --- */
        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; }
        .notifications-modal.active { display: flex; }
        .notifications-container { width: 400px; max-width: 100%; background-color: var(--card-bg); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; border: 1px solid var(--card-border);}
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; }
        .notifications-title { font-size: 1.25rem; font-weight: 600; }
        .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; }
        .notifications-body { flex-grow: 1; overflow-y: auto; }
        .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--table-border-color); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; cursor: pointer; position: relative; }
        .notification-list-item:hover { background-color: var(--table-row-hover-bg); }
        .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); }
        .notification-list-item:last-child { border-bottom: none; }
        .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: var(--primary);}
        .notification-content { flex: 1; min-width: 0; }
        .notification-message { margin-bottom: 0.25rem; color: var(--text-color); line-height: 1.4; }
        .notification-time { font-size: 0.8rem; color: var(--text-muted); }
        .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--card-bg); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .notification-list-item:hover .delete-notification { opacity: 0.6; }
        .delete-notification:hover { opacity: 1; background: var(--danger-light); }
        .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); }
        .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--light); flex-wrap: wrap; gap: 0.5rem; }
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .confirm-modal.active { display: flex; }
        .confirm-container { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; border: 1px solid var(--card-border);}
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--heading-color); }
        .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--text-muted); }
        .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-message.show { transform: translateX(0); }
        .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); }
        .back-button i { transition: transform 0.2s; font-size: 0.8rem; }
        .back-button:hover i { transform: translateX(-3px); }
        .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--light-gray); border-radius: 8px; margin-top: 2rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; }
        .placeholder-content h2 { color: var(--heading-color); margin-bottom: 1rem; }
        .placeholder-content p { color: var(--text-muted); }
        .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; }
        .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: var(--danger-light); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }

        /* --- Generic Modal Styles --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1050; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background-color: var(--card-bg); width: 100%; max-width: 550px; border-radius: var(--card-radius); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out; color: var(--text-color); border: 1px solid var(--card-border); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--light-gray); }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--heading-color); }
        body.dark-theme .modal-title { color: var(--primary); }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;}
        .close-modal:hover { color: var(--danger); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- Checkbox Group --- */
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid var(--light-gray); border-radius: 6px; }
        .checkbox-group label { display: flex; align-items: center; gap: 0.5rem; font-weight: normal; font-size: 0.9rem; margin-bottom: 0; color: var(--text-color); }
        .checkbox-group input[type="checkbox"] { width: auto; margin-right: 0.25rem; }
        .settings-link { color: var(--primary); text-decoration: none; cursor: pointer; }
        .settings-link:hover { text-decoration: underline; color: var(--primary-dark); }

        /* --- Toast --- */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; }
        .toast.show { opacity: 1; bottom: 30px; }
        .toast.success { background-color: var(--success); }
        .toast.error { background-color: var(--danger); }

        /* --- Feature Specific Styles (Shared / Common) --- */
        .feature-content { /* Applied to feature containers */ padding: 1.5rem; background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; }
        body.dark-theme .feature-content { background-color: var(--light); border-color: var(--light-gray); }
        .feature-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; padding: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--light-gray); background-color: var(--card-bg); border-radius: var(--card-radius) var(--card-radius) 0 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        body.dark-theme .feature-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
        .feature-title { font-size: 1.5rem; font-weight: 600; color: var(--heading-color); margin: 0; }
        body.dark-theme .feature-title { color: var(--primary); }
        .feature-actions { display: flex; gap: 0.75rem; align-items: center; }

        /* Generic Feature Table Styles */
        .feature-table { width: 100%; margin-bottom: 1rem; color: var(--text-color); border-collapse: collapse; font-size: 0.9rem; }
        .feature-table thead th { padding: 0.85rem 0.75rem; text-align: left; background-color: var(--table-header-bg); color: var(--table-header-text); border-bottom: 2px solid var(--table-border-color); font-weight: 600; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.5px; white-space: nowrap; position: sticky; top: 0; z-index: 1; }
        .feature-table tbody td { padding: 0.85rem 0.75rem; vertical-align: middle; border-bottom: 1px solid var(--table-border-color); }
        .feature-table tbody tr:hover td { background-color: var(--table-row-hover-bg); }
        .feature-table .text-center { text-align: center !important; }
        .feature-table .text-end { text-align: right !important; }
        .feature-table .action-buttons .btn { margin: 0 2px; }
        .feature-table .file-icon, .feature-table .dm-status i { width: 20px; text-align: center; margin-right: 0.5rem; }
        .status-badge, .priority-badge, .dm-status, .member-role, .suggestion-status, .shift { display: inline-block; padding: 0.3em 0.7em; font-size: 0.75rem; font-weight: 600; border-radius: 10px; text-transform: capitalize; white-space: nowrap; line-height: 1.3; text-align: center; min-width: 70px; border: 1px solid transparent; }
        .status-completed, .status-implemented { background-color: var(--status-completed-bg); color: var(--status-completed-text); border-color: var(--status-completed-text);}
        .status-inprogress, .status-active, .status-under-review { background-color: var(--status-inprogress-bg); color: var(--status-inprogress-text); border-color: var(--status-inprogress-text); }
        .status-overdue, .status-rejected { background-color: var(--status-overdue-bg); color: var(--status-overdue-text); border-color: var(--status-overdue-text); }
        .status-pending, .status-delayed { background-color: var(--status-pending-bg); color: var(--status-pending-text); border-color: var(--status-pending-text); }
        .status-inactive { background-color: var(--status-inactive-bg); color: var(--status-inactive-text); border-color: var(--status-inactive-text); }
        .priority-high { background-color: var(--priority-high-bg); color: var(--priority-high-text); border-color: var(--priority-high-text); }
        .priority-medium { background-color: var(--priority-medium-bg); color: var(--priority-medium-text); border-color: var(--priority-medium-text); }
        .priority-low { background-color: var(--priority-low-bg); color: var(--priority-low-text); border-color: var(--priority-low-text); }
        .shift-morning { background-color: var(--shift-morning-bg); color: var(--shift-morning-text); border-color: var(--shift-morning-border); }
        .shift-afternoon { background-color: var(--shift-afternoon-bg); color: var(--shift-afternoon-text); border-color: var(--shift-afternoon-border); }
        .shift-night { background-color: var(--shift-night-bg); color: var(--shift-night-text); border-color: var(--shift-night-border); }
        .shift-off { background-color: var(--shift-off-bg); color: var(--shift-off-text); border-color: var(--shift-off-border); }
        .shift-sick { background-color: var(--shift-sick-bg); color: var(--shift-sick-text); border-color: var(--shift-sick-border); }
        .shift-vacation { background-color: var(--shift-vacation-bg); color: var(--shift-vacation-text); border-color: var(--shift-vacation-border); }

        /* Container for Feature Sections */
        #featureSectionsContainer { display: none; background-color: transparent; padding: 0; box-shadow: none; border: none; border-radius: 0; }
        #featureSectionsContainer.active { display: block; min-height: calc(100vh - 150px); display: flex; flex-direction: column; }
        #featureSectionsContainer > *:first-child { flex-grow: 1; display: flex; flex-direction: column; }

        /* Responsive Styles (Combined) */
        @media (max-width: 992px) {
             .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; }
             .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
             .main-content { margin-left: 0; }
             .search-bar { width: 250px; }
             .main-content.sidebar-active { margin-left: 250px; }
             .sidebar-toggle { display: block; position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
             .top-nav { padding-left: 60px; }
             #featureSectionsContainer.projects-feature .projects-header { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper { width: auto; }
             #featureSectionsContainer.projects-feature .project-controls { justify-content: flex-start; }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-main-content { flex-direction: column; }
             #featureSectionsContainer.deadline-tracker-feature .chart-container,
             #featureSectionsContainer.deadline-tracker-feature .task-input-container { grid-column: span 12; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container,
             #featureSectionsContainer.project-tracking-feature .pt-reminders { height: 280px; }
             #featureSectionsContainer.reports-analytics-feature .chart-container { height: 300px; }
        }
        @media (min-width: 993px) { .sidebar-toggle { display: none; } }
        @media (max-width: 768px) {
             .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; }
             .search-bar { width: 100%; order: 2; }
             .user-menu { width: 100%; justify-content: space-between; order: 1; }
             .content-area { padding: 1.5rem; }
             .data-form { grid-template-columns: 1fr; }
             .form-actions { grid-column: span 1; }
             .user-info { flex-direction: column; text-align: center; }
             .user-info-avatar { margin-bottom: 1rem; }
             .stats-section { grid-template-columns: 1fr; }
             .settings-tabs { flex-wrap: nowrap; overflow-x: auto; }
             .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; }
             .confirm-container { width: 90%; }
             #settingsContent .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
             #settingsContent .member-role { margin: 0.5rem 0; }
             #settingsContent .member-actions { margin-top: 0.5rem; width: 100%; justify-content: flex-end; }
             .profile-avatar-section { margin-bottom: 1.5rem; }
             #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; }
             .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; }
             .add-member-form .data-form > div { margin-bottom: 1rem; }
             .add-member-form .data-form > div:last-child { margin-top: 0; }
             .modal-content { width: 95%; padding: 1.5rem;}
             .notifications-container { width: 100%; max-width: 100%; }
             .sidebar-toggle { top: 10px; left: 10px; }
             .top-nav { padding-top: 60px; }
             /* Feature Specific Responsive */
             #featureSectionsContainer.employee-scheduling .schedule-controls,
             #featureSectionsContainer.employee-scheduling .schedule-page-header { flex-direction: column; gap: 1rem; align-items: stretch; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .week-nav { justify-content: space-between; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions { margin-left: 0; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions .btn { width: 100%; justify-content: center; }
             #featureSectionsContainer.employee-scheduling .employee-name { position: sticky !important; left: 0; z-index: 5 !important; }
             #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { position: sticky !important; left: 0; z-index: 11 !important; }
             #featureSectionsContainer.task-management-feature .task-list { grid-template-columns: 1fr; }
             #featureSectionsContainer.task-management-feature .controls { flex-direction: column; align-items: stretch; gap: 10px; }
             #featureSectionsContainer.team-members-feature .team-members-section-header { flex-direction: column; align-items: flex-start;}
             #featureSectionsContainer.team-members-feature .team-filter { max-width: none; }
             #featureSectionsContainer.projects-feature .project-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select, #featureSectionsContainer.projects-feature .add-project-btn { width: 100%; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-header h1 { font-size: 1.5rem; }
             #featureSectionsContainer.deadline-tracker-feature #task-form { grid-template-columns: 1fr; }
             #featureSectionsContainer.deadline-tracker-feature #task-form button[type="submit"] { grid-column: 1 / -1; justify-self: stretch; width: 100%; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.deadline-tracker-feature .export-buttons { margin-left: 0; margin-top: 1rem; justify-content: flex-start; width: 100%; }
             #featureSectionsContainer.deadline-tracker-feature .tracker-main-content, #featureSectionsContainer.deadline-tracker-feature .deadline-tracker-container { display: flex; flex-direction: column; }
             #featureSectionsContainer.innovation-hub-feature .hub-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.innovation-hub-feature .form-row { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.data-management-feature .dm-toolbar { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.data-management-feature .dm-search-filter { width: 100%; }
             #featureSectionsContainer.data-management-feature .dm-actions { width: 100%; justify-content: space-around; }
             #featureSectionsContainer.calendar-feature .calendar-header { padding: 0.5rem 1rem; gap: 0.5rem; flex-wrap: wrap; }
             #featureSectionsContainer.calendar-feature .current-month-year { font-size: 1.2rem; margin-right: 0; order: 1; }
             #featureSectionsContainer.calendar-feature .add-event-button { order: 2; margin-left: auto; }
             #featureSectionsContainer.project-tracking-feature .card-header { flex-direction: column; align-items: flex-start; }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section .row > div { margin-bottom: 10px; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders { margin-bottom: 1.5rem; }
             #featureSectionsContainer.project-tracking-feature .pt-table .notes-cell { max-width: 100px; }
             #featureSectionsContainer.project-tracking-feature .pt-table-container { margin: 1rem; }
             #featureSectionsContainer.reports-analytics-feature .card-header { flex-direction: column; align-items: flex-start; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .d-flex { flex-direction: column; align-items: stretch !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons { margin-top: 10px; width: 100%; text-align: right; }
             #featureSectionsContainer.reports-analytics-feature .ra-table-container { margin: 1rem; }
        }
        @media (max-width: 480px) {
             .section-header > div { justify-content: center; width: 100%; }
             .welcome-section { padding: 1.5rem; }
             .stats-section { gap: 0.75rem; }
             .stat-card { padding: 1rem; }
             .user-menu { gap: 1rem; }
             .user-name { display: none; }
             .user-status { margin-left: 0; }
             .notifications-footer { flex-direction: column; gap: 0.5rem; }
             .notifications-footer .btn { width: 100%; justify-content: center; }
             /* Feature Specific Responsive */
             #featureSectionsContainer.task-management-feature .modal-content { padding: 20px 15px; }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: 1fr; gap: 15px; }
             #featureSectionsContainer.projects-feature .project-actions .btn { flex-grow: 1; justify-content: center; }
             #featureSectionsContainer.deadline-tracker-feature #tasks-table th, #featureSectionsContainer.deadline-tracker-feature #tasks-table td { padding: 0.8rem; font-size: 0.9rem; }
             #featureSectionsContainer.innovation-hub-feature .hub-header { padding: 1rem 1.5rem; }
             #featureSectionsContainer.data-management-feature .dm-actions button { flex-grow: 1; font-size: 13px; }
             #featureSectionsContainer.calendar-feature .calendar-header { flex-wrap: wrap; justify-content: space-between; }
             #featureSectionsContainer.calendar-feature .current-month-year { order: 1; flex-basis: 100%; text-align: center; margin-top: 0.5rem; }
             #featureSectionsContainer.calendar-feature .add-event-button span { display: none; }
             #featureSectionsContainer.calendar-feature .add-event-button { order: 2; margin-left: 0; }
             #featureSectionsContainer.project-tracking-feature .pt-table tbody td { padding: 0.5rem; }
             #featureSectionsContainer.reports-analytics-feature .ra-table tbody td { padding: 0.5rem; }
        }

    </style>
</head>
<body class=""> <!-- JS applies theme -->

    <!-- <audio id="notificationSound" preload="auto"> -->
        <!-- <source src="assets/notification.mp3" type="audio/mpeg"> --> <!-- Removed: Causes 404 -->
        <!-- Your browser does not support the audio element. -->
    <!-- </audio> -->

    <!-- Hamburger Menu Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Toast/Success Messages -->
    <div class="toast" id="toastMessage">Toast message</div>
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Action successful!</span> </div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="#dashboard" class="logo" data-feature="dashboard">
                <i class="fas fa-users-cog logo-icon"></i>
                <span>TeamFlow</span>
            </a>
             <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar" style="display: none;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>

             <div class="menu-title">Core Features</div>
             <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a>
             <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <a href="#deadline-tracker" class="menu-item" data-feature="deadline-tracker"><i class="fas fa-calendar-check"></i><span>Deadline Tracker</span></a>

             <div class="menu-title">Team Tools</div>
             <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
             <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>

             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
         <div class="connection-status">
             <div class="status-dot"></div>
             <span>Online</span>
         </div>
    </aside>

    <main class="main-content" id="mainContent">
         <nav class="top-nav">
             <div class="search-bar">
                 <i class="fas fa-search search-icon"></i>
                 <input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off">
                 <div class="search-results" id="searchResults"></div>
             </div>
             <div class="user-menu">
                 <div class="notification-icon" id="notificationIcon">
                     <i class="fas fa-bell"></i>
                     <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                 </div>
                 <div class="user-profile" id="userProfileContainer">
                     <div class="user-avatar" id="userAvatar">ME</div>
                     <div class="user-profile-details">
                         <span class="user-name" id="userName">Loading...</span>
                         <span class="user-status"> • Connected</span>
                     </div>
                     <div class="user-dropdown" id="userDropdown">
                         <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a>
                         <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a>
                         <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                     </div>
                 </div>
             </div>
         </nav>

         <div class="content-area">
             <!-- Back Button -->
             <div class="back-button" id="backButton" style="display: none;">
                 <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span>
             </div>

             <!-- Dashboard Content -->
             <div id="dashboardContent" class="content-section active">
                 <div class="welcome-section" id="welcomeSection">
                     <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2>
                     <p class="welcome-subtitle">Here's what's happening with your team today.</p>
                     <div class="user-info">
                         <div class="user-info-avatar" id="profileAvatar">U</div>
                         <div class="user-info-details">
                             <div class="user-info-name" id="userInfoName">Loading User...</div>
                             <div class="user-info-title" id="userInfoRoleTitle">Loading Role...</div>
                             <div class="user-info-email">
                                 <i class="fas fa-envelope"></i> <span id="userEmail">loading@email.com</span>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="stats-section" id="statsSection">
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                 </div>
                 <div class="activity-section">
                     <div class="section-header">
                         <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3>
                         <div>
                             <span class="view-all" id="viewAllActivity">Show All</span>
                             <span class="delete-all" id="deleteAllActivity">Delete All</span>
                         </div>
                     </div>
                     <ul class="activity-list" id="activityList">
                         <li style="text-align: center; padding: 2rem; color: var(--gray);"> Loading activities... </li>
                     </ul>
                 </div>
             </div>

             <!-- Profile Content -->
             <div class="content-section" id="profileContent">
                 <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Your personal information and account security settings.</p>
                 <div class="profile-avatar-section">
                     <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color);">Avatar</label>
                     <div id="profileAvatarLarge" title="Click to upload photo">ME</div>
                     <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                 </div>
                 <form class="data-form" id="profileForm">
                     <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control" value=""> </div>
                     <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control" value=""> </div>
                     <div class="form-actions">
                         <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button>
                         <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                            <span class="btn-text">Save Changes</span>
                            <span class="spinner" style="display: none;"></span>
                         </button>
                     </div>
                 </form>
             </div>

             <!-- Settings Content -->
             <div class="content-section" id="settingsContent">
                 <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                 <div class="settings-tabs">
                     <div class="settings-tab active" data-tab="preferences">Preferences</div>
                     <div class="settings-tab" data-tab="account">Account</div>
                     <div class="settings-tab" data-tab="security">Security</div>
                     <div class="settings-tab" data-tab="notifications">Notifications</div>
                     <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div>
                     <div class="settings-tab" data-tab="collaboration">Collaboration</div>
                     <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div>
                 </div>

                 <!-- Preferences Panel -->
                 <div class="settings-panel active" id="preferencesPanel">
                      <div class="settings-subsection">
                         <h4>Appearance</h4>
                         <div class="form-group">
                             <label class="settings-label">Theme</label>
                             <div class="theme-options-container">
                                 <div class="theme-option" data-theme="light"> <div class="theme-preview light-preview"><i class="fas fa-sun"></i></div> <span class="theme-label">Light</span> </div>
                                 <div class="theme-option" data-theme="dark"> <div class="theme-preview dark-preview"><i class="fas fa-moon"></i></div> <span class="theme-label">Dark</span> </div>
                                 <div class="theme-option" data-theme="system"> <div class="theme-preview system-preview"><i class="fas fa-desktop"></i></div> <span class="theme-label">System</span> </div>
                             </div>
                         </div>
                         <div class="setting-item">
                            <div> <span class="setting-item-label">High Contrast Mode</span> <p class="setting-item-description">Increase text visibility for accessibility.</p> </div>
                            <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="highContrastToggle"> <span class="slider round"></span> </label> </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Localization</h4>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group"> <label for="languageSelect">Language</label> <select id="languageSelect" class="form-control form-select"> <option value="en">English (US)</option> <option value="ar">العربية (Arabic)</option> <option value="es">Español (Spanish)</option> </select> </div>
                             <div class="form-group"> <label for="regionSelect">Region / Timezone</label> <select id="regionSelect" class="form-control form-select"> <option value="utc">UTC</option> <option value="est">EST (UTC-5)</option> <option value="pst">PST (UTC-8)</option> <option value="cet">CET (UTC+1)</option> <option value="eet">EET (UTC+2)</option> <option value="ast">AST (UTC+3) - Riyadh</option> </select> </div>
                         </div>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group"> <label for="timeFormatSelect">Time Format</label> <select id="timeFormatSelect" class="form-control form-select"> <option value="12h">12-hour (e.g., 3:00 PM)</option> <option value="24h">24-hour (e.g., 15:00)</option> </select> </div>
                              <div class="form-group"> <label for="dateFormatSelect">Date Format</label> <select id="dateFormatSelect" class="form-control form-select"> <option value="MM/DD/YYYY">MM/DD/YYYY</option> <option value="DD/MM/YYYY">DD/MM/YYYY</option> <option value="YYYY-MM-DD">YYYY-MM-DD</option> <option value="Month D, YYYY">Month D, YYYY</option> </select> </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Messages & Sounds</h4>
                         <div class="setting-item">
                             <div> <span class="setting-item-label">Enable Toast Notifications</span> <p class="setting-item-description">Show brief confirmation messages for actions.</p> </div>
                             <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="toastToggle" checked> <span class="slider round"></span> </label> </div>
                         </div>
                         <div class="setting-item">
                             <div> <span class="setting-item-label">Enable Sound Notifications</span> <p class="setting-item-description">Play a sound for new notifications and activities.</p> </div>
                             <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="soundToggle" checked> <span class="slider round"></span> </label> </div>
                         </div>
                         <div class="form-group"> <label for="notificationToneSelect">Notification Tone</label> <select id="notificationToneSelect" class="form-control form-select" disabled> <option value="default">Default</option> <option value="tone1">Tone 1 (Placeholder)</option> <option value="tone2">Tone 2 (Placeholder)</option> </select> <p class="setting-item-description">Select the sound to play for notifications (Requires enabling sound).</p> </div>
                         <div class="form-group"> <label class="settings-label">Keyboard Shortcuts</label> <p class="setting-item-description">View or customize keyboard shortcuts (Feature placeholder).</p> <button class="btn btn-outline btn-sm" disabled>View Shortcuts</button> </div>
                     </div>
                     <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="savePreferencesBtn">Save Preferences</button> </div>
                 </div>

                 <!-- Account Panel -->
                 <div class="settings-panel" id="accountPanel">
                    <div class="settings-subsection">
                         <h4>Account Information</h4>
                         <div class="data-form">
                             <div class="form-group"> <label for="accountEmail">Current Email</label> <input type="email" id="accountEmail" class="form-control" value="" readonly> </div>
                             <div class="form-group"> <label for="changeEmail">New Email Address</label> <input type="email" id="changeEmail" class="form-control" placeholder="Enter new email" disabled> <p class="setting-item-description">Changing email requires backend verification.</p> </div>
                             <div class="form-group" style="grid-column: span 2;"> <label for="accountConfirmPassword">Confirm Password (to change email)</label> <input type="password" id="accountConfirmPassword" class="form-control" placeholder="Enter current password" disabled> </div>
                            <div class="form-actions" style="grid-column: span 2;"> <button type="button" class="btn btn-primary" id="saveAccountEmailBtn" disabled>Change Email Address</button> </div>
                         </div>
                         <p style="margin-top: 1rem;">Note: Password changes are managed under the <a href="#settings-security" data-feature="settings" data-tab-target="security" class="settings-link">Security Tab</a>.</p>
                     </div>
                     <div class="settings-subsection">
                         <h4>Account Notifications</h4>
                         <div class="setting-item">
                             <div> <span class="setting-item-label">Enable Account Notifications</span> <p class="setting-item-description">Receive email alerts for important account activities (e.g., password changes, new logins).</p> </div>
                             <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="accountNotificationsToggle" checked> <span class="slider round"></span> </label> </div>
                         </div>
                     </div>
                     <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveAccountSettingsBtn">Save Account Settings</button> </div>
                 </div>

                 <!-- Security Panel -->
                 <div class="settings-panel" id="securityPanel">
                      <div class="settings-subsection">
                         <h4>Password</h4>
                         <form class="data-form" id="changePasswordForm">
                             <div class="form-group"> <label for="currentPassword">Current Password</label> <input type="password" id="currentPassword" class="form-control"> </div>
                             <div class="form-group"> <label for="newPassword">New Password</label> <input type="password" id="newPassword" class="form-control"> </div>
                             <div class="form-group"> <label for="confirmPassword">Confirm New Password</label> <input type="password" id="confirmPassword" class="form-control"> </div>
                             <div class="form-actions"> <button type="submit" class="btn btn-primary">Change Password</button> </div>
                         </form>
                     </div>
                     <div class="settings-subsection">
                         <h4>Two-Factor Authentication (2FA)</h4>
                         <div class="two-fa-status" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;"> <span class="status-indicator disabled" id="twoFaStatusIndicator" style="width: 10px; height: 10px; border-radius: 50%; display: inline-block; background-color: var(--gray); transition: background-color 0.3s;"></span> <span id="twoFaStatusText" style="font-weight: 500;">2FA is currently Disabled</span> </div>
                         <p class="setting-item-description">Add an extra layer of security to your account using an authenticator app or SMS.</p>
                         <div id="twoFaSetupSection" style="display: block; margin-top: 1rem;">
                             <button class="btn btn-primary" id="enable2faBtn">Enable 2FA</button>
                             <div class="two-fa-setup" id="twoFaSetupOptions" style="display:none; margin-top: 1rem;">
                                 <h5 style="margin-bottom: 0.75rem; font-size: 1rem;">Choose Setup Method:</h5>
                                 <div class="two-fa-actions" style="display: flex; gap: 1rem; margin-bottom: 1.5rem;"> <button class="btn btn-outline" id="setupAuthAppBtn"><i class="fas fa-mobile-alt"></i> Authenticator App</button> <button class="btn btn-outline" id="setupSmsBtn"><i class="fas fa-sms"></i> SMS Message</button> </div>
                                 <div id="authAppSetup" style="display: none; margin-top: 1.5rem;"> <p>1. Scan this QR code with your authenticator app (e.g., Google Authenticator, Authy).</p> <div class="qr-code-placeholder" style="width: 150px; height: 150px; border: 1px solid var(--light-gray); display: flex; align-items: center; justify-content: center; color: var(--gray); margin: 1rem auto;">QR Placeholder</div> <p>2. Enter the 6-digit code generated by your app below.</p> <div class="form-group" style="max-width: 200px;"> <label for="authCode">Verification Code</label> <input type="text" id="authCode" class="form-control" placeholder="123456" maxlength="6"> </div> <button class="btn btn-primary" id="verifyAuthCodeBtn">Verify & Enable</button> </div>
                                 <div id="smsSetup" style="display: none; margin-top: 1.5rem;"> <p>1. We'll send a verification code via SMS to your registered phone number (<span id="userPhoneNumberForSms"></span>).</p> <button class="btn btn-primary" id="sendSmsCodeBtn">Send Code</button> <div class="form-group" style="margin-top: 1rem; display: none;" id="smsCodeInputGroup"> <label for="smsCode">SMS Verification Code</label> <input type="text" id="smsCode" class="form-control" placeholder="123456" maxlength="6" style="max-width: 200px;"> </div> <button class="btn btn-primary" id="verifySmsCodeBtn" style="display: none;">Verify & Enable</button> </div>
                             </div>
                         </div>
                         <div id="twoFaManagementSection" style="display: none; margin-top: 1rem;"> <p>2FA is enabled. You can manage recovery codes or disable 2FA.</p> <div class="two-fa-actions" style="display: flex; gap: 1rem;"> <button class="btn btn-outline" disabled>View Recovery Codes</button> <button class="btn btn-danger" id="disable2faBtn">Disable 2FA</button> </div> </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Session Management</h4>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group"> <label for="sessionDuration">Session Duration (minutes)</label> <input type="number" id="sessionDuration" class="form-control" value="60" min="15"> <p class="setting-item-description">Set how long a login session remains active.</p> </div>
                            <div class="form-group"> <label for="idleTimeout">Idle Timeout (minutes)</label> <input type="number" id="idleTimeout" class="form-control" value="15" min="5"> <p class="setting-item-description">Automatically logout after inactivity.</p> </div>
                         </div>
                         <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveSessionSettingsBtn">Save Session Settings</button> </div>
                     </div>
                 </div>

                 <!-- Notifications Panel -->
                 <div class="settings-panel" id="notificationsPanel">
                     <div class="settings-subsection">
                         <h4>Notification Delivery</h4>
                         <div class="setting-item"> <div> <span class="setting-item-label">Enable Email Notifications</span> <p class="setting-item-description">Receive summaries and important alerts via email.</p> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="emailNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div>
                         <div class="setting-item"> <div> <span class="setting-item-label">Enable In-App Notifications</span> <p class="setting-item-description">Show notifications within the TeamFlow interface (bell icon).</p> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="inAppNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div>
                         <div class="setting-item"> <div> <span class="setting-item-label">Enable Push Notifications (Mobile/Desktop)</span> <p class="setting-item-description">Receive notifications even when the app isn't open (Requires browser/OS support & backend).</p> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="pushNotificationsToggle" disabled> <span class="slider round"></span> </label> </div> </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Notification Types</h4>
                         <p class="setting-item-description">Choose which types of notifications you want to receive (Settings apply to In-App & Email if enabled). Backend needed to manage these.</p>
                         <div class="checkbox-group"> <label><input type="checkbox" name="notificationType" value="task_assigned" checked> Task Assigned</label> <label><input type="checkbox" name="notificationType" value="task_comment" checked> Task Comment/Mention</label> <label><input type="checkbox" name="notificationType" value="project_update" checked> Project Update</label> <label><input type="checkbox" name="notificationType" value="deadline_reminder" checked> Deadline Reminder</label> <label><input type="checkbox" name="notificationType" value="file_shared"> File Shared</label> <label><input type="checkbox" name="notificationType" value="system_announcement" checked> System Announcement</label> </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Sound & Priority (Linked to Preferences)</h4>
                         <p class="setting-item-description">Sound settings are managed under the <a href="#settings-preferences" data-feature="settings" data-tab-target="preferences" class="settings-link">Preferences Tab</a>.</p>
                         <div class="form-group"> <label for="notificationPriority">Minimum Notification Priority</label> <select id="notificationPriority" class="form-control form-select" disabled> <option value="low">Low</option> <option value="medium">Medium</option> <option value="high">High</option> </select> <p class="setting-item-description">Only show notifications above a certain priority level (Feature placeholder).</p> </div>
                     </div>
                      <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveNotificationSettingsBtn">Save Notification Settings</button> </div>
                 </div>

                 <!-- Team Management Panel -->
                 <div class="settings-panel" id="teamPanel">
                      <div class="team-management">
                         <div class="settings-subsection">
                             <h4>Team Members</h4>
                             <div class="team-list" id="teamList"> <p>Loading team members...</p> </div>
                             <div class="add-member-form">
                                 <h4>Invite New Member</h4>
                                 <form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;">
                                    <div class="form-group"> <label for="inviteEmail">Email</label> <input type="email" id="inviteEmail" class="form-control" required> </div>
                                    <div class="form-group"> <label for="inviteRole">Role</label> <select id="inviteRole" class="form-control form-select" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                                    <button type="submit" class="btn btn-primary">Invite</button>
                                 </form>
                             </div>
                             <!-- Admin Action: Delete All -->
                             <div class="mt-4 pt-3 border-top" id="deleteAllUsersSection" style="display: none;">
                                 <h5 class="text-danger">Bulk Actions</h5>
                                 <div class="d-flex justify-content-between align-items-center">
                                     <div>
                                         <p class="mb-0">Delete all non-administrator users.</p>
                                         <small class="text-muted">This action cannot be undone.</small>
                                     </div>
                                     <button class="btn btn-danger" id="deleteAllNonAdminUsersBtn"> <i class="fas fa-users-slash"></i> Delete Non-Admins </button>
                                 </div>
                             </div>
                         </div>
                         <div class="settings-subsection">
                             <h4>Custom Role Permissions</h4>
                             <p class="setting-item-description">Define specific permissions for different roles within your team (Feature placeholder - requires backend).</p>
                             <button class="btn btn-outline" disabled>Manage Permissions</button>
                         </div>
                     </div>
                 </div>

                 <!-- Collaboration Panel -->
                 <div class="settings-panel" id="collaborationPanel">
                      <div class="settings-subsection">
                         <h4>External Integrations</h4>
                         <p class="setting-item-description">Connect TeamFlow with other applications (Requires backend setup).</p>
                         <div class="integration-list" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;"> <button class="btn btn-outline" disabled><i class="fab fa-slack"></i> Connect Slack</button> <button class="btn btn-outline" disabled><i class="fab fa-google-drive"></i> Connect Google Drive</button> <button class="btn btn-outline" disabled><i class="fab fa-github"></i> Connect GitHub</button> </div>
                     </div>
                      <div class="settings-subsection">
                         <h4>Sharing & Invitations</h4>
                         <p class="setting-item-description">Manage how projects and tasks can be shared externally (Feature placeholder).</p>
                         <div class="setting-item"> <div> <span class="setting-item-label">Allow External Sharing Links</span> </div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="externalSharingToggle" disabled> <span class="slider round"></span> </label> </div> </div>
                         <button class="btn btn-outline" disabled>Manage Pending Invites</button>
                      </div>
                      <div class="settings-subsection">
                         <h4>Collaboration Permissions</h4>
                         <p class="setting-item-description">Set default permissions for collaboration features like comments and file sharing (Feature placeholder).</p>
                         <button class="btn btn-outline" disabled>Set Default Permissions</button>
                     </div>
                 </div>

                 <!-- Danger Zone Panel (Refined) -->
                 <div class="settings-panel" id="dangerPanel">
                     <h3 class="section-title" style="color: var(--danger); margin-bottom: 0.5rem;">Danger Zone</h3>
                     <p style="color: var(--text-muted); margin-bottom: 1.5rem;">These actions are permanent and cannot be undone. Proceed with caution.</p>

                     <div class="danger-zone-item">
                         <div>
                            <h5>Logout From All Devices</h5>
                            <p>This will log you out of all active sessions on other computers and mobile devices.</p>
                         </div>
                         <button class="btn btn-warning" id="logoutAllDevicesBtn">Logout Everywhere</button>
                     </div>

                     <div class="danger-zone-item">
                         <div>
                            <h5>Delete Account</h5>
                            <p>Permanently delete your account and all associated data. This action cannot be reversed.</p>
                         </div>
                         <button class="btn btn-danger" id="deleteAccountBtn">Delete My Account</button>
                     </div>
                 </div>
             </div>

             <!-- Container for other feature sections -->
             <div id="featureSectionsContainer" class="content-section">
                 <div class="placeholder-content" id="featurePlaceholder">
                     <h2 id="featureTitle">Feature Content Area</h2>
                     <p id="featureDescription">Select a feature from the sidebar.</p>
                     <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                     <div class="error-message" style="display: none;"> Failed to load content. </div>
                 </div>
             </div>
         </div>
    </main>

    <!-- Notification Modal -->
    <div class="notifications-modal" id="notificationsModal">
         <div class="notifications-container">
             <div class="notifications-header">
                 <h3 class="notifications-title">Notifications</h3>
                 <button class="close-notifications" id="closeNotifications" aria-label="Close Notifications">×</button>
             </div>
             <div class="notifications-body" id="notificationsBody">
                 <div class="no-notifications-message" id="noNotificationsMessage">Loading notifications...</div>
             </div>
             <div class="notifications-footer">
                 <button class="btn btn-outline btn-sm" id="markAllReadBtn">Mark All as Read</button>
                 <button class="btn btn-danger btn-sm" id="deleteAllNotificationsBtn">Delete All</button>
             </div>
         </div>
    </div>

    <!-- Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
         <div class="confirm-container">
             <h3 class="confirm-title" id="confirmTitle">Confirm Action</h3>
             <div class="confirm-message" id="confirmMessage">Are you sure you want to proceed?</div>
             <div class="confirm-actions">
                 <button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button>
                 <button class="btn btn-danger" id="confirmBtn">Confirm</button>
             </div>
         </div>
    </div>

    <!-- Member Add/Edit Modal -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header"> <h3 class="modal-title" id="memberModalTitle">Member Details</h3> <button class="close-modal" data-close-modal>×</button> </div>
            <form id="memberForm">
                <input type="hidden" id="memberId">
                 <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                     <div class="form-group"> <label for="memberFirstName">First Name</label> <input type="text" id="memberFirstName" class="form-control" required> </div>
                     <div class="form-group"> <label for="memberLastName">Last Name</label> <input type="text" id="memberLastName" class="form-control" required> </div>
                     <div class="form-group"> <label for="memberEmail">Email</label> <input type="email" id="memberEmail" class="form-control" required> </div>
                     <div class="form-group"> <label for="memberRole">Role</label> <select id="memberRole" class="form-control form-select" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                      <div class="form-group"> <label for="memberTitle">Job Title</label> <input type="text" id="memberTitle" class="form-control"> </div>
                      <div class="form-group"> <label for="memberDepartment">Department</label> <input type="text" id="memberDepartment" class="form-control"> </div>
                 </div>
                <div class="form-actions" style="grid-column: span 2;"> <button type="button" class="btn btn-outline" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="saveMemberBtn">Save Changes</button> </div>
            </form>
        </div>
    </div>

    <!-- Project Add/Edit Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header"> <h3 class="modal-title" id="projectModalTitle">Project Details</h3> <button class="close-modal" data-close-modal>×</button> </div>
            <form id="projectForm">
                <input type="hidden" id="projectId">
                <div class="data-form" style="grid-template-columns: 1fr;">
                    <div class="form-group"> <label for="projectName">Project Name</label> <input type="text" id="projectName" class="form-control" required> </div>
                    <div class="form-group"> <label for="projectDescription">Description</label> <textarea id="projectDescription" class="form-control" rows="3"></textarea> </div>
                     <div class="form-group"> <label for="projectParticipantsInput">Participants (Separate with | )</label> <input type="text" id="projectParticipantsInput" class="form-control" placeholder="e.g., John D.|Jane S."> </div>
                    <div class="form-group"> <label for="projectImageInput">Image URL (Optional)</label> <input type="url" id="projectImageInput" class="form-control" placeholder="https://..."> </div>
                     <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                         <div class="form-group"> <label for="projectStartDate">Start Date</label> <input type="date" id="projectStartDate" class="form-control"> </div>
                        <div class="form-group"> <label for="projectDueDate">Due Date</label> <input type="date" id="projectDueDate" class="form-control"> </div>
                         <div class="form-group"> <label for="projectStatus">Status</label> <select id="projectStatus" class="form-control form-select" required> <option value="pending">Pending</option> <option value="active">Active</option> <option value="in-progress">In Progress</option> <option value="completed">Completed</option> </select> </div>
                        <div class="form-group"> <label for="projectProgress">Progress (%)</label> <input type="number" id="projectProgress" class="form-control" min="0" max="100" value="0"> </div>
                    </div>
                 </div>
                <div class="form-actions" style="grid-column: span 1;"> <button type="button" class="btn btn-outline" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="saveProjectBtn">Save Project</button> </div>
            </form>
        </div>
    </div>

    <!-- Add Event Modal (for Calendar) -->
    <div class="modal" id="calendarEventModal">
         <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="eventModalTitle">Add New Event</h2>
                <button class="close-modal" data-close-modal>×</button>
            </div>
            <div class="modal-body">
                <form id="add-event-form">
                    <div class="form-group"><label for="event-title">Event Title</label><input type="text" id="event-title" class="form-control" name="event-title" required></div>
                    <div class="form-group"><label for="event-employee">Assignee</label><select id="event-employee" class="form-control form-select" name="event-employee"><option value="">Select Employee...</option><option value="Mohamed Elmenisy">Mohamed Elmenisy</option><option value="Nada Mahmoud">Nada Mahmoud</option><option value="Yousef Ahmed">Yousef Ahmed</option><option value="Esraa Lashin">Esraa Lashin</option><option value="Bassant Badr">Bassant Badr</option><option value="Team">Team / General</option></select></div>
                    <div class="form-group"><label for="event-date">Date</label><input type="date" id="event-date" class="form-control" name="event-date" required></div>
                    <div class="form-group"><label for="event-time">Time (Optional)</label><input type="time" id="event-time" class="form-control" name="event-time"></div>
                    <div class="form-group"><label for="event-type">Event Type</label><select id="event-type" class="form-control form-select" name="event-type"><option value="meeting">Meeting</option><option value="deadline">Deadline</option><option value="task">Task</option><option value="personal">Personal</option></select></div>
                    <div class="form-group"><label for="event-description">Description (Optional)</label><textarea id="event-description" class="form-control" name="event-description" rows="3"></textarea></div>
                    <div class="form-group"><label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" id="event-important" name="event-important" style="width: auto;"> Mark as Important</label></div>
                </form>
            </div>
            <div class="modal-footer form-actions" style="grid-column: span 1;">
                <button type="button" id="cancel-modal-button" class="btn btn-outline" data-close-modal>Cancel</button>
                <button type="submit" id="save-event-button" form="add-event-form" class="btn btn-primary">Save Event</button>
            </div>
        </div>
    </div>

    <!-- View Record Modal (for Data Management) -->
    <div class="modal" id="dmViewModal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">Record Details</h3>
               <button class="close-modal" data-close-modal>×</button>
           </div>
           <dl id="view-details" style="font-size: 0.9rem;">
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">ID:</dt><dd id="view-id" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Record Name:</dt><dd id="view-name" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Creation Date:</dt><dd id="view-creation-date" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Responsible:</dt><dd id="view-responsible" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Status:</dt><dd id="view-status" style="margin-left: 0; margin-bottom: 10px;"></dd>
               <dt style="font-weight: 600; color: var(--text-muted); margin-top: 10px;">Last Updated:</dt><dd id="view-last-updated" style="margin-left: 0; margin-bottom: 10px;"></dd>
           </dl>
           <div class="form-actions" style="grid-column: span 1;">
               <button type="button" class="btn btn-outline" data-close-modal>Close</button>
           </div>
       </div>
   </div>

    <!-- Add/Edit Record Modal (for Data Management) -->
   <div class="modal" id="dmAddEditModal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title" id="dmModalTitle">Add New Record</h3>
               <button class="close-modal" data-close-modal>×</button>
           </div>
           <form id="dmAddEditForm">
               <input type="hidden" id="dmEditRecordId">
               <div class="form-group">
                   <label for="dmRecordName">Record Name:</label>
                   <input type="text" id="dmRecordName" name="recordName" class="form-control" required>
               </div>
               <div class="form-group">
                   <label for="dmResponsible">Responsible:</label>
                   <select id="dmResponsible" name="responsible" class="form-control form-select" required>
                       <option value="" disabled selected>-- Select Person --</option>
                       <option value="Nada Mahmoud">Nada Mahmoud</option>
                       <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                       <option value="Yousef Ahmed">Yousef Ahmed</option>
                       <option value="Esraa Lashin">Esraa Lashin</option>
                       <option value="Basssant Badr">Basssant Badr</option>
                       <option value="Other">Other</option>
                   </select>
               </div>
               <div class="form-group">
                   <label for="dmStatus">Status:</label>
                   <select id="dmStatus" name="status" class="form-control form-select" required>
                       <option value="" disabled selected>-- Select Status --</option>
                       <option value="active">Active</option>
                       <option value="pending">Pending</option>
                       <option value="inactive">Inactive</option>
                   </select>
               </div>
               <div class="form-actions" style="grid-column: span 1;">
                   <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                   <button type="submit" class="btn btn-primary save-btn">Save Record</button>
               </div>
           </form>
       </div>
   </div>

    <!-- Delete Confirmation Modal (for Deadline Tracker) -->
    <div class="modal" id="dtDeleteConfirmModal">
        <div class="modal-content" style="max-width: 450px;">
             <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
                  <h3 class="modal-title" style="color: var(--danger);"><i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion</h3>
                  <button class="close-modal" data-close-modal>×</button>
             </div>
            <p id="dtDeleteConfirmMessage" style="margin: 1.5rem 0; color: var(--text-muted);">Are you sure you want to delete this task?</p>
            <div class="form-actions" style="grid-column: span 1; justify-content: center;">
                <button id="dtConfirmDeleteNo" class="btn btn-outline" data-close-modal>No <i class="fas fa-times ms-1"></i></button>
                <button id="dtConfirmDeleteYes" class="btn btn-danger">Yes <i class="fas fa-check ms-1"></i></button>
            </div>
        </div>
    </div>

    <!-- Edit Shift Modal (for Employee Scheduling) -->
    <div class="modal" id="editShiftModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="editShiftModalTitle">Edit Shift</h3>
                <button class="close-modal" data-close-modal>×</button>
            </div>
            <form id="editShiftForm">
                <input type="hidden" id="editShiftEmployeeId">
                <input type="hidden" id="editShiftDayIndex">
                <input type="hidden" id="editShiftWeekOffset">
                 <div class="form-group"> <!-- Added for consistency -->
                    <label for="shiftEmployeeNameDisplay">Employee</label>
                    <input type="text" id="shiftEmployeeNameDisplay" class="form-control" readonly>
                 </div>
                <div class="form-group">
                    <label for="shiftTypeSelect">Shift Type</label> <!-- Changed ID -->
                    <select id="shiftTypeSelect" class="form-control form-select">
                        <option value="morning">Morning (9AM-5PM)</option>
                        <option value="afternoon">Afternoon (12PM-8PM)</option>
                        <option value="night">Night (8PM-4AM)</option>
                        <option value="off">Day Off</option>
                        <option value="sick">Sick Leave</option>
                        <option value="vacation">Vacation</option>
                    </select>
                </div>
                <div class="form-actions" style="grid-column: span 1;">
                    <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Shift</button>
                </div>
            </form>
        </div>
    </div>


    <!-- ========= Feature Templates ========= -->

    <!-- Template: Placeholder for Features Not Implemented Yet -->
    <template id="placeholderAssets">
        <div class="placeholder-content">
            <h2 id="featureTitle">Feature Name</h2>
            <p id="featureDescription">Content for this feature will be loaded here.</p>
             <!-- You can add a spinner or specific message if needed -->
        </div>
    </template>

    <!-- Template: Team Members Feature -->
    <template id="teamMembersAssets">
        <style id="injected-team-members-view-styles">
             #featureSectionsContainer.team-members-view-feature .team-members-section { background-color: var(--card-bg); border-radius: var(--card-radius); max-width: none; margin: 0; box-shadow: 0 1px 3px var(--card-shadow); overflow: hidden; border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.team-members-view-feature .team-members-section-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; background-color: var(--light); color: var(--heading-color); margin: 0; padding: 1.1rem 1.5rem; font-weight: 600; text-align: left; border-bottom: 1px solid var(--card-border); flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.team-members-view-feature .team-members-section-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.team-members-view-feature .team-members-section-header h2 { font-size: 1.5rem; margin: 0; color: var(--heading-color); }
             #featureSectionsContainer.team-members-view-feature .team-content-area { padding: 1.5rem; flex-grow: 1; overflow-y: auto; }
             #featureSectionsContainer.team-members-view-feature .team-filter { margin-bottom: 1.5rem; max-width: 400px; }
             #featureSectionsContainer.team-members-view-feature .team-filter input[type="text"] { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--input-border); border-radius: 6px; background-color: var(--input-bg); color: var(--input-text); box-sizing: border-box; font-size: 0.95rem; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
             #featureSectionsContainer.team-members-view-feature .team-filter input[type="text"]::placeholder { color: var(--placeholder-text); }
             #featureSectionsContainer.team-members-view-feature .team-filter input[type="text"]:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
             #featureSectionsContainer.team-members-view-feature .team-members-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
             #featureSectionsContainer.team-members-view-feature .team-member-card { display: flex; flex-direction: column; align-items: flex-start; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--card-radius); padding: 1.25rem; box-shadow: 0 3px 8px var(--card-shadow); transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out; overflow: hidden; }
             #featureSectionsContainer.team-members-view-feature .team-member-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px var(--card-hover-shadow); border-color: var(--gray); }
             #featureSectionsContainer.team-members-view-feature .member-info { width: 100%; }
             #featureSectionsContainer.team-members-view-feature .member-name { font-size: 1.15rem; font-weight: 600; color: var(--heading-color); margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
             #featureSectionsContainer.team-members-view-feature .member-email { font-size: 0.88rem; color: var(--text-muted); margin: 0 0 14px 0; word-break: break-all; line-height: 1.4; }
             #featureSectionsContainer.team-members-view-feature .member-role { /* Uses generic badge */ margin: 0; }
             #featureSectionsContainer.team-members-view-feature .member-role.role-admin { background-color: var(--danger); color: white; border-color: var(--danger-dark); }
             #featureSectionsContainer.team-members-view-feature .member-role.role-supervisor { background-color: var(--warning); color: var(--dark); border-color: var(--warning-dark); }
             #featureSectionsContainer.team-members-view-feature .member-role.role-senior { background-color: var(--success); color: white; border-color: var(--success-dark);}
             #featureSectionsContainer.team-members-view-feature .member-role.role-member { background-color: var(--secondary); color: white; border-color: var(--secondary-dark);}
             #featureSectionsContainer.team-members-view-feature .team-member-card.hidden-by-filter { display: none; }
        </style>
        <script>
             // Logic already in main JS (initializeTeamMembersFeature)
        </script>
        <!-- HTML Structure -->
        <div class="team-members-section">
            <div class="team-members-section-header">
               <h2>Team Members</h2>
               <!-- Add Member button dynamically added -->
               ${window.currentUser?.role === 'admin' ? `<button class="btn btn-primary btn-sm add-team-member-btn"><i class="fas fa-user-plus"></i> Add Member</button>` : ''}
            </div>
            <div class="team-content-area">
                <div class="team-filter">
                    <input type="text" id="teamSearchInputFeature" placeholder="Search team by name, email, or role..." aria-label="Search team members">
                </div>
                <div class="team-members-list team-list-display" id="teamListContainerFeature">
                    <p style="color: var(--gray);">Loading team members...</p>
                </div>
            </div>
        </div>
    </template>

    <!-- Template: Projects Feature -->
    <template id="projectsAssets">
         <style id="injected-projects-styles">
             #featureSectionsContainer.projects-feature #projects-section { width: 100%; max-width: none; margin: 0; padding: 1.5rem; background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.projects-feature .projects-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem; border-bottom: 1px solid var(--card-border); padding-bottom: 1rem; flex-shrink: 0; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper { background-color: transparent; padding: 0; border-radius: 0; box-shadow: none; flex-grow: 1; border-left: none; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper h2 { color: var(--heading-color); margin: 0; font-weight: 600; font-size: 1.5rem; }
             #featureSectionsContainer.projects-feature .project-controls { display: flex; flex-wrap: wrap; align-items: center; gap: 0.75rem; padding: 0; background-color: transparent; border-radius: 0; box-shadow: none; }
             #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select { padding: 0.6rem 1rem; border: 1px solid var(--input-border); border-radius: 6px; font-size: 0.9em; background-color: var(--input-bg); color: var(--input-text); transition: border-color 0.2s ease, box-shadow 0.2s ease; min-width: 150px; }
             #featureSectionsContainer.projects-feature .project-search-input:focus, #featureSectionsContainer.projects-feature .project-filter-select:focus { outline: none; border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
             #featureSectionsContainer.projects-feature .project-filter-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px; padding-right: 2.5rem; }
             body.dark-theme #featureSectionsContainer.projects-feature .project-filter-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); }
             #featureSectionsContainer.projects-feature .add-project-btn { /* Uses .btn styles */ }
             #featureSectionsContainer.projects-feature .projects-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; flex-grow: 1; overflow-y: auto; /* Allow scrolling if needed */ }
             #featureSectionsContainer.projects-feature .project-card { background-color: var(--card-bg); border-radius: var(--card-radius); border: 1px solid var(--card-border); box-shadow: 0 4px 8px var(--card-shadow); overflow: hidden; display: flex; flex-direction: column; transition: transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out; }
             #featureSectionsContainer.projects-feature .project-card:hover { transform: translateY(-5px) scale(1.01); box-shadow: 0 8px 16px var(--card-hover-shadow); }
             #featureSectionsContainer.projects-feature .project-card-image { height: 160px; background-size: cover; background-position: center; }
             #featureSectionsContainer.projects-feature .project-card-body { padding: 1.25rem; display: flex; flex-direction: column; flex-grow: 1; }
             #featureSectionsContainer.projects-feature .project-name { font-size: 1.25em; font-weight: 600; color: var(--heading-color); margin-top: 0; margin-bottom: 0.75rem; }
             #featureSectionsContainer.projects-feature .progress-bar-container { width: 100%; height: 8px; background-color: var(--light-gray); border-radius: 4px; overflow: hidden; margin-bottom: 1rem; }
             #featureSectionsContainer.projects-feature .progress-bar { height: 100%; border-radius: 4px; transition: width 0.4s ease; text-align: center; color: white; font-size: 0.7em; font-weight: 500; line-height: 8px; display: flex; align-items: center; justify-content: center; }
             #featureSectionsContainer.projects-feature .project-card[data-status='completed'] .progress-bar { background-color: var(--success); }
             #featureSectionsContainer.projects-feature .project-card[data-status='in-progress'] .progress-bar { background-color: var(--warning); color: var(--dark); }
             #featureSectionsContainer.projects-feature .project-card[data-status='active'] .progress-bar { background-color: var(--info); }
             #featureSectionsContainer.projects-feature .project-card[data-status='pending'] .progress-bar { background-color: var(--secondary); }
             #featureSectionsContainer.projects-feature .project-info { font-size: 0.85em; color: var(--text-muted); margin-bottom: 0.75rem; line-height: 1.5; display: flex; align-items: flex-start; }
             #featureSectionsContainer.projects-feature .project-info i { margin-right: 8px; color: var(--text-muted); width: 16px; text-align: center; margin-top: 3px; }
             #featureSectionsContainer.projects-feature .project-participants span { display: inline-block; background-color: var(--light); color: var(--text-color); padding: 3px 8px; border-radius: 10px; font-size: 0.75em; margin-right: 4px; margin-bottom: 4px; white-space: nowrap; border: 1px solid var(--card-border); }
             body.dark-theme #featureSectionsContainer.projects-feature .project-participants span { background-color: var(--light); color: var(--text-color); border-color: var(--light-gray); }
             #featureSectionsContainer.projects-feature .project-participants .participant-list { flex: 1; }
             #featureSectionsContainer.projects-feature .project-status { /* Uses generic status badge */ margin-bottom: 1rem; align-self: flex-start; }
             #featureSectionsContainer.projects-feature .project-actions { margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--card-border); display: flex; gap: 0.5rem; flex-wrap: wrap; }
             #featureSectionsContainer.projects-feature .project-actions .btn { /* Uses generic .btn styles */ font-size: 0.8em; }
             #featureSectionsContainer.projects-feature .project-actions .btn i { font-size: 0.9em; }
             #featureSectionsContainer.projects-feature .btn-view { background-color: var(--primary); color: white; }
             #featureSectionsContainer.projects-feature .btn-edit { background-color: var(--warning); color: var(--dark); }
             #featureSectionsContainer.projects-feature .btn-delete { background-color: var(--danger); color: white; }
             #featureSectionsContainer.projects-feature .btn:disabled { background-color: var(--secondary); color: var(--text-muted); opacity: 0.7; cursor: not-allowed; }
        </style>
        <script>
             // Logic already in main JS (initializeProjectsFeature)
        </script>
        <!-- HTML Structure -->
        <section id="projects-section" class="feature-content">
            <div class="projects-header">
                <div class="projects-title-wrapper"><h2>Projects</h2></div>
                <div class="project-controls">
                    <input type="search" placeholder="Search Projects..." class="project-search-input form-control form-control-sm" id="projectSearchInputFeature">
                    <select class="project-filter-select form-select form-select-sm" id="projectFilterSelectFeature">
                        <option value="all">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="pending">Pending</option>
                    </select>
                    ${(window.currentUser?.role === 'admin' || window.currentUser?.role === 'supervisor') ? `<button class="btn btn-sm btn-primary add-project-btn" id="addProjectBtnFeature"> <i class="fas fa-plus-circle"></i> Add Project </button>` : ''}
                </div>
            </div>
           <div class="projects-list" id="projectsListContainerFeature">
               <p style="color: var(--gray); grid-column: 1 / -1; text-align: center; padding: 2rem;">Loading projects...</p>
           </div>
       </section>
    </template>

    <!-- Template: Employee Scheduling Feature -->
    <template id="employeeSchedulingAssets">
        <style id="injected-employee-scheduling-styles">
            /* Styles already in main CSS, scoped selectors used in template */
        </style>
        <script>
             // Logic already in main JS (initializeEmployeeScheduleLogic)
        </script>
        <!-- HTML structure generated by JS -->
        <div id="employee-schedule-content" class="feature-content" style="padding: 0; display: flex; flex-direction: column; height: 100%;">
            <!-- Header, controls, table container will be inserted here by JS -->
        </div>
    </template>

    <!-- Template: Data Management Feature -->
    <template id="dataManagementAssets">
        <style id="injected-data-management-styles">
             /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.data-management-feature #data-management-section { flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.data-management-feature .dm-table-container { flex-grow: 1; overflow-y: auto; }
        </style>
        <script>
             // Logic already in main JS (initializeDataManagementFeature)
        </script>
        <!-- HTML Structure -->
        <div id="data-management-section" class="feature-content">
            <h2 class="dm-fancy-title"><i class="fas fa-database"></i> Data Management</h2>
            <div class="dm-toolbar">
                <div class="dm-search-filter">
                    <input type="search" id="dm-search-input" placeholder="Search data (ID, Name, etc.)..." class="form-control form-control-sm">
                    <select id="dm-filter-status" class="form-select form-select-sm"> <option value="">Filter by Status...</option> <option value="active">Active</option> <option value="pending">Pending</option> <option value="inactive">Inactive</option> </select>
                    <select id="dm-filter-responsible" class="form-select form-select-sm"> <option value="">Filter by Responsible...</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Basssant Badr">Basssant Badr</option> <option value="Other">Other</option> </select>
                </div>
                <div class="dm-actions">
                    <button id="dm-add-new-btn" class="dm-add-btn btn btn-sm btn-primary"><i class="fas fa-plus"></i> Add New</button>
                    <button id="dm-import-btn" class="dm-import-btn btn btn-sm btn-success"><i class="fas fa-file-import"></i> Import</button>
                    <button id="dm-export-btn" class="dm-export-btn btn btn-sm btn-warning"><i class="fas fa-file-export"></i> Export</button>
                </div>
            </div>
            <div class="dm-table-container table-responsive">
                <table class="dm-table feature-table" id="dm-data-table">
                    <thead> <tr> <th><input type="checkbox" id="dm-select-all" title="Select All"></th> <th>ID</th> <th>Record Name</th> <th>Creation Date</th> <th>Responsible</th> <th>Status</th> <th>Last Updated</th> <th>Actions</th> </tr> </thead>
                    <tbody id="dm-table-body"> <tr><td colspan="8" style="text-align:center; padding: 20px;">Loading data...</td></tr> </tbody>
                </table>
            </div>
            <div class="dm-pagination" id="dm-pagination-controls" style="flex-shrink: 0;"></div>
        </div>
    </template>

    <!-- Template: Deadline Tracker Feature -->
    <template id="deadlineTrackerAssets">
        <style id="injected-deadline-tracker-styles">
             /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.deadline-tracker-feature .deadline-tracker-container { flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.deadline-tracker-feature .tasks-display-area { flex-grow: 1; overflow-y: auto; }
             #featureSectionsContainer.deadline-tracker-feature .tasks-display-area .table-responsive { height: 100%; }
             #featureSectionsContainer.deadline-tracker-feature #tasks-table { height: 100%; }
        </style>
        <script>
             // Logic already in main JS (initializeDeadlineTrackerFeature)
        </script>
         <!-- HTML Structure -->
         <div class="deadline-tracker-container feature-content">
             <header class="tracker-header"> <h1><i class="fas fa-calendar-check"></i> Deadline Tracker</h1> </header>
             <div class="tracker-main-content">
                  <section class="task-input-container card">
                      <h2>Add New Task</h2>
                      <form id="task-form">
                          <div class="form-group"> <label for="task-name">Task Name:</label> <input type="text" id="task-name" class="form-control" name="task-name" required placeholder="Task description..."> </div>
                          <div class="form-group"> <label for="assignee-select">Assignee:</label> <select id="assignee-select" class="form-select" name="assignee" required> <option value="" disabled selected>-- Assignee --</option> </select> </div>
                          <div class="form-group"> <label for="start-date">Start Date:</label> <input type="date" id="start-date" class="form-control" name="start-date" required> </div>
                          <div class="form-group"> <label for="deadline-date">Deadline:</label> <input type="date" id="deadline-date" class="form-control" name="deadline" required> </div>
                          <button type="submit" class="btn btn-primary">Add Task</button>
                      </form>
                  </section>
                  <section class="chart-container card">
                      <h2>Task Status Overview</h2> <canvas id="task-status-chart"></canvas>
                  </section>
             </div>
             <section class="tracker-controls card">
                  <div class="control-group"> <label for="sort-by">Sort By:</label> <select id="sort-by" class="form-select"> <option value="deadline-asc">Deadline (Soonest)</option> <option value="deadline-desc">Deadline (Latest)</option> <option value="start-date-asc">Start Date (Oldest)</option> <option value="assignee-asc">Assignee (A-Z)</option> <option value="status-asc">Status</option> </select> </div>
                  <div class="control-group"> <label for="filter-assignee">Filter Assignee:</label> <select id="filter-assignee" class="form-select"> <option value="All">All Assignees</option> </select> </div>
                  <div class="control-group"> <label for="filter-status">Filter Status:</label> <select id="filter-status" class="form-select"> <option value="All">All Statuses</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> <option value="Overdue">Overdue</option> </select> </div>
                  <div class="export-buttons"> <button id="export-excel" class="button-export btn btn-sm" title="Download Excel Report"><i class="fas fa-file-excel"></i> Excel</button> <button id="export-pdf" class="button-pdf btn btn-sm" title="Download PDF Report"><i class="fas fa-file-pdf"></i> PDF</button> </div>
             </section>
             <section class="tasks-display-area card">
                 <div class="table-responsive">
                     <table id="tasks-table" class="feature-table">
                         <thead> <tr> <th>Task Name</th> <th>Assignee</th> <th>Start Date</th> <th>Deadline</th> <th>Duration</th> <th>Status</th> <th>Actions</th> </tr> </thead>
                         <tbody id="tasks-tbody"> <!-- Rows generated by JS --> </tbody>
                     </table>
                 </div>
             </section>
         </div>
    </template>

    <!-- Template: Innovation Hub Feature -->
    <template id="innovationHubAssets">
         <style id="injected-innovation-hub-styles">
             /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.innovation-hub-feature .innovation-hub-container { flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.innovation-hub-feature #suggestions-list { flex-grow: 1; overflow-y: auto; }
         </style>
         <script>
             // Logic already in main JS (initializeInnovationHubFeature)
         </script>
        <!-- HTML Structure -->
        <div class="innovation-hub-container feature-content">
             <header class="hub-header"> <h1>💡 Innovation Hub — Share Your Ideas & Improve Our Workplace</h1> </header>
             <section class="submission-form-container card">
                 <h2>Submit a New Suggestion</h2>
                 <form id="suggestion-form">
                     <div class="form-group"> <label for="suggestion-text">Your Idea / Suggestion:</label> <textarea id="suggestion-text" name="suggestion-text" class="form-control" rows="4" required placeholder="Describe your innovative idea..."></textarea> </div>
                     <div class="form-row">
                          <div class="form-group"> <label for="employee-select">Submitted By:</label> <select id="employee-select" name="employee" class="form-control form-select" required> <option value="" disabled selected>-- Select Your Name --</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> <option value="Nada Mahmoud">Nada Mahmoud</option> </select> </div>
                          <button type="submit" class="btn btn-primary">Submit Idea</button>
                     </div>
                 </form>
             </section>
             <section class="hub-controls">
                  <div class="form-group"> <label for="filter-status">Filter by Status:</label> <select id="filter-status" class="form-control form-select"> <option value="All">All Statuses</option> <option value="Under Review">Under Review</option> <option value="Implemented">Implemented</option> <option value="Rejected">Rejected</option> </select> </div>
                  <div class="form-group"> <label for="filter-author">Filter by Author:</label> <select id="filter-author" class="form-control form-select"> <option value="All">All Authors</option> </select> </div>
                  <button id="my-ideas-toggle" class="btn btn-outline">Show My Ideas Only</button>
             </section>
             <section id="suggestions-list"> <!-- Suggestion cards inserted here --> </section>
         </div>
    </template>

    <!-- Template: Team Calendar Feature -->
    <template id="teamCalendarAssets">
        <style id="injected-team-calendar-styles">
             /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.team-calendar-feature .calendar-page-container { flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.team-calendar-feature .calendar-main-content { flex-grow: 1; overflow: hidden; display: flex; }
             #featureSectionsContainer.team-calendar-feature #calendar-container { flex-grow: 1; overflow-y: auto; }
        </style>
        <script>
            // Logic already in main JS (initializeTeamCalendarFeature)
        </script>
         <!-- HTML Structure -->
        <div class="calendar-page-container feature-content" style="padding: 0;">
             <header class="calendar-header">
                 <button class="nav-button btn btn-sm btn-outline" id="calendar-prev-month" aria-label="Previous Month"><i class="fas fa-chevron-left"></i></button>
                 <button class="nav-button btn btn-sm btn-outline" id="calendar-next-month" aria-label="Next Month"><i class="fas fa-chevron-right"></i></button>
                 <h2 class="current-month-year" id="calendar-current-month-year">May 2025</h2>
                 <button class="add-event-button btn btn-sm btn-primary" id="calendar-add-event"><i class="fas fa-plus"></i> <span>Add Event</span></button>
             </header>
             <main class="calendar-main-content">
                 <div id="calendar-container">
                     <div class="calendar-grid-placeholder">
                         <div class="calendar-day other-month"><span class="day-number">27</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">28</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">29</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">30</span><div class="event-list"></div></div>
                         <div class="calendar-day current-month"><span class="day-number">1</span><div class="event-list"><div class="event event-meeting"><span>Team Sync</span><span class="employee-name">Nada M.</span></div><div class="event event-deadline important"><span>Project Alpha Due</span><span class="event-badge">!</span></div></div></div>
                         <div class="calendar-day current-month today"><span class="day-number">2</span><div class="event-list"><div class="event event-task"><span>Design Review</span><span class="employee-name">Yousef A.</span></div></div></div>
                         <div class="calendar-day current-month"><span class="day-number">3</span><div class="event-list"><div class="event event-personal"><span>Doc Appointment</span></div></div></div>
                         <div class="calendar-day current-month"><span class="day-number">4</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">5</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">6</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">7</span><div class="event-list"><div class="event event-meeting"><span>Client Call</span><span class="employee-name">Esraa L.</span></div></div></div> <div class="calendar-day current-month"><span class="day-number">8</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">9</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">10</span><div class="event-list"><div class="event event-task"><span>Deploy Staging</span><span class="employee-name">Mohamed E.</span></div></div></div> <div class="calendar-day current-month"><span class="day-number">11</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">12</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">13</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">14</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">15</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">16</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">17</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">18</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">19</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">20</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">21</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">22</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">23</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">24</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">25</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">26</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">27</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">28</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">29</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">30</span><div class="event-list"></div></div> <div class="calendar-day current-month"><span class="day-number">31</span><div class="event-list"></div></div>
                         <div class="calendar-day other-month"><span class="day-number">1</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">2</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">3</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">4</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">5</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">6</span><div class="event-list"></div></div> <div class="calendar-day other-month"><span class="day-number">7</span><div class="event-list"></div></div>
                     </div>
                 </div>
             </main>
         </div>
    </template>

    <!-- Template: File Sharing Feature -->
    <template id="fileSharingAssets">
        <style id="injected-file-sharing-styles">
             /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.file-sharing-feature .card { /* Main container card */ background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; }
             #featureSectionsContainer.file-sharing-feature .card-header { background-color: var(--light); border-radius: var(--card-radius) var(--card-radius) 0 0; border-bottom: 1px solid var(--card-border); padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.file-sharing-feature .card-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.file-sharing-feature .fancy-header-title { background: var(--dashboard-header-bg); color: white; padding: 8px 18px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.0rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 0; }
             #featureSectionsContainer.file-sharing-feature .card-body { padding: 1.5rem; flex-grow: 1; overflow-y: auto; /* Allow body scroll */ }
             #featureSectionsContainer.file-sharing-feature .filters-section { background-color: var(--card-bg); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--card-border); margin-bottom: 1.5rem; flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.file-sharing-feature .filters-section { background-color: var(--light); }
             #featureSectionsContainer.file-sharing-feature #recentUploadsSection { background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 6px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; flex-shrink: 0;}
             body.dark-theme #featureSectionsContainer.file-sharing-feature #recentUploadsSection { background-color: var(--light); }
             #featureSectionsContainer.file-sharing-feature .table-responsive { flex-grow: 1; overflow-y: auto; /* Allow table scroll */ }
             #featureSectionsContainer.file-sharing-feature .table { margin-bottom: 0; background-color: transparent; /* Let container handle bg */ }
        </style>
        <script>
             // Logic already in main JS (initializeFileSharingFeature)
        </script>
         <!-- HTML Structure -->
         <div class="card shadow-sm h-100"> <!-- Added h-100 -->
            <div class="card-header">
                <h5 class="fancy-header-title mb-0"><i class="fas fa-folder-open me-2"></i>File Management</h5>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#uploadFileModal"> <i class="fas fa-upload me-1"></i> Upload New File </button>
            </div>
            <div class="card-body pt-3 d-flex flex-column"> <!-- Added d-flex flex-column -->
                 <div class="row filters-section gy-2 align-items-end">
                     <div class="col-md-4"> <label for="fileSearchInput" class="form-label">Search by Name</label> <div class="input-group input-group-sm search-input"> <input type="text" class="form-control form-control-sm" placeholder="Enter file name..." id="fileSearchInput"> <span class="input-group-text"><i class="fas fa-search"></i></span> </div> </div>
                     <div class="col-md-2"> <label for="fileTypeFilter" class="form-label">File Type</label> <select class="form-select form-select-sm" id="fileTypeFilter" title="Filter by Type"> <option value="" selected>All Types</option> <option value="PDF">PDF</option> <option value="Image">Image</option> <option value="Video">Video</option> <option value="Archive">Archive</option> <option value="Document">Document</option> <option value="Spreadsheet">Spreadsheet</option> </select> </div>
                     <div class="col-md-3"> <label for="uploadDateFilter" class="form-label">Upload Date</label> <input type="date" class="form-control form-control-sm" id="uploadDateFilter" title="Filter by Upload Date"> </div>
                     <div class="col-md-2" id="userFilterContainer" style="display: none;"> <label for="userFilter" class="form-label">Uploader</label> <select class="form-select form-select-sm" id="userFilter" title="Filter by Uploader"> <option value="" selected>All Users</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div>
                      <div class="col-md-1 text-end"> <button class="btn btn-sm btn-outline-secondary" id="resetFiltersBtn" title="Reset Filters"> <i class="fas fa-sync-alt"></i> </button> </div>
                 </div>
                 <div class="mb-4 p-3" id="recentUploadsSection">
                     <h6><i class="fas fa-history me-1"></i> Recent Uploads</h6>
                     <ul class="list-group list-group-flush">
                         <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 5 * 60 * 1000).toISOString()}"> <div><i class="fas fa-file-pdf file-icon text-danger"></i> Quarterly_Report_Q1.pdf</div> <small class="text-muted time-ago">calculating...</small> </li>
                         <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()}"> <div><i class="fas fa-file-image file-icon text-success"></i> New_Company_Logo.png</div> <small class="text-muted time-ago">calculating...</small> </li>
                         <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()}"> <div><i class="fas fa-file-zipper file-icon text-warning"></i> Final_Project_Assets.zip</div> <small class="text-muted time-ago">calculating...</small> </li>
                    </ul>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle feature-table"> <!-- Added feature-table -->
                        <thead> <tr> <th scope="col" style="width: 5%;">Type</th> <th scope="col" style="width: 30%;">File Name</th> <th scope="col" style="width: 18%;">Upload Date</th> <th scope="col" style="width: 17%;">Tags</th> <th scope="col" style="width: 15%;">Uploader</th> <th scope="col" class="text-center" style="width: 15%;">Actions</th> </tr> </thead>
                        <tbody id="fileTableBody">
                             <tr data-file-type="PDF" data-upload-date="2024-05-25" data-uploader="Mohamed Elmenisy"> <td><i class="fas fa-file-pdf file-icon text-danger" title="PDF"></i></td> <td> <strong class="file-name">Monthly Performance Report.pdf</strong> <small class="d-block text-muted">Size: 2.5 MB</small> </td> <td class="upload-date">May 25, 2024, 10:30 AM</td> <td> <span class="badge text-bg-primary">Reports</span> <span class="badge text-bg-secondary">Monthly</span> </td> <td class="uploader-shared">Mohamed Elmenisy</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="1" data-file-url="path/to/report.pdf"> <i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="PDF" data-file-url="path/to/report.pdf"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="1"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> </td> </tr>
                             <tr data-file-type="Image" data-upload-date="2024-05-24" data-uploader="Nada Mahmoud"> <td><i class="fas fa-file-image file-icon text-success" title="Image"></i></td> <td> <strong class="file-name">New Product Photo.jpg</strong> <small class="d-block text-muted">Size: 800 KB</small> </td> <td class="upload-date">May 24, 2024, 03:15 PM</td> <td> <span class="badge text-bg-warning">Products</span> <span class="badge text-bg-info">Design</span> </td> <td class="uploader-shared">Nada Mahmoud</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="2" data-file-url="path/to/image.jpg"> <i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="Image" data-file-url="path/to/image.jpg"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="2"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> </td> </tr>
                             <tr data-file-type="Archive" data-upload-date="2024-05-23" data-uploader="Yousef Ahmed"> <td><i class="fas fa-file-zipper file-icon text-warning" title="Archive"></i></td> <td> <strong class="file-name">Project Resources.zip</strong> <small class="d-block text-muted">Size: 15.2 MB</small> </td> <td class="upload-date">May 23, 2024, 09:00 AM</td> <td><span class="badge text-bg-dark">Project X</span></td> <td class="uploader-shared">Yousef Ahmed</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="3" data-file-url="path/to/archive.zip"> <i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="3"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> </td> </tr>
                             <tr data-file-type="PDF" data-upload-date="2024-05-22" data-uploader="Esraa Lashin"> <td><i class="fas fa-file-pdf file-icon text-danger" title="PDF"></i></td> <td> <strong class="file-name">Meeting Agenda.pdf</strong> <small class="d-block text-muted">Size: 150 KB</small> </td> <td class="upload-date">May 22, 2024, 11:00 AM</td> <td><span class="badge text-bg-info">Meetings</span></td> <td class="uploader-shared">Esraa Lashin</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="4" data-file-url="path/to/agenda.pdf"> <i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="PDF" data-file-url="path/to/agenda.pdf"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="4"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> </td> </tr>
                             <tr data-file-type="Image" data-upload-date="2024-05-26" data-uploader="Bassant Badr"> <td><i class="fas fa-file-image file-icon text-success" title="Image"></i></td> <td> <strong class="file-name">Team Photo.png</strong> <small class="d-block text-muted">Size: 1.2 MB</small> </td> <td class="upload-date">May 26, 2024, 09:00 AM</td> <td><span class="badge text-bg-secondary">Team</span></td> <td class="uploader-shared">Bassant Badr</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="5" data-file-url="path/to/team.png"> <i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="Image" data-file-url="path/to/team.png"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="5"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span> </button> </td> </tr>
                            <tr id="noResultsRow" style="display: none;"> <td colspan="6" class="text-center text-muted fst-italic py-4">No files found matching your criteria.</td> </tr>
                        </tbody>
                    </table>
                </div>
            </div> <!-- End card-body -->
        </div> <!-- End card -->
    </template>

    <!-- Template: Project Tracking Feature (ADDED) -->
    <template id="projectTrackingAssets">
         <style id="injected-project-tracking-styles">
            /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.project-tracking-feature #project-tracking-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; padding: 0; }
             #featureSectionsContainer.project-tracking-feature .card-header { background-color: var(--light); border-radius: var(--card-radius) var(--card-radius) 0 0; border-bottom: 1px solid var(--card-border); padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .card-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-fancy-title { background: var(--dashboard-header-bg); color: white; padding: 8px 18px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.0rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 0; }
             #featureSectionsContainer.project-tracking-feature .pt-fancy-title i { margin-right: 8px; }
             #featureSectionsContainer.project-tracking-feature .pt-content-wrapper { padding: 1.5rem; flex-grow: 1; overflow-y: auto; }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section { background-color: var(--card-bg); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--card-border); margin-bottom: 1.5rem; flex-shrink: 0;}
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-filters-section { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section .form-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem; font-weight: 500; }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section .form-select-sm { font-size: 0.875rem; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations { margin-bottom: 1.5rem; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container { background-color: var(--chart-background); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); height: 300px; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container canvas { max-width: 100%; height: auto; flex-grow: 1; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-title { font-weight: 600; color: var(--text-muted); margin-bottom: 15px; font-size: 0.9rem; text-align: center; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders { background-color: var(--card-bg); padding: 15px; border-radius: 0.5rem; border: 1px solid var(--card-border); height: 300px; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-reminders { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-reminders h6 { color: var(--primary); font-weight: 600; margin-bottom: 10px; border-bottom: 1px solid var(--light-gray); padding-bottom: 8px; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders ul { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders li { padding: 8px 5px; border-bottom: 1px dashed var(--light-gray); font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s ease; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-reminders li { border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-reminders li:last-child { border-bottom: none; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders li:hover { background-color: var(--table-row-hover-bg); }
             #featureSectionsContainer.project-tracking-feature .pt-reminders .deadline { font-size: 0.8em; color: var(--danger); font-weight: 500; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders .days-left { font-size: 0.75em; color: var(--text-muted); font-style: italic; }
             #featureSectionsContainer.project-tracking-feature .pt-table-container { background-color: var(--card-bg); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-table-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-table-container h5 { color: var(--primary); margin-bottom: 15px; font-weight: 600; flex-shrink: 0; }
             #featureSectionsContainer.project-tracking-feature .pt-table-responsive { flex-grow: 1; overflow: auto; } /* Changed class */
             #featureSectionsContainer.project-tracking-feature .pt-table th[data-sort-by] { cursor: pointer; }
             #featureSectionsContainer.project-tracking-feature .pt-table th .sort-icon { margin-left: 5px; color: #ccc; font-size: 0.8em; display: inline-block; width: 10px; text-align: center; }
             #featureSectionsContainer.project-tracking-feature .pt-table th .sort-icon.active { color: var(--primary); }
             #featureSectionsContainer.project-tracking-feature .pt-table .project-name { font-weight: 500; color: var(--text-color); }
             #featureSectionsContainer.project-tracking-feature .pt-table .assigned-team span { display: inline-block; background-color: #eee; color: #555; font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; margin-right: 3px; margin-bottom: 2px; white-space: nowrap; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-table .assigned-team span { background-color: var(--light-gray); color: var(--text-color); }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-cell { min-width: 120px; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress { height: 14px; background-color: #e9ecef; border-radius: 7px; overflow: hidden; position: relative; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-table .progress { background-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar { font-size: 0.9rem; font-weight: bold; line-height: 14px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar.bg-progress-high { background-color: var(--chart-green) !important; color: white; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar.bg-progress-medium { background-color: var(--chart-orange) !important; color: #212529; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar.bg-progress-low { background-color: var(--chart-red) !important; color: white; }
             #featureSectionsContainer.project-tracking-feature .pt-table .status-badge, #featureSectionsContainer.project-tracking-feature .pt-table .priority-badge { /* Uses generic badge */ }
             #featureSectionsContainer.project-tracking-feature .pt-table .notes-cell { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: help; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination { display: flex; justify-content: center; align-items: center; margin-top: 1rem; flex-wrap: wrap; gap: 5px; flex-shrink: 0; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button, #featureSectionsContainer.project-tracking-feature .pt-pagination span { padding: 8px 12px; border: 1px solid var(--light-gray); background-color: var(--card-bg); border-radius: 4px; font-size: 0.9rem; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button { cursor: pointer; transition: background-color 0.2s ease; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button:hover:not(:disabled) { background-color: var(--light); }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button:disabled { cursor: not-allowed; opacity: 0.6; background-color: var(--light); }
             #featureSectionsContainer.project-tracking-feature .pt-pagination span.pt-page-info { border: none; background: none; padding: 8px 5px; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination span.pt-current-page { font-weight: bold; }
        </style>
        <script>
             // Logic already in main JS (initializeProjectTrackingFeature)
        </script>
        <div id="project-tracking-section" class="feature-content" style="padding: 0;"> <!-- No padding on main container -->
             <div class="card-header">
                 <h2 class="pt-fancy-title"><i class="fas fa-tasks me-2"></i> Project Tracking</h2>
             </div>
             <div class="pt-content-wrapper"> <!-- Added wrapper for padding -->
                 <div class="pt-filters-section">
                     <div class="row gy-2 align-items-end">
                         <div class="col-md-4"> <label for="project-status-filter" class="form-label">Filter by Status:</label> <select class="form-select form-select-sm" id="project-status-filter"> <option value="" selected>All Statuses</option> <option value="Completed">Completed</option> <option value="In Progress">In Progress</option> <option value="Delayed">Delayed</option> <option value="Pending">Pending</option> </select> </div>
                         <div class="col-md-4"> <label for="project-team-filter" class="form-label">Filter by Team/Member:</label> <select class="form-select form-select-sm" id="project-team-filter"> <option value="" selected>All Teams/Members</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Basssant Badr">Basssant Badr</option> <option value="Nada Mahmoud">Nada Mahmoud</option> </select> </div>
                         <div class="col-md-2"> <label for="project-priority-filter" class="form-label">Filter by Priority:</label> <select class="form-select form-select-sm" id="project-priority-filter"> <option value="" selected>All Priorities</option> <option value="High">High</option> <option value="Medium">Medium</option> <option value="Low">Low</option> </select> </div>
                         <div class="col-md-2 text-end"> <button class="btn btn-sm btn-outline-secondary w-100" id="resetProjectFiltersBtn" title="Reset Filters"> <i class="fas fa-sync-alt me-1"></i> Reset </button> </div>
                     </div>
                 </div>
                 <div class="row g-3 pt-visualizations">
                      <div class="col-lg-8"> <div class="row g-3"> <div class="col-md-6"> <div class="chart-container"> <p class="chart-title">Project Status Distribution</p> <canvas id="projectStatusPieChart"></canvas> </div> </div> <div class="col-md-6"> <div class="chart-container"> <p class="chart-title">Overall Progress Trend (Simulated)</p> <canvas id="projectProgressLineChart"></canvas> </div> </div> </div> </div>
                      <div class="col-lg-4"> <div class="pt-reminders"> <h6><i class="fas fa-bell me-1 text-warning"></i> Upcoming Deadlines (Next 7 Days)</h6> <ul id="upcomingDeadlinesList"> <li class="text-muted text-center pt-5">Loading deadlines...</li> </ul> </div> </div>
                 </div>
                 <div class="mt-4 pt-table-container">
                      <h5><i class="fas fa-list-check me-2"></i> Project Details</h5>
                      <div class="pt-table-responsive"> <!-- Changed class -->
                         <table class="table table-sm table-hover table-striped align-middle pt-table feature-table" id="projectTrackingTable"> <!-- Added feature-table -->
                             <thead> <tr> <th data-sort-by="name">Project Name <i class="fas fa-sort sort-icon"></i></th> <th data-sort-by="startDate">Start Date <i class="fas fa-sort sort-icon"></i></th> <th data-sort-by="endDate">End Date <i class="fas fa-sort sort-icon"></i></th> <th>Assigned Team</th> <th class="text-center progress-cell" data-sort-by="progress">Progress (%) <i class="fas fa-sort sort-icon"></i></th> <th class="text-center" data-sort-by="status">Status <i class="fas fa-sort sort-icon"></i></th> <th class="text-center" data-sort-by="priority">Priority <i class="fas fa-sort sort-icon"></i></th> <th>Notes</th> </tr> </thead>
                             <tbody id="projectTableBody"> <tr> <td colspan="8" class="text-center p-4 text-muted"> <div class="spinner-border spinner-border-sm text-primary me-2" role="status"> <span class="visually-hidden">Loading...</span> </div> Loading project data... </td> </tr> </tbody>
                         </table>
                      </div>
                      <div class="pt-pagination" id="projectPaginationControls"></div>
                 </div>
             </div>
        </div>
    </template>

    <!-- Template: Reports & Analytics Feature -->
    <template id="reportsAnalyticsAssets">
         <style id="injected-reports-analytics-styles">
            /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.reports-analytics-feature #reports-analytics-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; padding: 0; }
             #featureSectionsContainer.reports-analytics-feature .card-header { background-color: var(--light); border-radius: var(--card-radius) var(--card-radius) 0 0; border-bottom: 1px solid var(--card-border); padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .card-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-fancy-title { background: var(--dashboard-header-bg); color: white; padding: 8px 18px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.0rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 0; }
             #featureSectionsContainer.reports-analytics-feature .ra-fancy-title i { margin-right: 8px; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons .btn { font-size: 0.8rem; padding: 0.375rem 0.75rem; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons .btn i { margin-right: 5px; }
             #featureSectionsContainer.reports-analytics-feature .ra-content-wrapper { padding: 1.5rem; flex-grow: 1; overflow-y: auto; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section { background-color: var(--card-bg); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--card-border); margin-bottom: 1.5rem; flex-shrink: 0;}
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-filters-section { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .btn-group .btn { font-size: 0.85rem; padding: 0.375rem 0.85rem; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .form-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem; font-weight: 500; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section input[type="date"] { font-size: 0.85rem; padding: 0.375rem 0.75rem; max-width: 150px; }
             #featureSectionsContainer.reports-analytics-feature .chart-container { background-color: var(--chart-background); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); height: 350px; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .chart-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .chart-container canvas { max-width: 100%; height: auto; flex-grow: 1; }
             #featureSectionsContainer.reports-analytics-feature .chart-title { font-weight: 600; color: var(--text-muted); margin-bottom: 15px; font-size: 0.9rem; text-align: center; }
             #featureSectionsContainer.reports-analytics-feature .ra-table-container { background-color: var(--card-bg); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); margin-top: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-table-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-table-container h5 { color: var(--primary); margin-bottom: 15px; font-weight: 600; flex-shrink: 0;}
             #featureSectionsContainer.reports-analytics-feature .ra-table-responsive { flex-grow: 1; overflow: auto; } /* Changed class */
             #featureSectionsContainer.reports-analytics-feature .ra-table .employee-name { font-weight: 500; color: var(--text-color); padding-left: 5px; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress { height: 14px; background-color: #e9ecef; min-width: 100px; border-radius: 7px; overflow: hidden; position: relative; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-table .progress { background-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar { font-size: 0.9rem; font-weight: bold; line-height: 14px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar.bg-progress-high { background-color: var(--chart-green) !important; color: white; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar.bg-progress-medium { background-color: var(--chart-orange) !important; color: #212529; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar.bg-progress-low { background-color: var(--chart-red) !important; color: white; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .metric-value { font-weight: 500; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-success { color: var(--chart-green) !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-danger { color: var(--chart-red) !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-info { color: var(--chart-blue) !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-warning { color: var(--chart-orange) !important; }
        </style>
        <script>
             // Logic already in main JS (initializeReportsAnalyticsFeature)
        </script>
        <div id="reports-analytics-section" class="feature-content" style="padding:0;">
             <div class="card-header">
                 <h2 class="ra-fancy-title"><i class="fas fa-chart-pie me-2"></i> Reports & Analytics</h2>
                 <div class="ra-export-buttons"> <button id="exportPdfBtn" class="btn btn-sm btn-outline-danger"> <i class="fas fa-file-pdf"></i> Export PDF </button> <button id="exportExcelBtn" class="btn btn-sm btn-outline-success"> <i class="fas fa-file-excel"></i> Export Excel </button> </div>
             </div>
             <div class="ra-content-wrapper"> <!-- Added wrapper -->
                 <div class="ra-filters-section">
                     <form id="reports-filter-form">
                          <div class="row gy-2 align-items-end">
                             <div class="col-md-auto"> <label class="form-label">Quick Period:</label> <div class="btn-group w-100" role="group" aria-label="Report Period" id="periodBtnGroup"> <input type="radio" class="btn-check" name="period" id="period-day" autocomplete="off" value="day"> <label class="btn btn-sm btn-outline-secondary" for="period-day">Day</label> <input type="radio" class="btn-check" name="period" id="period-week" autocomplete="off" value="week" checked> <label class="btn btn-sm btn-outline-secondary" for="period-week">Week</label> <input type="radio" class="btn-check" name="period" id="period-month" autocomplete="off" value="month"> <label class="btn btn-sm btn-outline-secondary" for="period-month">Month</label> </div> </div>
                              <div class="col-md"> <label for="report-start-date" class="form-label">Start Date:</label> <input type="date" class="form-control form-control-sm" id="report-start-date" name="startDate" required> </div>
                              <div class="col-md"> <label for="report-end-date" class="form-label">End Date:</label> <input type="date" class="form-control form-control-sm" id="report-end-date" name="endDate" required> </div>
                              <div class="col-md-auto"> <button type="submit" class="btn btn-sm btn-primary w-100"> <i class="fas fa-sync-alt me-1"></i> Update Report </button> </div>
                         </div>
                     </form>
                 </div>
                 <div class="row g-4">
                     <div class="col-lg-4 col-md-6"> <div class="chart-container"> <p class="chart-title">Task Completion Rate (%)</p> <canvas id="taskCompletionChart"></canvas> </div> </div>
                     <div class="col-lg-4 col-md-6"> <div class="chart-container"> <p class="chart-title">Overdue Tasks Count</p> <canvas id="overdueTasksChart"></canvas> </div> </div>
                     <div class="col-lg-4 col-md-6"> <div class="chart-container"> <p class="chart-title">Files Uploaded by Employee</p> <canvas id="filesUploadedChart"></canvas> </div> </div>
                     <div class="col-lg-12"> <div class="chart-container" style="height: 400px;"> <p class="chart-title">Employee Performance Comparison</p> <canvas id="performanceComparisonChart"></canvas> </div> </div>
                 </div>
                 <div class="mt-4 ra-table-container">
                      <h5><i class="fas fa-users me-2"></i> Employee Performance Summary</h5>
                      <div class="ra-table-responsive"> <!-- Changed class -->
                         <table class="table table-sm table-hover table-striped align-middle ra-table feature-table" id="employeeSummaryTable"> <!-- Added feature-table -->
                             <thead> <tr> <th>Employee</th> <th class="text-center">Tasks Completed (%)</th> <th class="text-center">Overdue Tasks</th> <th class="text-center">Files Uploaded</th> <th class="text-center">Activity Score</th> </tr> </thead>
                             <tbody id="employeeSummaryTableBody"> <tr><td colspan="5" class="text-center p-4 text-muted"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div><span class="ms-2">Loading employee data...</span></td></tr> </tbody>
                         </table>
                      </div>
                 </div>
             </div>
        </div>
    </template>

    <!-- Template: Task Management Feature -->
    <template id="taskManagementAssets">
        <style id="injected-task-management-styles">
            /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.task-management-feature .task-management-content { flex-grow: 1; display: flex; flex-direction: column; background-color: transparent; padding: 0; box-shadow: none; border-radius: 0; }
             #featureSectionsContainer.task-management-feature .task-page-header { padding: 1.5rem; background: var(--dashboard-header-bg); color: white; border-radius: var(--card-radius) var(--card-radius) 0 0; margin-bottom: 0; text-align: center; flex-shrink: 0; }
             #featureSectionsContainer.task-management-feature .task-page-title { font-size: 1.5rem; font-weight: 600; margin: 0; }
             #featureSectionsContainer.task-management-feature .controls { padding: 1.5rem; background-color: var(--card-bg); border-bottom: 1px solid var(--card-border); flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.task-management-feature .controls { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.task-management-feature .task-list { padding: 1.5rem; background-color: var(--card-bg); border-radius: 0 0 var(--card-radius) var(--card-radius); flex-grow: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }
             body.dark-theme #featureSectionsContainer.task-management-feature .task-list { background-color: var(--light); }
            #featureSectionsContainer.task-management-feature .task-card { background-color: var(--card-bg); border: 1px solid var(--card-border); border-left-width: 5px; border-radius: 6px; padding: 1.25rem; box-shadow: 0 2px 4px var(--card-shadow); transition: box-shadow 0.3s ease, transform 0.2s ease; display: flex; flex-direction: column; justify-content: space-between; position: relative; }
            body.dark-theme #featureSectionsContainer.task-management-feature .task-card { background-color: var(--light); border-color: var(--light-gray); }
            #featureSectionsContainer.task-management-feature .task-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px var(--card-hover-shadow); }
             #featureSectionsContainer.task-management-feature .task-card h3 { font-size: 1.15em; margin-bottom: 0.5rem; color: var(--primary-dark); word-break: break-word; }
              body.dark-theme #featureSectionsContainer.task-management-feature .task-card h3 { color: var(--primary); }
             #featureSectionsContainer.task-management-feature .task-card .description { color: var(--text-muted); font-size: 0.85em; margin-bottom: 1rem; max-height: 60px; overflow-y: auto; }
             #featureSectionsContainer.task-management-feature .task-meta { font-size: 0.8em; color: var(--text-muted); margin-top: 1rem; border-top: 1px solid var(--light-gray); padding-top: 1rem; }
              #featureSectionsContainer.task-management-feature .task-meta > div { margin-bottom: 0.5rem; }
             #featureSectionsContainer.task-management-feature .task-meta strong { color: var(--text-color); font-weight: 600; margin-right: 0.3rem;}
             #featureSectionsContainer.task-management-feature .task-meta .links a { color: var(--primary); text-decoration: none; margin-right: 5px; word-break: break-all;}
             #featureSectionsContainer.task-management-feature .task-meta .links a:hover { text-decoration: underline; }
             #featureSectionsContainer.task-management-feature .task-meta .overdue-indicator { color: var(--danger); font-weight: bold; margin-left: 0.3rem;}
             #featureSectionsContainer.task-management-feature .status-badge { /* Uses generic badge */ }
             #featureSectionsContainer.task-management-feature .task-card.status-Completed { background-color: var(--light); border-left-color: var(--gray); opacity: 0.8; }
             body.dark-theme #featureSectionsContainer.task-management-feature .task-card.status-Completed { background-color: var(--primary-light); border-left-color: var(--gray); }
             #featureSectionsContainer.task-management-feature .task-actions { margin-top: 1rem; text-align: right; border-top: 1px solid var(--light-gray); padding-top: 1rem; }
             #featureSectionsContainer.task-management-feature .task-actions button { background: none; border: none; font-size: 1.1em; padding: 5px; margin-left: 8px; vertical-align: middle; color: var(--gray); cursor: pointer; transition: color 0.2s ease, transform 0.2s ease; }
             #featureSectionsContainer.task-management-feature .task-actions button:hover { transform: scale(1.1); }
             #featureSectionsContainer.task-management-feature .task-actions .edit-btn:hover { color: var(--primary); }
             #featureSectionsContainer.task-management-feature .task-actions .delete-btn { color: var(--danger); }
             #featureSectionsContainer.task-management-feature .task-actions .complete-btn { color: var(--success); }
             #featureSectionsContainer.task-management-feature .task-actions .reopen-btn { color: var(--warning); }
             #featureSectionsContainer.task-management-feature .no-tasks { grid-column: 1 / -1; text-align: center; padding: 2rem; background-color: var(--light); border-radius: var(--card-radius); color: var(--text-muted); }
        </style>
        <script>
            // Logic already in main JS (initializeTaskManagementFeature)
        </script>
        <!-- Task Management Modal (Global) -->
        <div class="modal" id="task-modal">
            <div class="modal-content">
                <div class="modal-header"> <h3 class="modal-title" id="modal-title">Add New Task</h3> <button type="button" class="close-btn close-modal" data-close-modal>&times;</button> </div>
                <form id="task-form">
                    <input type="hidden" id="task-id">
                    <div class="form-group"> <label for="task-name">Task Name</label> <input type="text" id="task-name" class="form-control" required> </div>
                    <div class="form-group"> <label for="task-description">Description</label> <textarea id="task-description" class="form-control" rows="3"></textarea> </div>
                    <div class="form-group"> <label for="task-links">Relevant Links (comma-separated)</label> <input type="text" id="task-links" class="form-control"> </div>
                    <div class="data-form form-row" style="grid-template-columns: 1fr 1fr;">
                        <div> <label for="task-assigned-by">Assigned By</label> <select id="task-assigned-by" class="form-select"> <option value="Self Assigned">Self Assigned</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div>
                        <div> <label for="task-assigned-to">Assigned To</label> <select id="task-assigned-to" class="form-select"> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div>
                    </div>
                     <div class="data-form form-row" style="grid-template-columns: 1fr 1fr;">
                        <div> <label for="task-start-date">Start Date</label> <input type="date" id="task-start-date" class="form-control"> </div>
                        <div> <label for="task-due-date">Due Date</label> <input type="date" id="task-due-date" class="form-control"> </div>
                    </div>
                    <div class="data-form form-row" style="grid-template-columns: 1fr 1fr;">
                         <div> <label for="task-priority">Priority</label> <select id="task-priority" class="form-select" required> <option value="Low">Low</option> <option value="Medium" selected>Medium</option> <option value="High">High</option> </select> </div>
                        <div> <label for="task-status">Status</label> <select id="task-status" class="form-select" required> <option value="Pending" selected>Pending</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> </select> </div>
                    </div>
                    <div class="form-actions"> <button type="button" class="btn btn-outline" id="cancel-btn" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="save-task-btn">Save Task</button> </div>
                </form>
            </div>
        </div>
        <!-- Task Management Content Area -->
        <div class="task-management-content feature-content">
            <div class="task-page-header"> <h1 class="task-page-title">Task Management</h1> </div>
            <div class="controls d-flex flex-wrap align-items-center gap-2">
                <div class="search-container flex-grow-1 me-md-3 position-relative"> <i class="fas fa-search search-icon position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary"></i> <input type="text" id="search-input" class="form-control form-control-sm ps-5" placeholder="Search tasks..."> </div>
                <div class="filters d-flex flex-wrap gap-2">
                    <select id="filter-status" class="form-select form-select-sm" style="min-width: 130px;"> <option value="all" selected>All Statuses</option> <option value="Pending">Pending</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> </select>
                    <select id="filter-priority" class="form-select form-select-sm" style="min-width: 120px;"> <option value="all" selected>All Priorities</option> <option value="High">High</option> <option value="Medium">Medium</option> <option value="Low">Low</option> </select>
                    <select id="filter-assigned-to" class="form-select form-select-sm" style="min-width: 150px;"> <option value="all" selected>All Assignees</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select>
                </div>
                <button id="add-task-btn" class="btn btn-primary btn-sm ms-md-auto"> <i class="fas fa-plus-circle me-1"></i> Add Task </button>
            </div>
            <div class="task-list mt-4" id="task-list">
                 <p class="no-tasks" style="grid-column: 1 / -1;">Loading tasks...</p>
            </div>
        </div>
    </template>

    <!-- Template: File Sharing Feature -->
    <template id="fileSharingAssets">
        <style id="injected-file-sharing-styles">
             /* Styles already in main CSS, scoped selectors used in template */
        </style>
        <script>
             // Logic already in main JS (initializeFileSharingFeature)
        </script>
         <!-- HTML Structure -->
         <div class="card shadow-sm h-100 feature-content">
            <div class="card-header">
                <h5 class="fancy-header-title mb-0"><i class="fas fa-folder-open me-2"></i>File Management</h5>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#uploadFileModal"> <i class="fas fa-upload me-1"></i> Upload New File </button>
            </div>
            <div class="card-body pt-3 d-flex flex-column">
                 <div class="row filters-section gy-2 align-items-end">
                     <div class="col-md-4"> <label for="fileSearchInput" class="form-label">Search by Name</label> <div class="input-group input-group-sm search-input"> <input type="text" class="form-control form
                                                 control-sm" placeholder="Enter file name..." id="fileSearchInput"> <span class="input-group-text"><i class="fas fa-search"></i></span> </div> </div>
                     <div class="col-md-2"> <label for="fileTypeFilter" class="form-label">File Type</label> <select class="form-select form-select-sm" id="fileTypeFilter" title="Filter by Type"> <option value="" selected>All Types</option> <option value="PDF">PDF</option> <option value="Image">Image</option> <option value="Video">Video</option> <option value="Archive">Archive</option> <option value="Document">Document</option> <option value="Spreadsheet">Spreadsheet</option> </select> </div>
                     <div class="col-md-3"> <label for="uploadDateFilter" class="form-label">Upload Date</label> <input type="date" class="form-control form-control-sm" id="uploadDateFilter" title="Filter by Upload Date"> </div>
                     <div class="col-md-2" id="userFilterContainer" style="display: none;"> <label for="userFilter" class="form-label">Uploader</label> <select class="form-select form-select-sm" id="userFilter" title="Filter by Uploader"> <option value="" selected>All Users</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div>
                      <div class="col-md-1 text-end"> <button class="btn btn-sm btn-outline-secondary" id="resetFiltersBtn" title="Reset Filters"> <i class="fas fa-sync-alt"></i> </button> </div>
                 </div>
                 <div class="mb-4 p-3" id="recentUploadsSection">
                     <h6><i class="fas fa-history me-1"></i> Recent Uploads</h6>
                     <ul class="list-group list-group-flush">
                         <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 5 * 60 * 1000).toISOString()}"> <div><i class="fas fa-file-pdf file-icon text-danger"></i> Quarterly_Report_Q1.pdf</div> <small class="text-muted time-ago">calculating...</small> </li>
                         <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()}"> <div><i class="fas fa-file-image file-icon text-success"></i> New_Company_Logo.png</div> <small class="text-muted time-ago">calculating...</small> </li>
                         <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()}"> <div><i class="fas fa-file-zipper file-icon text-warning"></i> Final_Project_Assets.zip</div> <small class="text-muted time-ago">calculating...</small> </li>
                    </ul>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle feature-table">
                        <thead> <tr> <th scope="col" style="width: 5%;">Type</th> <th scope="col" style="width: 30%;">File Name</th> <th scope="col" style="width: 18%;">Upload Date</th> <th scope="col" style="width: 17%;">Tags</th> <th scope="col" style="width: 15%;">Uploader</th> <th scope="col" class="text-center" style="width: 15%;">Actions</th> </tr> </thead>
                        <tbody id="fileTableBody">
                             <tr data-file-type="PDF" data-upload-date="2024-05-25" data-uploader="Mohamed Elmenisy"> <td><i class="fas fa-file-pdf file-icon text-danger" title="PDF"></i></td> <td> <strong class="file-name">Monthly Performance Report.pdf</strong> <small class="d-block text-muted">Size: 2.5 MB</small> </td> <td class="upload-date">May 25, 2024, 10:30 AM</td> <td> <span class="badge text-bg-primary">Reports</span> <span class="badge text-bg-secondary">Monthly</span> </td> <td class="uploader-shared">Mohamed Elmenisy</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="1" data-file-url="path/to/report.pdf"> <i class="fas fa-download original-icon"></i><span class="loading-spinner spinner"></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="PDF" data-file-url="path/to/report.pdf"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="1"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner spinner"></span> </button> </td> </tr>
                             <tr data-file-type="Image" data-upload-date="2024-05-24" data-uploader="Nada Mahmoud"> <td><i class="fas fa-file-image file-icon text-success" title="Image"></i></td> <td> <strong class="file-name">New Product Photo.jpg</strong> <small class="d-block text-muted">Size: 800 KB</small> </td> <td class="upload-date">May 24, 2024, 03:15 PM</td> <td> <span class="badge text-bg-warning">Products</span> <span class="badge text-bg-info">Design</span> </td> <td class="uploader-shared">Nada Mahmoud</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="2" data-file-url="path/to/image.jpg"> <i class="fas fa-download original-icon"></i><span class="loading-spinner spinner"></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="Image" data-file-url="path/to/image.jpg"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="2"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner spinner"></span> </button> </td> </tr>
                             <tr data-file-type="Archive" data-upload-date="2024-05-23" data-uploader="Yousef Ahmed"> <td><i class="fas fa-file-zipper file-icon text-warning" title="Archive"></i></td> <td> <strong class="file-name">Project Resources.zip</strong> <small class="d-block text-muted">Size: 15.2 MB</small> </td> <td class="upload-date">May 23, 2024, 09:00 AM</td> <td><span class="badge text-bg-dark">Project X</span></td> <td class="uploader-shared">Yousef Ahmed</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="3" data-file-url="path/to/archive.zip"> <i class="fas fa-download original-icon"></i><span class="loading-spinner spinner"></span> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="3"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner spinner"></span> </button> </td> </tr>
                             <tr data-file-type="PDF" data-upload-date="2024-05-22" data-uploader="Esraa Lashin"> <td><i class="fas fa-file-pdf file-icon text-danger" title="PDF"></i></td> <td> <strong class="file-name">Meeting Agenda.pdf</strong> <small class="d-block text-muted">Size: 150 KB</small> </td> <td class="upload-date">May 22, 2024, 11:00 AM</td> <td><span class="badge text-bg-info">Meetings</span></td> <td class="uploader-shared">Esraa Lashin</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="4" data-file-url="path/to/agenda.pdf"> <i class="fas fa-download original-icon"></i><span class="loading-spinner spinner"></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="PDF" data-file-url="path/to/agenda.pdf"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="4"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner spinner"></span> </button> </td> </tr>
                             <tr data-file-type="Image" data-upload-date="2024-05-26" data-uploader="Bassant Badr"> <td><i class="fas fa-file-image file-icon text-success" title="Image"></i></td> <td> <strong class="file-name">Team Photo.png</strong> <small class="d-block text-muted">Size: 1.2 MB</small> </td> <td class="upload-date">May 26, 2024, 09:00 AM</td> <td><span class="badge text-bg-secondary">Team</span></td> <td class="uploader-shared">Bassant Badr</td> <td class="text-center action-buttons"> <button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="5" data-file-url="path/to/team.png"> <i class="fas fa-download original-icon"></i><span class="loading-spinner spinner"></span> </button> <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="Image" data-file-url="path/to/team.png"> <i class="fas fa-eye"></i> </button> <button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="5"> <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner spinner"></span> </button> </td> </tr>
                            <tr id="noResultsRow" style="display: none;"> <td colspan="6" class="text-center text-muted fst-italic py-4">No files found matching your criteria.</td> </tr>
                        </tbody>
                    </table>
                </div>
                 <!-- Pagination (Optional) -->
                 <nav aria-label="File list navigation" class="mt-3 d-flex justify-content-center" style="flex-shrink: 0;">
                      <!-- <ul class="pagination pagination-sm"> --> <!-- Pagination items here --> <!-- </ul> -->
                 </nav>
            </div> <!-- End card-body -->
        </div> <!-- End card -->
    </template>

    <!-- Template: Project Tracking Feature -->
    <template id="projectTrackingAssets">
         <style id="injected-project-tracking-styles">
            /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.project-tracking-feature #project-tracking-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; padding: 0; }
             #featureSectionsContainer.project-tracking-feature .card-header { background-color: var(--light); border-radius: var(--card-radius) var(--card-radius) 0 0; border-bottom: 1px solid var(--card-border); padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .card-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-fancy-title { background: var(--dashboard-header-bg); color: white; padding: 8px 18px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.0rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 0; }
             #featureSectionsContainer.project-tracking-feature .pt-fancy-title i { margin-right: 8px; }
             #featureSectionsContainer.project-tracking-feature .pt-content-wrapper { padding: 1.5rem; flex-grow: 1; overflow-y: auto; }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section { background-color: var(--card-bg); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--card-border); margin-bottom: 1.5rem; flex-shrink: 0;}
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-filters-section { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section .form-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem; font-weight: 500; }
             #featureSectionsContainer.project-tracking-feature .pt-filters-section .form-select-sm { font-size: 0.875rem; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations { margin-bottom: 1.5rem; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container { background-color: var(--chart-background); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); height: 300px; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container canvas { max-width: 100%; height: auto; flex-grow: 1; }
             #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-title { font-weight: 600; color: var(--text-muted); margin-bottom: 15px; font-size: 0.9rem; text-align: center; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders { background-color: var(--card-bg); padding: 15px; border-radius: 0.5rem; border: 1px solid var(--card-border); height: 300px; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-reminders { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-reminders h6 { color: var(--primary); font-weight: 600; margin-bottom: 10px; border-bottom: 1px solid var(--light-gray); padding-bottom: 8px; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders ul { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders li { padding: 8px 5px; border-bottom: 1px dashed var(--light-gray); font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s ease; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-reminders li { border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-reminders li:last-child { border-bottom: none; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders li:hover { background-color: var(--table-row-hover-bg); }
             #featureSectionsContainer.project-tracking-feature .pt-reminders .deadline { font-size: 0.8em; color: var(--danger); font-weight: 500; }
             #featureSectionsContainer.project-tracking-feature .pt-reminders .days-left { font-size: 0.75em; color: var(--text-muted); font-style: italic; }
             #featureSectionsContainer.project-tracking-feature .pt-table-container { background-color: var(--card-bg); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-table-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-table-container h5 { color: var(--primary); margin-bottom: 15px; font-weight: 600; flex-shrink: 0;}
             #featureSectionsContainer.project-tracking-feature .pt-table-responsive { flex-grow: 1; overflow: auto; }
             #featureSectionsContainer.project-tracking-feature .pt-table th[data-sort-by] { cursor: pointer; }
             #featureSectionsContainer.project-tracking-feature .pt-table th .sort-icon { margin-left: 5px; color: #ccc; font-size: 0.8em; display: inline-block; width: 10px; text-align: center; }
             #featureSectionsContainer.project-tracking-feature .pt-table th .sort-icon.active { color: var(--primary); }
             #featureSectionsContainer.project-tracking-feature .pt-table .project-name { font-weight: 500; color: var(--text-color); }
             #featureSectionsContainer.project-tracking-feature .pt-table .assigned-team span { display: inline-block; background-color: #eee; color: #555; font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; margin-right: 3px; margin-bottom: 2px; white-space: nowrap; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-table .assigned-team span { background-color: var(--light-gray); color: var(--text-color); }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-cell { min-width: 120px; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress { height: 14px; background-color: #e9ecef; border-radius: 7px; overflow: hidden; position: relative; }
             body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-table .progress { background-color: var(--light-gray); }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar { font-size: 0.9rem; font-weight: bold; line-height: 14px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar.bg-progress-high { background-color: var(--chart-green) !important; color: white; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar.bg-progress-medium { background-color: var(--chart-orange) !important; color: #212529; }
             #featureSectionsContainer.project-tracking-feature .pt-table .progress-bar.bg-progress-low { background-color: var(--chart-red) !important; color: white; }
             #featureSectionsContainer.project-tracking-feature .pt-table .status-badge, #featureSectionsContainer.project-tracking-feature .pt-table .priority-badge { /* Uses generic badge */ }
             #featureSectionsContainer.project-tracking-feature .pt-table .notes-cell { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: help; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination { display: flex; justify-content: center; align-items: center; margin-top: 1rem; flex-wrap: wrap; gap: 5px; flex-shrink: 0; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button, #featureSectionsContainer.project-tracking-feature .pt-pagination span { padding: 8px 12px; border: 1px solid var(--light-gray); background-color: var(--card-bg); border-radius: 4px; font-size: 0.9rem; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button { cursor: pointer; transition: background-color 0.2s ease; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button:hover:not(:disabled) { background-color: var(--light); }
             #featureSectionsContainer.project-tracking-feature .pt-pagination button:disabled { cursor: not-allowed; opacity: 0.6; background-color: var(--light); }
             #featureSectionsContainer.project-tracking-feature .pt-pagination span.pt-page-info { border: none; background: none; padding: 8px 5px; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination span.pt-current-page { font-weight: bold; }
        </style>
        <script>
             // Logic already in main JS (initializeProjectTrackingFeature)
        </script>
        <div id="project-tracking-section" class="feature-content" style="padding: 0;">
             <div class="card-header">
                 <h2 class="pt-fancy-title"><i class="fas fa-tasks me-2"></i> Project Tracking</h2>
             </div>
             <div class="pt-content-wrapper">
                 <div class="pt-filters-section">
                     <div class="row gy-2 align-items-end">
                         <div class="col-md-4"> <label for="project-status-filter" class="form-label">Filter by Status:</label> <select class="form-select form-select-sm" id="project-status-filter"> <option value="" selected>All Statuses</option> <option value="Completed">Completed</option> <option value="In Progress">In Progress</option> <option value="Delayed">Delayed</option> <option value="Pending">Pending</option> </select> </div>
                         <div class="col-md-4"> <label for="project-team-filter" class="form-label">Filter by Team/Member:</label> <select class="form-select form-select-sm" id="project-team-filter"> <option value="" selected>All Teams/Members</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Basssant Badr">Basssant Badr</option> <option value="Nada Mahmoud">Nada Mahmoud</option> </select> </div>
                         <div class="col-md-2"> <label for="project-priority-filter" class="form-label">Filter by Priority:</label> <select class="form-select form-select-sm" id="project-priority-filter"> <option value="" selected>All Priorities</option> <option value="High">High</option> <option value="Medium">Medium</option> <option value="Low">Low</option> </select> </div>
                         <div class="col-md-2 text-end"> <button class="btn btn-sm btn-outline-secondary w-100" id="resetProjectFiltersBtn" title="Reset Filters"> <i class="fas fa-sync-alt me-1"></i> Reset </button> </div>
                     </div>
                 </div>
                 <div class="row g-3 pt-visualizations">
                      <div class="col-lg-8"> <div class="row g-3"> <div class="col-md-6"> <div class="chart-container"> <p class="chart-title">Project Status Distribution</p> <canvas id="projectStatusPieChart"></canvas> </div> </div> <div class="col-md-6"> <div class="chart-container"> <p class="chart-title">Overall Progress Trend (Simulated)</p> <canvas id="projectProgressLineChart"></canvas> </div> </div> </div> </div>
                      <div class="col-lg-4"> <div class="pt-reminders"> <h6><i class="fas fa-bell me-1 text-warning"></i> Upcoming Deadlines (Next 7 Days)</h6> <ul id="upcomingDeadlinesList"> <li class="text-muted text-center pt-5">Loading deadlines...</li> </ul> </div> </div>
                 </div>
                 <div class="mt-4 pt-table-container">
                      <h5><i class="fas fa-list-check me-2"></i> Project Details</h5>
                      <div class="pt-table-responsive">
                         <table class="table table-sm table-hover table-striped align-middle pt-table feature-table" id="projectTrackingTable">
                             <thead> <tr> <th data-sort-by="name">Project Name <i class="fas fa-sort sort-icon"></i></th> <th data-sort-by="startDate">Start Date <i class="fas fa-sort sort-icon"></i></th> <th data-sort-by="endDate">End Date <i class="fas fa-sort sort-icon"></i></th> <th>Assigned Team</th> <th class="text-center progress-cell" data-sort-by="progress">Progress (%) <i class="fas fa-sort sort-icon"></i></th> <th class="text-center" data-sort-by="status">Status <i class="fas fa-sort sort-icon"></i></th> <th class="text-center" data-sort-by="priority">Priority <i class="fas fa-sort sort-icon"></i></th> <th>Notes</th> </tr> </thead>
                             <tbody id="projectTableBody"> <tr> <td colspan="8" class="text-center p-4 text-muted"> <div class="spinner-border spinner-border-sm text-primary me-2" role="status"> <span class="visually-hidden">Loading...</span> </div> Loading project data... </td> </tr> </tbody>
                         </table>
                      </div>
                      <div class="pt-pagination" id="projectPaginationControls"></div>
                 </div>
             </div>
        </div>
    </template>

    <!-- Template: Reports & Analytics Feature -->
    <template id="reportsAnalyticsAssets">
         <style id="injected-reports-analytics-styles">
            /* Styles already in main CSS, scoped selectors used in template */
             #featureSectionsContainer.reports-analytics-feature #reports-analytics-section { background-color: var(--card-bg); border-radius: var(--card-radius); box-shadow: 0 1px 3px var(--card-shadow); border: 1px solid var(--card-border); flex-grow: 1; display: flex; flex-direction: column; padding: 0; }
             #featureSectionsContainer.reports-analytics-feature .card-header { background-color: var(--light); border-radius: var(--card-radius) var(--card-radius) 0 0; border-bottom: 1px solid var(--card-border); padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; flex-shrink: 0; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .card-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-fancy-title { background: var(--dashboard-header-bg); color: white; padding: 8px 18px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.0rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 0; }
             #featureSectionsContainer.reports-analytics-feature .ra-fancy-title i { margin-right: 8px; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons .btn { font-size: 0.8rem; padding: 0.375rem 0.75rem; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons .btn i { margin-right: 5px; }
             #featureSectionsContainer.reports-analytics-feature .ra-content-wrapper { padding: 1.5rem; flex-grow: 1; overflow-y: auto; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section { background-color: var(--card-bg); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--card-border); margin-bottom: 1.5rem; flex-shrink: 0;}
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-filters-section { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .btn-group .btn { font-size: 0.85rem; padding: 0.375rem 0.85rem; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .form-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem; font-weight: 500; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section input[type="date"] { font-size: 0.85rem; padding: 0.375rem 0.75rem; max-width: 150px; }
             #featureSectionsContainer.reports-analytics-feature .chart-container { background-color: var(--chart-background); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); height: 350px; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .chart-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .chart-container canvas { max-width: 100%; height: auto; flex-grow: 1; }
             #featureSectionsContainer.reports-analytics-feature .chart-title { font-weight: 600; color: var(--text-muted); margin-bottom: 15px; font-size: 0.9rem; text-align: center; }
             #featureSectionsContainer.reports-analytics-feature .ra-table-container { background-color: var(--card-bg); padding: 20px; border-radius: 0.5rem; border: 1px solid var(--card-border); margin-top: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-table-container { background-color: var(--light); border-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-table-container h5 { color: var(--primary); margin-bottom: 15px; font-weight: 600; flex-shrink: 0;}
             #featureSectionsContainer.reports-analytics-feature .ra-table-responsive { flex-grow: 1; overflow: auto; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .employee-name { font-weight: 500; color: var(--text-color); padding-left: 5px; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress { height: 14px; background-color: #e9ecef; min-width: 100px; border-radius: 7px; overflow: hidden; position: relative; }
             body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-table .progress { background-color: var(--light-gray); }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar { font-size: 0.9rem; font-weight: bold; line-height: 14px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar.bg-progress-high { background-color: var(--chart-green) !important; color: white; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar.bg-progress-medium { background-color: var(--chart-orange) !important; color: #212529; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .progress-bar.bg-progress-low { background-color: var(--chart-red) !important; color: white; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .metric-value { font-weight: 500; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-success { color: var(--chart-green) !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-danger { color: var(--chart-red) !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-info { color: var(--chart-blue) !important; }
             #featureSectionsContainer.reports-analytics-feature .ra-table .text-warning { color: var(--chart-orange) !important; }
        </style>
        <script>
             // Logic already in main JS (initializeReportsAnalyticsFeature)
        </script>
        <div id="reports-analytics-section" class="feature-content" style="padding:0;">
             <div class="card-header">
                 <h2 class="ra-fancy-title"><i class="fas fa-chart-pie me-2"></i> Reports & Analytics</h2>
                 <div class="ra-export-buttons"> <button id="exportPdfBtn" class="btn btn-sm btn-outline-danger"> <i class="fas fa-file-pdf"></i> Export PDF </button> <button id="exportExcelBtn" class="btn btn-sm btn-outline-success"> <i class="fas fa-file-excel"></i> Export Excel </button> </div>
             </div>
             <div class="ra-content-wrapper">
                 <div class="ra-filters-section">
                     <form id="reports-filter-form">
                          <div class="row gy-2 align-items-end">
                             <div class="col-md-auto"> <label class="form-label">Quick Period:</label> <div class="btn-group w-100" role="group" aria-label="Report Period" id="periodBtnGroup"> <input type="radio" class="btn-check" name="period" id="period-day" autocomplete="off" value="day"> <label class="btn btn-sm btn-outline-secondary" for="period-day">Day</label> <input type="radio" class="btn-check" name="period" id="period-week" autocomplete="off" value="week" checked> <label class="btn btn-sm btn-outline-secondary" for="period-week">Week</label> <input type="radio" class="btn-check" name="period" id="period-month" autocomplete="off" value="month"> <label class="btn btn-sm btn-outline-secondary" for="period-month">Month</label> </div> </div>
                              <div class="col-md"> <label for="report-start-date" class="form-label">Start Date:</label> <input type="date" class="form-control form-control-sm" id="report-start-date" name="startDate" required> </div>
                              <div class="col-md"> <label for="report-end-date" class="form-label">End Date:</label> <input type="date" class="form-control form-control-sm" id="report-end-date" name="endDate" required> </div>
                              <div class="col-md-auto"> <button type="submit" class="btn btn-sm btn-primary w-100"> <i class="fas fa-sync-alt me-1"></i> Update Report </button> </div>
                         </div>
                     </form>
                 </div>
                 <div class="row g-4">
                     <div class="col-lg-4 col-md-6"> <div class="chart-container"> <p class="chart-title">Task Completion Rate (%)</p> <canvas id="taskCompletionChart"></canvas> </div> </div>
                     <div class="col-lg-4 col-md-6"> <div class="chart-container"> <p class="chart-title">Overdue Tasks Count</p> <canvas id="overdueTasksChart"></canvas> </div> </div>
                     <div class="col-lg-4 col-md-6"> <div class="chart-container"> <p class="chart-title">Files Uploaded by Employee</p> <canvas id="filesUploadedChart"></canvas> </div> </div>
                     <div class="col-lg-12"> <div class="chart-container" style="height: 400px;"> <p class="chart-title">Employee Performance Comparison</p> <canvas id="performanceComparisonChart"></canvas> </div> </div>
                 </div>
                 <div class="mt-4 ra-table-container">
                      <h5><i class="fas fa-users me-2"></i> Employee Performance Summary</h5>
                      <div class="ra-table-responsive">
                         <table class="table table-sm table-hover table-striped align-middle ra-table feature-table" id="employeeSummaryTable">
                             <thead> <tr> <th>Employee</th> <th class="text-center">Tasks Completed (%)</th> <th class="text-center">Overdue Tasks</th> <th class="text-center">Files Uploaded</th> <th class="text-center">Activity Score</th> </tr> </thead>
                             <tbody id="employeeSummaryTableBody"> <tr><td colspan="5" class="text-center p-4 text-muted"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div><span class="ms-2">Loading employee data...</span></td></tr> </tbody>
                         </table>
                      </div>
                 </div>
             </div>
        </div>
    </template>

    <!-- Template: Task Management Feature -->
    <template id="taskManagementAssets">
        <style id="injected-task-management-styles">
             /* Styles already in main CSS, scoped selectors used in template */
        </style>
        <script>
             // Logic already in main JS (initializeTaskManagementFeature)
        </script>
        <!-- Task Management Modal (Global) -->
        <div class="modal" id="task-modal">
            <div class="modal-content">
                <div class="modal-header"> <h3 class="modal-title" id="modal-title">Add New Task</h3> <button type="button" class="close-btn close-modal" data-close-modal>&times;</button> </div>
                <form id="task-form">
                    <input type="hidden" id="task-id">
                    <div class="form-group"> <label for="task-name">Task Name</label> <input type="text" id="task-name" class="form-control" required> </div>
                    <div class="form-group"> <label for="task-description">Description</label> <textarea id="task-description" class="form-control" rows="3"></textarea> </div>
                    <div class="form-group"> <label for="task-links">Relevant Links (comma-separated)</label> <input type="text" id="task-links" class="form-control"> </div>
                    <div class="data-form form-row" style="grid-template-columns: 1fr 1fr;">
                        <div> <label for="task-assigned-by">Assigned By</label> <select id="task-assigned-by" class="form-select"> <option value="Self Assigned">Self Assigned</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div>
                        <div> <label for="task-assigned-to">Assigned To</label> <select id="task-assigned-to" class="form-select"> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div>
                    </div>
                     <div class="data-form form-row" style="grid-template-columns: 1fr 1fr;">
                        <div> <label for="task-start-date">Start Date</label> <input type="date" id="task-start-date" class="form-control"> </div>
                        <div> <label for="task-due-date">Due Date</label> <input type="date" id="task-due-date" class="form-control"> </div>
                    </div>
                    <div class="data-form form-row" style="grid-template-columns: 1fr 1fr;">
                         <div> <label for="task-priority">Priority</label> <select id="task-priority" class="form-select" required> <option value="Low">Low</option> <option value="Medium" selected>Medium</option> <option value="High">High</option> </select> </div>
                        <div> <label for="task-status">Status</label> <select id="task-status" class="form-select" required> <option value="Pending" selected>Pending</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> </select> </div>
                    </div>
                    <div class="form-actions"> <button type="button" class="btn btn-outline" id="cancel-btn" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="save-task-btn">Save Task</button> </div>
                </form>
            </div>
        </div>
        <!-- Task Management Content Area -->
        <div class="task-management-content feature-content">
            <div class="task-page-header"> <h1 class="task-page-title">Task Management</h1> </div>
            <div class="controls d-flex flex-wrap align-items-center gap-2">
                <div class="search-container flex-grow-1 me-md-3 position-relative"> <i class="fas fa-search search-icon position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary"></i> <input type="text" id="search-input" class="form-control form-control-sm ps-5" placeholder="Search tasks..."> </div>
                <div class="filters d-flex flex-wrap gap-2">
                    <select id="filter-status" class="form-select form-select-sm" style="min-width: 130px;"> <option value="all" selected>All Statuses</option> <option value="Pending">Pending</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> </select>
                    <select id="filter-priority" class="form-select form-select-sm" style="min-width: 120px;"> <option value="all" selected>All Priorities</option> <option value="High">High</option> <option value="Medium">Medium</option> <option value="Low">Low</option> </select>
                    <select id="filter-assigned-to" class="form-select form-select-sm" style="min-width: 150px;"> <option value="all" selected>All Assignees</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Nada Mahmoud">Nada Mahmoud</option> <option value="Yousef Ahmed">Yousef Ahmed</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select>
                </div>
                <button id="add-task-btn" class="btn btn-primary btn-sm ms-md-auto"> <i class="fas fa-plus-circle me-1"></i> Add Task </button>
            </div>
            <div class="task-list mt-4" id="task-list">
                 <p class="no-tasks" style="grid-column: 1 / -1;">Loading tasks...</p>
            </div>
        </div>
    </template>

    <!-- ========= END Feature Templates ========= -->

    <!-- JS Libraries (Bootstrap, Chart.js, SweetAlert2, jsPDF, jsPDF-AutoTable) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Chart.js already included -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- jsPDF and AutoTable included conditionally or make sure they are loaded -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script> -->

    <script>
        // Main Dashboard Logic (including fixes and integrations)
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements ---
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.menu-item');
            const contentSections = document.querySelectorAll('.content-area > .content-section');
            const dashboardContent = document.getElementById('dashboardContent');
            const profileContent = document.getElementById('profileContent');
            const settingsContent = document.getElementById('settingsContent');
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureTitleEl = document.getElementById('featureTitle');
            const featureDescEl = document.getElementById('featureDescription');
            const featureLoadingEl = featurePlaceholder?.querySelector('.loading-indicator'); // Add checks
            const featureErrorEl = featurePlaceholder?.querySelector('.error-message'); // Add checks
            const backButton = document.getElementById('backButton');
            const backButtonText = document.getElementById('backButtonText');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const searchInput = document.getElementById('searchInput');
            const searchResultsContainer = document.getElementById('searchResults');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationBadge = document.getElementById('notificationBadge');
            const notificationsModal = document.getElementById('notificationsModal');
            const closeNotifications = document.getElementById('closeNotifications');
            const notificationsBody = document.getElementById('notificationsBody');
            const noNotificationsMessage = document.getElementById('noNotificationsMessage');
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn');
            // const notificationSound = document.getElementById('notificationSound'); // Removed
            const activityList = document.getElementById('activityList');
            const viewAllActivity = document.getElementById('viewAllActivity');
            const deleteAllActivity = document.getElementById('deleteAllActivity');
            const statsSection = document.getElementById('statsSection');
            const welcomeSection = document.getElementById('welcomeSection');
            // Profile Elements
            const profileForm = document.getElementById('profileForm');
            const profileAvatarLarge = document.getElementById('profileAvatarLarge');
            const profileAvatarInput = document.getElementById('profileAvatarInput');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const fullNameDisplay = document.getElementById('fullNameDisplay');
            const jobTitleInput = document.getElementById('jobTitle');
            const emailDisplay = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const departmentInput = document.getElementById('department');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const cancelProfileBtn = document.getElementById('cancelProfileBtn');
            // Settings Elements
            const themeOptions = document.querySelectorAll('.theme-option');
            const highContrastToggle = document.getElementById('highContrastToggle');
            const languageSelect = document.getElementById('languageSelect');
            const regionSelect = document.getElementById('regionSelect');
            const timeFormatSelect = document.getElementById('timeFormatSelect');
            const dateFormatSelect = document.getElementById('dateFormatSelect');
            const toastToggle = document.getElementById('toastToggle');
            const soundToggle = document.getElementById('soundToggle');
            const notificationToneSelect = document.getElementById('notificationToneSelect');
            const savePreferencesBtn = document.getElementById('savePreferencesBtn');
            // Account Settings
            const accountEmailDisplay = document.getElementById('accountEmail');
            const changeEmailInput = document.getElementById('changeEmail');
            const accountConfirmPasswordInput = document.getElementById('accountConfirmPassword');
            const saveAccountEmailBtn = document.getElementById('saveAccountEmailBtn');
            const accountNotificationsToggle = document.getElementById('accountNotificationsToggle');
            const saveAccountSettingsBtn = document.getElementById('saveAccountSettingsBtn');
            // Security Settings
            const changePasswordForm = document.getElementById('changePasswordForm');
            const enable2faBtn = document.getElementById('enable2faBtn');
            const twoFaSetupSection = document.getElementById('twoFaSetupSection');
            const twoFaManagementSection = document.getElementById('twoFaManagementSection');
            const twoFaStatusIndicator = document.getElementById('twoFaStatusIndicator');
            const twoFaStatusText = document.getElementById('twoFaStatusText');
            const twoFaSetupOptions = document.getElementById('twoFaSetupOptions');
            const setupAuthAppBtn = document.getElementById('setupAuthAppBtn');
            const setupSmsBtn = document.getElementById('setupSmsBtn');
            const authAppSetup = document.getElementById('authAppSetup');
            const smsSetup = document.getElementById('smsSetup');
            const verifyAuthCodeBtn = document.getElementById('verifyAuthCodeBtn');
            const userPhoneNumberForSms = document.getElementById('userPhoneNumberForSms');
            const sendSmsCodeBtn = document.getElementById('sendSmsCodeBtn');
            const smsCodeInputGroup = document.getElementById('smsCodeInputGroup');
            const verifySmsCodeBtn = document.getElementById('verifySmsCodeBtn');
            const disable2faBtn = document.getElementById('disable2faBtn');
            const saveSessionSettingsBtn = document.getElementById('saveSessionSettingsBtn');
            // Danger Zone
            const logoutAllDevicesBtn = document.getElementById('logoutAllDevicesBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            // Notification Settings Panel
            const emailNotificationsToggle = document.getElementById('emailNotificationsToggle');
            const inAppNotificationsToggle = document.getElementById('inAppNotificationsToggle');
            const pushNotificationsToggle = document.getElementById('pushNotificationsToggle');
            const notificationTypeCheckboxes = document.querySelectorAll('input[name="notificationType"]');
            const saveNotificationSettingsBtn = document.getElementById('saveNotificationSettingsBtn');
            // Modals & Messages
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const successMessage = document.getElementById('successMessage');
            const successMessageText = document.getElementById('successMessageText');
            const toastMessage = document.getElementById('toastMessage');
            const memberModal = document.getElementById('memberModal');
            const memberForm = document.getElementById('memberForm');
            const memberModalTitle = document.getElementById('memberModalTitle');
            const saveMemberBtn = document.getElementById('saveMemberBtn');
            const projectModal = document.getElementById('projectModal');
            const projectForm = document.getElementById('projectForm');
            const projectModalTitle = document.getElementById('projectModalTitle');
            const saveProjectBtn = document.getElementById('saveProjectBtn');
            // Logout Link
            const logoutLink = document.getElementById('logoutLink');

            // --- State Variables ---
            let currentUser = null; let currentFeature = 'dashboard'; let currentSettingsTab = 'preferences'; let notifications = []; let activities = []; let activityIntervalId = null; let notificationIntervalId = null; let statsIntervalId = null; let welcomeBgIntervalId = null; let confirmCallback = null; let maxActivitiesToShow = 5; let showingAllActivities = false; let userDropdownOpen = false; let showToasts = true; let playSounds = true; let currentScheduleWeekOffset = 0; let scheduleMinWeekOffset = 0; let mockScheduleData = {}; let currentFeatureCleanup = null; let MOCK_PROJECTS_DATA = []; let MOCK_TASKS = [];

            // --- Mock Data ---
            let MOCK_USERS = [ { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin', twoFaEnabled: false }, { id: 2, name: 'Nada Mahmoud', email: 'n.mahmoud@thechefz.co', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'NM', role: 'supervisor', twoFaEnabled: false }, { id: 3, name: 'Yousef Ahmed', email: 'y.abbas@thechefz.co', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'YA', role: 'senior', twoFaEnabled: true }, { id: 4, name: 'Esraa Lashin', email: 'e.lasheen@thechefz.co', title: 'Member', department: 'Design', phone: '+20155444333', avatar: '', initials: 'EL', role: 'member', twoFaEnabled: false }, { id: 5, name: 'Bassant Badr', email: 'b.badr@thechefz.co', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'BB', role: 'member', twoFaEnabled: false }, ];
            const MOCK_PROJECTS = [ { id: 101, name: 'Project Alpha', status: 'Active' }, { id: 102, name: 'Project Beta', status: 'Planning' }, { id: 103, name: 'Project Gamma', status: 'Completed' }, { id: 104, name: 'Zeus Initiative', status: 'Active' }, ];
            function initializeMockTasks() { MOCK_TASKS = [ { id: 201, name: 'Design Homepage Mockup', status: 'Completed', project: 101, description: 'Create mockups for main pages using Figma.', links: "https://figma.com", assignedBy: "Yousef", assignedTo: "Esraa Lashin", startDate: "2024-07-21", dueDate: "2024-07-25", priority: "Medium", completionDate: "2024-07-24" }, { id: 202, name: 'Develop API Endpoints', status: 'In Progress', project: 101, description: 'Build RESTful APIs for core features.', links: "", assignedBy: "Nada", assignedTo: "Yousef Ahmed", startDate: "2024-07-23", dueDate: "2024-07-30", priority: "High", completionDate: null }, { id: 203, name: 'User Testing Phase 1', status: 'Pending', project: 102, description: 'Conduct usability tests with target group.', links: "", assignedBy: "Nada", assignedTo: "Bassant Badr", startDate: "2024-08-01", dueDate: "2024-08-05", priority: "Medium", completionDate: null }, { id: 204, name: 'Create Task Management Feature', status: 'In Progress', project: 104, description: 'Integrate the task management component.', links: "#task-management", assignedBy: "Mohamed Elmenisy", assignedTo: "Mohamed Elmenisy", startDate: "2024-07-28", dueDate: "2024-08-10", priority: "High", completionDate: null }, { id: 205, name: 'Fix Login Bug (JIRA-123)', description: "Special characters issue in password field.", links: "jira-123", assignedBy: "Yousef Ahmed", assignedTo: "Yousef Ahmed", startDate: "2024-07-15", dueDate: "2024-07-18", priority: "High", status: "Completed", completionDate: "2024-07-17" }, { id: 206, name: 'Prepare Q4 Budget Proposal', description: "Draft budget for next quarter.", links: "", assignedBy: "Nada Mahmoud", assignedTo: "Mohamed Elmenisy", startDate: "2024-08-05", dueDate: "2024-08-15", priority: "Medium", status: "Pending", completionDate: null }, ]; }

            // --- Global Utility Functions ---
            window.timeAgo = function(timestamp) { if (!timestamp) return ''; if (!(timestamp instanceof Date)) { const date = new Date(timestamp); if (isNaN(date.getTime())) return ''; timestamp = date; } const now = new Date(); const secondsPast = (now.getTime() - timestamp.getTime()) / 1000; if (secondsPast < 10) { return 'Just now'; } if (secondsPast < 60) { return parseInt(secondsPast) + 's ago'; } if (secondsPast < 3600) { return parseInt(secondsPast / 60) + 'm ago'; } if (secondsPast < 3600 * 24) { return parseInt(secondsPast / 3600) + 'h ago'; } return formatDateForDisplay(timestamp); }
            window.formatDateForDisplay = function(date) { if (!date) return 'N/A'; if (!(date instanceof Date)) { const parsedDate = new Date(date); if (isNaN(parsedDate.getTime())) return ''; date = parsedDate; } const dateFormat = localStorage.getItem('dateFormat') || 'MM/DD/YYYY'; const year = date.getFullYear(); const month = date.getMonth() + 1; const day = date.getDate(); const monthPadded = String(month).padStart(2, '0'); const dayPadded = String(day).padStart(2, '0'); const monthName = date.toLocaleDateString(undefined, { month: 'short' }); try { switch (dateFormat) { case 'DD/MM/YYYY': return `${dayPadded}/${monthPadded}/${year}`; case 'YYYY-MM-DD': return `${year}-${monthPadded}-${dayPadded}`; case 'Month D, YYYY': return `${monthName} ${day}, ${year}`; case 'MM/DD/YYYY': default: return `${monthPadded}/${dayPadded}/${year}`; } } catch (e) { console.error("Error formatting date:", e); return `${String(month).padStart(2, '0')}/${String(day).padStart(2, '0')}/${year}`; } }
            window.formatFullDateTime = function(date) { if (!date) return 'N/A'; if (!(date instanceof Date)) { const parsedDate = new Date(date); if (isNaN(parsedDate.getTime())) return ''; date = parsedDate; } const formattedDate = formatDateForDisplay(date); const timeFormat = localStorage.getItem('timeFormat') || '12h'; const options = { hour: 'numeric', minute: 'numeric', hour12: timeFormat === '12h' }; try { const formattedTime = date.toLocaleTimeString(undefined, options); return `${formattedDate}, ${formattedTime}`; } catch (e) { console.error("Error formatting time:", e); return formattedDate; } }
            window.generateMockActivities = function(count, baseTimestampMillis) { const nowMillis=baseTimestampMillis||Date.now(); const newActivities=[]; let users=MOCK_USERS.map(u=>u.name.split(' ')[0]); if(users.length===0)users.push('System'); const actions=['updated profile','completed task','added project','commented on task','uploaded file','joined team']; const icons=['fa-user-edit','fa-check-circle','fa-plus-circle','fa-comment','fa-upload','fa-user-plus']; const tasks=MOCK_TASKS.map(t=>`'${t.name.substring(0,20)}...'`); const projects=MOCK_PROJECTS_DATA.map(p=>`'${p.name}'`); const files=['doc.pdf','img.png','sheet.xlsx','pres.pptx']; for(let i=0;i<count;i++){ const user=users[Math.floor(Math.random()*users.length)]; const actionIndex=Math.floor(Math.random()*actions.length); let message=`${user} ${actions[actionIndex]}`; if(actions[actionIndex].includes('task')&&tasks.length>0){message+=` ${tasks[Math.floor(Math.random()*tasks.length)]}`;}else if(actions[actionIndex].includes('project')&&projects.length>0){message+=` ${projects[Math.floor(Math.random()*projects.length)]}`;}else if(actions[actionIndex].includes('file')&&files.length>0){message+=` ${files[Math.floor(Math.random()*files.length)]}`;} let timestampMillis; if(count===1){timestampMillis=nowMillis-Math.random()*1000*10;}else{timestampMillis=nowMillis-(Math.random()*1000*3600*(i+1)*1.5+300000);} timestampMillis=Math.min(timestampMillis,nowMillis); newActivities.push({id:nowMillis+i+Math.floor(Math.random()*1000),icon:icons[actionIndex],message:message,timestamp:new Date(timestampMillis),isNew:false});} return count>1?newActivities.sort((a,b)=>b.timestamp-a.timestamp):newActivities; }
            window.generateMockNotifications = function(count, baseTimestampMillis) { const nowMillis=baseTimestampMillis||Date.now(); const newNotifications=[]; const types=[{msg:'New task assigned:',icon:'fa-tasks',type:'task'},{msg:'Project deadline approaching:',icon:'fa-clock',type:'project'},{msg:'Mentioned you:',icon:'fa-comment-dots',type:'comment'},{msg:'System update:',icon:'fa-info-circle',type:'system'},{msg:'File shared:',icon:'fa-file-alt',type:'file'},]; const tasks=MOCK_TASKS.map(t=>`'${t.name.substring(0,20)}...'`); const projects=MOCK_PROJECTS_DATA.map(p=>`'${p.name}'`); let users=MOCK_USERS.map(u=>u.name.split(' ')[0]); if(users.length===0)users.push('System'); const files=['report.docx','logo.svg','data.csv']; for(let i=0;i<count;i++){ const typeInfo=types[Math.floor(Math.random()*types.length)]; let message=typeInfo.msg; if(typeInfo.type==='task'&&tasks.length>0)message+=` ${tasks[Math.floor(Math.random()*tasks.length)]}`;else if(typeInfo.type==='project'&&projects.length>0)message+=` ${projects[Math.floor(Math.random()*projects.length)]}`;else if(typeInfo.type==='comment'&&users.length>0)message+=` by ${users[Math.floor(Math.random()*users.length)]}`;else if(typeInfo.type==='file'&&files.length>0&&users.length>0)message+=` ${files[Math.floor(Math.random()*files.length)]} by ${users[Math.floor(Math.random()*users.length)]}`; let timestampMillis; if(count===1){timestampMillis=nowMillis-Math.random()*1000*15;}else{timestampMillis=nowMillis-(Math.random()*1000*3600*(i+1)*1.8+180000);} timestampMillis=Math.min(timestampMillis,nowMillis); newNotifications.push({id:nowMillis+i+10000+Math.floor(Math.random()*1000),icon:typeInfo.icon,message:message,timestamp:new Date(timestampMillis),unread:count===1?true:Math.random()>0.3});} return count>1?newNotifications.sort((a,b)=>b.timestamp-a.timestamp):newNotifications; }
            window.showConfirmModal = function(title, message, onConfirm, buttonClass = 'btn-danger') { confirmTitle.textContent = title; confirmMessage.innerHTML = message; confirmCallback = onConfirm; confirmBtn.className = 'btn'; confirmBtn.classList.add(buttonClass); confirmModal.classList.add('active'); }
            function hideConfirmModal() { confirmModal.classList.remove('active'); confirmCallback = null; }
            window.showSuccessMessage = function(message) { successMessageText.textContent = message; successMessage.classList.add('show'); setTimeout(() => { successMessage.classList.remove('show'); }, 3000); }
            window.showToast = function(message, type = 'info') { if (!showToasts && type !== 'error') { console.log("Toast suppressed:", message); return; } toastMessage.textContent = message; toastMessage.className = 'toast'; if (type === 'success') { toastMessage.classList.add('success'); } else if (type === 'error') { toastMessage.classList.add('error'); } toastMessage.classList.add('show'); setTimeout(() => { toastMessage.classList.remove('show'); }, 3000); }
            window.getCurrentDate = function() { const now = new Date(); return now.toISOString().split('T')[0]; };
            window.getCurrentDateTime = function() { const now = new Date(); return now.toISOString().replace('T', ' ').substring(0, 16); };
            window.getCssVar = function(varName) { return getComputedStyle(document.documentElement).getPropertyValue(varName).trim(); };

            // Define loadTeamMembers globally AFTER definition
             window.loadTeamMembers = loadTeamMembers;
             function loadTeamMembers(container = null) {
                 const targetListContainer = container ? container.querySelector('.team-list-display') : document.getElementById('teamList');
                 if (!targetListContainer) { console.warn("Team list container not found for", container ? "feature view" : "settings"); return; }
                 const isFeatureView = container !== null;
                 console.log(`Loading team members into ${isFeatureView ? 'feature view' : 'settings panel'}...`);
                 targetListContainer.innerHTML = '<p style="color: var(--gray);">Loading...</p>';
                 setTimeout(() => {
                     targetListContainer.innerHTML = ''; if (MOCK_USERS.length === 0) { targetListContainer.innerHTML = '<p style="color: var(--gray);">No team members found.</p>'; return; }
                     MOCK_USERS.sort((a, b) => a.name.localeCompare(b.name));
                     MOCK_USERS.forEach(member => {
                         const card = document.createElement('div'); card.classList.add(isFeatureView ? 'team-member-card' : 'team-member-card'); card.dataset.id = member.id; card.dataset.name = member.name; card.dataset.role = member.role; card.dataset.email = member.email;
                         const avatarStyle = member.avatar ? `background-image: url('${member.avatar}')` : ''; const avatarContent = member.avatar ? '' : member.initials;
                         if (isFeatureView) { // Grid Card for Feature View
                             card.innerHTML = ` <div class="member-info"> <h4 class="member-name">${member.name}</h4> <p class="member-email">${member.email}</p> <span class="member-role status-badge role-${member.role}">${formatRole(member.role)}</span> </div> `; // Added status-badge
                         } else { // List Item for Settings View
                             card.innerHTML = ` <div class="member-avatar" style="${avatarStyle}">${avatarContent}</div> <div class="member-details"> <div class="member-name">${member.name}</div> <div class="member-email">${member.email}</div> </div> <span class="member-role status-badge role-${member.role}">${formatRole(member.role)}</span> ${(currentUser.role === 'admin' && currentUser.id !== member.id) ? `<div class="member-actions"> <button class="btn btn-outline btn-sm edit-member" title="Edit Member"><i class="fas fa-pencil-alt"></i></button> <button class="btn btn-danger btn-sm remove-member" title="Remove Member"><i class="fas fa-trash-alt"></i></button> </div>` : '<div class="member-actions" style="width: 70px;">&nbsp;</div>'} `; // Added status-badge
                         } targetListContainer.appendChild(card);
                     });
                 }, 300);
             }

            // --- UI Updates ---
            function updateUserUI() {
                if (!currentUser) { console.warn("Current user not loaded yet for UI update."); return; } // Added check
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = currentUser.initials;
                if (currentUser.avatar) { document.getElementById('userAvatar').style.backgroundImage = `url(${currentUser.avatar})`; document.getElementById('userAvatar').textContent = ''; } else { document.getElementById('userAvatar').style.backgroundImage = 'none'; document.getElementById('userAvatar').textContent = currentUser.initials; }
                document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0];
                document.getElementById('userInfoName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('profileAvatar').textContent = currentUser.initials;
                if (currentUser.avatar) { document.getElementById('profileAvatar').style.backgroundImage = `url(${currentUser.avatar})`; document.getElementById('profileAvatar').textContent = ''; } else { document.getElementById('profileAvatar').style.backgroundImage = 'none'; document.getElementById('profileAvatar').textContent = currentUser.initials; }
                const roleTitle = document.getElementById('userInfoRoleTitle'); roleTitle.textContent = formatRole(currentUser.role); roleTitle.className = `user-info-title role-${currentUser.role}`;
                updateProfileForm();
                profileAvatarLarge.textContent = currentUser.initials;
                if (currentUser.avatar) { profileAvatarLarge.style.backgroundImage = `url(${currentUser.avatar})`; profileAvatarLarge.textContent = ''; } else { profileAvatarLarge.style.backgroundImage = 'none'; profileAvatarLarge.textContent = currentUser.initials; }
                if (accountEmailDisplay) accountEmailDisplay.value = currentUser.email;
                const teamSettingsTab = document.getElementById('teamSettingsTab'); const dangerZoneTab = document.getElementById('dangerZoneTab'); const deleteAllUsersSection = document.getElementById('deleteAllUsersSection');
                 if (currentUser.role === 'admin') { if (teamSettingsTab) teamSettingsTab.style.display = 'flex'; if (dangerZoneTab) dangerZoneTab.style.display = 'flex'; if (deleteAllUsersSection) deleteAllUsersSection.style.display = 'block'; } else { if (teamSettingsTab) teamSettingsTab.style.display = 'none'; if (dangerZoneTab) dangerZoneTab.style.display = 'none'; if (deleteAllUsersSection) deleteAllUsersSection.style.display = 'none'; if (currentFeature === 'settings' && (currentSettingsTab === 'team' || currentSettingsTab === 'danger')) { activateSettingsTab('preferences'); } }
                 update2FA_UI(); if(userPhoneNumberForSms) userPhoneNumberForSms.textContent = currentUser.phone || 'Not Available';
            }
            function updateProfileForm() { if (!currentUser) return; const nameParts = currentUser.name.split(' '); firstNameInput.value = nameParts[0] || ''; lastNameInput.value = nameParts.slice(1).join(' ') || ''; fullNameDisplay.value = currentUser.name; jobTitleInput.value = currentUser.title || ''; emailDisplay.value = currentUser.email || ''; phoneInput.value = currentUser.phone || ''; departmentInput.value = currentUser.department || ''; }
            function formatRole(role) { if (!role) return 'Member'; return role.charAt(0).toUpperCase() + role.slice(1); }

            // --- Preferences & Settings Logic ---
            function applyStoredPreferences() { const storedTheme = localStorage.getItem('theme') || 'system'; setTheme(storedTheme); const storedContrast = localStorage.getItem('highContrast') === 'true'; setContrast(storedContrast); if (highContrastToggle) highContrastToggle.checked = storedContrast; const storedLang = localStorage.getItem('language') || 'en'; if (languageSelect) languageSelect.value = storedLang; applyLanguage(storedLang); const storedRegion = localStorage.getItem('region') || 'utc'; if (regionSelect) regionSelect.value = storedRegion; const storedTimeFormat = localStorage.getItem('timeFormat') || '12h'; const storedDateFormat = localStorage.getItem('dateFormat') || 'MM/DD/YYYY'; if (timeFormatSelect) timeFormatSelect.value = storedTimeFormat; if (dateFormatSelect) dateFormatSelect.value = storedDateFormat; applyDateTimeFormat(storedTimeFormat, storedDateFormat); const storedToastPref = localStorage.getItem('showToasts'); showToasts = storedToastPref === null ? true : (storedToastPref === 'true'); if (toastToggle) toastToggle.checked = showToasts; const storedSoundPref = localStorage.getItem('playSounds'); playSounds = storedSoundPref === null ? true : (storedSoundPref === 'true'); if (soundToggle) soundToggle.checked = playSounds; }
            function setTheme(theme) { console.log("Setting theme:", theme); document.body.classList.remove('light-theme', 'dark-theme'); if (theme === 'system') { const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches; document.body.classList.add(prefersDark ? 'dark-theme' : 'light-theme'); console.log("System prefers dark:", prefersDark); } else { document.body.classList.add(`${theme}-theme`); } themeOptions.forEach(option => { option.classList.toggle('selected', option.dataset.theme === theme); }); localStorage.setItem('theme', theme); }
            function setContrast(enabled) { console.log("Setting high contrast:", enabled); document.body.classList.toggle('high-contrast', enabled); localStorage.setItem('highContrast', enabled); }
            function applyLanguage(lang) { console.log("Applying language:", lang); document.documentElement.lang = lang; if (lang === 'ar') { document.body.dir = 'rtl'; if (document.getElementById('welcomeName')) document.getElementById('welcomeName').textContent = "مستخدم"; if (document.querySelector('[data-feature="dashboard"] span')) document.querySelector('[data-feature="dashboard"] span').textContent = "لوحة التحكم"; if (document.querySelector('[data-feature="projects"] span')) document.querySelector('[data-feature="projects"] span').textContent = "المشاريع"; if (document.querySelector('[data-feature="team-members-view"] span')) document.querySelector('[data-feature="team-members-view"] span').textContent = "أعضاء الفريق"; if (document.querySelector('[data-feature="settings"] span')) document.querySelector('[data-feature="settings"] span').textContent = "الإعدادات"; if (document.querySelector('[data-feature="file-sharing"] span')) document.querySelector('[data-feature="file-sharing"] span').textContent = "مشاركة الملفات"; if (document.querySelector('[data-feature="project-tracking"] span')) document.querySelector('[data-feature="project-tracking"] span').textContent = "تتبع المشاريع"; if (document.querySelector('[data-feature="task-management"] span')) document.querySelector('[data-feature="task-management"] span').textContent = "إدارة المهام"; if (document.querySelector('[data-feature="employee-scheduling"] span')) document.querySelector('[data-feature="employee-scheduling"] span').textContent = "جدولة الموظفين"; if (document.querySelector('[data-feature="reports-analytics"] span')) document.querySelector('[data-feature="reports-analytics"] span').textContent = "التقارير والتحليلات"; if (document.querySelector('[data-feature="team-calendar"] span')) document.querySelector('[data-feature="team-calendar"] span').textContent = "تقويم الفريق"; if (document.querySelector('[data-feature="innovation-hub"] span')) document.querySelector('[data-feature="innovation-hub"] span').textContent = "مركز الابتكار"; if (document.querySelector('[data-feature="data-management"] span')) document.querySelector('[data-feature="data-management"] span').textContent = "إدارة البيانات"; if (document.querySelector('[data-feature="deadline-tracker"] span')) document.querySelector('[data-feature="deadline-tracker"] span').textContent = "متتبع المواعيد"; } else { document.body.dir = 'ltr'; if (document.getElementById('welcomeName') && currentUser) document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0]; if (document.querySelector('[data-feature="dashboard"] span')) document.querySelector('[data-feature="dashboard"] span').textContent = "Dashboard"; if (document.querySelector('[data-feature="projects"] span')) document.querySelector('[data-feature="projects"] span').textContent = "Projects"; if (document.querySelector('[data-feature="team-members-view"] span')) document.querySelector('[data-feature="team-members-view"] span').textContent = "Team Members"; if (document.querySelector('[data-feature="settings"] span')) document.querySelector('[data-feature="settings"] span').textContent = "Settings"; if (document.querySelector('[data-feature="file-sharing"] span')) document.querySelector('[data-feature="file-sharing"] span').textContent = "File Sharing"; if (document.querySelector('[data-feature="project-tracking"] span')) document.querySelector('[data-feature="project-tracking"] span').textContent = "Project Tracking"; if (document.querySelector('[data-feature="task-management"] span')) document.querySelector('[data-feature="task-management"] span').textContent = "Task Management"; if (document.querySelector('[data-feature="employee-scheduling"] span')) document.querySelector('[data-feature="employee-scheduling"] span').textContent = "Employee Scheduling"; if (document.querySelector('[data-feature="reports-analytics"] span')) document.querySelector('[data-feature="reports-analytics"] span').textContent = "Reports & Analytics"; if (document.querySelector('[data-feature="team-calendar"] span')) document.querySelector('[data-feature="team-calendar"] span').textContent = "Team Calendar"; if (document.querySelector('[data-feature="innovation-hub"] span')) document.querySelector('[data-feature="innovation-hub"] span').textContent = "Innovation Hub"; if (document.querySelector('[data-feature="data-management"] span')) document.querySelector('[data-feature="data-management"] span').textContent = "Data Management"; if (document.querySelector('[data-feature="deadline-tracker"] span')) document.querySelector('[data-feature="deadline-tracker"] span').textContent = "Deadline Tracker"; } localStorage.setItem('language', lang); }
            function applyDateTimeFormat(timeFormat, dateFormat) { console.log("Applying DateTime Format:", timeFormat, dateFormat); localStorage.setItem('timeFormat', timeFormat); localStorage.setItem('dateFormat', dateFormat); if (currentFeature === 'dashboard' && activityList.children.length > 0 && activities.length > 0) { loadRecentActivities(showingAllActivities); } if (currentFeature === 'dashboard' && notifications.length > 0) { renderNotifications(); } if (currentFeature === 'employee-scheduling') { const scheduleTableBody = document.getElementById('scheduleTableBody'); if (scheduleTableBody) { window.renderSchedule?.(currentScheduleWeekOffset); } } if (currentFeature === 'projects') { const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('projects-feature')) { window.renderProjects?.(container); } } if (currentFeature === 'task-management') { window.taskManagementInstance?.renderTasks(); } if (currentFeature === 'file-sharing') { window.fileSharingInstance?.updateRelativeTimes(); } if (currentFeature === 'project-tracking') { window.projectTrackingInstance?.renderTable(); window.projectTrackingInstance?.renderUpcomingDeadlines(window.projectTrackingInstance.filteredData); } if (currentFeature === 'data-management') { window.dataManagementInstance?.renderTable(); } if (currentFeature === 'deadline-tracker') { window.deadlineTrackerInstance?.renderTasks(); } if (currentFeature === 'innovation-hub') { window.innovationHubInstance?.renderSuggestions(); } if (currentFeature === 'team-calendar') { console.log("Calendar date/time format refresh needed - requires FullCalendar update or manual re-render"); } }
            function applyToastPreference(enabled) { console.log("Applying toast preference:", enabled); showToasts = enabled; localStorage.setItem('showToasts', enabled); }
            function applySoundPreference(enabled) { console.log("Applying sound preference:", enabled); playSounds = enabled; localStorage.setItem('playSounds', enabled); }

            // --- Navigation & Content Loading ---
            function setActiveFeature(featureId, settingsTab = null, skipHistory = false) {
                console.log(`Navigating to: ${featureId}` + (settingsTab ? ` / Tab: ${settingsTab}` : ''));
                 removeInjectedStyles(); if (typeof currentFeatureCleanup === 'function') { currentFeatureCleanup(); currentFeatureCleanup = null; }
                currentFeature = featureId;
                menuItems.forEach(item => { item.classList.toggle('active', item.getAttribute('data-feature') === featureId); });
                contentSections.forEach(section => section.classList.remove('active'));
                 featureSectionsContainer.className = 'content-section'; featureSectionsContainer.innerHTML = ''; featurePlaceholder.style.display = 'flex'; if(featureLoadingEl) featureLoadingEl.style.display = 'none'; if(featureErrorEl) featureErrorEl.style.display = 'none'; featureSectionsContainer.appendChild(featurePlaceholder);
                let targetSection = null; let isFeatureSection = false;
                if (featureId === 'dashboard') { targetSection = dashboardContent; backButton.style.display = 'none'; }
                else if (featureId === 'profile') { targetSection = profileContent; backButton.style.display = 'flex'; backButtonText.textContent = 'Back to Dashboard'; updateProfileForm(); }
                else if (featureId === 'settings') { targetSection = settingsContent; backButton.style.display = 'flex'; backButtonText.textContent = 'Back to Dashboard'; currentSettingsTab = settingsTab || (currentUser.role === 'admin' ? 'preferences' : 'preferences'); if (currentUser.role !== 'admin' && (currentSettingsTab === 'team' || currentSettingsTab === 'danger')) { currentSettingsTab = 'preferences'; } activateSettingsTab(currentSettingsTab); update2FA_UI(); }
                else { isFeatureSection = true; targetSection = featureSectionsContainer; backButton.style.display = 'flex'; backButtonText.textContent = 'Back to Dashboard'; loadFeatureContent(featureId); }
                if (targetSection) { targetSection.classList.add('active'); }
                if (!isFeatureSection) { featurePlaceholder.style.display = 'none'; }
                if (window.innerWidth <= 992 && sidebar.classList.contains('active')) { sidebar.classList.remove('active'); mainContent.classList.remove('sidebar-active'); if(closeSidebar) closeSidebar.style.display = 'none'; }
                userDropdown.classList.remove('active'); userDropdownOpen = false;
                if (!skipHistory) { updateBrowserHistory(featureId, featureId === 'settings' ? currentSettingsTab : null); }
                 window.scrollTo(0, 0);
            }
            function activateSettingsTab(tabId) { console.log(`Activating settings tab: ${tabId}`); currentSettingsTab = tabId; document.querySelectorAll('.settings-tab').forEach(tab => tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId)); document.querySelectorAll('.settings-panel').forEach(panel => panel.classList.toggle('active', panel.id === `${tabId}Panel`)); if (tabId === 'team' && currentUser.role === 'admin') { loadTeamMembers(); } if (tabId === 'security') { update2FA_UI(); } if (tabId === 'account' && accountEmailDisplay) { accountEmailDisplay.value = currentUser.email; } }
            function injectStyles(styleContent, styleId) { removeInjectedStyles(styleId); const styleTag = document.createElement('style'); styleTag.id = styleId; styleTag.textContent = styleContent; document.head.appendChild(styleTag); console.log(`Styles injected: ${styleId}`); }
            function removeInjectedStyles(styleIdPrefix = 'injected-') { const styles = document.querySelectorAll(`style[id^="${styleIdPrefix}"]`); styles.forEach(style => { style.remove(); console.log(`Styles removed: ${style.id}`); }); }
            function loadFeatureContent(featureId) {
                 const menuItem = Array.from(menuItems).find(item => item.getAttribute('data-feature') === featureId);
                 const featureName = menuItem ? menuItem.querySelector('span').textContent : 'Feature';
                 const templateIdMap = {
                     'task-management': 'taskManagementAssets',
                     'file-sharing': 'fileSharingAssets',
                     'project-tracking': 'projectTrackingAssets',
                     'reports-analytics': 'reportsAnalyticsAssets',
                     'team-members-view': 'teamMembersAssets',
                     'projects': 'projectsAssets',
                     'employee-scheduling': 'employeeSchedulingAssets',
                     'data-management': 'dataManagementAssets',
                     'deadline-tracker': 'deadlineTrackerAssets',
                     'innovation-hub': 'innovationHubAssets',
                     'team-calendar': 'teamCalendarAssets',
                 };
                 const templateId = templateIdMap[featureId] || 'placeholderAssets';

                 featurePlaceholder.style.display = 'none'; if(featureLoadingEl) featureLoadingEl.style.display = 'block'; if(featureErrorEl) featureErrorEl.style.display = 'none';
                 featureSectionsContainer.innerHTML = '';
                 featureSectionsContainer.className = `content-section active ${featureId}-feature`;
                 featureSectionsContainer.appendChild(featurePlaceholder);
                 featurePlaceholder.style.display = 'flex'; featureTitleEl.textContent = ''; featureDescEl.textContent = '';

                 console.log(`Loading content for: ${featureName} (${featureId}) from template: ${templateId}`);

                 setTimeout(() => {
                     try {
                         if(featureLoadingEl) featureLoadingEl.style.display = 'none';
                         featurePlaceholder.style.display = 'none';
                         featureSectionsContainer.innerHTML = '';

                         const template = document.getElementById(templateId);
                         if (!template) throw new Error(`Template #${templateId} not found for ${featureId}`);

                         if (templateId === 'placeholderAssets') {
                             const placeholderClone = template.content.cloneNode(true);
                             placeholderClone.querySelector('h2').textContent = featureName;
                             placeholderClone.querySelector('p').textContent = `Content for ${featureName} will be loaded here.`;
                             while (placeholderClone.firstChild) { featureSectionsContainer.appendChild(placeholderClone.firstChild); }
                             currentFeatureCleanup = () => { console.log(`Cleaning up placeholder for ${featureName}`); };
                             return;
                         }

                         const styleContent = template.content.querySelector('style');
                         if (styleContent) { injectStyles(styleContent.textContent, `injected-${featureId}-styles`); }
                         else { console.warn(`No styles found in template for ${featureId}`); }

                         const htmlContent = template.content.cloneNode(true);
                         htmlContent.querySelectorAll('style, script').forEach(el => el.remove());
                         while (htmlContent.firstChild) { featureSectionsContainer.appendChild(htmlContent.firstChild); }

                         const initFunctionNameMap = {
                             'task-management': 'initializeTaskManagementFeature',
                             'file-sharing': 'initializeFileSharingFeature',
                             'project-tracking': 'initializeProjectTrackingFeature',
                             'reports-analytics': 'initializeReportsAnalyticsFeature',
                             'team-members-view': 'initializeTeamMembersFeature',
                             'projects': 'initializeProjectsFeature',
                             'employee-scheduling': 'initializeEmployeeScheduleLogic',
                             'data-management': 'initializeDataManagementFeature',
                             'deadline-tracker': 'initializeDeadlineTrackerFeature',
                             'innovation-hub': 'initializeInnovationHubFeature',
                             'team-calendar': 'initializeTeamCalendarFeature',
                         };
                         const initFunctionName = initFunctionNameMap[featureId];

                         if (initFunctionName && typeof window[initFunctionName] === 'function') {
                             const result = window[initFunctionName](featureSectionsContainer);
                             currentFeatureCleanup = result?.cleanup;
                             console.log(`${featureName} JS initialized via function.`);
                             if (featureId === 'file-sharing') window.fileSharingInstance = result;
                             if (featureId === 'project-tracking') window.projectTrackingInstance = result;
                             if (featureId === 'task-management') window.taskManagementInstance = result;
                             if (featureId === 'data-management') window.dataManagementInstance = result;
                             if (featureId === 'deadline-tracker') window.deadlineTrackerInstance = result;
                             if (featureId === 'innovation-hub') window.innovationHubInstance = result;
                         } else if (initFunctionName) {
                              console.error(`Initialization function ${initFunctionName} not found in global scope.`);
                              throw new Error(`JS initialization failed for ${featureName}.`);
                         } else {
                             console.warn(`No specific JS init function mapped for ${featureId}.`);
                         }

                     } catch (error) {
                         console.error(`Error loading feature ${featureId}:`, error);
                         if(featureLoadingEl) featureLoadingEl.style.display = 'none';
                         featurePlaceholder.style.display = 'flex';
                         if(featureErrorEl) { featureErrorEl.textContent = `Failed to load ${featureName}. Error: ${error.message}`; featureErrorEl.style.display = 'block'; }
                         featureSectionsContainer.appendChild(featurePlaceholder);
                     }
                 }, 150);
             }
            function updateBrowserHistory(featureId, settingsTab = null) { let hash = `#${featureId}`; if (featureId === 'settings' && settingsTab) { hash += `-${settingsTab}`; } if (window.location.hash !== hash) { window.history.pushState({ feature: featureId, tab: settingsTab }, '', hash); } }
            function handleInitialNavigation() { const hash = window.location.hash.substring(1); console.log(`Handling navigation for hash: ${hash}`); let featureId = 'dashboard'; let settingsTab = null; if (hash) { if (hash.startsWith('settings-')) { const parts = hash.split('-'); featureId = parts[0]; settingsTab = parts[1]; } else { const knownFeature = Array.from(menuItems).some(item => item.getAttribute('data-feature') === hash); if (knownFeature) { featureId = hash; } } } setActiveFeature(featureId, settingsTab, true); }
            window.addEventListener('popstate', function(event) { console.log("Popstate event:", event.state, window.location.hash); handleInitialNavigation(); });

            // --- Data Loading & Simulation ---
            function loadInitialData() { loadDashboardStats(); loadRecentActivities(); loadNotifications(); loadMockProjects(); if (currentFeature === 'settings' && currentSettingsTab === 'team' && currentUser.role === 'admin') { loadTeamMembers(); } }
            function loadMockProjects() { MOCK_PROJECTS_DATA = [ { id: "alpha001", name: "Project Alpha", status: "in-progress", participants: "Alice B.|Bob K.|Charlie M.", img: "https://images.unsplash.com/photo-1517048676732-d65bc937f952?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 65, startDate: "2023-08-15", updatedDate: "2024-03-10", editable: true, description: "Revamp core platform infrastructure." }, { id: "web002", name: "Website Redesign", status: "completed", participants: "David L.|Eva G.", img: "https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 100, startDate: "2023-05-01", updatedDate: "2024-01-20", editable: false, description: "Complete overhaul of public website." }, { id: "mobile003", name: "Mobile App V2", status: "active", participants: "Frank H.|Grace P.|Heidi R.|Ian S.", img: "https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 20, startDate: "2024-02-20", updatedDate: "2024-03-05", editable: true, description: "Develop version 2 with new features." }, { id: "mktg004", name: "Q4 Marketing Plan", status: "pending", participants: "Marketing Team", img: "https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 0, startDate: "2024-09-01", updatedDate: "2024-03-12", editable: true, description: "Strategy for Q4 campaigns." }, { id: "infra005", name: "Server Migration", status: "in-progress", participants: "Admin Team|Mohamed Elmenisy", img: "https://images.unsplash.com/photo-1580894742597-87bc8789db3d?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 85, startDate: "2024-01-10", updatedDate: "2024-03-15", editable: true, description: "Migrate servers to new cloud provider." } ]; console.log("Mock projects loaded into MOCK_PROJECTS_DATA"); }
            function loadDashboardStats() { console.log("Loading dashboard stats..."); setTimeout(() => { const teamMembersCount = MOCK_USERS.length; const tasksCompleted = MOCK_TASKS.filter(t => t.status === 'Completed').length + Math.floor(Math.random() * 50); const activeProjects = MOCK_PROJECTS_DATA.filter(p => p.status === 'active' || p.status === 'in-progress').length; const upcomingDeadlines = MOCK_TASKS.filter(t => t.dueDate && new Date(t.dueDate) > new Date() && new Date(t.dueDate) < new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)).length; updateStatCard('teamMembersCount', 'Team Members', 'fas fa-users', teamMembersCount, Math.random() * 10 - 5); updateStatCard('tasksCompleted', 'Tasks Completed', 'fas fa-check-circle', tasksCompleted, Math.random() * 20); updateStatCard('activeProjects', 'Active Projects', 'fas fa-project-diagram', activeProjects, Math.random() * 5 - 2); updateStatCard('upcomingDeadlines', 'Upcoming Deadlines', 'fas fa-calendar-times', upcomingDeadlines, Math.random() * 15 - 10); }, 300); }
            function updateStatCard(id, title, iconClass, value, trendPercent) { const cardIndex = ['teamMembersCount', 'tasksCompleted', 'activeProjects', 'upcomingDeadlines'].indexOf(id); if (cardIndex === -1 || !statsSection || !statsSection.children[cardIndex]) return; const card = statsSection.children[cardIndex]; let trendClass = 'trend-neutral'; let trendIcon = 'fas fa-minus'; if (trendPercent > 1) { trendClass = 'trend-up'; trendIcon = 'fas fa-arrow-up'; } else if (trendPercent < -1) { trendClass = 'trend-down'; trendIcon = 'fas fa-arrow-down'; } card.innerHTML = ` <div class="stat-title"><i class="${iconClass}"></i>${title}</div> <div class="stat-value"> <span>${value}</span> <span class="stat-trend ${trendClass}"> <i class="${trendIcon}"></i> ${trendPercent !== 0 ? Math.abs(trendPercent).toFixed(0) + '%' : ''} </span> </div>`; }
            function loadRecentActivities(showAll = false) { console.log("Loading recent activities..."); if (activities.length === 0 || !showingAllActivities) { const now = Date.now(); activities = generateMockActivities(15, now); } showingAllActivities = showAll; const activitiesToDisplay = showAll ? activities : activities.slice(0, maxActivitiesToShow); activityList.innerHTML = ''; if (activitiesToDisplay.length === 0) { activityList.innerHTML = '<li style="text-align: center; padding: 2rem; color: var(--gray);">No recent activity.</li>'; deleteAllActivity.style.display = 'none'; viewAllActivity.style.display = 'none'; return; } activitiesToDisplay.sort((a, b) => b.timestamp - a.timestamp); activitiesToDisplay.forEach((activity, index) => { const li = document.createElement('li'); li.classList.add('activity-item'); li.dataset.id = activity.id; if (activity.isNew) { li.classList.add('new-activity'); setTimeout(() => { activity.isNew = false; const currentLi = activityList.querySelector(`[data-id='${activity.id}']`); if (currentLi) currentLi.classList.remove('new-activity'); }, 2500); } li.innerHTML = ` <div class="activity-icon"><i class="fas ${activity.icon}"></i></div> <div class="activity-content"> <div class="activity-message">${activity.message}</div> <div class="activity-time" title="${formatFullDateTime(activity.timestamp)}">${timeAgo(activity.timestamp)}</div> </div> <div class="activity-actions"> <i class="fas fa-trash-alt delete-activity" title="Delete Activity"></i> </div>`; activityList.appendChild(li); }); deleteAllActivity.style.display = activities.length > 0 ? 'inline-block' : 'none'; viewAllActivity.textContent = showAll ? 'Show Less' : 'Show All'; viewAllActivity.style.display = activities.length > maxActivitiesToShow ? 'inline-block' : 'none'; }
            function loadNotifications() { console.log("Loading notifications..."); if (notifications.length === 0) { const now = Date.now(); notifications = generateMockNotifications(8, now); } renderNotifications(); }
            function renderNotifications() { notificationsBody.innerHTML = ''; const unreadCount = notifications.filter(n => n.unread).length; if (notifications.length === 0) { noNotificationsMessage.textContent = 'You have no notifications.'; noNotificationsMessage.style.display = 'block'; notificationBadge.style.display = 'none'; notificationBadge.textContent = '0'; markAllReadBtn.disabled = true; deleteAllNotificationsBtn.disabled = true; return; } noNotificationsMessage.style.display = 'none'; markAllReadBtn.disabled = unreadCount === 0; deleteAllNotificationsBtn.disabled = false; notifications.sort((a, b) => b.timestamp - a.timestamp); notifications.forEach(notification => { const div = document.createElement('div'); div.classList.add('notification-list-item'); div.dataset.id = notification.id; if (notification.unread) { div.classList.add('unread'); } div.innerHTML = ` <div class="notification-icon-wrapper"><i class="fas ${notification.icon}"></i></div> <div class="notification-content"> <div class="notification-message">${notification.message}</div> <div class="notification-time" title="${formatFullDateTime(notification.timestamp)}">${timeAgo(notification.timestamp)}</div> </div> <i class="fas fa-times delete-notification" title="Delete Notification"></i>`; notificationsBody.appendChild(div); }); notificationBadge.textContent = unreadCount; notificationBadge.style.display = unreadCount > 0 ? 'flex' : 'none'; }

            // --- Dynamic Updates Simulation ---
            function startDynamicUpdates() { if (activityIntervalId) clearInterval(activityIntervalId); activityIntervalId = setInterval(() => { const newActivity = generateMockActivities(1, Date.now())[0]; newActivity.isNew = true; activities.unshift(newActivity); if (activities.length > 50) activities.pop(); activities.sort((a, b) => b.timestamp - a.timestamp); if (currentFeature === 'dashboard') { loadRecentActivities(showingAllActivities); } showToast(`New Activity: ${newActivity.message.substring(0, 30)}...`); }, Math.random() * 10000 + 10000); if (notificationIntervalId) clearInterval(notificationIntervalId); notificationIntervalId = setInterval(() => { const newNotification = generateMockNotifications(1, Date.now())[0]; newNotification.unread = true; notifications.unshift(newNotification); if (notifications.length > 30) notifications.pop(); renderNotifications(); playNotificationSound(); }, Math.random() * 20000 + 20000); if (statsIntervalId) clearInterval(statsIntervalId); statsIntervalId = setInterval(loadDashboardStats, 30000); if (welcomeBgIntervalId) clearInterval(welcomeBgIntervalId); welcomeBgIntervalId = setInterval(changeWelcomeBackground, 15000); }
            function changeWelcomeBackground() { const backgrounds = ['--welcome-bg-1', '--welcome-bg-2', '--welcome-bg-3']; const currentBgVar = getComputedStyle(document.documentElement).getPropertyValue('--welcome-bg-current').trim(); let currentIndex = backgrounds.indexOf(currentBgVar); if (currentIndex === -1) currentIndex = 0; const nextIndex = (currentIndex + 1) % backgrounds.length; document.documentElement.style.setProperty('--welcome-bg-current', `var(${backgrounds[nextIndex]})`); }

            // --- Event Listeners ---
            function setupEventListeners() {
                 if (sidebarToggle) { sidebarToggle.addEventListener('click', () => { sidebar.classList.add('active'); mainContent.classList.add('sidebar-active'); if(closeSidebar) closeSidebar.style.display = 'block'; }); }
                 if (closeSidebar) { closeSidebar.addEventListener('click', () => { sidebar.classList.remove('active'); mainContent.classList.remove('sidebar-active'); closeSidebar.style.display = 'none'; }); }
                 document.addEventListener('click', (event) => { if (window.innerWidth <= 992 && sidebar.classList.contains('active')) { const isClickInsideSidebar = sidebar.contains(event.target); const isClickOnToggler = sidebarToggle && sidebarToggle.contains(event.target); if (!isClickInsideSidebar && !isClickOnToggler) { sidebar.classList.remove('active'); mainContent.classList.remove('sidebar-active'); if(closeSidebar) closeSidebar.style.display = 'none'; } } });
                menuItems.forEach(item => item.addEventListener('click', function(e) { e.preventDefault(); const featureId = this.getAttribute('data-feature'); setActiveFeature(featureId); }));
                document.body.addEventListener('click', function(e) { const target = e.target; if (target.closest('.settings-tab') && !target.closest('.settings-tab.active')) { const tabId = target.closest('.settings-tab').getAttribute('data-tab'); activateSettingsTab(tabId); updateBrowserHistory('settings', tabId); } else if (target.closest('.settings-link') && target.closest('.settings-link').dataset.tabTarget) { e.preventDefault(); const tabId = target.closest('.settings-link').dataset.tabTarget; setActiveFeature('settings', tabId); } });
                backButton.addEventListener('click', function() { setActiveFeature('dashboard'); });
                userProfileContainer.addEventListener('click', function(e) { if (e.target.closest('.dropdown-item')) { const feature = e.target.closest('.dropdown-item').getAttribute('data-feature'); if (feature) { setActiveFeature(feature); } return; } userDropdownOpen = !userDropdownOpen; userDropdown.classList.toggle('active', userDropdownOpen); });
                 document.addEventListener('click', function(event) { if (!userProfileContainer.contains(event.target) && userDropdownOpen) { userDropdown.classList.remove('active'); userDropdownOpen = false; } });
                searchInput.addEventListener('input', handleSearch); searchInput.addEventListener('focus', handleSearch);
                 document.addEventListener('click', (event) => { if (!searchInput.contains(event.target) && !searchResultsContainer.contains(event.target)) { searchResultsContainer.classList.remove('active'); } });
                 searchResultsContainer.addEventListener('click', (event) => { const targetItem = event.target.closest('.search-result-item'); if (targetItem && targetItem.dataset.feature) { const featureId = targetItem.dataset.feature; const itemId = targetItem.dataset.id; console.log(`Search result: Feature=${featureId}, ID=${itemId}`); setActiveFeature(featureId); searchResultsContainer.classList.remove('active'); searchInput.value = ''; } });
                notificationIcon.addEventListener('click', () => { notificationsModal.classList.add('active'); });
                closeNotifications.addEventListener('click', () => { notificationsModal.classList.remove('active'); });
                 notificationsModal.addEventListener('click', (event) => { if (event.target === notificationsModal) { notificationsModal.classList.remove('active'); } });
                 notificationsBody.addEventListener('click', (event) => { const target = event.target; const notificationItem = target.closest('.notification-list-item'); const notificationId = notificationItem ? parseInt(notificationItem.dataset.id) : null; if (target.classList.contains('delete-notification') && notificationId) { showConfirmModal('Delete Notification', 'Are you sure?', () => { notifications = notifications.filter(n => n.id !== notificationId); renderNotifications(); showToast('Notification deleted.', 'success'); }); } else if (notificationItem && notificationId) { const notification = notifications.find(n => n.id === notificationId); if (notification && notification.unread) { notification.unread = false; renderNotifications(); } console.log(`Clicked notification ${notificationId}`); } });
                 markAllReadBtn.addEventListener('click', markAllNotificationsAsRead);
                 deleteAllNotificationsBtn.addEventListener('click', () => { if (notifications.length === 0) return; showConfirmModal('Delete All Notifications', 'Are you sure?', () => { notifications = []; renderNotifications(); showToast('All notifications deleted.', 'success'); }); });
                 activityList.addEventListener('click', (event) => { const target = event.target; if (target.classList.contains('delete-activity')) { const activityItem = target.closest('.activity-item'); const activityId = activityItem ? parseInt(activityItem.dataset.id) : null; if (activityId) { activities = activities.filter(a => a.id !== activityId); loadRecentActivities(showingAllActivities); showToast('Activity deleted.'); } } });
                viewAllActivity.addEventListener('click', () => { loadRecentActivities(!showingAllActivities); });
                deleteAllActivity.addEventListener('click', () => { if (activities.length === 0) return; showConfirmModal('Delete All Activities', 'Are you sure?', () => { activities = []; loadRecentActivities(false); showToast('All activities deleted.'); }); });
                profileAvatarLarge.addEventListener('click', () => { profileAvatarInput.click(); });
                 profileAvatarInput.addEventListener('change', handleAvatarUpload);
                 profileForm.addEventListener('submit', handleProfileSave);
                 cancelProfileBtn.addEventListener('click', handleProfileCancel);
                 firstNameInput.addEventListener('input', updateFullNameDisplay);
                 lastNameInput.addEventListener('input', updateFullNameDisplay);
                 logoutLink.addEventListener('click', handleLogout);
                 // Team Management Actions (Settings Panel)
                 const teamListContainer = document.getElementById('teamList');
                 if (teamListContainer) { teamListContainer.addEventListener('click', (event) => { const target = event.target; const memberCard = target.closest('.team-member-card'); const memberId = memberCard ? parseInt(memberCard.dataset.id) : null; if (!memberId || memberId === currentUser.id || currentUser.role !== 'admin') return; if (target.closest('.edit-member')) { openMemberModal(memberId); } else if (target.closest('.remove-member')) { handleRemoveMember(memberId); } }); }
                 else { console.warn("Settings team list container not found."); }
                 // Member Modal Form Listener
                 if (memberForm) { memberForm.addEventListener('submit', handleSaveMember); }
                 // Generic Modal Close Listeners (for Member Modal etc.)
                 document.querySelectorAll('.modal').forEach(modal => { modal.querySelectorAll('[data-close-modal]').forEach(btn => { btn.addEventListener('click', () => modal.classList.remove('active')); }); modal.addEventListener('click', (event) => { if (event.target === modal) { modal.classList.remove('active'); } }); });
                 // Invite Member Form Listener
                 const inviteMemberForm = document.getElementById('inviteMemberForm');
                 if (inviteMemberForm) { inviteMemberForm.addEventListener('submit', handleInviteMember); }
                 // Admin Action: Delete All Non-Admin Users
                 const deleteAllNonAdminUsersBtn = document.getElementById('deleteAllNonAdminUsersBtn');
                 if (deleteAllNonAdminUsersBtn) { deleteAllNonAdminUsersBtn.addEventListener('click', handleDeleteAllNonAdminUsers); }
                 // Project Modal Listeners
                 if (projectForm) { projectForm.addEventListener('submit', handleSaveProject); }

                 // Settings Controls Listeners
                 themeOptions.forEach(option => { option.addEventListener('click', () => setTheme(option.dataset.theme)); });
                 if (highContrastToggle) { highContrastToggle.addEventListener('change', (e) => setContrast(e.target.checked)); }
                 if (languageSelect) { languageSelect.addEventListener('change', (e) => applyLanguage(e.target.value)); }
                 if (regionSelect) { regionSelect.addEventListener('change', (e) => localStorage.setItem('region', e.target.value)); }
                 if (timeFormatSelect || dateFormatSelect) { const applyDateTimeListener = () => { applyDateTimeFormat(timeFormatSelect.value, dateFormatSelect.value); }; if (timeFormatSelect) timeFormatSelect.addEventListener('change', applyDateTimeListener); if (dateFormatSelect) dateFormatSelect.addEventListener('change', applyDateTimeListener); }
                 if (toastToggle) { toastToggle.addEventListener('change', (e) => applyToastPreference(e.target.checked)); }
                 if (soundToggle) { soundToggle.addEventListener('change', (e) => applySoundPreference(e.target.checked)); }
                if(savePreferencesBtn) savePreferencesBtn.addEventListener('click', handleSavePreferences);
                if(changePasswordForm) changePasswordForm.addEventListener('submit', handleChangePassword);
                if(saveAccountSettingsBtn) saveAccountSettingsBtn.addEventListener('click', handleSaveAccountSettings);
                if(saveSessionSettingsBtn) saveSessionSettingsBtn.addEventListener('click', handleSaveSessionSettings);
                if(saveNotificationSettingsBtn) saveNotificationSettingsBtn.addEventListener('click', handleSaveNotificationSettings);
                 if (enable2faBtn) enable2faBtn.addEventListener('click', handleEnable2FA);
                 if (setupAuthAppBtn) setupAuthAppBtn.addEventListener('click', showAuthAppSetup);
                 if (setupSmsBtn) setupSmsBtn.addEventListener('click', showSmsSetup);
                 if (verifyAuthCodeBtn) verifyAuthCodeBtn.addEventListener('click', handleVerifyAuthCode);
                 if (sendSmsCodeBtn) sendSmsCodeBtn.addEventListener('click', handleSendSmsCode);
                 if (verifySmsCodeBtn) verifySmsCodeBtn.addEventListener('click', handleVerifySmsCode);
                 if (disable2faBtn) disable2faBtn.addEventListener('click', handleDisable2FA);
                 if(logoutAllDevicesBtn) logoutAllDevicesBtn.addEventListener('click', handleLogoutAllDevices);
                 if(deleteAccountBtn) deleteAccountBtn.addEventListener('click', handleDeleteAccount);
                 if(cancelConfirmBtn) cancelConfirmBtn.addEventListener('click', hideConfirmModal);
                 if(confirmBtn) confirmBtn.addEventListener('click', () => { if (confirmCallback) { confirmCallback(); } hideConfirmModal(); });
            }

            // --- Specific Feature Logic ---
            function setupResponsiveSidebar() { /* Handled in setupEventListeners */ }
            // --- Search Logic ---
            function handleSearch() { const searchTerm = searchInput.value.trim().toLowerCase(); searchResultsContainer.innerHTML = ''; if (searchTerm.length < 2) { searchResultsContainer.classList.remove('active'); return; } console.log(`Searching for: ${searchTerm}`); const results = []; MOCK_USERS.forEach(user => { if (user.name.toLowerCase().includes(searchTerm) || user.email.toLowerCase().includes(searchTerm)) { results.push({ type: 'User', id: user.id, name: user.name, description: user.email, icon: 'fa-user', feature: 'team-members-view' }); } }); MOCK_PROJECTS_DATA.forEach(project => { if (project.name.toLowerCase().includes(searchTerm)) { results.push({ type: 'Project', id: project.id, name: project.name, description: `Status: ${project.status}`, icon: 'fa-briefcase', feature: 'projects' }); } }); MOCK_TASKS.forEach(task => { if (task.name.toLowerCase().includes(searchTerm)) { const projectName = MOCK_PROJECTS.find(p => p.id === task.project)?.name || 'Unknown Project'; results.push({ type: 'Task', id: task.id, name: task.name, description: `Project: ${projectName} | Status: ${task.status}`, icon: 'fa-tasks', feature: 'task-management' }); } }); menuItems.forEach(item => { const featureName = item.querySelector('span')?.textContent; const featureId = item.getAttribute('data-feature'); if (featureName && featureId && featureName.toLowerCase().includes(searchTerm)) { if (!results.some(r => r.feature === featureId && r.type !== 'User' && r.type !== 'Project' && r.type !== 'Task')) { results.push({ type: 'Feature', id: null, name: featureName, description: 'Navigate to section', icon: item.querySelector('i')?.className.split(' ')[1] || 'fa-compass', feature: featureId }); } } }); if (results.length > 0) { results.slice(0, 10).forEach(result => { const item = document.createElement('div'); item.classList.add('search-result-item'); item.dataset.feature = result.feature; if (result.id) item.dataset.id = result.id; item.innerHTML = `<i class="fas ${result.icon}"></i> <div> <strong>${result.name}</strong> <small>(${result.type})</small><br> <span style="font-size: 0.8em; color: var(--gray);">${result.description}</span> </div>`; searchResultsContainer.appendChild(item); }); searchResultsContainer.classList.add('active'); } else { searchResultsContainer.innerHTML = '<div class="search-result-item" style="text-align: center; color: var(--gray); cursor: default;">No results found.</div>'; searchResultsContainer.classList.add('active'); } }
            // --- Profile Logic ---
            function handleAvatarUpload(event) { const file = event.target.files[0]; if (file && file.type.startsWith('image/')) { const reader = new FileReader(); reader.onload = (e) => { const imageUrl = e.target.result; profileAvatarLarge.style.backgroundImage = `url(${imageUrl})`; profileAvatarLarge.textContent = ''; document.getElementById('userAvatar').style.backgroundImage = `url(${imageUrl})`; document.getElementById('userAvatar').textContent = ''; document.getElementById('profileAvatar').style.backgroundImage = `url(${imageUrl})`; document.getElementById('profileAvatar').textContent = ''; currentUser.avatar = imageUrl; showToast('Avatar preview updated. Save changes to persist.'); }; reader.readAsDataURL(file); } else if (file) { showToast('Please select a valid image file.', 'error'); } }
            function updateFullNameDisplay() { if(firstNameInput && lastNameInput && fullNameDisplay) fullNameDisplay.value = `${firstNameInput.value.trim()} ${lastNameInput.value.trim()}`.trim(); }
            function handleProfileSave(event) { event.preventDefault(); console.log("Saving profile..."); showConfirmModal( 'Save Profile Changes', 'Are you sure?', () => { console.log("Profile save confirmed."); const saveButtonText = saveProfileBtn.querySelector('.btn-text'); const spinner = saveProfileBtn.querySelector('.spinner'); saveProfileBtn.disabled = true; if (saveButtonText) saveButtonText.style.display = 'none'; if (spinner) spinner.style.display = 'inline-block'; setTimeout(() => { currentUser.name = fullNameDisplay.value; currentUser.title = jobTitleInput.value; currentUser.phone = phoneInput.value; currentUser.department = departmentInput.value; if (!currentUser.avatar) { const nameParts = currentUser.name.split(' '); currentUser.initials = (nameParts[0]?.[0] || '') + (nameParts[1]?.[0] || ''); } if(userPhoneNumberForSms) userPhoneNumberForSms.textContent = currentUser.phone || 'Not Available'; updateUserUI(); saveProfileBtn.disabled = false; if (saveButtonText) saveButtonText.style.display = 'inline'; if (spinner) spinner.style.display = 'none'; showSuccessMessage('Profile updated successfully!'); }, 1000); }, 'btn-primary' ); }
            function handleProfileCancel() { showConfirmModal( 'Cancel Changes', 'Discard changes?', () => { updateProfileForm(); showToast('Changes discarded.'); }, 'btn-warning' ); }
            // --- Settings Save Logic ---
            function handleSavePreferences() { showConfirmModal('Save Preferences', 'Save Appearance/Localization?', () => { console.log("Saving Preferences..."); showToast('Preferences saved (simulated).', 'success'); }, 'btn-primary'); }
            function handleSaveAccountSettings() { showConfirmModal('Save Account Settings', 'Save notification settings?', () => { console.log("Saving Account Settings..."); const enableNotifications = document.getElementById('accountNotificationsToggle').checked; console.log("Account Notifications Enabled:", enableNotifications); showToast('Account settings saved (simulated).', 'success'); }, 'btn-primary'); }
            function handleChangePassword(event) { event.preventDefault(); showConfirmModal('Change Password', 'Are you sure you want to attempt to change your password?', () => { console.log("Changing password..."); const currentPass = document.getElementById('currentPassword').value; const newPass = document.getElementById('newPassword').value; const confirmPass = document.getElementById('confirmPassword').value; if (!currentPass || !newPass || !confirmPass) { showToast('Please fill in all password fields.', 'error'); return; } if (newPass !== confirmPass) { showToast('New passwords do not match.', 'error'); return; } if (newPass.length < 8) { showToast('New password must be at least 8 characters.', 'error'); return; } showToast('Attempting password change...', 'info'); setTimeout(() => { const success = Math.random() > 0.2; if (success) { showSuccessMessage('Password changed successfully!'); document.getElementById('currentPassword').value = ''; document.getElementById('newPassword').value = ''; document.getElementById('confirmPassword').value = ''; } else { showToast('Password change failed. Incorrect current password?', 'error'); } }, 1500); }, 'btn-danger'); }
            function handleSaveSessionSettings() { showConfirmModal('Save Session Settings', 'Save session duration and idle timeout?', () => { console.log("Saving Session Settings..."); const sessionDuration = document.getElementById('sessionDuration').value; const idleTimeout = document.getElementById('idleTimeout').value; console.log("Session Duration:", sessionDuration, "Idle Timeout:", idleTimeout); showToast('Session settings saved (simulated).', 'success'); }, 'btn-primary'); }
            function handleSaveNotificationSettings() { showConfirmModal('Save Notification Settings', 'Save notification delivery/types?', () => { console.log("Saving Notification Settings..."); const emailEnabled = document.getElementById('emailNotificationsToggle').checked; const inAppEnabled = document.getElementById('inAppNotificationsToggle').checked; const pushEnabled = document.getElementById('pushNotificationsToggle').checked; const selectedTypes = Array.from(document.querySelectorAll('input[name="notificationType"]:checked')).map(cb => cb.value); console.log("Email:", emailEnabled, "InApp:", inAppEnabled, "Types:", selectedTypes); showToast('Notification settings saved (simulated).', 'success'); }, 'btn-primary'); }
            // --- 2FA Logic (Simulation) ---
            function update2FA_UI() { if (!currentUser || !twoFaStatusIndicator || !twoFaStatusText || !twoFaSetupSection || !twoFaManagementSection) return; const isEnabled = currentUser.twoFaEnabled; twoFaStatusIndicator.style.backgroundColor = isEnabled ? 'var(--success)' : 'var(--gray)'; twoFaStatusText.textContent = `2FA is currently ${isEnabled ? 'Enabled' : 'Disabled'}`; twoFaSetupSection.style.display = isEnabled ? 'none' : 'block'; twoFaManagementSection.style.display = isEnabled ? 'block' : 'none'; if (twoFaSetupOptions) twoFaSetupOptions.style.display = 'none'; if (authAppSetup) authAppSetup.style.display = 'none'; if (smsSetup) smsSetup.style.display = 'none'; }
            function handleEnable2FA() { if(twoFaSetupOptions) twoFaSetupOptions.style.display = 'block'; if(enable2faBtn) enable2faBtn.style.display = 'none'; }
            function showAuthAppSetup() { if(authAppSetup) authAppSetup.style.display = 'block'; if(smsSetup) smsSetup.style.display = 'none'; }
            function showSmsSetup() { if(authAppSetup) authAppSetup.style.display = 'none'; if(smsSetup) smsSetup.style.display = 'block'; if(smsCodeInputGroup) smsCodeInputGroup.style.display = 'none'; if(verifySmsCodeBtn) verifySmsCodeBtn.style.display = 'none'; }
            function handleVerifyAuthCode() { const authCodeInput = document.getElementById('authCode'); if (!authCodeInput) return; const code = authCodeInput.value; if (code && code.length === 6 && /^\d+$/.test(code)) { showToast('Verifying code...', 'info'); setTimeout(() => { currentUser.twoFaEnabled = true; update2FA_UI(); showToast('2FA enabled via Authenticator App!', 'success'); }, 1000); } else { showToast('Invalid code. Please enter 6 digits.', 'error'); } }
            function handleSendSmsCode() { showToast('Sending SMS code...', 'info'); setTimeout(() => { showToast('SMS code sent (simulated).', 'success'); if(smsCodeInputGroup) smsCodeInputGroup.style.display = 'block'; if(verifySmsCodeBtn) verifySmsCodeBtn.style.display = 'inline-flex'; }, 1500); }
            function handleVerifySmsCode() { const smsCodeInput = document.getElementById('smsCode'); if (!smsCodeInput) return; const code = smsCodeInput.value; if (code && code.length === 6 && /^\d+$/.test(code)) { showToast('Verifying SMS code...', 'info'); setTimeout(() => { currentUser.twoFaEnabled = true; update2FA_UI(); showToast('2FA enabled via SMS!', 'success'); }, 1000); } else { showToast('Invalid SMS code. Please enter 6 digits.', 'error'); } }
            function handleDisable2FA() { showConfirmModal('Disable 2FA', 'Are you sure? This reduces security.', () => { currentUser.twoFaEnabled = false; update2FA_UI(); if(enable2faBtn) enable2faBtn.style.display = 'inline-flex'; showToast('2FA disabled.'); }, 'btn-danger'); }
            // --- Danger Zone Logic ---
            function handleLogoutAllDevices() { showConfirmModal('Logout From All Devices', 'End all other sessions?', () => { showToast('Logging out from other devices...', 'info'); setTimeout(() => { showSuccessMessage('Logged out from other devices.'); }, 1500); }, 'btn-warning'); }
            function handleDeleteAccount() { showConfirmModal('Delete Account', 'IRREVERSIBLE! Delete all data?', () => { showConfirmModal('Final Confirmation', 'Are you absolutely sure?', () => { console.warn("Account Deletion Confirmed (Simulated)"); showToast('Deleting account...', 'error'); setTimeout(() => { alert("Account Deleted (Simulated). Redirecting..."); handleLogout(new Event('click')); }, 2000); }, 'btn-danger'); }, 'btn-danger'); }
            // --- Notification Logic ---
            function markAllNotificationsAsRead() { if (notifications.some(n => n.unread)) { notifications.forEach(n => n.unread = false); renderNotifications(); showToast('All notifications marked as read.'); } }
            function playNotificationSound() { if (!playSounds) return; const audioEl = document.getElementById('notificationSound'); if(audioEl) { try { if (audioEl.paused) { audioEl.play().catch(e => console.warn("Audio play failed:", e)); } } catch(e) { console.warn("Audio error:", e); } } else { console.warn("Notification sound element not found.")} }
            // --- Logout Logic ---
            function handleLogout(event) { event.preventDefault(); showConfirmModal( 'Confirm Logout', 'Are you sure?', () => { console.log("Logging out..."); clearInterval(activityIntervalId); clearInterval(notificationIntervalId); clearInterval(statsIntervalId); clearInterval(welcomeBgIntervalId); showSuccessMessage('Logout successful! Redirecting...'); setTimeout(() => { window.location.href = 'login.html'; }, 1500); }, 'btn-danger' ); }

            // --- Team Management Logic ---
            function handleInviteMember(event) { event.preventDefault(); const emailInput = document.getElementById('inviteEmail'); const roleInput = document.getElementById('inviteRole'); const email = emailInput ? emailInput.value : null; const role = roleInput ? roleInput.value : null; const inviteButton = event.target.querySelector('button[type="submit"]'); if (!email || !role || !/\S+@\S+\.\S+/.test(email)) { showToast('Please provide a valid email and role.', 'error'); return; } if (MOCK_USERS.some(user => user.email.toLowerCase() === email.toLowerCase())) { showToast('A user with this email already exists.', 'error'); return; } console.log(`Inviting ${email} as ${role}`); if (inviteButton) { inviteButton.disabled = true; inviteButton.innerHTML = '<span class="spinner"></span> Sending...'; } setTimeout(() => { const newId = MOCK_USERS.length > 0 ? Math.max(...MOCK_USERS.map(u => u.id)) + 1 : 1; const nameParts = email.split('@')[0].split('.').map(part => part.charAt(0).toUpperCase() + part.slice(1)); const newUser = { id: newId, name: nameParts.join(' ') || 'New User', email: email, title: formatRole(role), department: 'Pending', phone: '', avatar: '', initials: (nameParts[0]?.[0] || 'N') + (nameParts[1]?.[0] || 'U'), role: role, twoFaEnabled: false }; MOCK_USERS.push(newUser); loadTeamMembers(); loadDashboardStats(); if(currentFeature === 'team-members-view') { const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('team-members-view-feature')) { loadTeamMembers(container); } } showToast(`Invitation sent to ${email}.`, 'success'); if (inviteButton) { inviteButton.disabled = false; inviteButton.innerHTML = 'Invite'; } if (emailInput) emailInput.value = ''; if (roleInput) roleInput.value = 'member'; }, 1000); }
            function openMemberModal(memberId = null) { const isEditing = memberId !== null; const member = isEditing ? MOCK_USERS.find(u => u.id === memberId) : null; if (isEditing && !member) { showToast("Error: Member not found.", "error"); return; } memberForm.reset(); document.getElementById('memberId').value = isEditing ? member.id : ''; document.getElementById('memberEmail').readOnly = isEditing; if (isEditing) { const nameParts = member.name.split(' '); document.getElementById('memberFirstName').value = nameParts[0] || ''; document.getElementById('memberLastName').value = nameParts.slice(1).join(' ') || ''; document.getElementById('memberEmail').value = member.email; document.getElementById('memberRole').value = member.role; document.getElementById('memberTitle').value = member.title || ''; document.getElementById('memberDepartment').value = member.department || ''; memberModalTitle.textContent = `Edit ${member.name}`; saveMemberBtn.textContent = 'Save Changes'; } else { memberModalTitle.textContent = `Add New Member`; saveMemberBtn.textContent = 'Add Member'; document.getElementById('memberEmail').readOnly = false; } memberModal.classList.add('active'); }
            function handleSaveMember(event) { event.preventDefault(); const memberId = document.getElementById('memberId').value ? parseInt(document.getElementById('memberId').value) : null; const firstName = document.getElementById('memberFirstName').value.trim(); const lastName = document.getElementById('memberLastName').value.trim(); const email = document.getElementById('memberEmail').value.trim(); const role = document.getElementById('memberRole').value; const title = document.getElementById('memberTitle').value.trim(); const department = document.getElementById('memberDepartment').value.trim(); const isEditing = memberId !== null; if (!firstName || !lastName || !email || !role) { showToast('Please fill in First Name, Last Name, Email, and Role.', 'error'); return; } if (!/\S+@\S+\.\S+/.test(email)) { showToast('Please enter a valid email address.', 'error'); return; } if (!isEditing && MOCK_USERS.some(user => user.email.toLowerCase() === email.toLowerCase())) { showToast('A user with this email already exists.', 'error'); return; } const memberData = { id: isEditing ? memberId : Date.now(), name: `${firstName} ${lastName}`, email: email, role: role, title: title, department: department, phone: isEditing ? MOCK_USERS.find(u=>u.id === memberId)?.phone || '' : '', avatar: isEditing ? MOCK_USERS.find(u=>u.id === memberId)?.avatar || '' : '', initials: (firstName?.[0] || '') + (lastName?.[0] || ''), twoFaEnabled: isEditing ? MOCK_USERS.find(u=>u.id === memberId)?.twoFaEnabled || false : false }; if (!memberData.avatar) { memberData.initials = (firstName?.[0] || '') + (lastName?.[0] || ''); } console.log(`${isEditing ? 'Saving' : 'Adding'} member:`, memberData); showToast(`${isEditing ? 'Saving' : 'Adding'} member...`, 'info'); setTimeout(() => { if (isEditing) { const memberIndex = MOCK_USERS.findIndex(u => u.id === memberId); if (memberIndex > -1) { MOCK_USERS[memberIndex] = memberData; if (currentUser && currentUser.id === memberId) { currentUser = { ...memberData }; window.currentUser = currentUser; updateUserUI(); } } else { console.error("Error finding member to edit"); } } else { MOCK_USERS.push(memberData); } loadTeamMembers(); if(currentFeature === 'team-members-view') { const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('team-members-view-feature')) { loadTeamMembers(container); } } loadDashboardStats(); showToast(`Member ${isEditing ? 'updated' : 'added'} successfully!`, 'success'); memberModal.classList.remove('active'); }, 1000); }
            function handleRemoveMember(memberId) { const memberToRemove = MOCK_USERS.find(u => u.id === memberId); showConfirmModal('Remove Team Member', `Are you sure you want to remove ${memberToRemove?.name || 'this member'}?`, () => { showToast(`Removing ${memberToRemove?.name || 'member'}...`, 'info'); setTimeout(() => { MOCK_USERS = MOCK_USERS.filter(u => u.id !== memberId); loadTeamMembers(); if(currentFeature === 'team-members-view') { const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('team-members-view-feature')) { loadTeamMembers(container); } } loadDashboardStats(); if (currentFeature === 'employee-scheduling') { window.renderSchedule?.(currentScheduleWeekOffset); } showToast('Team member removed.', 'success'); }, 500); }, 'btn-danger'); }
            function handleDeleteAllNonAdminUsers() { const nonAdminUsers = MOCK_USERS.filter(u => u.role !== 'admin'); if (nonAdminUsers.length === 0) { showToast('No non-admin users to delete.', 'info'); return; } const userCount = nonAdminUsers.length; const userListHTML = nonAdminUsers.slice(0, 5).map(u => `<li>${u.name} (${u.email})</li>`).join('') + (userCount > 5 ? '<li>... and more</li>' : ''); showConfirmModal( `Delete ${userCount} Non-Admin Users`, `This will permanently delete ${userCount} user(s) who are not administrators, including:<br><ul>${userListHTML}</ul><strong>This action cannot be undone.</strong> Are you sure?`, () => { showConfirmModal( 'Final Confirmation', `Really delete all ${userCount} non-admin users?`, () => { showToast(`Deleting ${userCount} users...`, 'warning'); setTimeout(() => { MOCK_USERS = MOCK_USERS.filter(u => u.role === 'admin'); loadTeamMembers(); if (currentFeature === 'team-members-view') { const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('team-members-view-feature')) { loadTeamMembers(container); } } loadDashboardStats(); showSuccessMessage(`${userCount} non-admin users deleted successfully.`); }, 1500); }, 'btn-danger' ); }, 'btn-danger' ); }

             // --- Projects Feature Logic (Global helpers) ---
            function renderProjects(container) { const projectsListContainer = container.querySelector('#projectsListContainerFeature'); if (!projectsListContainer) return; const searchInput = container.querySelector('#projectSearchInputFeature'); const filterSelect = container.querySelector('#projectFilterSelectFeature'); const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : ''; const selectedStatus = filterSelect ? filterSelect.value : 'all'; projectsListContainer.innerHTML = ''; let projectsToDisplay = MOCK_PROJECTS_DATA.filter(project => { const statusMatch = (selectedStatus === 'all' || project.status === selectedStatus); const searchMatch = ( project.name.toLowerCase().includes(searchTerm) || (project.participants || '').toLowerCase().includes(searchTerm) || project.status.toLowerCase().includes(searchTerm) ); return statusMatch && searchMatch; }); if (projectsToDisplay.length === 0) { projectsListContainer.innerHTML = '<p style="color: var(--gray); grid-column: 1 / -1; text-align: center; padding: 2rem;">No projects found matching your criteria.</p>'; return; } projectsToDisplay.forEach(project => { const card = document.createElement('div'); card.classList.add('project-card'); card.dataset.projectId = project.id; card.dataset.status = project.status; card.dataset.participants = project.participants; const participantsHTML = (project.participants || '').split('|') .map(p => p.trim()) .filter(p => p) .map(p => `<span>${p}</span>`).join(' '); const canEdit = project.editable !== false; const canDelete = currentUser.role === 'admin'; const statusText = project.status.replace('-', ' '); card.innerHTML = ` <div class="project-card-image" style="background-image: url('${project.img || 'https://via.placeholder.com/400x160/cccccc/969696?text=Project+Image'}');"></div> <div class="project-card-body"> <h3 class="project-name">${project.name}</h3> <span class="project-status status-badge status-${project.status}">${statusText}</span> <div class="progress-bar-container" title="Progress: ${project.progress}%"> <div class="progress-bar" style="width: ${project.progress}%;">${project.progress > 5 ? project.progress + '%' : ''}</div> </div> <div class="project-info project-participants"> <i class="fas fa-users"></i> <div class="participant-list">${participantsHTML || 'N/A'}</div> </div> <div class="project-info project-dates"> <i class="fas fa-calendar-alt"></i> Started: ${formatDateForDisplay(project.startDate)} | Updated: ${formatDateForDisplay(project.updatedDate)} </div> <div class="project-actions"> <button class="btn btn-sm btn-view" data-project-id="${project.id}"><i class="fas fa-eye"></i> View</button> <button class="btn btn-sm btn-edit" data-project-id="${project.id}" ${!canEdit ? 'disabled' : ''}><i class="fas fa-pencil-alt"></i> Edit</button> <button class="btn btn-sm btn-delete" data-project-id="${project.id}" ${!canDelete ? 'disabled' : ''}><i class="fas fa-trash-alt"></i> Delete</button> </div> </div> `; projectsListContainer.appendChild(card); }); }
            function handleDeleteProject(projectId) { const projectToDelete = MOCK_PROJECTS_DATA.find(p => p.id === projectId); if (!projectToDelete) return; showConfirmModal( 'Confirm Project Deletion', `Are you sure you want to delete project: "${projectToDelete.name}"? This action cannot be undone.`, () => { showToast(`Deleting project ${projectToDelete.name}...`, 'info'); setTimeout(() => { MOCK_PROJECTS_DATA = MOCK_PROJECTS_DATA.filter(p => p.id !== projectId); const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('projects-feature')) { renderProjects(container); } loadDashboardStats(); showToast('Project deleted successfully!', 'success'); }, 500); }, 'btn-danger' ); }
            function openProjectModal(projectId = null) { const isEditing = projectId !== null; const project = isEditing ? MOCK_PROJECTS_DATA.find(p => p.id === projectId) : null; if (isEditing && !project) { showToast("Error: Project not found.", "error"); return; } projectForm.reset(); document.getElementById('projectId').value = isEditing ? project.id : ''; if (isEditing) { projectModalTitle.textContent = `Edit Project: ${project.name}`; saveProjectBtn.textContent = 'Save Changes'; document.getElementById('projectName').value = project.name; document.getElementById('projectDescription').value = project.description || ''; document.getElementById('projectParticipantsInput').value = project.participants || ''; document.getElementById('projectImageInput').value = project.img || ''; document.getElementById('projectStartDate').value = project.startDate || ''; document.getElementById('projectDueDate').value = project.dueDate || ''; document.getElementById('projectStatus').value = project.status || 'pending'; document.getElementById('projectProgress').value = project.progress || 0; } else { projectModalTitle.textContent = 'Add New Project'; saveProjectBtn.textContent = 'Add Project'; document.getElementById('projectStatus').value = 'pending'; document.getElementById('projectProgress').value = 0; } projectModal.classList.add('active'); }
            function handleSaveProject(event) { event.preventDefault(); const projectId = document.getElementById('projectId').value; const isEditing = projectId !== ''; const projectData = { id: isEditing ? projectId : `proj-${Date.now()}`, name: document.getElementById('projectName').value.trim(), description: document.getElementById('projectDescription').value.trim(), participants: document.getElementById('projectParticipantsInput').value.trim(), img: document.getElementById('projectImageInput').value.trim(), startDate: document.getElementById('projectStartDate').value || null, dueDate: document.getElementById('projectDueDate').value || null, status: document.getElementById('projectStatus').value, progress: parseInt(document.getElementById('projectProgress').value) || 0, updatedDate: getCurrentDate(), editable: true }; if (!projectData.name) { showToast('Project Name is required.', 'error'); return; } console.log(`${isEditing ? 'Saving' : 'Adding'} project:`, projectData); showToast(`${isEditing ? 'Saving' : 'Adding'} project...`, 'info'); setTimeout(() => { if (isEditing) { const index = MOCK_PROJECTS_DATA.findIndex(p => p.id === projectId); if (index > -1) { MOCK_PROJECTS_DATA[index] = { ...MOCK_PROJECTS_DATA[index], ...projectData }; } else { console.error("Error finding project to edit"); MOCK_PROJECTS_DATA.push(projectData); } } else { MOCK_PROJECTS_DATA.push(projectData); } const container = document.getElementById('featureSectionsContainer'); if(container && container.classList.contains('projects-feature')) { renderProjects(container); } loadDashboardStats(); showToast(`Project ${isEditing ? 'updated' : 'added'} successfully!`, 'success'); projectModal.classList.remove('active'); }, 500); }

            // --- Employee Scheduling (Global helpers) ---
            function getWeekDates(weekOffset = 0) { const baseDate=new Date(); const startOfWeek=new Date(baseDate); const dayOfWeek=baseDate.getDay(); const diff=baseDate.getDate()-dayOfWeek; startOfWeek.setDate(diff+(weekOffset*7)); startOfWeek.setHours(0,0,0,0); const dates=[]; for(let i=0;i<7;i++){ const date=new Date(startOfWeek); date.setDate(startOfWeek.getDate()+i); dates.push(date); } return dates; }
            function getShiftText(type) { switch (type) { case 'morning': return '9AM-5PM'; case 'afternoon': return '12PM-8PM'; case 'night': return '8PM-4AM'; case 'off': return 'OFF'; case 'sick': return 'Sick'; case 'vacation': return 'Vacation'; default: return 'N/A'; } }
            function handleSendReminders() { const btn = document.getElementById('sendRemindersBtn'); if (!btn) return; btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Sending...'; console.log("Sending reminders..."); const weekDates = getWeekDates(currentScheduleWeekOffset); const weekStart = formatDateForDisplay(weekDates[0]); const weekEnd = formatDateForDisplay(weekDates[6]); const emailSubject = `Schedule: ${weekStart} - ${weekEnd}`; const emailFooter = "\n\nRegards,\nTeam Management System"; const fullDays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; let emailsSent = 0; let emailsFailed = 0; MOCK_USERS.forEach((user, index) => { let userScheduleInfo = `Your schedule:\n`; for (let dayIndex = 0; dayIndex < 7; dayIndex++) { const scheduleKey = `${user.id}-${currentScheduleWeekOffset}-${dayIndex}`; const shiftType = mockScheduleData[scheduleKey] || 'off'; userScheduleInfo += `- ${fullDays[dayIndex]} (${formatDateForDisplay(weekDates[dayIndex])}): ${getShiftText(shiftType)}\n`; } const emailBody = `Hi ${user.name.split(' ')[0]},\n\n${userScheduleInfo}${emailFooter}`; console.log(`--- Sending to: ${user.email} ---\nSubject: ${emailSubject}\nBody:\n${emailBody}\n------`); const success = Math.random() > 0.1; if (success) { emailsSent++; } else { emailsFailed++; } }); setTimeout(() => { if (emailsFailed > 0) { showToast(`Sent ${emailsSent} reminders. ${emailsFailed} failed.`, "error"); } else { showToast(`Sent ${emailsSent} reminders!`, "success"); } btn.disabled = false; btn.innerHTML = '<i class="fas fa-envelope"></i> Send Reminders'; }, 1500 + MOCK_USERS.length * 50); }
             window.renderSchedule = function(weekOffset) { console.log(`Rendering schedule offset: ${weekOffset}`); const container = document.getElementById('featureSectionsContainer'); const weekDisplay = container?.querySelector('#weekDisplay'); const scheduleTableBody = container?.querySelector('#scheduleTableBody'); const scheduleThead = container?.querySelector('.schedule-table thead tr'); const prevWeekBtn = container?.querySelector('#prevWeekBtn'); if (!weekDisplay || !scheduleTableBody || !scheduleThead || !prevWeekBtn) { console.warn("Schedule elements not found for render."); return; } if (isNaN(weekOffset)) { weekOffset = currentScheduleWeekOffset; } const weekDates = getWeekDates(weekOffset); const start = weekDates[0]; const end = weekDates[6]; weekDisplay.textContent = `${formatDateForDisplay(start)} - ${formatDateForDisplay(end)}`; prevWeekBtn.disabled = weekOffset <= scheduleMinWeekOffset; const nextWeekBtn = container.querySelector('#nextWeekBtn'); if(nextWeekBtn) nextWeekBtn.disabled = false; // Enable by default, logic might disable later if needed scheduleThead.innerHTML = '<th>Employee</th>'; const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; weekDates.forEach((date, index) => { scheduleThead.innerHTML += `<th><div class="day-header"><span class="day-name">${days[index]}</span><span class="day-date">${date.toLocaleDateString(undefined, { month: 'short', day: 'numeric'})}</span></div></th>`; }); scheduleTableBody.innerHTML = ''; if (MOCK_USERS.length === 0) { scheduleTableBody.innerHTML = `<tr><td colspan="8">No employees found.</td></tr>`; return; } MOCK_USERS.forEach(employee => { const row = document.createElement('tr'); row.innerHTML = `<td class="employee-name">${employee.name}</td>`; for (let dayIndex = 0; dayIndex < 7; dayIndex++) { const cell = document.createElement('td'); const scheduleKey = `${employee.id}-${weekOffset}-${dayIndex}`; const isWeekend = dayIndex === 0 || dayIndex === 6; // Sunday or Saturday let shiftType; let isEditable = currentUser.role === 'admin' && !isWeekend; if (isWeekend) { shiftType = 'off'; mockScheduleData[scheduleKey] = 'off'; cell.classList.add('weekend-cell'); } else { if (!mockScheduleData[scheduleKey]) { const shiftTypes = ['morning', 'afternoon', 'night', 'off']; mockScheduleData[scheduleKey] = shiftTypes[Math.floor(Math.random() * shiftTypes.length)]; } shiftType = mockScheduleData[scheduleKey]; } const shiftDiv = document.createElement('div'); shiftDiv.classList.add('shift'); if (isWeekend) { shiftDiv.classList.add('shift-weekend-off'); } else { shiftDiv.classList.add(`shift-${shiftType.replace('_', '-')}`); } shiftDiv.textContent = getShiftText(shiftType); if (isEditable) { shiftDiv.classList.add('editable'); shiftDiv.dataset.employeeId = employee.id; shiftDiv.dataset.employeeName = employee.name; shiftDiv.dataset.dayIndex = dayIndex; shiftDiv.dataset.weekOffset = weekOffset; shiftDiv.dataset.date = formatDateForDisplay(weekDates[dayIndex]); shiftDiv.title = `Edit ${employee.name}'s shift`; shiftDiv.addEventListener('click', handleEditShiftClick); } else if (isWeekend) { shiftDiv.title = "Weekend Off"; } cell.appendChild(shiftDiv); row.appendChild(cell); } scheduleTableBody.appendChild(row); }); }
             function handleEditShiftClick(event) { const target=event.target; if(!target.classList.contains('editable'))return; const employeeId=target.dataset.employeeId; const dayIndex=target.dataset.dayIndex; const weekOffset=target.dataset.weekOffset; const employeeName=target.dataset.employeeName; const dateStr=target.dataset.date; const scheduleKey=`${employeeId}-${weekOffset}-${dayIndex}`; const currentShift=mockScheduleData[scheduleKey]||'morning'; const editShiftModal = document.getElementById('editShiftModal'); const editShiftForm = document.getElementById('editShiftForm'); const shiftTypeSelect = document.getElementById('shiftTypeSelect'); const editShiftEmployeeIdInput = document.getElementById('editShiftEmployeeId'); const editShiftDayIndexInput = document.getElementById('editShiftDayIndex'); const editShiftWeekOffsetInput = document.getElementById('editShiftWeekOffset'); const editShiftModalTitle = document.getElementById('editShiftModalTitle'); const shiftEmployeeNameDisplay = document.getElementById('shiftEmployeeNameDisplay'); if(!editShiftModal || !shiftTypeSelect || !shiftEmployeeNameDisplay) return; if(editShiftEmployeeIdInput)editShiftEmployeeIdInput.value=employeeId; if(editShiftDayIndexInput)editShiftDayIndexInput.value=dayIndex; if(editShiftWeekOffsetInput)editShiftWeekOffsetInput.value=weekOffset; shiftTypeSelect.value=currentShift; shiftEmployeeNameDisplay.value = employeeName; if(editShiftModalTitle)editShiftModalTitle.textContent=`Edit ${employeeName}'s Shift on ${days[dayIndex]||dateStr}`; editShiftModal.classList.add('active'); }

            // --- Initialize ---
            initDashboard(); // Start the application

        }); // End DOMContentLoaded
    </script>

</body>
</html>                                                                                                                            

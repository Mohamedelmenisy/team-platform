<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#1e3a8a">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb; --primary-dark: #1e3a8a; --primary-light: #dbeafe;
            --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --info: #3b82f6;
            --success: #10b981; --dark: #1e293b; --light: #f8fafc; --gray: #64748b;
            --light-gray: #e2e8f0; --white: #ffffff; --sidebar-width: 280px;
            --sidebar-bg: #1e3a8a; --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1); --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1); --team-manager: var(--danger);
            --compact-padding: 0.5rem; --normal-padding: 1rem; --spacious-padding: 1.5rem;
            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd);
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0);
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a);
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca);
            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1);
            --file-share-hover-bg: #eef4ff;
            --file-share-header-bg: linear-gradient(90deg, hsla(217, 91%, 60%, 1) 0%, hsla(245, 100%, 70%, 1) 100%);

            /* High Contrast Variables */
            --hc-text: #000000; --hc-background: #ffffff; --hc-primary: #0000ff;
            --hc-secondary: #008000; --hc-link: #0000ee; --hc-border: #000000;

            /* Text Color Variable */
            --text-color: var(--dark);

             /* Schedule specific */
             --schedule-weekend-bg: #f3f4f6; --schedule-weekend-text: #9ca3af;
             --shift-morning-bg: #dbeafe; --shift-morning-text: #1e40af; --shift-morning-border: #bfdbfe;
             --shift-afternoon-bg: #e0f2fe; --shift-afternoon-text: #0c4a6e; --shift-afternoon-border: #bae6fd;
             --shift-night-bg: #ede9fe; --shift-night-text: #5b21b6; --shift-night-border: #ddd6fe;
             --shift-off-bg: #f0fdf4; --shift-off-text: #166534; --shift-off-border: #bbf7d0;
             --shift-sick-bg: #fee2e2; --shift-sick-text: #991b1b; --shift-sick-border: #fecaca;
             --shift-vacation-bg: #ffedd5; --shift-vacation-text: #9a3412; --shift-vacation-border: #fed7aa;

            /* Team Members Feature Specific Variables */
            --feature-team-bg: var(--white); --feature-team-card-bg: var(--white); --feature-team-border-color: var(--light-gray);
            --feature-team-shadow-color: rgba(0, 0, 0, 0.05); --feature-team-hover-shadow-color: rgba(0, 0, 0, 0.08);
            --feature-team-text-primary: var(--dark); --feature-team-text-secondary: var(--gray); --feature-team-title-text: var(--dark);
            --feature-team-title-bg: var(--light); --feature-team-admin-color: var(--danger); --feature-team-supervisor-color: var(--primary);
            --feature-team-senior-color: var(--success); --feature-team-member-color: var(--gray); --feature-team-card-border-radius: 12px;
            --feature-team-section-padding: 1.5rem; --feature-team-card-padding: 1.25rem; --feature-team-grid-gap: 1.5rem;

            /* Projects Feature Specific Variables */
            --feature-projects-body-bg: var(--primary-light); --feature-projects-card-bg: var(--white); --feature-projects-text-color: var(--text-color);
            --feature-projects-text-muted: var(--gray); --feature-projects-heading-color: var(--primary-dark); --feature-projects-border-color: var(--light-gray);
            --feature-projects-shadow-color: rgba(0, 0, 0, 0.08); --feature-projects-shadow-hover-color: rgba(0, 0, 0, 0.12);
            --feature-projects-input-bg: var(--white); --feature-projects-input-border: var(--light-gray); --feature-projects-input-focus-border: var(--primary);
            --feature-projects-input-focus-shadow: rgba(37, 99, 235, 0.1); --feature-projects-primary-color: var(--primary);
            --feature-projects-primary-hover: var(--primary-dark); --feature-projects-primary-text: var(--white); --feature-projects-success-bg: #dcfce7;
            --feature-projects-success-text: #15803d; --feature-projects-success-progress: var(--success); --feature-projects-warning-bg: #fef3c7;
            --feature-projects-warning-text: #a16207; --feature-projects-warning-progress: var(--warning); --feature-projects-warning-btn-text: var(--dark);
            --feature-projects-info-bg: #e0f2fe; --feature-projects-info-text: #075985; --feature-projects-info-progress: var(--primary);
            --feature-projects-secondary-bg: var(--light-gray); --feature-projects-secondary-text: var(--gray); --feature-projects-secondary-progress: var(--gray);
            --feature-projects-danger-color: var(--danger); --feature-projects-danger-hover: #dc2626; --feature-projects-danger-text: var(--white);
            --feature-projects-progress-bar-bg: var(--light-gray); --feature-projects-modal-backdrop-bg: rgba(0, 0, 0, 0.5);
        }

        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--primary-light); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* --- High Contrast Mode --- */
        body.high-contrast {
             --hc-text: #000000; --hc-background: #ffffff; --hc-primary: #0000ff; --hc-secondary: #008000;
             --hc-link: #0000ee; --hc-border: #000000; --dark: var(--hc-text); --light: var(--hc-background);
             --gray: var(--hc-text); --light-gray: var(--hc-border); --white: var(--hc-background); --primary: var(--hc-primary);
             --primary-dark: var(--hc-primary); --primary-light: #e0e0ff; --secondary: var(--hc-secondary);
             --success: var(--hc-secondary); --warning: #ffa500; --danger: #ff0000; --info: var(--hc-primary);
             --sidebar-bg: var(--hc-background); --sidebar-text: var(--hc-text); --sidebar-hover: #e0e0e0;
             --sidebar-active: #c0c0c0; --sidebar-divider: var(--hc-border); --text-color: var(--hc-text);
             --schedule-weekend-bg: #dddddd; --schedule-weekend-text: var(--hc-text);
             --feature-team-bg: var(--hc-background); --feature-team-card-bg: var(--hc-background); --feature-team-border-color: var(--hc-border);
             --feature-team-shadow-color: transparent; --feature-team-hover-shadow-color: transparent; --feature-team-text-primary: var(--hc-text);
             --feature-team-text-secondary: var(--hc-text); --feature-team-title-text: var(--hc-text); --feature-team-title-bg: var(--hc-background);
             --feature-team-admin-color: var(--danger); --feature-team-supervisor-color: var(--hc-primary); --feature-team-senior-color: var(--hc-secondary);
             --feature-team-member-color: var(--hc-text); --feature-projects-card-bg: var(--hc-background); --feature-projects-text-color: var(--hc-text);
             --feature-projects-text-muted: var(--hc-text); --feature-projects-heading-color: var(--hc-text); --feature-projects-border-color: var(--hc-border);
             --feature-projects-shadow-color: transparent; --feature-projects-shadow-hover-color: transparent; --feature-projects-input-bg: var(--hc-background);
             --feature-projects-input-border: var(--hc-border); --feature-projects-primary-color: var(--hc-primary); --feature-projects-primary-text: var(--hc-background);
             --feature-projects-success-bg: var(--hc-background); --feature-projects-success-text: var(--hc-secondary); --feature-projects-success-progress: var(--hc-secondary);
             --feature-projects-warning-bg: var(--hc-background); --feature-projects-warning-text: var(--hc-text); --feature-projects-warning-progress: var(--warning);
             --feature-projects-warning-btn-text: var(--hc-text); --feature-projects-info-bg: var(--hc-background); --feature-projects-info-text: var(--hc-primary);
             --feature-projects-info-progress: var(--hc-primary); --feature-projects-secondary-bg: var(--hc-background); --feature-projects-secondary-text: var(--hc-text);
             --feature-projects-secondary-progress: var(--hc-text); --feature-projects-danger-color: var(--danger); --feature-projects-danger-text: var(--hc-background);
             --feature-projects-progress-bar-bg: var(--hc-background);
             --shift-morning-bg: var(--hc-background); --shift-morning-text: var(--hc-text); --shift-morning-border: var(--hc-border);
             --shift-afternoon-bg: var(--hc-background); --shift-afternoon-text: var(--hc-text); --shift-afternoon-border: var(--hc-border);
             --shift-night-bg: var(--hc-background); --shift-night-text: var(--hc-text); --shift-night-border: var(--hc-border);
             --shift-off-bg: var(--hc-background); --shift-off-text: var(--hc-text); --shift-off-border: var(--hc-border);
             --shift-sick-bg: var(--hc-background); --shift-sick-text: var(--hc-text); --shift-sick-border: var(--hc-border);
             --shift-vacation-bg: var(--hc-background); --shift-vacation-text: var(--hc-text); --shift-vacation-border: var(--hc-border);
             --file-share-hover-bg: #e0e0e0; --file-share-header-bg: var(--hc-background);
             color: var(--text-color); background-color: var(--hc-background);
        }
        body.high-contrast .welcome-section, body.high-contrast .stat-card, body.high-contrast .top-nav,
        body.high-contrast .sidebar, body.high-contrast .activity-section, body.high-contrast .content-section,
        body.high-contrast #featureSectionsContainer.team-members-feature .team-members-section, body.high-contrast #featureSectionsContainer.team-members-feature .team-member-card,
        body.high-contrast #featureSectionsContainer.projects-feature #projects-section, body.high-contrast #featureSectionsContainer.projects-feature .project-card,
        body.high-contrast #featureSectionsContainer.projects-feature .projects-title-wrapper, body.high-contrast #featureSectionsContainer.projects-feature .project-controls,
        body.high-contrast #featureSectionsContainer.task-management-feature .task-management-content, body.high-contrast #featureSectionsContainer.task-management-feature .task-card,
        body.high-contrast #featureSectionsContainer.file-sharing-feature .card, body.high-contrast #featureSectionsContainer.file-sharing-feature .card-header,
        body.high-contrast #featureSectionsContainer.file-sharing-feature .filters-section, body.high-contrast #featureSectionsContainer.file-sharing-feature #recentUploadsSection,
        body.high-contrast #featureSectionsContainer.file-sharing-feature .table, body.high-contrast #featureSectionsContainer.file-sharing-feature .upload-area
        { background: var(--hc-background); border: 1px solid var(--hc-border); color: var(--text-color); box-shadow: none !important; }

        body.high-contrast .btn, body.high-contrast .form-control, body.high-contrast .form-select, body.high-contrast .search-bar input,
        body.high-contrast #featureSectionsContainer.team-members-feature .team-filter input, body.high-contrast #featureSectionsContainer.projects-feature .project-search-input,
        body.high-contrast #featureSectionsContainer.projects-feature .project-filter-select, body.high-contrast #featureSectionsContainer.task-management-feature #search-input,
        body.high-contrast #featureSectionsContainer.task-management-feature .filters select, body.high-contrast #featureSectionsContainer.task-management-feature #task-form input,
        body.high-contrast #featureSectionsContainer.task-management-feature #task-form textarea, body.high-contrast #featureSectionsContainer.task-management-feature #task-form select,
        body.high-contrast #featureSectionsContainer.file-sharing-feature .form-control, body.high-contrast #featureSectionsContainer.file-sharing-feature .form-select
        { border: 1px solid var(--hc-border); background: var(--hc-background); color: var(--text-color); }

        body.high-contrast .btn-primary, body.high-contrast #featureSectionsContainer.projects-feature .add-project-btn,
        body.high-contrast #featureSectionsContainer.task-management-feature .btn-primary, body.high-contrast #featureSectionsContainer.team-members-feature .add-team-member-btn,
        body.high-contrast #featureSectionsContainer.file-sharing-feature .btn-primary
        { background-color: var(--hc-primary); color: var(--hc-background); border: 1px solid var(--hc-border); }

        body.high-contrast .btn-danger { background-color: var(--danger); color: var(--hc-background); border: 1px solid var(--hc-border); }
        body.high-contrast .btn-warning { background-color: var(--warning); color: var(--hc-text); border: 1px solid var(--hc-border); }
        body.high-contrast .btn-success { background-color: var(--hc-secondary); color: var(--hc-background); border: 1px solid var(--hc-border); }
        body.high-contrast .btn-info { background-color: var(--hc-primary); color: var(--hc-background); border: 1px solid var(--hc-border); }
        body.high-contrast .btn-outline, body.high-contrast .btn-outline-secondary, body.high-contrast .btn-outline-success,
        body.high-contrast .btn-outline-info, body.high-contrast .btn-outline-danger
        { background: var(--hc-background); color: var(--hc-primary); border: 1px solid var(--hc-primary); }
        body.high-contrast .logo { color: var(--text-color); } body.high-contrast .logo-icon { color: var(--hc-primary); }
        body.high-contrast .menu-item { color: var(--text-color); border-left-color: transparent; }
        body.high-contrast .menu-item.active { background-color: #c0c0c0; border-left-color: var(--hc-primary); color: var(--hc-text); }
        body.high-contrast .stat-card { border-left-width: 3px; background: var(--hc-background); }
        body.high-contrast .welcome-section { background: var(--hc-background); border: 1px solid var(--hc-border); color: var(--hc-text);}
        body.high-contrast .welcome-section .user-info-title { color: var(--hc-text); }
        body.high-contrast #featureSectionsContainer.team-members-feature .member-role, body.high-contrast #featureSectionsContainer.projects-feature .project-status,
        body.high-contrast #featureSectionsContainer.task-management-feature .status-badge, body.high-contrast #featureSectionsContainer.file-sharing-feature .badge
        { border: 1px solid var(--hc-border); color: var(--hc-text) !important; background: none !important; padding: 3px 8px; }
        body.high-contrast #featureSectionsContainer.projects-feature .progress-bar { border: 1px solid var(--hc-border); color: var(--hc-text); background: none; }
        body.high-contrast #featureSectionsContainer.projects-feature .progress-bar-container { background: var(--hc-background); border: 1px solid var(--hc-border); }
        body.high-contrast #featureSectionsContainer.projects-feature .project-participants span { border: 1px solid var(--hc-border); color: var(--hc-text); background: none; }
        body.high-contrast .theme-preview { border: 2px solid var(--hc-border); background: var(--hc-background) !important; }
        body.high-contrast .theme-option.selected .theme-preview { border-color: var(--hc-primary); }
        body.high-contrast .switch .slider { background-color: #999; border: 1px solid var(--hc-border); }
        body.high-contrast .switch input:checked + .slider { background-color: var(--hc-primary); }
        body.high-contrast .switch .slider:before { background-color: var(--hc-text); }
        body.high-contrast #featureSectionsContainer.employee-scheduling .schedule-table thead th { background: var(--hc-background); color: var(--hc-text); border: 1px solid var(--hc-border); }
        body.high-contrast #featureSectionsContainer.employee-scheduling .schedule-table tbody td { border: 1px solid var(--hc-border); background: var(--hc-background) !important; }
        body.high-contrast #featureSectionsContainer.employee-scheduling .employee-name { background: var(--hc-background); border-right: 2px solid var(--hc-border); }
        body.high-contrast #featureSectionsContainer.employee-scheduling .day-name, body.high-contrast #featureSectionsContainer.employee-scheduling .day-date { color: var(--hc-text); }
        body.high-contrast #featureSectionsContainer.employee-scheduling .shift { border: 1px solid var(--hc-border); background: none !important; color: var(--hc-text) !important; }
        body.high-contrast #featureSectionsContainer.employee-scheduling .shift-weekend-off { border: none; font-style: normal; }
        body.high-contrast #featureSectionsContainer.task-management-feature .task-card, body.high-contrast #featureSectionsContainer.task-management-feature .modal-content,
        body.high-contrast #featureSectionsContainer.task-management-feature .controls { border: 1px solid var(--hc-border); }
        body.high-contrast #featureSectionsContainer.task-management-feature .task-card { border-left-width: 3px; }
        body.high-contrast #featureSectionsContainer.file-sharing-feature .fancy-header-title { background: var(--hc-background); color: var(--hc-text); border: 1px solid var(--hc-border); }
        body.high-contrast #featureSectionsContainer.file-sharing-feature .file-icon { color: var(--hc-text) !important; }
        body.high-contrast #featureSectionsContainer.file-sharing-feature .table-hover > tbody > tr:hover > * { background-color: #e0e0e0 !important; }
        body.high-contrast #featureSectionsContainer.file-sharing-feature #recentUploadsSection .list-group-item { border-bottom-color: var(--hc-border) !important; }
        body.high-contrast #featureSectionsContainer.file-sharing-feature .upload-area { border-style: solid; border-color: var(--hc-border); }
        body.high-contrast #featureSectionsContainer.file-sharing-feature .upload-area:hover { background-color: #e0e0e0; }
        body.high-contrast #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar { background-color: var(--hc-primary) !important; }
        body.high-contrast .swal2-popup { background: var(--hc-background); color: var(--hc-text); border: 1px solid var(--hc-border); }
        body.high-contrast .swal2-confirm { background-color: var(--hc-secondary) !important; color: var(--hc-background); border: 1px solid var(--hc-border); }
        body.high-contrast .swal2-cancel { background-color: var(--danger) !important; color: var(--hc-background); border: 1px solid var(--hc-border); }

        /* --- Sidebar Styles --- */
        /* ... (remains unchanged) ... */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        /* ... (remains unchanged) ... */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--white); color: var(--text-color); }
        .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; }
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--text-color); }
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; }
        .dropdown-item:hover { background-color: var(--light); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        /* ... (remains unchanged) ... */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; }
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section { background: var(--welcome-bg-current); color: var(--white); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--team-manager); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--secondary); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card { background: var(--white); border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease; position: relative; overflow: hidden; border-left: 5px solid var(--primary); color: var(--dark); }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--secondary); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }
        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        .stat-card:nth-child(1) .stat-value { color: #1e40af; }
        .stat-card:nth-child(2) .stat-value { color: #15803d; }
        .stat-card:nth-child(3) .stat-value { color: #b45309; }
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; }
        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--text-color); }
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; }
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--light-gray); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--text-color); }
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--gray); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        .delete-activity { color: var(--danger); cursor: pointer; opacity: 0.6; transition: opacity 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .activity-item:hover .delete-activity { opacity: 1; }
        .delete-activity:hover { opacity: 1; background-color: rgba(239, 68, 68, 0.1); }

        /* --- Profile & Settings Sections Styles --- */
        /* ... (remains unchanged) ... */
        .content-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease, opacity 0.4s ease-in-out; display: none; opacity: 0; } /* Hidden & faded out by default */
        .content-section.active { display: block; opacity: 1; } /* Shown when active */
        /* @keyframes fadeInContent no longer needed as opacity transition handles it */
        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 1rem;}
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; }
        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; }
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control, .form-select { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; background-color: var(--white); color: var(--text-color); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        body.compact .form-control, body.compact .form-select { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control, body.spacious .form-select { padding: 1rem; }
        .form-control:focus, .form-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--primary-dark); }
        .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: #dc2626; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: #0d9f6e; }
        .btn-info { background-color: var(--info); color: white; }
        .btn-info:hover:not(:disabled) { background-color: var(--primary); }
        .btn-outline-secondary { background-color: transparent; border: 1px solid var(--gray); color: var(--gray); }
        .btn-outline-secondary:hover:not(:disabled) { background-color: var(--light); color: var(--dark); }
        .btn-outline-success { background-color: transparent; border: 1px solid var(--success); color: var(--success); }
        .btn-outline-success:hover:not(:disabled) { background-color: rgba(16, 185, 129, 0.1); }
        .btn-outline-info { background-color: transparent; border: 1px solid var(--info); color: var(--info); }
        .btn-outline-info:hover:not(:disabled) { background-color: rgba(59, 130, 246, 0.1); }
        .btn-outline-danger { background-color: transparent; border: 1px solid var(--danger); color: var(--danger); }
        .btn-outline-danger:hover:not(:disabled) { background-color: rgba(239, 68, 68, 0.1); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; opacity: 0; transition: opacity 0.5s ease-out;}
        .settings-panel.active { display: block; opacity: 1; }
        /* @keyframes fadeInPanel no longer needed */
        .settings-subsection { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray); }
        .settings-subsection:first-child { margin-top: 0; padding-top: 0; border-top: none; }
        .settings-subsection h4 { font-size: 1.1rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 1rem; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; }
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; }
        @media (min-width: 768px) { .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; } }
        .setting-item-label { font-weight: 500; color: var(--text-color); }
        .setting-item-description { font-size: 0.9rem; color: var(--gray); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
        @media (max-width: 767px) { .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; } }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--text-color); margin-bottom: 1rem; }
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        #settingsContent .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--light-gray); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--white); }
        body.compact #settingsContent .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious #settingsContent .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        #settingsContent .team-member-card:hover { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); border-color: var(--primary); }
        #settingsContent .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact #settingsContent .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        #settingsContent .member-details { flex: 1; min-width: 0; }
        #settingsContent .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-name { font-size: 0.9rem; }
        #settingsContent .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-email { font-size: 0.8rem; }
        #settingsContent .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; }
        body.compact #settingsContent .member-role { font-size: 0.7rem; margin: 0 0.75rem; }
        #settingsContent .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); }
        #settingsContent .role-senior { background-color: rgba(37, 99, 235, 0.1); color: var(--primary); }
        #settingsContent .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); }
        #settingsContent .role-member { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        #settingsContent .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        #settingsContent .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span { margin-left: 0.5rem; }
        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }
        .loading-text { display: none; font-size: 0.9rem; color: var(--gray); margin-left: 0.5rem; }

        /* --- Theme Styles & Dark Mode Overrides --- */
        /* ... (remains unchanged) ... */
        body.light-theme { --primary-light: #f1f5f9; --light: #ffffff; --white: #ffffff; --dark: #1e293b; --gray: #64748b; --light-gray: #e2e8f0; --text-color: var(--dark); background-color: var(--primary-light); }
        body.dark-theme {
             --primary: #3b82f6; --primary-dark: #1e40af; --primary-light: #1e293b; --light: #334155; --white: #0f172a;
             --dark: #e2e8f0; --gray: #94a3b8; --light-gray: #475569; --text-color: var(--dark);
             --schedule-weekend-bg: #262f3e; --schedule-weekend-text: #6b7280;
             --shift-morning-bg: #1e3a8a; --shift-morning-text: #dbeafe; --shift-morning-border: #2563eb;
             --shift-afternoon-bg: #0e7490; --shift-afternoon-text: #ecfeff; --shift-afternoon-border: #22d3ee;
             --shift-night-bg: #581c87; --shift-night-text: #f3e8ff; --shift-night-border: #a855f7;
             --shift-off-bg: #064e3b; --shift-off-text: #d1fae5; --shift-off-border: #34d399;
             --shift-sick-bg: #881337; --shift-sick-text: #fecdd3; --shift-sick-border: #fb7185;
             --shift-vacation-bg: #7c2d12; --shift-vacation-text: #ffedd5; --shift-vacation-border: #fb923c;
            --feature-team-bg: var(--white); --feature-team-card-bg: var(--light); --feature-team-border-color: var(--light-gray);
            --feature-team-text-primary: var(--text-color); --feature-team-text-secondary: var(--gray); --feature-team-title-text: var(--text-color);
            --feature-team-title-bg: var(--light);
            --feature-projects-body-bg: var(--white); --feature-projects-card-bg: var(--light); --feature-projects-text-color: var(--text-color);
            --feature-projects-text-muted: var(--gray); --feature-projects-heading-color: #a5b4fc; --feature-projects-border-color: var(--light-gray);
            --feature-projects-input-bg: var(--primary-light); --feature-projects-input-border: var(--light-gray); --feature-projects-success-bg: #14532d;
            --feature-projects-success-text: #a7f3d0; --feature-projects-success-progress: #4ade80; --feature-projects-warning-bg: #7f5d11;
            --feature-projects-warning-text: #fef3c7; --feature-projects-warning-progress: #facc15; --feature-projects-warning-btn-text: #1f2937;
            --feature-projects-info-bg: #1e40af; --feature-projects-info-text: #dbeafe; --feature-projects-info-progress: #60a5fa;
            --feature-projects-secondary-bg: #4b5563; --feature-projects-secondary-text: #d1d5db; --feature-projects-secondary-progress: var(--gray);
            --feature-projects-danger-color: #f87171; --feature-projects-danger-hover: #ef4444; --feature-projects-progress-bar-bg: var(--light-gray);
             --file-share-hover-bg: #475569;
             --file-share-header-bg: linear-gradient(90deg, #1e3a8a 0%, #3b82f6 100%);
             background-color: var(--white); color: var(--text-color);
        }
        body.dark-theme .top-nav { background-color: var(--light); border-bottom-color: var(--light-gray); }
        body.dark-theme .stat-card, body.dark-theme .activity-section, body.dark-theme .content-section,
        body.dark-theme #settingsContent .team-member-card, body.dark-theme .add-member-form,
        body.dark-theme #featureSectionsContainer.file-sharing-feature .card, body.dark-theme #featureSectionsContainer.file-sharing-feature .filters-section,
        body.dark-theme #featureSectionsContainer.file-sharing-feature #recentUploadsSection, body.dark-theme #featureSectionsContainer.file-sharing-feature .table,
        body.dark-theme #featureSectionsContainer.file-sharing-feature .upload-area
        { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .search-bar input, body.dark-theme .form-control, body.dark-theme .form-select { background-color: var(--primary-light); border-color: var(--light-gray); color: var(--text-color); }
        body.dark-theme .form-control[readonly] { background-color: var(--light); opacity: 0.6; }
        body.dark-theme .search-results { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .search-result-item { color: var(--text-color); }
        body.dark-theme .search-result-item:hover { background-color: var(--primary-light); }
        body.dark-theme .user-dropdown { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .dropdown-item { color: var(--text-color); }
        body.dark-theme .dropdown-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notifications-container { background-color: var(--light); }
        body.dark-theme .notification-list-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); }
        body.dark-theme .confirm-container, body.dark-theme .modal-content { background-color: var(--light); color: var(--text-color); }
        body.dark-theme .theme-option .theme-preview { border-color: var(--light-gray); background: linear-gradient(45deg, var(--light) 50%, var(--white) 50%); }
        body.dark-theme .theme-option .light-preview { background: var(--light) !important; }
        body.dark-theme .theme-option .dark-preview { background: var(--white) !important; }
        body.dark-theme .theme-option .system-preview { background: linear-gradient(45deg, var(--light) 50%, var(--white) 50%) !important; color: var(--gray);}
        body.dark-theme .theme-option.selected .theme-preview { border-color: var(--primary); }
        body.dark-theme .theme-option .theme-label { color: var(--text-color); }
        body.dark-theme .back-button { color: var(--primary); }
        body.dark-theme .back-button:hover { background-color: var(--light); color: #60a5fa; border-color: var(--primary); }
        body.dark-theme .notifications-footer { background-color: var(--light); border-top-color: var(--light-gray); }
        body.dark-theme .welcome-section { background: var(--welcome-bg-current); color: var(--white); }
        body.dark-theme .welcome-subtitle { color: inherit; opacity: 0.8; }
        body.dark-theme .user-info-name { color: inherit; }
        body.dark-theme .user-info-title { color: var(--gray); }
        body.dark-theme .user-info-title.role-admin { color: var(--team-manager); }
        body.dark-theme .user-info-email span { color: inherit; }
        body.dark-theme .stat-card { background: var(--light); color: var(--text-color);}
        body.dark-theme .stat-title { color: var(--text-color); }
        body.dark-theme .stat-card:nth-child(1) .stat-value { color: #93c5fd; }
        body.dark-theme .stat-card:nth-child(2) .stat-value { color: #86efac; }
        body.dark-theme .stat-card:nth-child(3) .stat-value { color: #fcd34d; }
        body.dark-theme .stat-card:nth-child(4) .stat-value { color: #fca5a5; }
        body.dark-theme .activity-icon { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa; }
        body.dark-theme .activity-item { border-bottom-color: var(--light-gray); }
        body.dark-theme .activity-message { color: var(--text-color); }
        body.dark-theme .activity-time { color: var(--gray); }
        body.dark-theme .activity-item.new-activity { background-color: rgba(59, 130, 246, 0.1); }
        body.dark-theme .delete-activity:hover { background-color: rgba(239, 68, 68, 0.2); }
        body.dark-theme .profile-avatar-section label { color: var(--text-color); }
        body.dark-theme #profileAvatarLarge { background-color: var(--light); color: var(--text-color); border-color: var(--primary-light); }
        body.dark-theme .profile-header-text { color: var(--gray); }
        body.dark-theme .placeholder-content { color: var(--gray); border-color: var(--light-gray); }
        body.dark-theme .placeholder-content h2 { color: var(--text-color); }
        body.dark-theme .placeholder-content p { color: var(--gray); }
        body.dark-theme .placeholder-content .error-message { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: var(--text-color); }
        body.dark-theme .settings-label, body.dark-theme .form-group label { color: var(--text-color); }
        body.dark-theme .settings-subsection h4 { color: #93c5fd; }
        body.dark-theme .setting-item-label { color: var(--text-color); }
        body.dark-theme .setting-item-description { color: var(--gray); }
        body.dark-theme .qr-code-placeholder { border-color: var(--light-gray); color: var(--gray); }
        body.dark-theme .danger-zone-item .btn-danger { background-color: #dc2626; }
        body.dark-theme .danger-zone-item .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        body.dark-theme .danger-zone-item p { color: var(--gray); }
        body.dark-theme .checkbox-group { border-color: var(--light-gray); }
        body.dark-theme .checkbox-group label { color: var(--text-color); }
        body.dark-theme .confirm-title { color: var(--text-color); }
        body.dark-theme .confirm-message { color: var(--gray); }
        body.dark-theme .modal-title { color: #93c5fd; }
        body.dark-theme #settingsContent .team-member-card .member-name { color: var(--text-color); }
        body.dark-theme #settingsContent .team-member-card .member-email { color: var(--gray); }
        body.dark-theme .search-result-item strong { color: var(--text-color); }
        body.dark-theme .user-name { color: var(--text-color); }
        body.dark-theme .toast { background-color: var(--light); color: var(--text-color); }
        body.dark-theme .toast.success { background-color: var(--success); color: white; }
        body.dark-theme .toast.error { background-color: var(--danger); color: white; }
        /* Dark Theme: Employee Scheduling */
        /* ... (remains unchanged) ... */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th { background-color: var(--primary-dark); color: var(--dark); border-bottom-color: var(--light-gray);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td { color: var(--text-color); border-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td, body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: var(--primary-light); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td, body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: #475569; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--white); border-right-color: var(--light-gray); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .day-name { color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .day-date { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td.weekend-cell { background-color: var(--schedule-weekend-bg) !important; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-weekend-off { color: var(--schedule-weekend-text); background-color: transparent; border-color: transparent; font-style: italic;}
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-page-title { background-color: var(--light); color: #93c5fd; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-morning { background-color: var(--shift-morning-bg); color: var(--shift-morning-text); border-color: var(--shift-morning-border);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-afternoon { background-color: var(--shift-afternoon-bg); color: var(--shift-afternoon-text); border-color: var(--shift-afternoon-border);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-night { background-color: var(--shift-night-bg); color: var(--shift-night-text); border-color: var(--shift-night-border);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-off { background-color: var(--shift-off-bg); color: var(--shift-off-text); border-color: var(--shift-off-border);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-sick { background-color: var(--shift-sick-bg); color: var(--shift-sick-text); border-color: var(--shift-sick-border);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-vacation { background-color: var(--shift-vacation-bg); color: var(--shift-vacation-text); border-color: var(--shift-vacation-border);}
        /* Dark Theme: Task Management */
        /* ... (remains unchanged) ... */
        body.dark-theme #featureSectionsContainer.task-management-feature { background-color: var(--white); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-page-header { background-color: var(--primary-dark); color: var(--dark); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content { background-color: var(--light); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content h1 { color: #93c5fd; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .controls { background-color: var(--primary-light); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content #search-input, body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .filters select { background-color: var(--white); border-color: var(--light-gray); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .search-icon { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .no-tasks { background-color: var(--primary-light); color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card { background-color: var(--light); border-color: var(--light-gray); border-left-color: var(--primary); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.priority-High { border-left-color: var(--danger); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.priority-Medium { border-left-color: var(--warning); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.priority-Low { border-left-color: var(--success); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card h3 { color: #93c5fd; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card p { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card .description { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card strong { color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card .links a { color: #60a5fa; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-meta { color: var(--gray); border-top-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .status-badge { color: var(--dark); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .status-Pending { background-color: var(--warning); color: #333; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .status-InProgress { background-color: #3b82f6; color: white; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .status-Completed { background-color: var(--success); color: white; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed { background-color: var(--primary-light); border-left-color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed h3, body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed p, body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed .description, body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed .task-meta, body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed strong { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-actions { border-top-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-actions button { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-actions .edit-btn:hover { color: #60a5fa; }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-actions .delete-btn { color: var(--danger); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-actions .complete-btn { color: var(--success); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-management-content .task-actions .reopen-btn { color: var(--warning); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal { background-color: rgba(0, 0, 0, 0.7); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content { background-color: var(--light); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content .close-btn { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content .close-btn:hover { color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content #modal-title { color: #93c5fd; }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content label { color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content input[type="text"], body.dark-theme #featureSectionsContainer.task-management-feature .modal-content input[type="date"], body.dark-theme #featureSectionsContainer.task-management-feature .modal-content textarea, body.dark-theme #featureSectionsContainer.task-management-feature .modal-content select { background-color: var(--primary-light); border-color: var(--light-gray); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .modal-content .form-actions { border-top-color: var(--light-gray); }
        /* Dark Theme: Team Members */
        /* ... (remains unchanged) ... */
        body.dark-theme #featureSectionsContainer.team-members-feature .team-members-section { background-color: var(--feature-team-bg); border-color: var(--feature-team-border-color);}
        body.dark-theme #featureSectionsContainer.team-members-feature .team-members-section-header { background-color: var(--feature-team-title-bg); color: var(--feature-team-title-text); border-bottom-color: var(--feature-team-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-filter input[type="text"] { background-color: var(--feature-projects-input-bg); color: var(--feature-projects-text-color); border-color: var(--feature-team-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-filter input[type="text"]::placeholder { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-member-card { background-color: var(--feature-team-card-bg); border-color: var(--feature-team-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-member-card:hover { border-color: var(--gray); }
        body.dark-theme #featureSectionsContainer.team-members-feature .member-name { color: var(--feature-team-text-primary); }
        body.dark-theme #featureSectionsContainer.team-members-feature .member-email { color: var(--feature-team-text-secondary); }
        body.dark-theme #featureSectionsContainer.team-members-feature .member-role.role-member { background-color: #4b5563; color: #d1d5db;}
        /* Dark Theme: Projects */
        /* ... (remains unchanged) ... */
        body.dark-theme #featureSectionsContainer.projects-feature .projects-title-wrapper { background-color: var(--feature-projects-card-bg); border-left-color: var(--feature-projects-primary-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .projects-title-wrapper h2 { color: var(--feature-projects-heading-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-controls { background-color: var(--feature-projects-card-bg); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-search-input, body.dark-theme #featureSectionsContainer.projects-feature .project-filter-select { background-color: var(--feature-projects-input-bg); color: var(--feature-projects-text-color); border-color: var(--feature-projects-input-border); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-card { background-color: var(--feature-projects-card-bg); border-color: var(--feature-projects-border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-name { color: var(--feature-projects-heading-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .progress-bar-container { background-color: var(--feature-projects-progress-bar-bg); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-info { color: var(--feature-projects-text-muted); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-info i { color: var(--feature-projects-text-muted); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-participants span { background-color: color-mix(in srgb, var(--feature-projects-card-bg) 80%, var(--feature-projects-text-muted) 20%); color: var(--feature-projects-text-color); border-color: var(--feature-projects-border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .status-completed { background-color: var(--feature-projects-success-bg); color: var(--feature-projects-success-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .status-in-progress { background-color: var(--feature-projects-warning-bg); color: var(--feature-projects-warning-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .status-active { background-color: var(--feature-projects-info-bg); color: var(--feature-projects-info-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .status-pending { background-color: var(--feature-projects-secondary-bg); color: var(--feature-projects-secondary-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions { border-top-color: var(--feature-projects-border-color); }
        /* Dark Theme: File Sharing */
        /* ... (remains unchanged) ... */
        body.dark-theme #featureSectionsContainer.file-sharing-feature .card-header { background-color: var(--light); border-bottom-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .fancy-header-title { background: var(--file-share-header-bg); color: var(--white); box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .file-icon.text-danger { color: #fca5a5 !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .file-icon.text-success { color: #86efac !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .file-icon.text-warning { color: #fcd34d !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .file-icon.text-primary { color: #93c5fd !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .file-icon.text-info { color: #7dd3fc !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .table thead { background-color: var(--primary-light) !important; color: var(--gray); border-bottom-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .table-hover > tbody > tr:hover > * { background-color: var(--file-share-hover-bg) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .file-name { color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-primary { background-color: var(--primary) !important; color: var(--white) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-secondary { background-color: var(--gray) !important; color: var(--white) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-success { background-color: var(--success) !important; color: var(--white) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-danger { background-color: var(--danger) !important; color: var(--white) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-warning { background-color: var(--warning) !important; color: var(--dark) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-info { background-color: var(--info) !important; color: var(--white) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .badge.text-bg-dark { background-color: var(--dark) !important; color: var(--light) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature #recentUploadsSection h6 { color: #93c5fd; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature #recentUploadsSection .list-group-item { border-bottom-color: var(--light-gray) !important; background-color: transparent !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .time-ago { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .upload-area { border-color: var(--primary); background-color: var(--primary-light); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .upload-area:hover { background-color: var(--light); border-color: #60a5fa; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .upload-area i { color: var(--primary); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar { background-color: var(--primary) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar.bg-success { background-color: var(--success) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar.bg-danger { background-color: var(--danger) !important; }
        body.dark-theme .swal2-popup { background-color: var(--light) !important; color: var(--text-color) !important; border: 1px solid var(--light-gray) !important; }
        body.dark-theme .swal2-title, body.dark-theme .swal2-html-container { color: var(--text-color) !important; }


        /* --- Notifications Modal, Confirm Modal, Utils --- */
        /* ... (remains unchanged) ... */
        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; }
        .notifications-modal.active { display: flex; }
        .notifications-container { width: 400px; max-width: 100%; background-color: var(--white); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; }
        .notifications-title { font-size: 1.25rem; font-weight: 600; }
        .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; }
        .notifications-body { flex-grow: 1; overflow-y: auto; }
        .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--light-gray); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; cursor: pointer; position: relative; }
        .notification-list-item:hover { background-color: var(--light); }
        .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); }
        .notification-list-item:last-child { border-bottom: none; }
        .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa;}
        .notification-content { flex: 1; min-width: 0; }
        .notification-message { margin-bottom: 0.25rem; color: var(--text-color); line-height: 1.4; }
        .notification-time { font-size: 0.8rem; color: var(--gray); }
        .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--white); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .notification-list-item:hover .delete-notification { opacity: 0.6; }
        .delete-notification:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        body.dark-theme .delete-notification { background: var(--light); }
        body.dark-theme .delete-notification:hover { background: rgba(239, 68, 68, 0.2); }
        .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); }
        .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--light); flex-wrap: wrap; gap: 0.5rem; }
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .confirm-modal.active { display: flex; }
        .confirm-container { background-color: var(--white); border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-color); }
        .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--gray); }
        .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-message.show { transform: translateX(0); }
        .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); }
        .back-button i { transition: transform 0.2s; font-size: 0.8rem; }
        .back-button:hover i { transform: translateX(-3px); }
        #notificationSound { display: none; }
        .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--light-gray); border-radius: 8px; margin-top: 2rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; }
        .placeholder-content h2 { color: var(--text-color); margin-bottom: 1rem; }
        .placeholder-content p { color: var(--gray); }
        .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; }
        .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }

        /* --- Generic Modal Styles --- */
        /* ... (remains unchanged) ... */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1050; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background-color: var(--white); width: 100%; max-width: 550px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out; color: var(--text-color); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--light-gray); }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--primary-dark); }
        body.dark-theme .modal-title { color: #93c5fd; }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;}
        .close-modal:hover { color: var(--danger); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- Checkbox Group --- */
        /* ... (remains unchanged) ... */
         .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid var(--light-gray); border-radius: 6px; }
         .checkbox-group label { display: flex; align-items: center; gap: 0.5rem; font-weight: normal; font-size: 0.9rem; margin-bottom: 0; color: var(--text-color); }
         .checkbox-group input[type="checkbox"] { width: auto; margin-right: 0.25rem; }
         .settings-link { color: var(--primary); text-decoration: none; cursor: pointer; }
         .settings-link:hover { text-decoration: underline; color: var(--primary-dark); }

        /* --- Toast --- */
        /* ... (remains unchanged) ... */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; }
        .toast.show { opacity: 1; bottom: 30px; }
        .toast.success { background-color: var(--success); }
        .toast.error { background-color: var(--danger); }

        /* --- Employee Scheduling Table Refinements --- */
        /* ... (remains unchanged) ... */
        #featureSectionsContainer.employee-scheduling .schedule-controls { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; margin-bottom: 1.5rem; }
        #featureSectionsContainer.employee-scheduling .schedule-controls .week-nav { display: flex; align-items: center; gap: 0.75rem; }
        #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions { display: flex; flex-direction: column; gap: 0.5rem; margin-left: auto; }
        @media (max-width: 768px) { #featureSectionsContainer.employee-scheduling .schedule-controls { flex-direction: column; align-items: stretch; } #featureSectionsContainer.employee-scheduling .schedule-controls .week-nav { justify-content: space-between; width: 100%; } #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions { margin-left: 0; width: 100%; } #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions .btn { width: 100%; justify-content: center; } }
        #featureSectionsContainer.employee-scheduling .schedule-container { margin-top: 1rem; overflow-x: auto; border: 1px solid var(--light-gray); border-radius: 8px; background-color: var(--white); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-container { border-color: var(--light-gray); background-color: var(--light); }
        #featureSectionsContainer.employee-scheduling .schedule-table { width: 100%; min-width: 900px; border-collapse: separate; border-spacing: 0; }
        #featureSectionsContainer.employee-scheduling .schedule-table thead th { padding: 0.8rem 0.75rem; text-align: center; background-color: var(--primary); color: white; font-weight: 600; position: sticky; top: 0; z-index: 10; border-bottom: 2px solid var(--primary-dark); border-right: 1px solid var(--primary-dark); }
        #featureSectionsContainer.employee-scheduling .schedule-table thead th:last-child { border-right: none; }
        #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { position: sticky; left: 0; z-index: 11 !important; border-right: 2px solid var(--primary-dark); background-color: var(--primary); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th { background-color: var(--primary-dark); color: var(--dark); border-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { background-color: var(--primary-dark); border-right: 2px solid var(--light-gray); }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody td { padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--light-gray); border-right: 1px solid var(--light-gray); vertical-align: middle; transition: background-color 0.2s; color: var(--text-color); white-space: nowrap; }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody td:last-child { border-right: none; }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:last-child td { border-bottom: none; }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td { background-color: #f9fafb; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td { background-color: var(--primary-light); }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td { background-color: #f0f9ff; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td { background-color: #475569; }
        #featureSectionsContainer.employee-scheduling .employee-name { font-weight: 600; text-align: left; position: sticky; left: 0; z-index: 5; background-color: var(--white); border-right: 2px solid var(--gray); }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: #f9fafb; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--white); border-right-color: var(--light-gray); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: var(--primary-light); }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: #f0f9ff; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: #475569; }
        #featureSectionsContainer.employee-scheduling .schedule-table tbody td.weekend-cell { background-color: var(--schedule-weekend-bg) !important; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td.weekend-cell { background-color: var(--schedule-weekend-bg) !important; }
        #featureSectionsContainer.employee-scheduling .shift { padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.8rem; font-weight: 500; white-space: nowrap; display: inline-block; min-width: 70px; border: 1px solid transparent; cursor: default; }
        #featureSectionsContainer.employee-scheduling .shift.editable { cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        #featureSectionsContainer.employee-scheduling .shift.editable:hover { transform: scale(1.05); box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
        #featureSectionsContainer.employee-scheduling .shift-weekend-off { color: var(--schedule-weekend-text); background-color: transparent !important; font-style: italic; border: none; cursor: default; font-weight: normal; }
        #featureSectionsContainer.employee-scheduling .shift-morning { background-color: var(--shift-morning-bg); color: var(--shift-morning-text); border-color: var(--shift-morning-border); }
        #featureSectionsContainer.employee-scheduling .shift-afternoon { background-color: var(--shift-afternoon-bg); color: var(--shift-afternoon-text); border-color: var(--shift-afternoon-border); }
        #featureSectionsContainer.employee-scheduling .shift-night { background-color: var(--shift-night-bg); color: var(--shift-night-text); border-color: var(--shift-night-border); }
        #featureSectionsContainer.employee-scheduling .shift-off { background-color: var(--shift-off-bg); color: var(--shift-off-text); border-color: var(--shift-off-border); }
        #featureSectionsContainer.employee-scheduling .shift-sick { background-color: var(--shift-sick-bg); color: var(--shift-sick-text); border-color: var(--shift-sick-border); }
        #featureSectionsContainer.employee-scheduling .shift-vacation { background-color: var(--shift-vacation-bg); color: var(--shift-vacation-text); border-color: var(--shift-vacation-border); }
        #featureSectionsContainer.employee-scheduling .day-header { display: flex; flex-direction: column; gap: 0.25rem; align-items: center; }
        #featureSectionsContainer.employee-scheduling .day-name { font-weight: 600; font-size: 0.9rem; color: inherit; }
        #featureSectionsContainer.employee-scheduling .day-date { font-size: 0.8rem; opacity: 0.8; color: inherit; }

        /* --- Appearance & Theme Refinements --- */
        /* ... (remains unchanged) ... */
        #preferencesPanel .theme-options-container { display: flex; gap: 1.5rem; margin-top: 0.5rem; flex-wrap: wrap; justify-content: flex-start; margin-bottom: 1.5rem; padding: 0.5rem 0; }
        #preferencesPanel .theme-option { display: flex; flex-direction: column; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 8px; transition: background-color 0.2s, box-shadow 0.2s; min-width: 100px; border: 2px solid transparent; background-color: var(--light); }
        body.dark-theme #preferencesPanel .theme-option { background-color: var(--light); }
        #preferencesPanel .theme-option:hover { background-color: var(--primary-light); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        body.dark-theme #preferencesPanel .theme-option:hover { background-color: var(--light-gray); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #preferencesPanel .theme-option.selected { border-color: var(--primary); background-color: var(--primary-light); }
        body.dark-theme #preferencesPanel .theme-option.selected { background-color: var(--primary-dark); border-color: var(--primary); }
        #preferencesPanel .theme-option .theme-preview { width: 60px; height: 40px; border: 1px solid var(--gray); border-radius: 6px; transition: border-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-bottom: 0.75rem; background-color: var(--white); overflow: hidden; }
        #preferencesPanel .theme-option .theme-label { text-align: center; display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-color); }
        body.dark-theme #preferencesPanel .theme-option .theme-label { color: var(--text-color); }
        #preferencesPanel .theme-preview.light-preview { background-color: #f8fafc; color: #1e293b; border-color: var(--light-gray);}
        #preferencesPanel .theme-preview.dark-preview { background-color: #0f172a; color: #e2e8f0; border-color: var(--gray);}
        #preferencesPanel .theme-preview.system-preview { background: linear-gradient(45deg, #f8fafc 50%, #0f172a 50%); color: var(--gray); border-color: var(--gray);}
        body.dark-theme #preferencesPanel .theme-preview { border-color: var(--light-gray); }
        body.dark-theme #preferencesPanel .theme-preview.light-preview { background: var(--light) !important; color: var(--dark); border-color: var(--light-gray);}
        body.dark-theme #preferencesPanel .theme-preview.dark-preview { background: var(--white) !important; color: var(--dark); border-color: var(--gray);}
        body.dark-theme #preferencesPanel .theme-preview.system-preview { background: linear-gradient(45deg, var(--light) 50%, var(--white) 50%) !important; color: var(--gray); border-color: var(--gray);}

        /* --- Responsive --- */
        /* ... (remains unchanged) ... */
         @media (max-width: 992px) {
             .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; }
             .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
             .main-content { margin-left: 0; }
             .search-bar { width: 250px; }
             .main-content.sidebar-active { margin-left: 250px; }
             .sidebar-toggle { display: block; position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
             .top-nav { padding-left: 60px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-list { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
            #featureSectionsContainer.task-management-feature .task-management-content .container { padding: 20px; }
            #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
            #featureSectionsContainer.projects-feature .projects-header { flex-direction: column; align-items: stretch; }
            #featureSectionsContainer.projects-feature .projects-title-wrapper { width: auto; }
            #featureSectionsContainer.projects-feature .project-controls { justify-content: flex-start; }
            #featureSectionsContainer.file-sharing-feature .filters-section .row { display: flex; flex-direction: column; } /* Stack filters */
            #featureSectionsContainer.file-sharing-feature .filters-section .col-md-1 { text-align: left !important; margin-top: 0.5rem; } /* Align reset button */
         }
         @media (min-width: 993px) { .sidebar-toggle { display: none; } }
         @media (max-width: 768px) {
             .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; }
             .search-bar { width: 100%; order: 2; }
             .user-menu { width: 100%; justify-content: space-between; order: 1; }
             .content-area { padding: 1.5rem; }
             .data-form { grid-template-columns: 1fr; }
             .form-actions { grid-column: span 1; }
             .user-info { flex-direction: column; text-align: center; }
             .user-info-avatar { margin-bottom: 1rem; }
             .stats-section { grid-template-columns: 1fr; }
             .settings-tabs { flex-wrap: nowrap; overflow-x: auto; }
             .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; }
             .confirm-container { width: 90%; }
             #settingsContent .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
             #settingsContent .member-role { margin: 0.5rem 0; }
             #settingsContent .member-actions { margin-top: 0.5rem; width: 100%; justify-content: flex-end; }
             .profile-avatar-section { margin-bottom: 1.5rem; }
             #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; }
             .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; }
             .add-member-form .data-form > div { margin-bottom: 1rem; }
             .add-member-form .data-form > div:last-child { margin-top: 0; }
             #featureSectionsContainer.employee-scheduling .schedule-controls { flex-direction: column; gap: 1rem; align-items: stretch; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .week-nav { justify-content: space-between; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions { margin-left: 0; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions .btn { width: 100%; justify-content: center; }
             #featureSectionsContainer.employee-scheduling .schedule-page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
             #featureSectionsContainer.employee-scheduling .schedule-table { border-spacing: 0; }
             #featureSectionsContainer.employee-scheduling .schedule-table thead th, #featureSectionsContainer.employee-scheduling .schedule-table tbody td { white-space: nowrap; }
             #featureSectionsContainer.employee-scheduling .employee-name { position: sticky !important; left: 0; z-index: 5 !important; border-right: 1px solid var(--feature-projects-border-color); background-color: var(--white); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--white); border-right-color: var(--light-gray); }
             #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { position: sticky !important; left: 0; z-index: 11 !important; background-color: var(--primary); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { background-color: var(--primary-dark); }
             #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: #f9fafb; }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: var(--primary-light); }
             #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: #f0f9ff; }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: #475569; }
             .modal-content { width: 95%; padding: 1.5rem;}
             .notifications-container { width: 100%; max-width: 100%; }
             .sidebar-toggle { top: 10px; left: 10px; }
             .top-nav { padding-top: 60px; }
            #featureSectionsContainer.task-management-feature .task-management-content .controls { flex-direction: column; align-items: stretch; gap: 10px; }
            #featureSectionsContainer.task-management-feature .task-management-content .search-container { margin: 0; }
            #featureSectionsContainer.task-management-feature .task-management-content #add-task-btn { width: 100%; margin-left: 0; order: -1; margin-bottom: 10px; }
            #featureSectionsContainer.task-management-feature .task-management-content .filters { flex-direction: column; width: 100%; gap: 10px; }
            #featureSectionsContainer.task-management-feature .task-management-content .filters select { width: 100%; min-width: unset; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-list { grid-template-columns: 1fr; }
            #featureSectionsContainer.task-management-feature .modal-content { width: 95%; padding: 20px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-row { flex-direction: column; gap: 15px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-row > div { min-width: unset; }
            #featureSectionsContainer.task-management-feature .task-management-content h1 { font-size: 1.8em; }
             #featureSectionsContainer.team-members-feature .team-content-area, #featureSectionsContainer.team-members-feature .team-members-section-header { padding-left: 15px; padding-right: 15px; }
             #featureSectionsContainer.team-members-feature .team-members-section-header h2 { font-size: 1.5rem;}
             #featureSectionsContainer.team-members-feature .team-members-section-header { padding-top: 18px; padding-bottom: 18px; flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.team-members-feature .team-filter { max-width: none; }
             #featureSectionsContainer.team-members-feature .team-member-card { flex-direction: column; align-items: flex-start; }
            #featureSectionsContainer.projects-feature .projects-list { grid-template-columns: 1fr; gap: 20px; }
            #featureSectionsContainer.projects-feature .project-controls { flex-direction: column; align-items: stretch; }
            #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select, #featureSectionsContainer.projects-feature .add-project-btn { width: 100%; box-sizing: border-box; }
            #featureSectionsContainer.projects-feature .project-card-image { height: 160px; }
            #featureSectionsContainer.projects-feature .project-name { font-size: 1.25em; }
            #featureSectionsContainer.projects-feature .project-actions .btn { padding: 7px 12px; font-size: 0.8em; }
             #preferencesPanel .theme-options-container { justify-content: center; }
             #featureSectionsContainer.file-sharing-feature .filters-section .row > div { margin-bottom: 0.75rem; }
         }
         @media (max-width: 480px) {
             .section-header > div { justify-content: center; width: 100%; }
             .welcome-section { padding: 1.5rem; }
             .stats-section { gap: 0.75rem; }
             .stat-card { padding: 1rem; }
             .user-menu { gap: 1rem; }
             .user-name { display: none; }
             .user-status { margin-left: 0; }
             .notifications-footer { flex-direction: column; gap: 0.5rem; }
             .notifications-footer .btn { width: 100%; justify-content: center; }
            #featureSectionsContainer.task-management-feature { padding: 10px; }
            #featureSectionsContainer.task-management-feature .task-management-content { padding: 15px; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn { font-size: 0.95em; padding: 9px 15px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-actions .btn { padding: 10px 20px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card { padding: 15px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card h3 { font-size: 1.15em; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card p, #featureSectionsContainer.task-management-feature .task-management-content .task-card .description, #featureSectionsContainer.task-management-feature .task-management-content .task-meta { font-size: 0.9em; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions button { font-size: 1.1em; margin-left: 8px; }
            #featureSectionsContainer.task-management-feature .modal-content { padding: 20px 15px; }
            #featureSectionsContainer.task-management-feature .modal-content #modal-title { font-size: 1.5em; margin-bottom: 20px; }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: 1fr; gap: 15px; }
             #featureSectionsContainer.team-members-feature .team-member-card { padding: 18px; }
             #featureSectionsContainer.team-members-feature .member-name { font-size: 1.1rem; }
             #featureSectionsContainer.team-members-feature .member-email { font-size: 0.85rem; margin-bottom: 12px; }
             #featureSectionsContainer.team-members-feature .member-role { font-size: 0.8rem; padding: 3px 8px; }
            #featureSectionsContainer.projects-feature .project-actions .btn { flex-grow: 1; justify-content: center; }
            #featureSectionsContainer.file-sharing-feature .action-buttons { display: flex; flex-wrap: wrap; justify-content: center; }
            #featureSectionsContainer.file-sharing-feature .action-buttons .btn { margin: 2px; }
            #featureSectionsContainer.file-sharing-feature .fancy-header-title { font-size: 1rem; padding: 8px 15px; }
         }

        /* --- START: Team Members Styles --- */
        /* ... (remains unchanged) ... */
        #featureSectionsContainer.team-members-feature .team-members-section { background-color: var(--feature-team-bg); border-radius: var(--feature-team-card-border-radius); max-width: 1200px; margin: 0 auto; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06); overflow: hidden; border: 1px solid var(--feature-team-border-color); }
        #featureSectionsContainer.team-members-feature .team-members-section-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; background-color: var(--feature-team-title-bg); color: var(--feature-team-title-text); margin: 0; padding: 1.1rem var(--feature-team-section-padding); font-weight: 600; text-align: left; letter-spacing: 0.3px; border-bottom: 1px solid var(--feature-team-border-color); }
        #featureSectionsContainer.team-members-feature .team-members-section-header h2 { font-size: 1.5rem; margin: 0; }
        #featureSectionsContainer.team-members-feature .team-content-area { padding: var(--feature-team-section-padding); }
        #featureSectionsContainer.team-members-feature .team-filter { margin-bottom: 1.5rem; max-width: 400px; }
        #featureSectionsContainer.team-members-feature .team-filter input[type="text"] { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--feature-team-border-color); border-radius: 6px; background-color: var(--white); box-sizing: border-box; font-size: 0.95rem; transition: border-color 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.03); color: var(--text-color); }
        #featureSectionsContainer.team-members-feature .team-filter input[type="text"]::placeholder { color: var(--gray); }
        #featureSectionsContainer.team-members-feature .team-filter input[type="text"]:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        #featureSectionsContainer.team-members-feature .team-members-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--feature-team-grid-gap); }
        #featureSectionsContainer.team-members-feature .team-member-card { display: flex; flex-direction: column; align-items: flex-start; background-color: var(--feature-team-card-bg); border: 1px solid var(--feature-team-border-color); border-radius: var(--feature-team-card-border-radius); padding: var(--feature-team-card-padding); box-shadow: 0 3px 8px var(--feature-team-shadow-color); transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out; overflow: hidden; }
        #featureSectionsContainer.team-members-feature .team-member-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px var(--feature-team-hover-shadow-color); border-color: var(--gray); }
        #featureSectionsContainer.team-members-feature .member-info { width: 100%; }
        #featureSectionsContainer.team-members-feature .member-name { font-size: 1.15rem; font-weight: 600; color: var(--feature-team-text-primary); margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #featureSectionsContainer.team-members-feature .member-email { font-size: 0.88rem; color: var(--feature-team-text-secondary); margin: 0 0 14px 0; word-break: break-all; line-height: 1.4; }
        #featureSectionsContainer.team-members-feature .member-role { font-size: 0.85rem; font-weight: 500; margin: 0; padding: 4px 10px; border-radius: 6px; display: inline-block; line-height: 1.3; color: #fff; }
        #featureSectionsContainer.team-members-feature .member-role.role-admin { background-color: var(--feature-team-admin-color); }
        #featureSectionsContainer.team-members-feature .member-role.role-supervisor { background-color: var(--feature-team-supervisor-color); }
        #featureSectionsContainer.team-members-feature .member-role.role-senior { background-color: var(--feature-team-senior-color); }
        #featureSectionsContainer.team-members-feature .member-role.role-member { background-color: var(--feature-team-member-color); }
        #featureSectionsContainer.team-members-feature .team-member-card.hidden-by-filter { display: none; }

        /* --- START: Adapted Projects Styles --- */
        /* ... (remains unchanged) ... */
        #featureSectionsContainer.projects-feature #projects-section { width: 100%; max-width: 1200px; margin: 0 auto; }
        #featureSectionsContainer.projects-feature .projects-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 30px; gap: 20px; }
        #featureSectionsContainer.projects-feature .projects-title-wrapper { background-color: var(--feature-projects-card-bg); padding: 15px 25px; border-radius: 8px; box-shadow: 0 2px 4px var(--feature-projects-shadow-color); flex-grow: 1; border-left: 5px solid var(--feature-projects-primary-color); transition: background-color 0.3s ease, border-color 0.3s ease; }
        #featureSectionsContainer.projects-feature .projects-title-wrapper h2 { color: var(--feature-projects-heading-color); margin: 0; font-weight: 600; font-size: 1.8em; transition: color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-controls { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; padding: 10px; background-color: var(--feature-projects-card-bg); border-radius: 8px; box-shadow: 0 2px 4px var(--feature-projects-shadow-color); transition: background-color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select { padding: 9px 13px; border: 1px solid var(--feature-projects-input-border); border-radius: 6px; font-size: 0.9em; background-color: var(--feature-projects-input-bg); color: var(--feature-projects-text-color); transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-search-input:focus, #featureSectionsContainer.projects-feature .project-filter-select:focus { outline: none; border-color: var(--feature-projects-input-focus-border); box-shadow: 0 0 0 0.2rem var(--feature-projects-input-focus-shadow); }
        #featureSectionsContainer.projects-feature .project-search-input { min-width: 200px; }
        #featureSectionsContainer.projects-feature .project-filter-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px; padding-right: 2.5rem; }
        body.dark-theme #featureSectionsContainer.projects-feature .project-filter-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23cccccc' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); }
        #featureSectionsContainer.projects-feature .add-project-btn { background-color: var(--feature-projects-primary-color); color: var(--feature-projects-primary-text); }
        #featureSectionsContainer.projects-feature .add-project-btn:hover { background-color: var(--feature-projects-primary-hover); box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3); }
        #featureSectionsContainer.projects-feature .projects-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        #featureSectionsContainer.projects-feature .project-card { background-color: var(--feature-projects-card-bg); border-radius: 12px; border: 1px solid var(--feature-projects-border-color); box-shadow: 0 6px 12px var(--feature-projects-shadow-color); overflow: hidden; display: flex; flex-direction: column; transition: transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out, background-color 0.3s ease, border-color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-card:hover { transform: translateY(-6px) scale(1.01); box-shadow: 0 10px 20px var(--feature-projects-shadow-hover-color); }
        #featureSectionsContainer.projects-feature .project-card-image { height: 180px; background-size: cover; background-position: center; position: relative; }
        #featureSectionsContainer.projects-feature .project-card-body { padding: 25px; display: flex; flex-direction: column; flex-grow: 1; }
        #featureSectionsContainer.projects-feature .project-name { font-size: 1.4em; font-weight: 600; color: var(--feature-projects-heading-color); margin-top: 0; margin-bottom: 10px; transition: color 0.3s ease; }
        #featureSectionsContainer.projects-feature .progress-bar-container { width: 100%; height: 10px; background-color: var(--feature-projects-progress-bar-bg); border-radius: 5px; overflow: hidden; margin-bottom: 20px; transition: background-color 0.3s ease; }
        #featureSectionsContainer.projects-feature .progress-bar { height: 100%; background-color: var(--feature-projects-primary-color); border-radius: 5px; transition: width 0.4s ease, background-color 0.3s ease; text-align: center; color: var(--feature-projects-primary-text); font-size: 0.75em; font-weight: 500; line-height: 10px; display: flex; align-items: center; justify-content: center; }
        #featureSectionsContainer.projects-feature .status-completed ~ .progress-bar-container .progress-bar { background-color: var(--feature-projects-success-progress); color: var(--feature-projects-primary-text); }
        #featureSectionsContainer.projects-feature .status-in-progress ~ .progress-bar-container .progress-bar { background-color: var(--feature-projects-warning-progress); color: var(--feature-projects-warning-btn-text); }
        #featureSectionsContainer.projects-feature .status-active ~ .progress-bar-container .progress-bar { background-color: var(--feature-projects-info-progress); color: var(--feature-projects-primary-text); }
        #featureSectionsContainer.projects-feature .status-pending ~ .progress-bar-container .progress-bar { background-color: var(--feature-projects-secondary-progress); color: var(--feature-projects-primary-text); }
        #featureSectionsContainer.projects-feature .project-info { font-size: 0.9em; color: var(--feature-projects-text-muted); margin-bottom: 12px; line-height: 1.6; display: flex; align-items: flex-start; transition: color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-info i { margin-right: 10px; color: var(--feature-projects-text-muted); width: 18px; text-align: center; margin-top: 3px; transition: color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-participants span { display: inline-block; background-color: color-mix(in srgb, var(--feature-projects-card-bg) 80%, var(--feature-projects-text-muted) 20%); color: var(--feature-projects-text-color); padding: 4px 10px; border-radius: 15px; font-size: 0.8em; margin-right: 6px; margin-bottom: 6px; white-space: nowrap; border: 1px solid var(--feature-projects-border-color); transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
        #featureSectionsContainer.projects-feature .project-participants .participant-list { flex: 1; }
        #featureSectionsContainer.projects-feature .project-status { display: inline-block; padding: 6px 14px; border-radius: 15px; font-size: 0.8em; font-weight: 600; text-transform: uppercase; margin-bottom: 15px; align-self: flex-start; transition: background-color 0.3s ease, color 0.3s ease; }
        #featureSectionsContainer.projects-feature .status-completed { background-color: var(--feature-projects-success-bg); color: var(--feature-projects-success-text); }
        #featureSectionsContainer.projects-feature .status-in-progress { background-color: var(--feature-projects-warning-bg); color: var(--feature-projects-warning-text); }
        #featureSectionsContainer.projects-feature .status-active { background-color: var(--feature-projects-info-bg); color: var(--feature-projects-info-text); }
        #featureSectionsContainer.projects-feature .status-pending { background-color: var(--feature-projects-secondary-bg); color: var(--feature-projects-secondary-text); }
        #featureSectionsContainer.projects-feature .project-actions { margin-top: auto; padding-top: 15px; border-top: 1px solid var(--feature-projects-border-color); display: flex; gap: 10px; transition: border-color 0.3s ease; flex-wrap: wrap; }
        #featureSectionsContainer.projects-feature .project-actions .btn { font-size: 0.85em; }
        #featureSectionsContainer.projects-feature .project-actions .btn i { font-size: 0.9em; }
        #featureSectionsContainer.projects-feature .btn-view { background-color: var(--feature-projects-primary-color); color: var(--feature-projects-primary-text); }
        #featureSectionsContainer.projects-feature .btn-view:hover { background-color: var(--feature-projects-primary-hover); }
        #featureSectionsContainer.projects-feature .btn-edit { background-color: var(--feature-projects-warning-progress); color: var(--feature-projects-warning-btn-text); }
        #featureSectionsContainer.projects-feature .btn-edit:hover { background-color: color-mix(in srgb, var(--feature-projects-warning-progress) 90%, black 10%); }
        #featureSectionsContainer.projects-feature .btn-delete { background-color: var(--feature-projects-danger-color); color: var(--feature-projects-danger-text); }
        #featureSectionsContainer.projects-feature .btn-delete:hover { background-color: var(--feature-projects-danger-hover); }
        #featureSectionsContainer.projects-feature .btn:disabled, #featureSectionsContainer.projects-feature .btn[disabled] { opacity: 0.5; cursor: not-allowed; box-shadow: none; background-color: var(--feature-projects-secondary-progress); color: var(--feature-projects-secondary-text); }

        /* --- START: File Sharing Feature Styles --- */
        /* ... (remains unchanged) ... */
        #featureSectionsContainer.file-sharing-feature .card { border: none; border-radius: 8px; background-color: var(--white); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
        #featureSectionsContainer.file-sharing-feature .card-header { background-color: var(--white); border-bottom: 1px solid var(--light-gray); padding: 1rem 1.5rem; }
        #featureSectionsContainer.file-sharing-feature .fancy-header-title { background: var(--file-share-header-bg); color: var(--white); padding: 10px 20px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.1rem; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease; }
        #featureSectionsContainer.file-sharing-feature .fancy-header-title:hover { transform: scale(1.02); }
        #featureSectionsContainer.file-sharing-feature .card-header .d-flex { align-items: center; }
        #featureSectionsContainer.file-sharing-feature .file-icon { font-size: 1.6rem; vertical-align: middle; margin-right: 10px; width: 25px; text-align: center; }
        #featureSectionsContainer.file-sharing-feature .file-icon.text-danger { color: var(--danger) !important; }
        #featureSectionsContainer.file-sharing-feature .file-icon.text-success { color: var(--success) !important; }
        #featureSectionsContainer.file-sharing-feature .file-icon.text-warning { color: var(--warning) !important; }
        #featureSectionsContainer.file-sharing-feature .file-icon.text-primary { color: var(--primary) !important; }
        #featureSectionsContainer.file-sharing-feature .file-icon.text-info { color: var(--info) !important; }
        #featureSectionsContainer.file-sharing-feature .action-buttons .btn { margin: 0 3px; transition: all 0.2s ease-in-out; border-radius: 50px; padding: 0.25rem 0.6rem; font-size: 0.8rem; }
         #featureSectionsContainer.file-sharing-feature .action-buttons .btn:hover { transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #featureSectionsContainer.file-sharing-feature .action-btn .loading-spinner { display: none; margin: 0 2px; }
        #featureSectionsContainer.file-sharing-feature .action-btn.loading .original-icon { display: none; }
        #featureSectionsContainer.file-sharing-feature .action-btn.loading .loading-spinner { display: inline-block; }
        #featureSectionsContainer.file-sharing-feature .filters-section { background-color: var(--light); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--light-gray); margin-bottom: 1.5rem; }
        #featureSectionsContainer.file-sharing-feature .filters-section .form-label { font-size: 0.8rem; color: var(--gray); margin-bottom: 0.25rem; }
        #featureSectionsContainer.file-sharing-feature .filters-section .form-control-sm, #featureSectionsContainer.file-sharing-feature .filters-section .form-select-sm { font-size: 0.875rem; padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--light-gray); background-color: var(--white); color: var(--text-color); }
        #featureSectionsContainer.file-sharing-feature .filters-section .form-control-sm:focus, #featureSectionsContainer.file-sharing-feature .filters-section .form-select-sm:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        #featureSectionsContainer.file-sharing-feature #recentUploadsSection { background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; padding: 1rem 1.25rem; }
        #featureSectionsContainer.file-sharing-feature #recentUploadsSection h6 { color: var(--primary); margin-bottom: 10px; font-weight: 600; }
        #featureSectionsContainer.file-sharing-feature #recentUploadsSection .list-group-item { border-bottom: 1px dashed var(--light-gray) !important; padding: 8px 0 !important; background-color: transparent !important; border-top: none !important; border-left: none !important; border-right: none !important; }
         #featureSectionsContainer.file-sharing-feature #recentUploadsSection .list-group-item:last-child { border-bottom: 0 !important; }
        #featureSectionsContainer.file-sharing-feature .time-ago { font-style: normal; font-size: 0.85em; color: var(--gray); }
        #featureSectionsContainer.file-sharing-feature .table { margin-bottom: 0; background-color: var(--white); }
        #featureSectionsContainer.file-sharing-feature .table thead { background-color: var(--light) !important; color: var(--gray); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.5px; border-bottom: 2px solid var(--light-gray); }
        #featureSectionsContainer.file-sharing-feature .table tbody tr td { vertical-align: middle; padding: 0.85rem 0.75rem; border-bottom: 1px solid var(--light-gray); }
        #featureSectionsContainer.file-sharing-feature .table tbody tr:last-child td { border-bottom: none; }
        #featureSectionsContainer.file-sharing-feature .table-hover > tbody > tr:hover > * { background-color: var(--file-share-hover-bg) !important; cursor: default; }
        #featureSectionsContainer.file-sharing-feature .file-name { font-weight: 500; color: var(--text-color); }
        #featureSectionsContainer.file-sharing-feature .badge { font-size: 0.75em; padding: 0.35em 0.6em; font-weight: 500; border-radius: 4px; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-primary { background-color: var(--primary) !important; color: var(--white) !important; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-secondary { background-color: var(--gray) !important; color: var(--white) !important; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-success { background-color: var(--success) !important; color: var(--white) !important; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-danger { background-color: var(--danger) !important; color: var(--white) !important; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-warning { background-color: var(--warning) !important; color: var(--dark) !important; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-info { background-color: var(--info) !important; color: var(--white) !important; }
        #featureSectionsContainer.file-sharing-feature .badge.text-bg-dark { background-color: var(--dark) !important; color: var(--light) !important; }
        #featureSectionsContainer.file-sharing-feature .upload-area { border: 2px dashed var(--primary); padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer; background-color: var(--light); border-radius: 8px; transition: background-color 0.2s ease, border-color 0.2s ease; }
        #featureSectionsContainer.file-sharing-feature .upload-area:hover { background-color: var(--file-share-hover-bg); border-color: color-mix(in srgb, var(--primary) 80%, white 20%); }
        #featureSectionsContainer.file-sharing-feature .upload-area i { color: var(--primary); }
        #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar.bg-success { background-color: var(--success) !important; }
        #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar.bg-danger { background-color: var(--danger) !important; }
        #featureSectionsContainer.file-sharing-feature #uploadProgressContainer .progress-bar { background-color: var(--primary) !important; }
        .swal2-popup { font-size: 0.9rem !important; border-radius: 8px !important; background-color: var(--white) !important; color: var(--text-color) !important; border: 1px solid var(--light-gray) !important; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;}
        .swal2-title { color: var(--text-color) !important; }
        .swal2-html-container { color: var(--gray) !important; }
        .swal2-confirm { background-color: var(--success) !important; color: var(--white) !important; border: none !important; box-shadow: none !important; }
        .swal2-cancel { background-color: var(--danger) !important; color: var(--white) !important; border: none !important; box-shadow: none !important; }
        .swal2-actions { gap: 0.75rem !important; }
        body.dark-theme .swal2-popup { background-color: var(--light) !important; color: var(--text-color) !important; border-color: var(--light-gray) !important; }
        body.dark-theme .swal2-title { color: var(--text-color) !important; }
        body.dark-theme .swal2-html-container { color: var(--gray) !important; }
        /* --- END: File Sharing Feature Styles --- */

    </style>
</head>
<body class="">

    <audio id="notificationSound" preload="auto">
        <source src="assets/notification.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar"> <i class="fas fa-bars"></i> </button>

    <div class="toast" id="toastMessage">Toast message</div>
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Action successful!</span> </div>

    <aside class="sidebar" id="sidebar">
        <!-- Sidebar content remains unchanged -->
         <div class="sidebar-header"> <div class="logo"> <i class="fas fa-users-cog logo-icon"></i> <span>TeamFlow</span> </div> <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar" style="display: none; background: none; border: none; color: white; font-size: 1.2rem; position: absolute; top: 1.5rem; right: 1rem;"> <i class="fas fa-times"></i> </button> </div>
         <div class="sidebar-menu">
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>
             <div class="menu-title">Core Features</div>
             <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-folder-open"></i><span>File Sharing</span></a>
             <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <div class="menu-title">Team Tools</div>
             <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
             <a href="#deadline-tracking" class="menu-item" data-feature="deadline-tracking"><i class="fas fa-clock"></i><span>Deadline Tracking</span></a>
             <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>
             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
         <div class="connection-status"> <div class="status-dot"></div> <span>Online</span> </div>
    </aside>

    <main class="main-content" id="mainContent">
         <nav class="top-nav">
             <!-- Top Nav content remains unchanged -->
             <div class="search-bar"> <i class="fas fa-search search-icon"></i> <input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off"> <div class="search-results" id="searchResults"></div> </div>
             <div class="user-menu"> <div class="notification-icon" id="notificationIcon"> <i class="fas fa-bell"></i> <span class="notification-badge" id="notificationBadge" style="display: none;">0</span> </div> <div class="user-profile" id="userProfileContainer"> <div class="user-avatar" id="userAvatar">ME</div> <div class="user-profile-details"> <span class="user-name" id="userName">Loading...</span> <span class="user-status"> • Connected</span> </div> <div class="user-dropdown" id="userDropdown"> <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a> <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a> <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a> </div> </div> </div>
         </nav>

         <div class="content-area">
             <div class="back-button" id="backButton" style="display: none;"> <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span> </div>

             <!-- Static Sections -->
             <div id="dashboardContent" class="content-section active"> <!-- Dashboard starts active -->
                 <!-- Dashboard content remains unchanged -->
                <div class="welcome-section" id="welcomeSection"> <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2> <p class="welcome-subtitle">Here's what's happening.</p> <div class="user-info"> <div class="user-info-avatar" id="profileAvatar">U</div> <div class="user-info-details"> <div class="user-info-name" id="userInfoName">Loading...</div> <div class="user-info-title" id="userInfoRoleTitle">Loading...</div> <div class="user-info-email"> <i class="fas fa-envelope"></i> <span id="userEmail">loading...</span> </div> </div> </div> </div>
                <div class="stats-section" id="statsSection"> <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div> <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div> <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div> <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div> </div>
                <div class="activity-section"> <div class="section-header"> <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3> <div> <span class="view-all" id="viewAllActivity">Show All</span> <span class="delete-all" id="deleteAllActivity">Delete All</span> </div> </div> <ul class="activity-list" id="activityList"> <li style="text-align: center; padding: 2rem; color: var(--gray);"> Loading activities... </li> </ul> </div>
             </div>
             <div id="profileContent" class="content-section">
                 <!-- Profile content remains unchanged -->
                <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                <p class="profile-header-text">Your personal info.</p>
                <div class="profile-avatar-section"> <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color);">Avatar</label> <div id="profileAvatarLarge" title="Click to upload photo">ME</div> <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;"> </div>
                <form class="data-form" id="profileForm"> <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control" value=""> </div> <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control" value=""> </div> <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" value="" readonly> </div> <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control" value=""> </div> <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" value="" readonly> </div> <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control" value=""> </div> <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control" value=""> </div> <div class="form-actions"> <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button> <button type="submit" class="btn btn-primary" id="saveProfileBtn"> <span class="btn-text">Save Changes</span> <span class="spinner" style="display: none;"></span> </button> </div> </form>
             </div>
             <div id="settingsContent" class="content-section">
                 <!-- Settings content remains unchanged -->
                <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                <div class="settings-tabs"> <div class="settings-tab active" data-tab="preferences">Preferences</div> <div class="settings-tab" data-tab="account">Account</div> <div class="settings-tab" data-tab="security">Security</div> <div class="settings-tab" data-tab="notifications">Notifications</div> <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div> <div class="settings-tab" data-tab="collaboration">Collaboration</div> <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div> </div>
                <div class="settings-panel active" id="preferencesPanel"> <!-- Preferences Content --> <div class="settings-subsection"> <h4>Appearance</h4> <div class="form-group"> <label class="settings-label">Theme</label> <div class="theme-options-container"> <div class="theme-option" data-theme="light"> <div class="theme-preview light-preview"><i class="fas fa-sun"></i></div> <span class="theme-label">Light</span> </div> <div class="theme-option" data-theme="dark"> <div class="theme-preview dark-preview"><i class="fas fa-moon"></i></div> <span class="theme-label">Dark</span> </div> <div class="theme-option" data-theme="system"> <div class="theme-preview system-preview"><i class="fas fa-desktop"></i></div> <span class="theme-label">System</span> </div> </div> </div> <div class="setting-item"> <div><span class="setting-item-label">High Contrast Mode</span><p class="setting-item-description">Increase visibility.</p></div> <div class="setting-item-control"> <label class="switch"><input type="checkbox" id="highContrastToggle"><span class="slider round"></span></label> </div> </div> </div> <div class="settings-subsection"> <h4>Localization</h4> <div class="data-form" style="grid-template-columns: 1fr 1fr;"> <div class="form-group"> <label for="languageSelect">Language</label> <select id="languageSelect" class="form-control"> <option value="en">English (US)</option> <option value="ar">العربية (Arabic)</option> <option value="es">Español (Spanish)</option> </select> </div> <div class="form-group"> <label for="regionSelect">Region / Timezone</label> <select id="regionSelect" class="form-control"> <option value="utc">UTC</option> <option value="est">EST (UTC-5)</option> <option value="pst">PST (UTC-8)</option> <option value="cet">CET (UTC+1)</option> <option value="eet">EET (UTC+2)</option> <option value="ast">AST (UTC+3)</option> </select> </div> </div> <div class="data-form" style="grid-template-columns: 1fr 1fr;"> <div class="form-group"> <label for="timeFormatSelect">Time Format</label> <select id="timeFormatSelect" class="form-control"> <option value="12h">12-hour</option> <option value="24h">24-hour</option> </select> </div> <div class="form-group"> <label for="dateFormatSelect">Date Format</label> <select id="dateFormatSelect" class="form-control"> <option value="MM/DD/YYYY">MM/DD/YYYY</option> <option value="DD/MM/YYYY">DD/MM/YYYY</option> <option value="YYYY-MM-DD">YYYY-MM-DD</option> <option value="Month D, YYYY">Month D, YYYY</option> </select> </div> </div> </div> <div class="settings-subsection"> <h4>Messages & Sounds</h4> <div class="setting-item"> <div><span class="setting-item-label">Toast Notifications</span><p class="setting-item-description">Show brief confirmations.</p></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="toastToggle" checked> <span class="slider round"></span> </label> </div> </div> <div class="setting-item"> <div><span class="setting-item-label">Sound Notifications</span><p class="setting-item-description">Play notification sounds.</p></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="soundToggle" checked> <span class="slider round"></span> </label> </div> </div> <div class="form-group"> <label for="notificationToneSelect">Notification Tone</label> <select id="notificationToneSelect" class="form-control" disabled> <option value="default">Default</option> </select> <p class="setting-item-description">Select sound.</p> </div> <div class="form-group"> <label class="settings-label">Keyboard Shortcuts</label> <p class="setting-item-description">View shortcuts.</p> <button class="btn btn-outline btn-sm" disabled>View</button> </div> </div> <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="savePreferencesBtn">Save Preferences</button> </div> </div>
                <div class="settings-panel" id="accountPanel"> <!-- Account Content --> <div class="settings-subsection"> <h4>Account Information</h4> <div class="data-form"> <div class="form-group"> <label for="accountEmail">Current Email</label> <input type="email" id="accountEmail" class="form-control" value="" readonly> </div> <div class="form-group"> <label for="changeEmail">New Email Address</label> <input type="email" id="changeEmail" class="form-control" placeholder="Enter new email" disabled> <p class="setting-item-description">Backend required.</p> </div> <div class="form-group" style="grid-column: span 2;"> <label for="accountConfirmPassword">Confirm Password</label> <input type="password" id="accountConfirmPassword" class="form-control" placeholder="Enter current password" disabled> </div> <div class="form-actions" style="grid-column: span 2;"> <button type="button" class="btn btn-primary" id="saveAccountEmailBtn" disabled>Change Email</button> </div> </div> <p style="margin-top: 1rem;">Password changes: <a href="#settings-security" data-feature="settings" data-tab-target="security" class="settings-link">Security Tab</a>.</p> </div> <div class="settings-subsection"> <h4>Account Notifications</h4> <div class="setting-item"> <div><span class="setting-item-label">Enable Account Emails</span><p class="setting-item-description">Receive alerts for important account activity.</p></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="accountNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div> </div> <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveAccountSettingsBtn">Save Account Settings</button> </div> </div>
                <div class="settings-panel" id="securityPanel"> <!-- Security Content --> <div class="settings-subsection"> <h4>Password</h4> <form class="data-form" id="changePasswordForm"> <div class="form-group"> <label for="currentPassword">Current Password</label> <input type="password" id="currentPassword" class="form-control"> </div> <div class="form-group"> <label for="newPassword">New Password</label> <input type="password" id="newPassword" class="form-control"> </div> <div class="form-group"> <label for="confirmPassword">Confirm New Password</label> <input type="password" id="confirmPassword" class="form-control"> </div> <div class="form-actions"> <button type="submit" class="btn btn-primary">Change Password</button> </div> </form> </div> <div class="settings-subsection"> <h4>Two-Factor Authentication (2FA)</h4> <div class="two-fa-status"> <span class="status-indicator disabled" id="twoFaStatusIndicator"></span> <span id="twoFaStatusText">2FA is Disabled</span> </div> <p class="setting-item-description">Add extra security.</p> <div id="twoFaSetupSection" style="display: block;"> <button class="btn btn-primary" id="enable2faBtn">Enable 2FA</button> <div class="two-fa-setup" id="twoFaSetupOptions" style="display:none;"> <h5>Choose Method:</h5> <div class="two-fa-actions"> <button class="btn btn-outline" id="setupAuthAppBtn"><i class="fas fa-mobile-alt"></i> App</button> <button class="btn btn-outline" id="setupSmsBtn"><i class="fas fa-sms"></i> SMS</button> </div> <div id="authAppSetup" style="display: none; margin-top: 1.5rem;"> <p>1. Scan QR code.</p> <div class="qr-code-placeholder">QR Placeholder</div> <p>2. Enter code.</p> <div class="form-group"> <label for="authCode">Code</label> <input type="text" id="authCode" class="form-control" placeholder="123456" maxlength="6"> </div> <button class="btn btn-primary" id="verifyAuthCodeBtn">Verify</button> </div> <div id="smsSetup" style="display: none; margin-top: 1.5rem;"> <p>1. Send code to <span id="userPhoneNumberForSms"></span>.</p> <button class="btn btn-primary" id="sendSmsCodeBtn">Send</button> <div class="form-group" style="margin-top: 1rem; display: none;" id="smsCodeInputGroup"> <label for="smsCode">SMS Code</label> <input type="text" id="smsCode" class="form-control" placeholder="123456" maxlength="6"> </div> <button class="btn btn-primary" id="verifySmsCodeBtn" style="display: none;">Verify</button> </div> </div> </div> <div id="twoFaManagementSection" style="display: none;"> <p>2FA is enabled.</p> <div class="two-fa-actions"> <button class="btn btn-outline" disabled>Recovery Codes</button> <button class="btn btn-danger" id="disable2faBtn">Disable 2FA</button> </div> </div> </div> <div class="settings-subsection"> <h4>Session Management</h4> <div class="data-form" style="grid-template-columns: 1fr 1fr;"> <div class="form-group"> <label for="sessionDuration">Session (min)</label> <input type="number" id="sessionDuration" class="form-control" value="60" min="15"> <p class="setting-item-description">Active duration.</p> </div> <div class="form-group"> <label for="idleTimeout">Idle Timeout (min)</label> <input type="number" id="idleTimeout" class="form-control" value="15" min="5"> <p class="setting-item-description">Logout on inactivity.</p> </div> </div> <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveSessionSettingsBtn">Save Session</button> </div> </div> </div>
                <div class="settings-panel" id="notificationsPanel"> <!-- Notifications Content --> <div class="settings-subsection"> <h4>Notification Delivery</h4> <div class="setting-item"> <div><span class="setting-item-label">Email Notifications</span><p class="setting-item-description">Receive email alerts.</p></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="emailNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div> <div class="setting-item"> <div><span class="setting-item-label">In-App Notifications</span><p class="setting-item-description">Show alerts in interface.</p></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="inAppNotificationsToggle" checked> <span class="slider round"></span> </label> </div> </div> <div class="setting-item"> <div><span class="setting-item-label">Push Notifications</span><p class="setting-item-description">Mobile/Desktop alerts.</p></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="pushNotificationsToggle" disabled> <span class="slider round"></span> </label> </div> </div> </div> <div class="settings-subsection"> <h4>Notification Types</h4> <p class="setting-item-description">Choose which alerts to receive.</p> <div class="checkbox-group"> <label><input type="checkbox" name="notificationType" value="task_assigned" checked> Task Assigned</label> <label><input type="checkbox" name="notificationType" value="task_comment" checked> Task Comment</label> <label><input type="checkbox" name="notificationType" value="project_update" checked> Project Update</label> <label><input type="checkbox" name="notificationType" value="deadline_reminder" checked> Deadline Reminder</label> <label><input type="checkbox" name="notificationType" value="file_shared"> File Shared</label> <label><input type="checkbox" name="notificationType" value="system_announcement" checked> Announcement</label> </div> </div> <div class="settings-subsection"> <h4>Sound & Priority</h4> <p class="setting-item-description">Sound settings: <a href="#settings-preferences" data-feature="settings" data-tab-target="preferences" class="settings-link">Preferences Tab</a>.</p> <div class="form-group"> <label for="notificationPriority">Min Priority</label> <select id="notificationPriority" class="form-control" disabled> <option value="low">Low</option> <option value="medium">Medium</option> <option value="high">High</option> </select> <p class="setting-item-description">Show only above level.</p> </div> </div> <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;"> <button type="button" class="btn btn-primary" id="saveNotificationSettingsBtn">Save Notifications</button> </div> </div>
                <div class="settings-panel" id="teamPanel"> <!-- Team Content --> <div class="team-management"> <div class="settings-subsection"> <h4>Team Members</h4> <div class="team-list" id="teamList"> <p>Loading...</p> </div> <div class="add-member-form"> <h4>Invite New Member</h4> <form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;"> <div class="form-group"> <label for="inviteEmail">Email</label> <input type="email" id="inviteEmail" class="form-control" required> </div> <div class="form-group"> <label for="inviteRole">Role</label> <select id="inviteRole" class="form-control" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div> <button type="submit" class="btn btn-primary">Invite</button> </form> </div> </div> <div class="settings-subsection"> <h4>Custom Role Permissions</h4> <p class="setting-item-description">Define permissions (Placeholder).</p> <button class="btn btn-outline" disabled>Manage Permissions</button> </div> </div> </div>
                <div class="settings-panel" id="collaborationPanel"> <!-- Collaboration Content --> <div class="settings-subsection"> <h4>External Integrations</h4> <p class="setting-item-description">Connect other apps.</p> <div class="integration-list" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;"> <button class="btn btn-outline" disabled><i class="fab fa-slack"></i> Slack</button> <button class="btn btn-outline" disabled><i class="fab fa-google-drive"></i> G Drive</button> <button class="btn btn-outline" disabled><i class="fab fa-github"></i> GitHub</button> </div> </div> <div class="settings-subsection"> <h4>Sharing & Invitations</h4> <p class="setting-item-description">Manage external sharing.</p> <div class="setting-item"> <div><span class="setting-item-label">Allow External Links</span></div> <div class="setting-item-control"> <label class="switch"> <input type="checkbox" id="externalSharingToggle" disabled> <span class="slider round"></span> </label> </div> </div> <button class="btn btn-outline" disabled>Manage Invites</button> </div> <div class="settings-subsection"> <h4>Collaboration Permissions</h4> <p class="setting-item-description">Set defaults.</p> <button class="btn btn-outline" disabled>Set Defaults</button> </div> </div>
                <div class="settings-panel" id="dangerPanel"> <!-- Danger Zone Content --> <h3 class="section-title" style="color: var(--danger);">Danger Zone</h3> <p>Actions are permanent.</p> <div class="danger-zone-item" style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray);"> <div> <h5>Logout From All Devices</h5> <p>End all other sessions.</p> </div> <button class="btn btn-warning" id="logoutAllDevicesBtn">Logout Everywhere</button> </div> <div class="danger-zone-item" style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray);"> <div> <h5>Delete Account</h5> <p>Permanently delete account.</p> </div> <button class="btn btn-danger" id="deleteAccountBtn">Delete Account</button> </div> </div>
             </div>

             <!-- Container for Dynamic Feature Sections -->
             <div id="featureSectionsContainer" class="content-section">
                 <!-- Content loaded here by JS -->
                 <div class="placeholder-content" id="featurePlaceholder">
                     <h2 id="featureTitle">Feature Content Area</h2>
                     <p id="featureDescription">Select a feature from the sidebar.</p>
                     <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                     <div class="error-message" style="display: none;"> Failed to load content. </div>
                 </div>
             </div>
         </div>
    </main>

    <!-- Notification Modal -->
    <!-- ... (remains unchanged) ... -->
    <div class="notifications-modal" id="notificationsModal"> <div class="notifications-container"> <div class="notifications-header"> <h3 class="notifications-title">Notifications</h3> <button class="close-notifications" id="closeNotifications" aria-label="Close Notifications">×</button> </div> <div class="notifications-body" id="notificationsBody"> <div class="no-notifications-message" id="noNotificationsMessage">Loading...</div> </div> <div class="notifications-footer"> <button class="btn btn-outline btn-sm" id="markAllReadBtn">Mark All Read</button> <button class="btn btn-danger btn-sm" id="deleteAllNotificationsBtn">Delete All</button> </div> </div> </div>

    <!-- Confirm Modal -->
    <!-- ... (remains unchanged) ... -->
    <div class="confirm-modal" id="confirmModal"> <div class="confirm-container"> <h3 class="confirm-title" id="confirmTitle">Confirm</h3> <div class="confirm-message" id="confirmMessage">Are you sure?</div> <div class="confirm-actions"> <button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button> <button class="btn btn-danger" id="confirmBtn">Confirm</button> </div> </div> </div>

    <!-- Member Add/Edit Modal -->
    <!-- ... (remains unchanged) ... -->
     <div class="modal" id="memberModal"> <div class="modal-content"> <div class="modal-header"> <h3 class="modal-title" id="memberModalTitle">Member Details</h3> <button class="close-modal" data-close-modal>&times;</button> </div> <form id="memberForm"> <input type="hidden" id="memberId"> <div class="data-form" style="grid-template-columns: 1fr 1fr;"> <div class="form-group"> <label for="memberFirstName">First Name</label> <input type="text" id="memberFirstName" class="form-control" required> </div> <div class="form-group"> <label for="memberLastName">Last Name</label> <input type="text" id="memberLastName" class="form-control" required> </div> <div class="form-group"> <label for="memberEmail">Email</label> <input type="email" id="memberEmail" class="form-control" required> </div> <div class="form-group"> <label for="memberRole">Role</label> <select id="memberRole" class="form-control" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div> <div class="form-group"> <label for="memberTitle">Job Title</label> <input type="text" id="memberTitle" class="form-control"> </div> <div class="form-group"> <label for="memberDepartment">Department</label> <input type="text" id="memberDepartment" class="form-control"> </div> </div> <div class="form-actions" style="grid-column: span 2;"> <button type="button" class="btn btn-outline" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="saveMemberBtn">Save Changes</button> </div> </form> </div> </div>

    <!-- Project Add/Edit Modal -->
    <!-- ... (remains unchanged) ... -->
    <div class="modal" id="projectModal"> <div class="modal-content"> <div class="modal-header"> <h3 class="modal-title" id="projectModalTitle">Project Details</h3> <button class="close-modal" data-close-modal>&times;</button> </div> <form id="projectForm"> <input type="hidden" id="projectId"> <div class="data-form" style="grid-template-columns: 1fr;"> <div class="form-group"> <label for="projectName">Project Name</label> <input type="text" id="projectName" class="form-control" required> </div> <div class="form-group"> <label for="projectDescription">Description</label> <textarea id="projectDescription" class="form-control" rows="3"></textarea> </div> <div class="form-group"> <label for="projectParticipantsInput">Participants (|)</label> <input type="text" id="projectParticipantsInput" class="form-control" placeholder="John D.|Jane S."> </div> <div class="form-group"> <label for="projectImageInput">Image URL</label> <input type="url" id="projectImageInput" class="form-control" placeholder="https://..."> </div> <div class="data-form" style="grid-template-columns: 1fr 1fr;"> <div class="form-group"> <label for="projectStartDate">Start Date</label> <input type="date" id="projectStartDate" class="form-control"> </div> <div class="form-group"> <label for="projectDueDate">Due Date</label> <input type="date" id="projectDueDate" class="form-control"> </div> <div class="form-group"> <label for="projectStatus">Status</label> <select id="projectStatus" class="form-control" required> <option value="pending">Pending</option> <option value="active">Active</option> <option value="in-progress">In Progress</option> <option value="completed">Completed</option> </select> </div> <div class="form-group"> <label for="projectProgress">Progress (%)</label> <input type="number" id="projectProgress" class="form-control" min="0" max="100" value="0"> </div> </div> </div> <div class="form-actions" style="grid-column: span 1;"> <button type="button" class="btn btn-outline" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary" id="saveProjectBtn">Save Project</button> </div> </form> </div> </div>

    <!-- File Sharing Modals -->
    <!-- ... (remain unchanged, already moved above) ... -->
     <div class="modal fade" id="uploadFileModal" tabindex="-1" aria-labelledby="uploadFileModalLabel" aria-hidden="true"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="uploadFileModalLabel"><i class="fas fa-cloud-upload-alt me-2"></i>Upload File</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> <div class="upload-area" id="dropZone"> <p><i class="fas fa-cloud-upload-alt fa-3x mb-2"></i></p> <p>Drag & drop or click</p> <input type="file" id="fileInputHidden" multiple hidden> </div> <div class="mb-3"> <label for="fileInputManual" class="form-label">Or select:</label> <input class="form-control form-control-sm" type="file" id="fileInputManual" multiple> </div> <div class="mb-3"> <label for="fileTagsInput" class="form-label"><i class="fas fa-tags me-1"></i>Tags:</label> <input type="text" class="form-control form-control-sm" id="fileTagsInput" placeholder="e.g., reports, 2024"> </div> <div id="uploadProgressContainer" class="mt-3" style="display: none;"> <div class="d-flex justify-content-between"> <small id="uploadFileName" class="text-muted">Uploading...</small> <small id="uploadPercentage" class="text-muted">0%</small> </div> <div class="progress mt-1" style="height: 10px;"> <div id="uploadProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div> </div> <small id="uploadStatus" class="text-muted d-block mt-1"></small> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button> <button type="button" class="btn btn-sm btn-primary" id="startUploadButton">Upload</button> </div> </div> </div> </div>
     <div class="modal fade" id="filePreviewModal" tabindex="-1" aria-labelledby="filePreviewModalLabel" aria-hidden="true"> <div class="modal-dialog modal-xl modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="filePreviewModalLabel">Preview</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body text-center" style="min-height: 400px; max-height: 80vh; overflow-y: auto;"> <div id="previewContent"> <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;"> <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div> </div> </div> </div> <div class="modal-footer justify-content-start py-2"> <small class="text-muted me-3" id="previewFileName">File:</small> <small class="text-muted" id="previewFileType">Type:</small> </div> </div> </div> </div>


    <!-- Task Management Assets Template -->
    <!-- ... (remains unchanged) ... -->
    <template id="taskManagementAssets">
        <style id="task-management-styles">
            /* Task CSS */
            #featureSectionsContainer.task-management-feature * { box-sizing: border-box; }
            #featureSectionsContainer.task-management-feature .task-management-content { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7fc; color: #333; line-height: 1.6; }
            #featureSectionsContainer.task-management-feature .task-management-content .container { max-width: 1200px; margin: 20px auto; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
            #featureSectionsContainer.task-management-feature .task-management-content h1 { color: #333; margin-bottom: 25px; text-align: center; font-weight: 600; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn { padding: 10px 18px; margin-left: 5px; gap: 5px; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn i { font-size: 0.9em; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-primary { background-color: #007bff; color: white; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-primary:hover { background-color: #0056b3; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-secondary { background-color: #6c757d; color: white; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-secondary:hover { background-color: #5a6268; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-danger { background-color: #dc3545; color: white; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-danger:hover { background-color: #c82333; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-warning { background-color: #ffc107; color: #333; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-warning:hover { background-color: #e0a800; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-success { background-color: #28a745; color: white; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-success:hover { background-color: #218838; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-info { background-color: #17a2b8; color: white; }
            #featureSectionsContainer.task-management-feature .task-management-content .btn-info:hover { background-color: #138496; }
            #featureSectionsContainer.task-management-feature .task-management-content .controls { display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 30px; padding: 15px; background-color: #e9ecef; border-radius: 6px; gap: 15px; }
            #featureSectionsContainer.task-management-feature .task-management-content .search-container { position: relative; display: flex; align-items: center; flex-grow: 1; min-width: 200px; }
            #featureSectionsContainer.task-management-feature .task-management-content #search-input { padding: 10px 35px 10px 15px; border: 1px solid #ced4da; border-radius: 5px; font-size: 1em; width: 100%; }
            #featureSectionsContainer.task-management-feature .task-management-content .search-icon { position: absolute; right: 12px; color: #6c757d; pointer-events: none; }
            #featureSectionsContainer.task-management-feature .task-management-content .filters { display: flex; flex-wrap: wrap; gap: 10px; }
            #featureSectionsContainer.task-management-feature .task-management-content .filters select { padding: 10px; border: 1px solid #ced4da; border-radius: 5px; background-color: #fff; font-size: 0.95em; cursor: pointer; min-width: 150px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-list { margin-top: 20px; display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
            #featureSectionsContainer.task-management-feature .task-management-content .no-tasks { text-align: center; color: #6c757d; padding: 40px 20px; font-size: 1.1em; background-color: #f8f9fa; border-radius: 6px; grid-column: 1 / -1; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card { background-color: #ffffff; border: 1px solid #e0e0e0; border-left: 5px solid #007bff; border-radius: 6px; padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); transition: box-shadow 0.3s ease, transform 0.2s ease; display: flex; flex-direction: column; justify-content: space-between; position: relative; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12); transform: translateY(-2px); }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card h3 { font-size: 1.25em; margin-bottom: 10px; color: #0056b3; word-break: break-word; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card p { margin-bottom: 8px; color: #555; font-size: 0.95em; word-break: break-word; line-height: 1.5; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card .description { color: #666; font-size: 0.9em; margin-bottom: 15px; max-height: 80px; overflow-y: auto; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card strong { color: #333; min-width: 90px; display: inline-block; margin-right: 5px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card .links { font-size: 0.9em; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card .links a, #featureSectionsContainer.task-management-feature .task-management-content .task-card .links span { display: inline-block; margin-right: 5px; margin-bottom: 3px; word-break: break-all; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card .links a { color: #007bff; text-decoration: none; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card .links a:hover { text-decoration: underline; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-meta { font-size: 0.85em; color: #777; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-meta > div { display: flex; flex-wrap: wrap; gap: 5px 15px; margin-bottom: 5px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-meta span { white-space: nowrap; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.priority-High { border-left-color: #dc3545; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.priority-Medium { border-left-color: #ffc107; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.priority-Low { border-left-color: #28a745; }
            #featureSectionsContainer.task-management-feature .task-management-content .status-badge { padding: 3px 10px; border-radius: 12px; font-size: 0.8em; font-weight: 600; color: white; white-space: nowrap; text-transform: uppercase; letter-spacing: 0.5px; }
            #featureSectionsContainer.task-management-feature .task-management-content .status-Pending { background-color: #ffc107; color: #333;}
            #featureSectionsContainer.task-management-feature .task-management-content .status-InProgress { background-color: #17a2b8; }
            #featureSectionsContainer.task-management-feature .task-management-content .status-Completed { background-color: #28a745; }
            #featureSectionsContainer.task-management-feature .task-management-content .overdue-indicator { color: #dc3545; font-weight: bold; margin-left: 5px; font-size: 0.9em; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed { background-color: #f8f9fa; border-left-color: #6c757d; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed h3 { color: #6c757d; text-decoration: line-through; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed p, #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed .description, #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed .task-meta { color: #6c757d; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-card.status-Completed strong { color: #5a6268; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions { margin-top: 15px; text-align: right; border-top: 1px solid #eee; padding-top: 15px; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions button { background: none; border: none; font-size: 1.2em; padding: 5px 8px; margin-left: 10px; vertical-align: middle; color: #6c757d; cursor: pointer; transition: color 0.2s ease, transform 0.2s ease; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions button:hover { transform: scale(1.1); }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .edit-btn:hover { color: #007bff; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .delete-btn { color: #dc3545; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .delete-btn:hover { color: #a71d2a; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .complete-btn { color: #28a745; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .complete-btn:hover { color: #1e7e34; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .reopen-btn { color: #ffc107; }
            #featureSectionsContainer.task-management-feature .task-management-content .task-actions .reopen-btn:hover { color: #d39e00; }
            #featureSectionsContainer.task-management-feature .modal { display: none; position: fixed; z-index: 1060; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.6); padding-top: 50px; backdrop-filter: blur(3px); }
            #featureSectionsContainer.task-management-feature .modal-content { background-color: #fefefe; margin: 5% auto 10% auto; padding: 30px 40px; border: none; width: 90%; max-width: 650px; border-radius: 8px; position: relative; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25); animation: slideDown 0.4s ease-out; }
            @keyframes slideDown { from {opacity: 0; transform: translateY(-30px);} to {opacity: 1; transform: translateY(0);} }
            #featureSectionsContainer.task-management-feature .modal-content .close-btn { color: #aaa; position: absolute; top: 15px; right: 20px; font-size: 28px; font-weight: bold; line-height: 1; transition: color 0.2s ease; text-decoration: none; cursor: pointer; background: none; border: none; }
            #featureSectionsContainer.task-management-feature .modal-content .close-btn:hover, #featureSectionsContainer.task-management-feature .modal-content .close-btn:focus { color: #333; text-decoration: none; cursor: pointer; }
            #featureSectionsContainer.task-management-feature .modal-content #modal-title { margin-bottom: 25px; font-weight: 600; color: #333; text-align: left; }
            #featureSectionsContainer.task-management-feature .modal-content #task-form { margin-top: 20px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-group { margin-bottom: 18px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #555; font-size: 0.9em; }
            #featureSectionsContainer.task-management-feature .modal-content #task-form input[type="text"], #featureSectionsContainer.task-management-feature .modal-content #task-form input[type="date"], #featureSectionsContainer.task-management-feature .modal-content #task-form textarea, #featureSectionsContainer.task-management-feature .modal-content #task-form select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; transition: border-color 0.2s ease, box-shadow 0.2s ease; background-color: white; color: #333; }
            #featureSectionsContainer.task-management-feature .modal-content #task-form input:focus, #featureSectionsContainer.task-management-feature .modal-content #task-form textarea:focus, #featureSectionsContainer.task-management-feature .modal-content #task-form select:focus { border-color: #007bff; box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2); outline: none; }
            #featureSectionsContainer.task-management-feature .modal-content #task-form textarea { resize: vertical; min-height: 80px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-row { display: flex; flex-wrap: wrap; gap: 20px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-row > div { flex: 1; min-width: 200px; }
            #featureSectionsContainer.task-management-feature .modal-content .form-actions { text-align: right; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
            #featureSectionsContainer.task-management-feature .modal-content .form-actions .btn { padding: 12px 25px; }
        </style>
        <script>
             function initializeTaskManagementFeature(container) { /* Task JS */
                const taskContentContainer = container.querySelector('.task-management-content'); if (!taskContentContainer) { console.error("Task container not found!"); return { cleanup: () => {} }; }
                const addTaskBtn = taskContentContainer.querySelector('#add-task-btn'); const taskModal = taskContentContainer.querySelector('#task-modal'); const closeModalBtn = taskModal?.querySelector('.close-btn'); const cancelBtn = taskContentContainer.querySelector('#cancel-btn'); const taskForm = taskContentContainer.querySelector('#task-form'); const taskListDiv = taskContentContainer.querySelector('#task-list'); const modalTitle = taskContentContainer.querySelector('#modal-title'); const saveTaskBtn = taskContentContainer.querySelector('#save-task-btn'); const taskIdInput = taskContentContainer.querySelector('#task-id'); const taskNameInput = taskContentContainer.querySelector('#task-name'); const taskDescriptionInput = taskContentContainer.querySelector('#task-description'); const taskLinksInput = taskContentContainer.querySelector('#task-links'); const taskAssignedBySelect = taskContentContainer.querySelector('#task-assigned-by'); const taskAssignedToSelect = taskContentContainer.querySelector('#task-assigned-to'); const taskStartDateInput = taskContentContainer.querySelector('#task-start-date'); const taskDueDateInput = taskContentContainer.querySelector('#task-due-date'); const taskPrioritySelect = taskContentContainer.querySelector('#task-priority'); const taskStatusSelect = taskContentContainer.querySelector('#task-status'); const searchInput = taskContentContainer.querySelector('#search-input'); const filterStatusSelect = taskContentContainer.querySelector('#filter-status'); const filterPrioritySelect = taskContentContainer.querySelector('#filter-priority'); const filterAssignedToSelect = taskContentContainer.querySelector('#filter-assigned-to');
                 if (!addTaskBtn || !taskModal || !closeModalBtn || !taskListDiv || !taskForm) { console.error("Task elements missing."); return { cleanup: () => {} }; }
                let tasks = []; let boundCloseOnEscape = null; let boundCloseOnOutsideClick = null;
                const loadTasks = () => { const stored = localStorage.getItem('dashboard_tasks'); if (stored) { try { tasks = JSON.parse(stored); } catch (e) { tasks = getDefaultTasks(); } } else { tasks = getDefaultTasks(); } renderTasks(); };
                function getDefaultTasks() { return [ { id: 1, name: "Setup Env", description: "Install Node.", links: "nodejs.org", assignedBy: "Nada", assignedTo: "Mohamed Elmenisy", startDate: "2024-07-20", dueDate: "2024-07-22", priority: "High", status: "In Progress", completionDate: null }, { id: 2, name: "Design Mockups", description: "Figma mockups.", links: "figma.com", assignedBy: "Yousef", assignedTo: "Esraa Lashin", startDate: "2024-07-21", dueDate: "2024-07-25", priority: "Medium", status: "Pending", completionDate: null }, { id: 3, name: "Build APIs", description: "REST APIs.", links: "", assignedBy: "Self Assigned", assignedTo: "Yousef", startDate: "2024-07-23", dueDate: "2024-07-30", priority: "High", status: "Pending", completionDate: null }, { id: 4, name: "Client Prep", description: "Presentation.", links: "", assignedBy: "Nada", assignedTo: "Bassant Badr", startDate: "2024-07-28", dueDate: "2024-07-29", priority: "Medium", status: "Pending", completionDate: null }, { id: 5, name: "Code Review", description: "feature/login.", links: "github.com, PR #42", assignedBy: "Self Assigned", assignedTo: "Mohamed Elmenisy", startDate: "2024-07-26", dueDate: "2024-07-26", priority: "Low", status: "Completed", completionDate: "2024-07-25" }, { id: 6, name: "Fix Login Bug", description: "Special chars.", links: "jira-123", assignedBy: "Yousef", assignedTo: "Yousef", startDate: "2024-07-15", dueDate: "2024-07-18", priority: "High", status: "In Progress", completionDate: null } ]; }
                const saveTasks = () => { localStorage.setItem('dashboard_tasks', JSON.stringify(tasks)); };
                const formatDate = (ds) => { if (!ds) return 'N/A'; try { const d = new Date(ds + 'T00:00:00'); return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); } catch (e) { return 'Invalid'; } };
                const getCurrentDate = () => new Date().toLocaleDateString('en-CA');
                const isOverdue = (t) => { if (t.status === 'Completed' || !t.dueDate) return false; try { const due = new Date(t.dueDate + 'T00:00:00Z'); const today = new Date(); const todayUTC = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate())); return due < todayUTC; } catch(e) { return false; } };
                const renderTasks = () => { if (!taskListDiv) return; taskListDiv.innerHTML = ''; const term = searchInput ? searchInput.value.toLowerCase() : ''; const statusF = filterStatusSelect ? filterStatusSelect.value : 'all'; const prioF = filterPrioritySelect ? filterPrioritySelect.value : 'all'; const assignF = filterAssignedToSelect ? filterAssignedToSelect.value : 'all'; let displayTasks = tasks.filter(t => (statusF === 'all' || (t.status || '') === statusF) && (prioF === 'all' || (t.priority || '') === prioF) && (assignF === 'all' || (t.assignedTo || '') === assignF)); if (term) { displayTasks = displayTasks.filter(t => (t.name||'').toLowerCase().includes(term) || (t.description||'').toLowerCase().includes(term) || (t.links||'').toLowerCase().includes(term) || (t.assignedTo||'').toLowerCase().includes(term) || (t.assignedBy||'').toLowerCase().includes(term)); } if (displayTasks.length === 0) { taskListDiv.innerHTML = '<p class="no-tasks">No tasks found.</p>'; return; } displayTasks.sort((a, b) => { const so = { "Pending": 1, "In Progress": 1, "Completed": 2 }; const sa = so[a.status] || 3; const sb = so[b.status] || 3; if (sa !== sb) return sa - sb; const da = a.dueDate ? new Date(a.dueDate + 'T00:00:00Z') : null; const db = b.dueDate ? new Date(b.dueDate + 'T00:00:00Z') : null; const va = da && !isNaN(da) ? da.getTime() : Infinity; const vb = db && !isNaN(db) ? db.getTime() : Infinity; if (va !== vb) return va - vb; const po = { High: 3, Medium: 2, Low: 1 }; const pa = po[a.priority] || 0; const pb = po[b.priority] || 0; return pb - pa; }); displayTasks.forEach(t => { const card = document.createElement('div'); card.className = `task-card priority-${t.priority||''} status-${(t.status||'').replace(/\s+/g, '')}`; card.dataset.taskId = t.id; if(t.status === 'Completed') card.classList.add('task-completed'); if(isOverdue(t)) card.classList.add('task-overdue'); const od = isOverdue(t); const odTxt = od ? `<span class="overdue-indicator">(Overdue!)</span>` : ''; let linksHTML = 'N/A'; if (t.links && t.links.trim()) { linksHTML = t.links.split(',').map(l => l.trim()).filter(l => l).map(link => { let href = link, isUrl = false; try { const url = new URL(link.startsWith('http') ? link : `http://${link}`); if(url.hostname && (url.hostname.includes('.') || url.hostname.match(/^\d{1,3}(\.\d{1,3}){3}$/))) { isUrl = true; href = url.toString(); } } catch (_) {} const dText = link.length > 35 ? link.substring(0, 32) + '...' : link; return isUrl ? `<a href="${href}" target="_blank" rel="noopener noreferrer" title="${link}">${dText}</a>` : `<span title="${link}">${dText}</span>`; }).join(' '); } card.innerHTML = `<h3>${t.name || 'Unnamed'}</h3> ${t.description ? `<p class="description">${t.description}</p>` : ''} <p><strong>Links:</strong> <span class="links">${linksHTML}</span></p> <p><strong>By:</strong> ${t.assignedBy || 'N/A'}</p> <p><strong>To:</strong> ${t.assignedTo || 'N/A'}</p> <div class="task-meta"> <div> <span><strong>Start:</strong> ${formatDate(t.startDate)}</span> <span><strong>Due:</strong> ${formatDate(t.dueDate)} ${odTxt}</span> </div> <div> <span><strong>Priority:</strong> ${t.priority || 'N/A'}</span> <span><strong>Status:</strong> <span class="status-badge status-${(t.status || '').replace(/\s+/g, '')}">${t.status || 'N/A'}</span></span> </div> ${t.status === 'Completed' ? `<div><span><strong>Completed:</strong> ${formatDate(t.completionDate)}</span></div>` : ''} </div> <div class="task-actions"> <button class="edit-btn" title="Edit"><i class="fas fa-edit"></i></button> <button class="delete-btn" title="Delete"><i class="fas fa-trash-alt"></i></button> ${t.status === 'Completed' ? `<button class="reopen-btn" title="Reopen"><i class="fas fa-undo"></i></button>` : `<button class="complete-btn" title="Complete"><i class="fas fa-check-circle"></i></button>`} </div>`; card.querySelector('.edit-btn')?.addEventListener('click', (e) => { e.stopPropagation(); openEditModal(t.id); }); card.querySelector('.delete-btn')?.addEventListener('click', (e) => { e.stopPropagation(); deleteTask(t.id); }); card.querySelector('.complete-btn, .reopen-btn')?.addEventListener('click', (e) => { e.stopPropagation(); toggleTaskStatus(t.id); }); taskListDiv.appendChild(card); }); };
                const showModal = () => { if (!taskModal) return; taskModal.style.display = 'block'; document.body.style.overflow = 'hidden'; };
                const hideModal = () => { if (!taskModal) return; taskModal.style.display = 'none'; if (taskForm) taskForm.reset(); if (taskIdInput) taskIdInput.value = ''; if (modalTitle) modalTitle.textContent = "Add New Task"; if (saveTaskBtn) saveTaskBtn.textContent = "Save Task"; document.body.style.overflow = ''; };
                const openAddModal = () => { hideModal(); if (modalTitle) modalTitle.textContent = "Add New Task"; if (saveTaskBtn) saveTaskBtn.textContent = "Save Task"; if (taskStatusSelect) taskStatusSelect.value = "Pending"; if (taskPrioritySelect) taskPrioritySelect.value = "Medium"; showModal(); if (taskNameInput) taskNameInput.focus(); };
                const openEditModal = (id) => { const t = tasks.find(t => t.id === id); if (!t || !taskIdInput || !taskNameInput || !taskDescriptionInput || !taskLinksInput || !taskAssignedBySelect || !taskAssignedToSelect || !taskStartDateInput || !taskDueDateInput || !taskPrioritySelect || !taskStatusSelect) return; hideModal(); if (modalTitle) modalTitle.textContent = "Edit Task"; if (saveTaskBtn) saveTaskBtn.textContent = "Update Task"; taskIdInput.value = t.id; taskNameInput.value = t.name; taskDescriptionInput.value = t.description || ''; taskLinksInput.value = t.links || ''; taskAssignedBySelect.value = t.assignedBy; taskAssignedToSelect.value = t.assignedTo; taskStartDateInput.value = t.startDate || ''; taskDueDateInput.value = t.dueDate || ''; taskPrioritySelect.value = t.priority; taskStatusSelect.value = t.status; showModal(); taskNameInput.focus(); };
                const handleFormSubmit = (e) => { e.preventDefault(); if (!taskIdInput || !taskNameInput || !taskDescriptionInput || !taskLinksInput || !taskAssignedBySelect || !taskAssignedToSelect || !taskStartDateInput || !taskDueDateInput || !taskPrioritySelect || !taskStatusSelect) return; const id = taskIdInput.value ? parseInt(taskIdInput.value) : Date.now(); const currentT = tasks.find(t => t.id === id); const newStatus = taskStatusSelect.value; let compDate = currentT?.completionDate || null; if (newStatus === 'Completed' && (!taskIdInput.value || (currentT && currentT.status !== 'Completed'))) { compDate = getCurrentDate(); } else if (newStatus !== 'Completed') { compDate = null; } const start = taskStartDateInput.value; const due = taskDueDateInput.value; if (start && due && new Date(due) < new Date(start)) { alert("Due Date cannot be before Start Date."); taskDueDateInput.focus(); return; } const data = { id, name: taskNameInput.value.trim(), description: taskDescriptionInput.value.trim(), links: taskLinksInput.value.trim(), assignedBy: taskAssignedBySelect.value, assignedTo: taskAssignedToSelect.value, startDate: start || null, dueDate: due || null, priority: taskPrioritySelect.value, status: newStatus, completionDate: compDate }; if (!data.name) { alert("Task Name required."); taskNameInput.focus(); return; } if (taskIdInput.value) { const idx = tasks.findIndex(t => t.id === data.id); if (idx > -1) tasks[idx] = data; else tasks.push(data); } else { tasks.push(data); } saveTasks(); renderTasks(); hideModal(); };
                const deleteTask = (id) => { const t = tasks.find(t => t.id === id); if (confirm(`Delete task: "${t?.name || id}"?`)) { tasks = tasks.filter(t => t.id !== id); saveTasks(); renderTasks(); } };
                const toggleTaskStatus = (id) => { tasks = tasks.map(t => { if (t.id === id) { return t.status === 'Completed' ? { ...t, status: 'Pending', completionDate: null } : { ...t, status: 'Completed', completionDate: getCurrentDate() }; } return t; }); saveTasks(); renderTasks(); };
                addTaskBtn.addEventListener('click', openAddModal); closeModalBtn.addEventListener('click', hideModal); if (cancelBtn) cancelBtn.addEventListener('click', hideModal); taskForm.addEventListener('submit', handleFormSubmit);
                const handleOutsideClick = (e) => { if (e.target === taskModal) { hideModal(); } }; const handleEscapeKey = (e) => { if (e.key === 'Escape' && taskModal && taskModal.style.display === 'block') { hideModal(); } };
                taskModal.addEventListener('click', handleOutsideClick); document.addEventListener('keydown', handleEscapeKey); boundCloseOnOutsideClick = handleOutsideClick; boundCloseOnEscape = handleEscapeKey;
                if (searchInput) searchInput.addEventListener('input', renderTasks); if (filterStatusSelect) filterStatusSelect.addEventListener('change', renderTasks); if (filterPrioritySelect) filterPrioritySelect.addEventListener('change', renderTasks); if (filterAssignedToSelect) filterAssignedToSelect.addEventListener('change', renderTasks);
                loadTasks();
                const cleanup = () => { console.log("Cleaning Task Mgmt..."); addTaskBtn?.removeEventListener('click', openAddModal); closeModalBtn?.removeEventListener('click', hideModal); cancelBtn?.removeEventListener('click', hideModal); taskForm?.removeEventListener('submit', handleFormSubmit); taskModal?.removeEventListener('click', boundCloseOnOutsideClick); document.removeEventListener('keydown', boundCloseOnEscape); searchInput?.removeEventListener('input', renderTasks); filterStatusSelect?.removeEventListener('change', renderTasks); filterPrioritySelect?.removeEventListener('change', renderTasks); filterAssignedToSelect?.removeEventListener('change', renderTasks); removeTaskManagementStyles(); document.body.style.overflow = ''; console.log("Task Mgmt cleanup done."); }; return { cleanup };
             }
        </script>
    </template>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Dashboard Core JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements ---
            const dashboardContent = document.getElementById('dashboardContent');
            const profileContent = document.getElementById('profileContent');
            const settingsContent = document.getElementById('settingsContent');
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureTitleEl = document.getElementById('featureTitle');
            const featureDescEl = document.getElementById('featureDescription');
            const featureLoadingEl = featurePlaceholder.querySelector('.loading-indicator');
            const featureErrorEl = featurePlaceholder.querySelector('.error-message');
            const allContentSections = [dashboardContent, profileContent, settingsContent, featureSectionsContainer]; // Array for easier management

            // Other elements... (sidebar, nav, modals etc. - selectors assumed correct)
             const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.menu-item');
            const backButton = document.getElementById('backButton');
            const backButtonText = document.getElementById('backButtonText');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const searchInput = document.getElementById('searchInput');
            const searchResultsContainer = document.getElementById('searchResults');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationBadge = document.getElementById('notificationBadge');
            const notificationsModal = document.getElementById('notificationsModal');
            const closeNotifications = document.getElementById('closeNotifications');
            const notificationsBody = document.getElementById('notificationsBody');
            const noNotificationsMessage = document.getElementById('noNotificationsMessage');
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn');
            const notificationSound = document.getElementById('notificationSound');
            const activityList = document.getElementById('activityList');
            const viewAllActivity = document.getElementById('viewAllActivity');
            const deleteAllActivity = document.getElementById('deleteAllActivity');
            const statsSection = document.getElementById('statsSection');
            const welcomeSection = document.getElementById('welcomeSection');
            const profileForm = document.getElementById('profileForm');
            const profileAvatarLarge = document.getElementById('profileAvatarLarge');
            const profileAvatarInput = document.getElementById('profileAvatarInput');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const fullNameDisplay = document.getElementById('fullNameDisplay');
            const jobTitleInput = document.getElementById('jobTitle');
            const emailDisplay = document.getElementById('email'); // Profile email display
            const phoneInput = document.getElementById('phone');
            const departmentInput = document.getElementById('department');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const cancelProfileBtn = document.getElementById('cancelProfileBtn');
            const themeOptions = document.querySelectorAll('.theme-option');
            const highContrastToggle = document.getElementById('highContrastToggle');
            const languageSelect = document.getElementById('languageSelect');
            const regionSelect = document.getElementById('regionSelect');
            const timeFormatSelect = document.getElementById('timeFormatSelect');
            const dateFormatSelect = document.getElementById('dateFormatSelect');
            const toastToggle = document.getElementById('toastToggle');
            const soundToggle = document.getElementById('soundToggle');
            const notificationToneSelect = document.getElementById('notificationToneSelect');
            const savePreferencesBtn = document.getElementById('savePreferencesBtn');
            const accountEmailDisplay = document.getElementById('accountEmail'); // Account panel email display
            const changeEmailInput = document.getElementById('changeEmail');
            const accountConfirmPasswordInput = document.getElementById('accountConfirmPassword');
            const saveAccountEmailBtn = document.getElementById('saveAccountEmailBtn');
            const accountNotificationsToggle = document.getElementById('accountNotificationsToggle');
            const saveAccountSettingsBtn = document.getElementById('saveAccountSettingsBtn');
            const changePasswordForm = document.getElementById('changePasswordForm');
            const enable2faBtn = document.getElementById('enable2faBtn');
            const twoFaSetupSection = document.getElementById('twoFaSetupSection');
            const twoFaManagementSection = document.getElementById('twoFaManagementSection');
            const twoFaStatusIndicator = document.getElementById('twoFaStatusIndicator');
            const twoFaStatusText = document.getElementById('twoFaStatusText');
            const twoFaSetupOptions = document.getElementById('twoFaSetupOptions');
            const setupAuthAppBtn = document.getElementById('setupAuthAppBtn');
            const setupSmsBtn = document.getElementById('setupSmsBtn');
            const authAppSetup = document.getElementById('authAppSetup');
            const smsSetup = document.getElementById('smsSetup');
            const verifyAuthCodeBtn = document.getElementById('verifyAuthCodeBtn');
            const userPhoneNumberForSms = document.getElementById('userPhoneNumberForSms');
            const sendSmsCodeBtn = document.getElementById('sendSmsCodeBtn');
            const smsCodeInputGroup = document.getElementById('smsCodeInputGroup');
            const verifySmsCodeBtn = document.getElementById('verifySmsCodeBtn');
            const disable2faBtn = document.getElementById('disable2faBtn');
            const saveSessionSettingsBtn = document.getElementById('saveSessionSettingsBtn');
            const logoutAllDevicesBtn = document.getElementById('logoutAllDevicesBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            const emailNotificationsToggle = document.getElementById('emailNotificationsToggle');
            const inAppNotificationsToggle = document.getElementById('inAppNotificationsToggle');
            const pushNotificationsToggle = document.getElementById('pushNotificationsToggle');
            const notificationTypeCheckboxes = document.querySelectorAll('input[name="notificationType"]');
            const saveNotificationSettingsBtn = document.getElementById('saveNotificationSettingsBtn');
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const successMessage = document.getElementById('successMessage');
            const successMessageText = document.getElementById('successMessageText');
            const toastMessage = document.getElementById('toastMessage');
            const memberModal = document.getElementById('memberModal');
            const memberForm = document.getElementById('memberForm');
            const memberModalTitle = document.getElementById('memberModalTitle');
            const saveMemberBtn = document.getElementById('saveMemberBtn');
            const projectModal = document.getElementById('projectModal');
            const projectForm = document.getElementById('projectForm');
            const projectModalTitle = document.getElementById('projectModalTitle');
            const saveProjectBtn = document.getElementById('saveProjectBtn');
            const logoutLink = document.getElementById('logoutLink');

            // --- State Variables ---
            let currentUser = null;
            let currentFeature = 'dashboard';
            let currentSettingsTab = 'preferences';
            let notifications = [];
            let activities = [];
            let activityIntervalId = null;
            let notificationIntervalId = null;
            let statsIntervalId = null;
            let welcomeBgIntervalId = null;
            let confirmCallback = null;
            let maxActivitiesToShow = 5;
            let showingAllActivities = false;
            let userDropdownOpen = false;
            let showToasts = true;
            let playSounds = true;
            let currentScheduleWeekOffset = 0;
            let scheduleMinWeekOffset = 0;
            let mockScheduleData = {};
            let currentFeatureCleanup = null;
            let MOCK_PROJECTS_DATA = [];
            let fileSharingRelativeTimeInterval = null; // Moved from feature init

            // --- Mock Data ---
            // ... (remains unchanged) ...
            let MOCK_USERS = [ { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin', twoFaEnabled: false }, { id: 2, name: 'Nada Mahmoud', email: 'n.mahmoud@thechefz.co', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'NM', role: 'supervisor', twoFaEnabled: false }, { id: 3, name: 'Yousef Ahmed', email: 'y.abbas@thechefz.co', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'YA', role: 'senior', twoFaEnabled: true }, { id: 4, name: 'Esraa Lashin', email: 'e.lasheen@thechefz.co', title: 'Member', department: 'Design', phone: '+20155444333', avatar: '', initials: 'EL', role: 'member', twoFaEnabled: false }, { id: 5, name: 'Bassant Badr', email: 'b.badr@thechefz.co', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'BB', role: 'member', twoFaEnabled: false }, ];
            const MOCK_PROJECTS = [ { id: 101, name: 'Project Alpha', status: 'Active' }, { id: 102, name: 'Project Beta', status: 'Planning' }, { id: 103, name: 'Project Gamma', status: 'Completed' },{ id: 104, name: 'Zeus Initiative', status: 'Active' }, ];
            const MOCK_TASKS = [ { id: 201, name: 'Design Mockup', status: 'Completed', project: 101 }, { id: 202, name: 'Develop API', status: 'In Progress', project: 101 }, { id: 203, name: 'User Testing', status: 'Pending', project: 102 }, { id: 204, name: 'Task Mgmt Feature', status: 'Active', project: 104 }, ];

             // --- Initialization ---
             // ... (remains unchanged) ...
            function initDashboard() { currentUser = { ...MOCK_USERS[0] }; console.log("Initializing for:", currentUser.name); applyStoredPreferences(); updateUserUI(); setupEventListeners(); loadInitialData(); handleInitialNavigation(); startDynamicUpdates(); setupResponsiveSidebar(); }

             // --- UI Updates ---
             // ... (remains unchanged) ...
            function updateUserUI() { /* ... */ } function updateProfileForm() { /* ... */ } function formatRole(role) { /* ... */ }

             // --- Preferences & Settings Logic ---
             // ... (remains unchanged) ...
            function applyStoredPreferences() { /* ... */ } function setTheme(theme) { /* ... */ } function setContrast(enabled) { /* ... */ } function applyLanguage(lang) { /* ... */ } function applyDateTimeFormat(timeFormat, dateFormat) { /* ... */ } function applyToastPreference(enabled) { /* ... */ } function applySoundPreference(enabled) { /* ... */ }

            // --- Navigation & Content Loading (REVISED) ---
            function setActiveFeature(featureId, settingsTab = null, skipHistory = false) {
                console.log(`Navigating to: ${featureId}` + (settingsTab ? ` / Tab: ${settingsTab}` : ''));

                // --- Cleanup previous feature ---
                // Remove dynamically injected styles FIRST
                removeTaskManagementStyles();
                removeTeamMembersStyles(); // Placeholder if needed
                removeProjectsStyles(); // Placeholder if needed
                // No specific file sharing style tag to remove

                // Call previous feature's cleanup function
                if (typeof currentFeatureCleanup === 'function') {
                    console.log(`Cleaning up previous feature: ${currentFeature}`);
                    currentFeatureCleanup();
                    currentFeatureCleanup = null;
                }
                // --- End Cleanup ---

                currentFeature = featureId;

                // Update Menu Items
                menuItems.forEach(item => {
                    item.classList.toggle('active', item.getAttribute('data-feature') === featureId);
                });

                // *** REVISED: Hide ALL potential content sections ***
                allContentSections.forEach(section => {
                    if (section) { // Check if element exists
                         section.classList.remove('active');
                         // For the feature container, also clear content and reset classes
                         if (section === featureSectionsContainer) {
                             section.innerHTML = ''; // Clear dynamic content
                             section.className = 'content-section'; // Reset classes
                             section.appendChild(featurePlaceholder); // Re-add placeholder structure
                             featurePlaceholder.style.display = 'flex'; // Ensure placeholder visible initially
                             featureLoadingEl.style.display = 'none';
                             featureErrorEl.style.display = 'none';
                         }
                    }
                });

                // Determine the target section and load content if necessary
                let targetSection = null;
                const isStaticSection = ['dashboard', 'profile', 'settings'].includes(featureId);

                if (featureId === 'dashboard') {
                    targetSection = dashboardContent;
                    backButton.style.display = 'none';
                } else if (featureId === 'profile') {
                    targetSection = profileContent;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                     updateProfileForm();
                } else if (featureId === 'settings') {
                    targetSection = settingsContent;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    currentSettingsTab = settingsTab || (currentUser.role === 'admin' ? 'preferences' : 'preferences');
                     if (currentUser.role !== 'admin' && (currentSettingsTab === 'team' || currentSettingsTab === 'danger')) {
                         currentSettingsTab = 'preferences';
                     }
                    activateSettingsTab(currentSettingsTab);
                     update2FA_UI();
                } else {
                    // Handle other dynamic features
                    targetSection = featureSectionsContainer; // The container is the target
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    loadFeatureContent(featureId); // Load content into the container
                }

                // *** Activate ONLY the target section ***
                if (targetSection) {
                    // Small delay to allow CSS transition to catch the class change
                    requestAnimationFrame(() => {
                         targetSection.classList.add('active');
                    });
                }

                // Close sidebar on mobile
                if (window.innerWidth <= 992 && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    mainContent.classList.remove('sidebar-active');
                    if(closeSidebar) closeSidebar.style.display = 'none';
                }
                // Close user dropdown
                if(userDropdown) userDropdown.classList.remove('active');
                userDropdownOpen = false;

                if (!skipHistory) {
                    updateBrowserHistory(featureId, featureId === 'settings' ? currentSettingsTab : null);
                }
            }

            function activateSettingsTab(tabId) { /* ... (remains unchanged) ... */ }

             function loadFeatureContent(featureId) {
                 // ... (logic to get featureName remains same) ...
                  const menuItem = Array.from(menuItems).find(item => item.getAttribute('data-feature') === featureId);
                 const featureName = menuItem ? menuItem.querySelector('span').textContent : 'Feature';

                 // Show loading indicator within the placeholder (which is inside the container now)
                 featurePlaceholder.style.display = 'flex'; // Ensure placeholder structure is displayed
                 featureTitleEl.textContent = `Loading ${featureName}...`; // Update title
                 featureDescEl.textContent = ''; // Clear description
                 featureLoadingEl.style.display = 'block'; // Show spinner
                 featureErrorEl.style.display = 'none'; // Hide error

                 console.log(`Loading content for: ${featureName} (${featureId})`);

                 setTimeout(() => {
                     try {
                         // ** Important: Clear only the placeholder *after* content is ready **
                         // featureSectionsContainer.innerHTML = ''; // DON'T clear the whole container here

                         let featureHTML = '';
                         let initFunction = null;

                         // --- Feature Loading Logic ---
                         if (featureId === 'team-members-view') {
                             featureSectionsContainer.classList.add('team-members-feature');
                             featureHTML = getTeamMembersHTML();
                             initFunction = initializeTeamMembersFeature;
                         } else if (featureId === 'projects') {
                             featureSectionsContainer.classList.add('projects-feature');
                             featureHTML = getProjectsHTML();
                             initFunction = initializeProjectsFeature;
                         } else if (featureId === 'employee-scheduling') {
                             featureSectionsContainer.classList.add('employee-scheduling');
                             featureHTML = getEmployeeScheduleHTML();
                             initFunction = initializeEmployeeScheduleLogic; // Needs global window.renderSchedule
                         } else if (featureId === 'task-management') {
                             featureSectionsContainer.classList.add('task-management-feature');
                             featureHTML = loadTaskManagementHTML(); // Get HTML separately
                             initFunction = loadTaskManagementJS; // Load JS separately
                         } else if (featureId === 'file-sharing') {
                             featureSectionsContainer.classList.add('file-sharing-feature');
                             featureHTML = getFileSharingHTML();
                             initFunction = initializeFileSharingFeature;
                         } else {
                             // Default placeholder for unimplemented features
                             featureHTML = featurePlaceholder.outerHTML; // Keep the placeholder structure
                             featureTitleEl.textContent = featureName; // Reset title/desc
                             featureDescEl.textContent = `Content for ${featureName} would be loaded here.`;
                             featureLoadingEl.style.display = 'none'; // Hide loading
                         }

                         // Inject the HTML, replacing the placeholder content
                         featureSectionsContainer.innerHTML = featureHTML;

                         // Initialize JS if applicable
                         if (typeof initFunction === 'function') {
                              const result = initFunction(featureSectionsContainer);
                              if (result && typeof result.cleanup === 'function') {
                                  currentFeatureCleanup = result.cleanup; // Store cleanup function
                              } else if(featureId !== 'employee-scheduling') { // Scheduling might not have a specific cleanup yet
                                 console.warn(`No cleanup function returned for ${featureId}`);
                              }
                         }

                     } catch (error) {
                         console.error(`Error loading feature ${featureId}:`, error);
                         featureLoadingEl.style.display = 'none'; // Hide loading
                         featurePlaceholder.style.display = 'flex'; // Show placeholder again
                         featureErrorEl.textContent = `Failed to load ${featureName}. Error: ${error.message}`;
                         featureErrorEl.style.display = 'block';
                         // Keep the placeholder structure on error
                         featureSectionsContainer.innerHTML = ''; // Clear potentially broken HTML
                         featureSectionsContainer.appendChild(featurePlaceholder);
                     }
                 }, 300); // Simulate network delay
             }

             // Adjust Task Management loading to fit the new pattern
             function loadTaskManagementHTML() {
                 const template = document.getElementById('taskManagementAssets');
                 if (!template) { return '<p class="error-message">Error: Task assets missing.</p>'; }
                 // Extract only the HTML part needed for the container
                 const taskHTML = ` <div class="task-page-header"> <h2 class="task-page-title">Task Management</h2> </div> <div class="task-management-content"> <!-- Controls --> <div class="controls"> <button id="add-task-btn" class="btn btn-primary"><i class="fas fa-plus"></i> New Task</button> <div class="search-container"> <input type="text" id="search-input" placeholder="Search tasks..."> <i class="fas fa-search search-icon"></i> </div> <div class="filters"> <select id="filter-status"> <option value="all">Status: All</option> <option value="Pending">Pending</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> </select> <select id="filter-priority"> <option value="all">Priority: All</option> <option value="High">High</option> <option value="Medium">Medium</option> <option value="Low">Low</option> </select> <select id="filter-assigned-to"> <option value="all">Assigned To: All</option> <option value="Mohamed Elmenisy">Mohamed Elmenisy</option> <option value="Yousef">Yousef</option> <option value="Esraa Lashin">Esraa Lashin</option> <option value="Bassant Badr">Bassant Badr</option> </select> </div> </div> <!-- Task List --> <div id="task-list" class="task-list"> <p class="no-tasks">Loading tasks...</p> </div> <!-- Modal is global, not part of this HTML --> </div> `;
                 return taskHTML;
             }
             function loadTaskManagementJS(container) {
                const template = document.getElementById('taskManagementAssets');
                 if (!template) { console.error("Task Management template not found!"); return null; }
                // Inject Styles
                 const styleContent = template.content.querySelector('#task-management-styles');
                 if (styleContent) { const styleTag = document.createElement('style'); styleTag.id = 'injected-task-management-styles'; styleTag.textContent = styleContent.textContent; document.head.appendChild(styleTag); console.log("Task styles injected."); }
                 else { console.warn("Task styles not found in template."); }
                 // Initialize JS
                 const scriptContent = template.content.querySelector('script');
                 if (scriptContent) { try { const initFunction = new Function(`${scriptContent.textContent}\n return initializeTaskManagementFeature;`)(); if (typeof initFunction === 'function') { return initFunction(container); } else { console.error("Task init function not found."); return null;} } catch (e) { console.error("Error initializing Task script:", e); return null; } }
                 else { console.warn("Task script not found in template."); return null; }
             }
             // Function to remove styles remains the same
             function removeTaskManagementStyles() { const injectedStyle = document.getElementById('injected-task-management-styles'); if (injectedStyle) { injectedStyle.remove(); console.log("Task styles removed."); } }
             function removeTeamMembersStyles() { /* No specific styles injected */ }
             function removeProjectsStyles() { /* No specific styles injected */ }


            function updateBrowserHistory(featureId, settingsTab = null) {
                let hash = `#${featureId}`;
                if (featureId === 'settings' && settingsTab) {
                    hash += `-${settingsTab}`;
                }
                // Avoid pushing the same state repeatedly
                if (window.location.hash !== hash) {
                    // Use replaceState for initial load/popstate to avoid polluting history too much,
                    // Use pushState for user clicks if desired (currently using pushState for all updates)
                    window.history.pushState({ feature: featureId, tab: settingsTab }, '', hash);
                     console.log("History updated:", hash);
                }
            }

            function handleInitialNavigation() {
                const hash = window.location.hash.substring(1);
                console.log(`Handling navigation for hash: '${hash}'`);
                let featureId = 'dashboard'; // Default feature
                let settingsTab = null;

                if (hash) {
                    if (hash.startsWith('settings-')) {
                        const parts = hash.split('-');
                        // Check if the feature part is actually 'settings'
                        if (parts[0] === 'settings' && parts.length > 1) {
                             featureId = parts[0];
                             // Check if the target tab exists
                             const validTab = document.querySelector(`.settings-tab[data-tab="${parts[1]}"]`);
                             if(validTab) {
                                settingsTab = parts[1];
                             } else {
                                console.warn(`Settings tab '${parts[1]}' not found, defaulting.`);
                                settingsTab = 'preferences'; // Default if tab invalid
                                // Optionally, update the hash to reflect the default
                                // window.history.replaceState(null, '', `#settings-preferences`);
                             }
                        } else {
                             console.warn(`Invalid settings hash '${hash}', defaulting to dashboard.`);
                             // Optionally, update the hash
                             // window.history.replaceState(null, '', `#dashboard`);
                        }
                    } else {
                         // Check if the hash corresponds to a known feature
                         const knownFeature = Array.from(menuItems).some(item => item.getAttribute('data-feature') === hash);
                         if (knownFeature) {
                             featureId = hash;
                         } else if (hash !== 'dashboard') { // Only warn if it's not the default
                            console.warn(`Feature '${hash}' not found, defaulting to dashboard.`);
                             // Optionally, update the hash
                             // window.history.replaceState(null, '', `#dashboard`);
                         }
                    }
                }
                // Ensure admin restrictions are applied on load
                 if (featureId === 'settings' && currentUser && currentUser.role !== 'admin' && (settingsTab === 'team' || settingsTab === 'danger')) {
                     console.warn(`Non-admin access attempt to ${settingsTab} tab, redirecting.`);
                     settingsTab = 'preferences';
                     // window.history.replaceState(null, '', `#settings-preferences`);
                 }

                setActiveFeature(featureId, settingsTab, true); // Skip history update on initial load/popstate
            }

            window.addEventListener('popstate', function(event) {
                console.log("Popstate triggered:", event.state, window.location.hash);
                // The state object pushed might be null if the user navigated manually (back/forward browser buttons)
                // So, we rely on handleInitialNavigation to read the hash
                handleInitialNavigation();
            });


            // --- Data Loading & Simulation ---
            // ... (loadInitialData, loadMockProjects, loadDashboardStats, updateStatCard, loadRecentActivities, loadNotifications, renderNotifications, loadTeamMembers remain unchanged) ...
            function loadInitialData() { loadDashboardStats(); loadRecentActivities(); loadNotifications(); loadMockProjects(); if (currentFeature === 'settings' && currentSettingsTab === 'team' && currentUser.role === 'admin') { loadTeamMembers(); } }
            function loadMockProjects() { MOCK_PROJECTS_DATA = [ { id: "alpha001", name: "Project Alpha", status: "in-progress", participants: "Alice B.|Bob K.|Charlie M.", img: "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=400", progress: 65, startDate: "2023-08-15", updatedDate: "2024-03-10", editable: true }, { id: "web002", name: "Website Redesign", status: "completed", participants: "David L.|Eva G.", img: "https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?w=400", progress: 100, startDate: "2023-05-01", updatedDate: "2024-01-20", editable: false }, { id: "mobile003", name: "Mobile App V2", status: "active", participants: "Frank H.|Grace P.|Heidi R.|Ian S.", img: "https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?w=400", progress: 20, startDate: "2024-02-20", updatedDate: "2024-03-05", editable: true }, { id: "mktg004", name: "Q4 Marketing Plan", status: "pending", participants: "Marketing Team", img: "https://images.unsplash.com/photo-1557804506-669a67965ba0?w=400", progress: 0, startDate: "2024-09-01", updatedDate: "2024-03-12", editable: true }, { id: "infra005", name: "Server Migration", status: "in-progress", participants: "Admin Team|Mohamed Elmenisy", img: "https://images.unsplash.com/photo-1580894742597-87bc8789db3d?w=400", progress: 85, startDate: "2024-01-10", updatedDate: "2024-03-15", editable: true } ]; }
            function loadDashboardStats() { /* ... */ } function updateStatCard(id, title, iconClass, value, trendPercent) { /* ... */ } function loadRecentActivities(showAll = false) { /* ... */ } function loadNotifications() { /* ... */ } function renderNotifications() { /* ... */ } function loadTeamMembers(container) { /* ... */ }

            // --- Dynamic Updates Simulation ---
            // ... (startDynamicUpdates, changeWelcomeBackground remain unchanged) ...
            function startDynamicUpdates() { /* ... */ } function changeWelcomeBackground() { /* ... */ }

            // --- Event Listeners ---
            // ... (setupEventListeners remains structurally the same, ensures all necessary listeners are attached) ...
            function setupEventListeners() { /* ... */ }

            // --- Specific Feature Logic ---
            // ... (setupResponsiveSidebar, handleSearch remain unchanged) ...
            function setupResponsiveSidebar() { /* ... */ } function handleSearch() { /* ... */ }

            // --- Profile Logic ---
            // ... (handleAvatarUpload, updateFullNameDisplay, handleProfileSave, handleProfileCancel remain unchanged) ...
            function handleAvatarUpload(event) { /* ... */ } function updateFullNameDisplay() { /* ... */ } function handleProfileSave(event) { /* ... */ } function handleProfileCancel() { /* ... */ }

             // --- Settings Save Logic ---
             // ... (handleSavePreferences, handleSaveAccountSettings, handleChangePassword, handleSaveSessionSettings, handleSaveNotificationSettings remain unchanged) ...
            function handleSavePreferences() { /* ... */ } function handleSaveAccountSettings() { /* ... */ } function handleChangePassword(event) { /* ... */ } function handleSaveSessionSettings() { /* ... */ } function handleSaveNotificationSettings() { /* ... */ }

             // --- 2FA Logic ---
             // ... (update2FA_UI, handleEnable2FA, showAuthAppSetup, showSmsSetup, handleVerifyAuthCode, handleSendSmsCode, handleVerifySmsCode, handleDisable2FA remain unchanged) ...
             function update2FA_UI() { /* ... */ } function handleEnable2FA() { /* ... */ } function showAuthAppSetup() { /* ... */ } function showSmsSetup() { /* ... */ } function handleVerifyAuthCode() { /* ... */ } function handleSendSmsCode() { /* ... */ } function handleVerifySmsCode() { /* ... */ } function handleDisable2FA() { /* ... */ }

             // --- Danger Zone Logic ---
             // ... (handleLogoutAllDevices, handleDeleteAccount remain unchanged) ...
            function handleLogoutAllDevices() { /* ... */ } function handleDeleteAccount() { /* ... */ }

             // --- Notification Logic ---
             // ... (markAllNotificationsAsRead, playNotificationSound remain unchanged) ...
            function markAllNotificationsAsRead() { /* ... */ } function playNotificationSound() { /* ... */ }

             // --- Logout Logic ---
             // ... (handleLogout remains unchanged) ...
            function handleLogout(event) { /* ... */ }

            // --- Team Management Logic ---
             // ... (handleInviteMember, openMemberModal, handleSaveMember, handleRemoveMember remain unchanged) ...
            function handleInviteMember(event) { /* ... */ } function openMemberModal(memberId = null) { /* ... */ } function handleSaveMember(event) { /* ... */ } function handleRemoveMember(memberId) { /* ... */ }

            // --- Employee Scheduling Logic (Initialization called from loadFeatureContent) ---
            // ... (getEmployeeScheduleHTML, initializeEmployeeScheduleLogic, handleSendReminders remain unchanged) ...
            function getEmployeeScheduleHTML() { /* ... */ } function initializeEmployeeScheduleLogic() { /* ... */ } function handleSendReminders() { /* ... */ } // Global render function needed by initializeEmployeeScheduleLogic and potentially others
             window.renderSchedule = function(weekOffset) { /* ... Schedule rendering logic ... */ };

            // --- Task Management Feature Loading (Functions already defined above) ---

            // --- Team Members Feature Logic (Functions already defined above) ---

            // --- Projects Feature Logic (Functions already defined above) ---
             // Global render function needed by initializeProjectsFeature and potentially others
             window.renderProjects = function(container) { /* ... Project rendering logic ... */ };

            // --- File Sharing Feature Logic (Functions already defined above) ---
            // Global function needed by initializeFileSharingFeature and potentially others
            window.updateRelativeTimes = function() { /* ... Relative time update logic ... */ };

            // --- Utility Functions ---
            // ... (timeAgo, formatDateForDisplay, formatFullDateTime, generateMockActivities, generateMockNotifications, showConfirmModal, hideConfirmModal, showSuccessMessage, showToast remain unchanged) ...
            function timeAgo(timestamp) { /* ... */ } function formatDateForDisplay(date) { /* ... */ } function formatFullDateTime(date) { /* ... */ } function generateMockActivities(count, baseTimestampMillis) { /* ... */ } function generateMockNotifications(count, baseTimestampMillis) { /* ... */ } function showConfirmModal(title, message, onConfirm, buttonClass = 'btn-danger') { /* ... */ } function hideConfirmModal() { /* ... */ } function showSuccessMessage(message) { /* ... */ } function showToast(message, type = 'info') { /* ... */ }

            // --- Start Application ---
            initDashboard();
        });
    </script>
</body>
</html>

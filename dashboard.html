<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAzFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+0ESp5AAAAPHRSTlMAAgMFBggJCw0OEBESFhccHR8hIiUnKCkqLC8xNDU3ODk7Q0VJTlBSVVpbXV9iZGt0dnmGiZGeoqqusLe9wMfV4ufr+P/R2c8tAAABUklEQVR4Xq3U61LCQBSG4R8qUAREQXEWBDcQxAHc3QHufw//kGRm0yyZRdqDHD4MdH+S9D01pZZqpYADGCSpFcBUAWSpTAAFGFnC6wJQBJKfEcAp4K4y82QLwOIB7wXA8wFsA9ANgNkA+J53fC8ABgO8PwAeCzAMgBkANgO43wdAZACcDIDfAfBuA3AEwFkAXAjANkB0AEQLwMgAPSEAowFgMgBIAIA9AKgBgD0AIAEA9gCQBAC4B8D8/QHgFwC0B0DlAAgDANACAGwHwFkA7QPkvwCkGACzAMAeAJgCwLoAWAvAWgDsAWC/AZQMQNkASAwAzQHQFQBJASDrASAOAHQApAEgHQCBAJAPAPEA0AUADgDuAOgDgDUAkoQAjAOgLQDZAeC+D8BeAEgKADgDwGUAfAfABgB8ALgDoM8BKA8AewDUA0A3AFAEQNkAUAUADgC0AUANACUBsFsApBnA/ANH3A1tFXyGCgAAAABJRU5ErkJggg=="> <!-- Embed Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAjVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8v5hNCAAAAL3RSTlMAAQIFBggJCw0ODxARFhcYHB0fISIjJCYoKSosMDE0Nzg5O0NFSktUVVtfY2uHi5CrxqPGvYufAAAAl0lEQVR4XqXRSwrAIAwA0KRCQEREFe/+l/Zg2F2Tsv9k5k1yY4OZCEMidI5QIkSOkCJkz79ERERE9EREhEREhEREr7uXSmVtmVNKZV2Zk1J5pS+XqjK1yqmytcqsrXKqLK1y+43zTGebW2ebW2eb2+Pm1/s7Ouf+VfV8YDPn8q63O9/x7gC8/QD4BKgFkA8A7wDgBwAXALEA4AXABMBDLxcpRTlaOWQAAAAASUVORK5CYII="> <!-- Embed Favicon -->

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e3a8a;
            --primary-light: #dbeafe;
            --secondary: #10b981; /* Used as Success in some features */
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;  /* Default Text Color (Dark in Light Mode) */
            --light: #f8fafc; /* Light Background */
            --white: #ffffff; /* True white (e.g., card backgrounds) */
            --gray: #64748b;
            --light-gray: #e2e8f0; /* Borders */
            --info: #0dcaf0; /* Bootstrap cyan for info */
            --sidebar-width: 280px;
            --sidebar-bg: #1e3a8a;
            --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1);
            --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1);
            --success: #10b981; /* Explicit success */
            --team-manager: #ef4444; /* Keep for role color */
            --compact-padding: 0.5rem;
            --normal-padding: 1rem;
            --spacious-padding: 1.5rem;
            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); /* Light Blue */
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); /* Light Green */
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); /* Light Yellow */
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); /* Light Red */
            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1); /* Default welcome bg */
            --dashboard-header-bg: linear-gradient(90deg, hsla(217, 91%, 60%, 1) 0%, hsla(245, 100%, 70%, 1) 100%); /* Fancy Header Gradient */

            /* High Contrast Variables */
            --hc-text: #000000;
            --hc-background: #ffffff;
            --hc-primary: #0000ff;
            --hc-secondary: #008000;
            --hc-link: #0000ee;
            --hc-border: #000000;

            /* Base Colors */
            --base-bg-color: var(--light);
            --base-text-color: var(--dark);
            --card-bg-color: var(--white);
            --card-border-color: var(--light-gray);
            --card-shadow-color: rgba(0, 0, 0, 0.05);
            --input-bg-color: var(--white);
            --input-border-color: var(--light-gray);
            --input-focus-border-color: var(--primary);
            --input-focus-shadow-color: rgba(37, 99, 235, 0.1);

             /* Schedule specific */
             --schedule-weekend-bg: #f3f4f6;
             --schedule-weekend-text: #9ca3af;
             --shift-morning-bg: #dbeafe; --shift-morning-text: #1e40af; --shift-morning-border: #bfdbfe;
             --shift-afternoon-bg: #e0f2fe; --shift-afternoon-text: #0c4a6e; --shift-afternoon-border: #bae6fd;
             --shift-night-bg: #ede9fe; --shift-night-text: #5b21b6; --shift-night-border: #ddd6fe;
             --shift-off-bg: #f0fdf4; --shift-off-text: #166534; --shift-off-border: #bbf7d0;
             --shift-sick-bg: #fee2e2; --shift-sick-text: #991b1b; --shift-sick-border: #fecaca;
             --shift-vacation-bg: #ffedd5; --shift-vacation-text: #9a3412; --shift-vacation-border: #fed7aa;

            /* Tracking & Reports */
             --chart-background: #F5F7FA;
             --status-completed-bg: rgba(76, 175, 80, 0.15); --status-completed-text: #388E3C;
             --status-inprogress-bg: rgba(33, 150, 243, 0.15); --status-inprogress-text: #1976D2;
             --status-delayed-bg: rgba(255, 193, 7, 0.15); --status-delayed-text: #FFA000;
             --status-pending-bg: rgba(158, 158, 158, 0.15); --status-pending-text: #616161;
             --priority-high-bg: rgba(244, 67, 54, 0.15); --priority-high-text: #D32F2F;
             --priority-medium-bg: rgba(255, 193, 7, 0.15); --priority-medium-text: #FFA000;
             --priority-low-bg: rgba(76, 175, 80, 0.15); --priority-low-text: #388E3C;
             --feature-reports-chart-fill-opacity: 0.7;
             --feature-reports-chart-radar-fill-opacity: 0.15;

             /* Innovation Hub Variables (Default Light) */
             --feature-hub-header-bg-start: #6f42c1;
             --feature-hub-header-bg-end: #0d6efd;
             --feature-hub-header-text-color: var(--white);
             --feature-hub-status-review-bg: #cfe2ff;
             --feature-hub-status-review-text: #0a58ca;
             --feature-hub-status-implemented-bg: #d1e7dd;
             --feature-hub-status-implemented-text: #146c43;
             --feature-hub-status-rejected-bg: #f8d7da;
             --feature-hub-status-rejected-text: #842029;
        }
        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--base-bg-color); color: var(--base-text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* --- High Contrast Mode --- */
        body.high-contrast {
             --dark: var(--hc-text); --light: var(--hc-background); --gray: var(--hc-text); --light-gray: var(--hc-border); --white: var(--hc-background); --primary: var(--hc-primary); --primary-dark: var(--hc-primary); --primary-light: #e0e0ff; --secondary: var(--hc-secondary); --success: var(--hc-secondary); --warning: #ffa500; --danger: #ff0000; --info: var(--hc-primary);
             --sidebar-bg: var(--hc-background); --sidebar-text: var(--hc-text); --sidebar-hover: #e0e0e0; --sidebar-active: #c0c0c0; --sidebar-divider: var(--hc-border);
             --base-text-color: var(--hc-text); --base-bg-color: var(--hc-background); --card-bg-color: var(--hc-background); --card-border-color: var(--hc-border); --input-bg-color: var(--hc-background); --input-border-color: var(--hc-border);
             --schedule-weekend-bg: #dddddd; --schedule-weekend-text: var(--hc-text);
             --shift-morning-bg: var(--hc-background); --shift-morning-text: var(--hc-text); --shift-morning-border: var(--hc-border);
             --shift-afternoon-bg: var(--hc-background); --shift-afternoon-text: var(--hc-text); --shift-afternoon-border: var(--hc-border);
             --shift-night-bg: var(--hc-background); --shift-night-text: var(--hc-text); --shift-night-border: var(--hc-border);
             --shift-off-bg: var(--hc-background); --shift-off-text: var(--hc-text); --shift-off-border: var(--hc-border);
             --shift-sick-bg: var(--hc-background); --shift-sick-text: var(--hc-text); --shift-sick-border: var(--hc-border);
             --shift-vacation-bg: var(--hc-background); --shift-vacation-text: var(--hc-text); --shift-vacation-border: var(--hc-border);
              --chart-background: var(--hc-background);
              --status-completed-bg: transparent; --status-completed-text: var(--hc-secondary); --status-inprogress-bg: transparent; --status-inprogress-text: var(--hc-primary); --status-delayed-bg: transparent; --status-delayed-text: var(--warning); --status-pending-bg: transparent; --status-pending-text: var(--hc-text);
              --priority-high-bg: transparent; --priority-high-text: var(--danger); --priority-medium-bg: transparent; --priority-medium-text: var(--warning); --priority-low-bg: transparent; --priority-low-text: var(--hc-secondary);
              --feature-hub-header-bg-start: var(--hc-primary); --feature-hub-header-bg-end: var(--hc-primary); --feature-hub-header-text-color: var(--hc-background);
              --feature-hub-status-review-bg: transparent; --feature-hub-status-review-text: var(--hc-primary); --feature-hub-status-implemented-bg: transparent; --feature-hub-status-implemented-text: var(--hc-secondary); --feature-hub-status-rejected-bg: transparent; --feature-hub-status-rejected-text: var(--danger);

             color: var(--base-text-color);
             background-color: var(--base-bg-color);
        }
        body.high-contrast .welcome-section,
        body.high-contrast .stat-card,
        body.high-contrast .top-nav,
        body.high-contrast .sidebar,
        body.high-contrast .activity-section,
        body.high-contrast .content-section,
        body.high-contrast .card,
        body.high-contrast .feature-header,
        body.high-contrast .feature-content,
        body.high-contrast #featureSectionsContainer .card { /* Target cards within features */
            background: var(--hc-background) !important;
            border: 1px solid var(--hc-border) !important;
            color: var(--base-text-color) !important;
            box-shadow: none !important;
        }
        body.high-contrast .btn,
        body.high-contrast button, /* Target generic button */
        body.high-contrast .form-control,
        body.high-contrast .form-select,
        body.high-contrast textarea,
        body.high-contrast .search-bar input {
            border: 1px solid var(--hc-border) !important;
            background: var(--hc-background) !important;
            color: var(--base-text-color) !important;
        }
        body.high-contrast .btn-primary,
        body.high-contrast button.button-primary {
            background-color: var(--hc-primary) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important;
        }
        body.high-contrast .btn-danger,
        body.high-contrast button.button-danger { background-color: var(--danger) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-warning { background-color: var(--warning) !important; color: var(--hc-text) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-success { background-color: var(--hc-secondary) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .btn-secondary,
        body.high-contrast button.button-secondary { background-color: var(--hc-text) !important; color: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; } /* Use text color for secondary */
        body.high-contrast .btn-outline { background: var(--hc-background) !important; color: var(--hc-primary) !important; border: 1px solid var(--hc-primary) !important; }
        body.high-contrast .btn-outline-danger { background: var(--hc-background) !important; color: var(--danger) !important; border: 1px solid var(--danger) !important;}
        body.high-contrast .btn-outline-success { background: var(--hc-background) !important; color: var(--hc-secondary) !important; border: 1px solid var(--hc-secondary) !important;}
        body.high-contrast .btn-outline-info { background: var(--hc-background) !important; color: var(--hc-primary) !important; border: 1px solid var(--hc-primary) !important;}
        body.high-contrast .logo { color: var(--base-text-color) !important; }
        body.high-contrast .logo-icon { color: var(--hc-primary) !important; }
        body.high-contrast .menu-item { color: var(--base-text-color) !important; border-left-color: transparent !important; }
        body.high-contrast .menu-item.active { background-color: #c0c0c0 !important; border-left-color: var(--hc-primary) !important; color: var(--hc-text) !important; }
        body.high-contrast .stat-card { border-left-width: 3px !important; background: var(--hc-background) !important; }
        body.high-contrast .welcome-section { background: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; color: var(--base-text-color) !important;}
        body.high-contrast .welcome-section .user-info-title { color: var(--hc-text) !important; }
        body.high-contrast .badge { border: 1px solid var(--hc-border) !important; color: var(--base-text-color) !important; background: none !important; padding: 3px 8px !important; }
        body.high-contrast .progress-bar { border: 1px solid var(--hc-border) !important; color: var(--base-text-color) !important; background: none !important; }
        body.high-contrast .progress { background: var(--hc-background) !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .theme-preview { border: 2px solid var(--hc-border) !important; background: var(--hc-background) !important; }
        body.high-contrast .theme-option.selected .theme-preview { border-color: var(--hc-primary) !important; }
        body.high-contrast .switch .slider { background-color: #999 !important; border: 1px solid var(--hc-border) !important; }
        body.high-contrast .switch input:checked + .slider { background-color: var(--hc-primary) !important; }
        body.high-contrast .switch .slider:before { background-color: var(--hc-text) !important; }
        body.high-contrast .fancy-header-title,
        body.high-contrast .pt-fancy-title,
        body.high-contrast .ra-fancy-title,
        body.high-contrast .hub-header h1 { background: var(--hc-primary) !important; color: var(--hc-background) !important; padding: 8px 15px !important; border-radius: 4px !important; box-shadow: none !important; }
        body.high-contrast .table thead { background: var(--hc-background) !important; color: var(--base-text-color) !important; border-bottom-color: var(--hc-border) !important; }
        body.high-contrast canvas { border: 1px dashed var(--hc-border); }

        /* --- Sidebar Styles --- */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; text-decoration: none;}
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .connection-status span { font-weight: 600; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--card-bg-color); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--card-border-color); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--input-border-color); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--input-bg-color); color: var(--base-text-color); }
        .search-bar input:focus { outline: none; border-color: var(--input-focus-border-color); box-shadow: 0 0 0 3px var(--input-focus-shadow-color); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--card-bg-color); border: 1px solid var(--card-border-color); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--base-text-color); display: flex; align-items: center; gap: 0.75rem; }
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--base-text-color); }
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--card-bg-color); border: 1px solid var(--card-border-color); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--base-text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; }
        .dropdown-item:hover { background-color: var(--base-bg-color); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; }
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section { background: var(--welcome-bg-current); color: var(--white); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--team-manager); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--secondary); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card { background: var(--card-bg-color); border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px var(--card-shadow-color); transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease; position: relative; overflow: hidden; border-left: 5px solid var(--primary); color: var(--base-text-color); }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--secondary); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }
        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        .stat-title { font-size: 0.9rem; color: var(--base-text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        .stat-card:nth-child(1) .stat-value { color: #1e40af; }
        .stat-card:nth-child(2) .stat-value { color: #15803d; }
        .stat-card:nth-child(3) .stat-value { color: #b45309; }
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; }
        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--card-bg-color); border-radius: 8px; box-shadow: 0 1px 3px var(--card-shadow-color); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--base-text-color); }
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; }
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--card-border-color); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--base-text-color); }
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--gray); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        .delete-activity { color: var(--danger); cursor: pointer; opacity: 0.6; transition: opacity 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .activity-item:hover .delete-activity { opacity: 1; }
        .delete-activity:hover { opacity: 1; background-color: rgba(239, 68, 68, 0.1); }

        /* --- Profile & Settings Sections Styles --- */
        .content-section { background-color: var(--card-bg-color); border-radius: 8px; box-shadow: 0 1px 3px var(--card-shadow-color); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; }
        .content-section.active { display: block; }
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        #featureSectionsContainer { padding: 0; background-color: transparent; box-shadow: none; border-radius: 0; }
        #featureSectionsContainer > .card { border: none; border-radius: 8px; box-shadow: 0 1px 3px var(--card-shadow-color); background-color: var(--card-bg-color); margin-bottom: 0; overflow: hidden; }
        .feature-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; padding: 1.5rem; border-bottom: 1px solid var(--card-border-color); background-color: var(--base-bg-color); }
        .feature-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); margin: 0; }
        body.dark-theme .feature-title { color: #93c5fd; }
        .feature-actions { display: flex; gap: 0.75rem; align-items: center; }
        .feature-content { padding: 1.5rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 1rem;}
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; }
        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--base-text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; }
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control, .form-select, textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--input-border-color); border-radius: 6px; font-size: 1rem; background-color: var(--input-bg-color); color: var(--base-text-color); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        body.compact .form-control, body.compact .form-select, body.compact textarea { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control, body.spacious .form-select, body.spacious textarea { padding: 1rem; }
        .form-control:focus, .form-select:focus, textarea:focus { outline: none; border-color: var(--input-focus-border-color); box-shadow: 0 0 0 3px var(--input-focus-shadow-color); }
        .form-control[readonly] { background-color: var(--base-bg-color); cursor: not-allowed; opacity: 0.7; }
        textarea { resize: vertical; min-height: 80px; }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }
        .btn, button, #featureSectionsContainer button { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; text-decoration: none; line-height: 1.5; vertical-align: middle; }
        body.compact .btn, body.compact button { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn, body.spacious button { padding: 1rem 2rem; }
        .btn-primary, button.button-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled), button.button-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--primary-dark); }
        .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-danger, button.button-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled), button.button-danger:hover:not(:disabled) { background-color: #dc2626; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: #0d9f6e; }
        .btn-secondary, button.button-secondary { background-color: var(--gray); color: white; }
        .btn-secondary:hover:not(:disabled), button.button-secondary:hover:not(:disabled) { background-color: #4b5563; }
        .btn-info { background-color: var(--info); color: white; }
        .btn-info:hover:not(:disabled) { background-color: #0a9aaf; }
        .btn:disabled, button:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-sm { padding: 0.3rem 0.6rem !important; font-size: 0.8rem !important; }
        .btn-outline-secondary { background-color: transparent; border: 1px solid var(--gray); color: var(--gray); }
        .btn-outline-secondary:hover:not(:disabled) { background-color: var(--light-gray); }
        .btn-outline-success { background-color: transparent; border: 1px solid var(--success); color: var(--success); }
        .btn-outline-success:hover:not(:disabled) { background-color: rgba(16, 185, 129, 0.1); }
        .btn-outline-danger { background-color: transparent; border: 1px solid var(--danger); color: var(--danger); }
        .btn-outline-danger:hover:not(:disabled) { background-color: rgba(239, 68, 68, 0.1); }
        .btn-outline-info { background-color: transparent; border: 1px solid var(--info); color: var(--info); }
        .btn-outline-info:hover:not(:disabled) { background-color: rgba(13, 202, 240, 0.1); }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--card-border-color); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; }
        @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        .settings-subsection { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--card-border-color); }
        .settings-subsection:first-child { margin-top: 0; padding-top: 0; border-top: none; }
        .settings-subsection h4 { font-size: 1.1rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 1rem; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; }
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; }
        @media (min-width: 768px) { .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; } }
        .setting-item-label { font-weight: 500; color: var(--base-text-color); }
        .setting-item-description { font-size: 0.9rem; color: var(--gray); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
         @media (max-width: 767px) { .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; } }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--base-text-color); margin-bottom: 1rem; }
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        #settingsContent .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--card-border-color); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--card-bg-color); }
        body.compact #settingsContent .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious #settingsContent .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        #settingsContent .team-member-card:hover { box-shadow: 0 2px 4px var(--card-shadow-color); border-color: var(--primary); }
        #settingsContent .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact #settingsContent .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        #settingsContent .member-details { flex: 1; min-width: 0; }
        #settingsContent .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--base-text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-name { font-size: 0.9rem; }
        #settingsContent .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact #settingsContent .member-email { font-size: 0.8rem; }
        #settingsContent .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; }
        body.compact #settingsContent .member-role { font-size: 0.7rem; margin: 0 0.75rem; }
        #settingsContent .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); }
        #settingsContent .role-senior { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        #settingsContent .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); }
        #settingsContent .role-member { background-color: rgba(100, 116, 139, 0.1); color: var(--gray); }
        #settingsContent .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        #settingsContent .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--card-border-color); border-radius: 8px; background-color: var(--base-bg-color); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span { margin-left: 0.5rem; }
        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }
        .loading-text { display: none; font-size: 0.9rem; color: var(--gray); margin-left: 0.5rem; }

        /* --- Theme Styles & Dark Mode Overrides --- */
        body.light-theme { /* Light theme uses base :root vars */ }
        body.dark-theme {
             --primary: #3b82f6; --primary-dark: #1e40af; --primary-light: #1e293b;
             --dark: #e2e8f0; --light: #334155; --white: #0f172a; --gray: #94a3b8; --light-gray: #475569;
             --base-bg-color: #0f172a; --base-text-color: #e2e8f0; --card-bg-color: #1e293b; --card-border-color: #475569; --card-shadow-color: rgba(255, 255, 255, 0.05);
             --input-bg-color: #334155; --input-border-color: #475569;
             --sidebar-bg: #1e293b; --sidebar-divider: #475569; --sidebar-text: rgba(226, 232, 240, 0.9); --sidebar-hover: rgba(59, 130, 246, 0.1); --sidebar-active: rgba(59, 130, 246, 0.2);
             --schedule-weekend-bg: #262f3e; --schedule-weekend-text: #6b7280;
             --shift-morning-bg: #1e3a8a; --shift-morning-text: #dbeafe; --shift-morning-border: #2563eb;
             --shift-afternoon-bg: #0e7490; --shift-afternoon-text: #ecfeff; --shift-afternoon-border: #22d3ee;
             --shift-night-bg: #581c87; --shift-night-text: #f3e8ff; --shift-night-border: #a855f7;
             --shift-off-bg: #064e3b; --shift-off-text: #d1fae5; --shift-off-border: #34d399;
             --shift-sick-bg: #881337; --shift-sick-text: #fecdd3; --shift-sick-border: #fb7185;
             --shift-vacation-bg: #7c2d12; --shift-vacation-text: #ffedd5; --shift-vacation-border: #fb923c;
             --chart-background: #1e293b;
             --status-completed-bg: rgba(76, 175, 80, 0.2); --status-completed-text: #86efac;
             --status-inprogress-bg: rgba(59, 130, 246, 0.2); --status-inprogress-text: #93c5fd;
             --status-delayed-bg: rgba(245, 158, 11, 0.2); --status-delayed-text: #fcd34d;
             --status-pending-bg: rgba(158, 158, 158, 0.2); --status-pending-text: #94a3b8;
             --priority-high-bg: rgba(244, 67, 54, 0.2); --priority-high-text: #fca5a5;
             --priority-medium-bg: rgba(245, 158, 11, 0.2); --priority-medium-text: #fcd34d;
             --priority-low-bg: rgba(76, 175, 80, 0.2); --priority-low-text: #86efac;
             --feature-hub-header-bg-start: #5a3b9a; --feature-hub-header-bg-end: #0b5ed7;
             --feature-hub-status-review-bg: #0a58ca; --feature-hub-status-review-text: #cfe2ff;
             --feature-hub-status-implemented-bg: #146c43; --feature-hub-status-implemented-text: #d1e7dd;
             --feature-hub-status-rejected-bg: #842029; --feature-hub-status-rejected-text: #f8d7da;
        }
        /* ... other dark theme overrides ... */
        body.dark-theme .top-nav { background-color: var(--card-bg-color); border-bottom-color: var(--card-border-color); }
        body.dark-theme .stat-card, body.dark-theme .activity-section, body.dark-theme .content-section, body.dark-theme #settingsContent .team-member-card, body.dark-theme .add-member-form, body.dark-theme #featureSectionsContainer > .card { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme .search-bar input, body.dark-theme .form-control, body.dark-theme .form-select, body.dark-theme textarea { background-color: var(--input-bg-color); border-color: var(--input-border-color); color: var(--base-text-color); }
        body.dark-theme .form-control[readonly] { background-color: var(--card-bg-color); opacity: 0.6; }
        body.dark-theme .search-results { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme .search-result-item:hover { background-color: var(--primary-light); }
        body.dark-theme .user-dropdown { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme .dropdown-item:hover { background-color: var(--base-bg-color); }
        body.dark-theme .notifications-container { background-color: var(--card-bg-color); }
        body.dark-theme .notification-list-item:hover { background-color: var(--base-bg-color); }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); }
        body.dark-theme .confirm-container, body.dark-theme .modal-content { background-color: var(--card-bg-color); color: var(--base-text-color); }
        body.dark-theme .theme-option .theme-preview { border-color: var(--card-border-color); background: linear-gradient(45deg, var(--card-bg-color) 50%, var(--base-bg-color) 50%); }
        body.dark-theme .theme-option .light-preview { background: var(--light) !important; }
        body.dark-theme .theme-option .dark-preview { background: var(--base-bg-color) !important; }
        body.dark-theme .theme-option .system-preview { background: linear-gradient(45deg, var(--light) 50%, var(--base-bg-color) 50%) !important; color: var(--gray);}
        body.dark-theme .theme-option.selected .theme-preview { border-color: var(--primary); }
        body.dark-theme .back-button:hover { background-color: var(--card-bg-color); color: #60a5fa; border-color: var(--primary); }
        body.dark-theme .notifications-footer { background-color: var(--card-bg-color); border-top-color: var(--card-border-color); }
        body.dark-theme .welcome-section { background: var(--welcome-bg-current); color: var(--white); }
        body.dark-theme .stat-card { background: var(--card-bg-color); color: var(--base-text-color);}
        body.dark-theme .stat-title { color: var(--base-text-color); }
        body.dark-theme .stat-card:nth-child(1) .stat-value { color: #93c5fd; }
        body.dark-theme .stat-card:nth-child(2) .stat-value { color: #86efac; }
        body.dark-theme .stat-card:nth-child(3) .stat-value { color: #fcd34d; }
        body.dark-theme .stat-card:nth-child(4) .stat-value { color: #fca5a5; }
        body.dark-theme .activity-icon { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa; }
        body.dark-theme .activity-item { border-bottom-color: var(--card-border-color); }
        body.dark-theme .delete-activity:hover { background-color: rgba(239, 68, 68, 0.2); }
        body.dark-theme #profileAvatarLarge { background-color: var(--card-bg-color); color: var(--base-text-color); border-color: var(--primary-light); }
        body.dark-theme .placeholder-content { color: var(--gray); border-color: var(--card-border-color); background-color: var(--card-bg-color); }
        body.dark-theme .settings-subsection h4 { color: #93c5fd; }
        body.dark-theme .danger-zone-item .btn-danger { background-color: #dc2626; }
        body.dark-theme .danger-zone-item .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        body.dark-theme .checkbox-group { border-color: var(--card-border-color); }
        body.dark-theme .toast { background-color: var(--card-bg-color); color: var(--base-text-color); }
        body.dark-theme .toast.success { background-color: var(--success); color: white; }
        body.dark-theme .toast.error { background-color: var(--danger); color: white; }
        /* Dark Theme: Feature Specific Overrides */
        body.dark-theme .feature-header { background-color: var(--base-bg-color); border-bottom-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-container { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th { background-color: var(--primary-dark); color: var(--dark); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td { background-color: var(--base-bg-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--card-bg-color); border-right-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td.weekend-cell { background-color: var(--schedule-weekend-bg) !important; }
        body.dark-theme #featureSectionsContainer.task-management-feature .controls { background-color: var(--base-bg-color); border-bottom-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.task-management-feature .task-card { background-color: var(--base-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-members-section-header { background-color: var(--base-bg-color); border-bottom-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-member-card { background-color: var(--base-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .projects-header { background-color: var(--base-bg-color); border-bottom-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-card { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-participants span { background-color: var(--base-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .card-header { background-color: var(--base-bg-color) !important; border-color: var(--card-border-color) !important; }
        body.dark-theme #featureSectionsContainer.file-sharing-feature .filters-section, body.dark-theme #featureSectionsContainer.file-sharing-feature #recentUploadsSection { background-color: var(--base-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.project-tracking-feature .card-header { background-color: var(--base-bg-color) !important; border-color: var(--card-border-color) !important; }
        body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-filters-section { background-color: var(--base-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-visualizations .chart-container { background-color: var(--chart-background) !important; border-color: var(--card-border-color) !important; }
        body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-reminders { background-color: var(--card-bg-color) !important; border-color: var(--card-border-color) !important; }
        body.dark-theme #featureSectionsContainer.project-tracking-feature .pt-reminders li { border-bottom-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.reports-analytics-feature .card-header { background-color: var(--base-bg-color) !important; border-color: var(--card-border-color) !important; }
        body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-filters-section { background-color: var(--base-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.reports-analytics-feature .chart-container { background-color: var(--chart-background) !important; border-color: var(--card-border-color) !important; }
        body.dark-theme #featureSectionsContainer.reports-analytics-feature .ra-table-container { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.innovation-hub-feature .hub-header { background: linear-gradient(90deg, var(--feature-hub-header-bg-start), var(--feature-hub-header-bg-end)); }
        body.dark-theme #featureSectionsContainer.innovation-hub-feature .submission-form-container, body.dark-theme #featureSectionsContainer.innovation-hub-feature .suggestion-card { background-color: var(--card-bg-color); border-color: var(--card-border-color); }
        body.dark-theme #featureSectionsContainer.innovation-hub-feature .suggestion-status.status-under-review { background-color: var(--feature-hub-status-review-bg); color: var(--feature-hub-status-review-text); }
        body.dark-theme #featureSectionsContainer.innovation-hub-feature .suggestion-status.status-implemented { background-color: var(--feature-hub-status-implemented-bg); color: var(--feature-hub-status-implemented-text); }
        body.dark-theme #featureSectionsContainer.innovation-hub-feature .suggestion-status.status-rejected { background-color: var(--feature-hub-status-rejected-bg); color: var(--feature-hub-status-rejected-text); }
        body.dark-theme #featureSectionsContainer.innovation-hub-feature .supervisor-reply { background-color: var(--base-bg-color); }
        body.dark-theme .table thead { background-color: var(--base-bg-color) !important; border-bottom-color: var(--card-border-color) !important; }
        body.dark-theme .table-striped > tbody > tr:nth-of-type(odd) > * { background-color: var(--base-bg-color); }
        body.dark-theme .table-hover > tbody > tr:hover > * { background-color: var(--light); }


        /* --- Notifications Modal, Confirm Modal, Utils --- */
        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; }
        .notifications-modal.active { display: flex; }
        .notifications-container { width: 400px; max-width: 100%; background-color: var(--card-bg-color); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--card-border-color); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; }
        .notifications-title { font-size: 1.25rem; font-weight: 600; }
        .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; }
        .notifications-body { flex-grow: 1; overflow-y: auto; }
        .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--card-border-color); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; cursor: pointer; position: relative; }
        .notification-list-item:hover { background-color: var(--base-bg-color); }
        .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); }
        .notification-list-item:last-child { border-bottom: none; }
        .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa;}
        .notification-content { flex: 1; min-width: 0; }
        .notification-message { margin-bottom: 0.25rem; color: var(--base-text-color); line-height: 1.4; }
        .notification-time { font-size: 0.8rem; color: var(--gray); }
        .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--card-bg-color); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .notification-list-item:hover .delete-notification { opacity: 0.6; }
        .delete-notification:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        body.dark-theme .delete-notification { background: var(--card-bg-color); }
        body.dark-theme .delete-notification:hover { background: rgba(239, 68, 68, 0.2); }
        .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); }
        .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--card-border-color); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--base-bg-color); flex-wrap: wrap; gap: 0.5rem; }
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .confirm-modal.active { display: flex; }
        .confirm-container { background-color: var(--card-bg-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--base-text-color); }
        .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--gray); }
        .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-message.show { transform: translateX(0); }
        .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); }
        .back-button i { transition: transform 0.2s; font-size: 0.8rem; }
        .back-button:hover i { transform: translateX(-3px); }
        .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--card-border-color); border-radius: 8px; margin: 1.5rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; background-color: var(--card-bg-color); }
        .placeholder-content h2 { color: var(--base-text-color); margin-bottom: 1rem; }
        .placeholder-content p { color: var(--gray); }
        .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; }
        .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }

        /* --- Generic Modal Styles (Add/Edit Member, Project, etc.) --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1050; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background-color: var(--card-bg-color); width: 100%; max-width: 550px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out; color: var(--base-text-color); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--card-border-color); }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--primary-dark); }
        body.dark-theme .modal-title { color: #93c5fd; }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;}
        .close-modal:hover { color: var(--danger); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- Checkbox Group --- */
         .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid var(--card-border-color); border-radius: 6px; }
         .checkbox-group label { display: flex; align-items: center; gap: 0.5rem; font-weight: normal; font-size: 0.9rem; margin-bottom: 0; color: var(--base-text-color); }
         .checkbox-group input[type="checkbox"] { width: auto; margin-right: 0.25rem; }
         .settings-link { color: var(--primary); text-decoration: none; cursor: pointer; }
         .settings-link:hover { text-decoration: underline; color: var(--primary-dark); }

        /* --- Toast --- */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; }
        .toast.show { opacity: 1; bottom: 30px; }
        .toast.success { background-color: var(--success); }
        .toast.error { background-color: var(--danger); }

        /* --- Responsive --- */
         @media (max-width: 992px) {
             .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; }
             .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
             .main-content { margin-left: 0; }
             .search-bar { width: 250px; }
             .main-content.sidebar-active { margin-left: 250px; }
             .sidebar-toggle { display: block; position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
             .top-nav { padding-left: 60px; }
             #featureSectionsContainer.task-management-feature .task-list { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
             #featureSectionsContainer.projects-feature .projects-header { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper { width: auto; }
             #featureSectionsContainer.projects-feature .project-controls { justify-content: flex-start; }
         }
         @media (min-width: 993px) { .sidebar-toggle { display: none; } }
         @media (max-width: 768px) {
             .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; }
             .search-bar { width: 100%; order: 2; }
             .user-menu { width: 100%; justify-content: space-between; order: 1; }
             .content-area { padding: 1.5rem; }
             .data-form { grid-template-columns: 1fr; }
             .form-actions { grid-column: span 1; }
             .user-info { flex-direction: column; text-align: center; }
             .user-info-avatar { margin-bottom: 1rem; }
             .stats-section { grid-template-columns: 1fr; }
             .settings-tabs { flex-wrap: nowrap; overflow-x: auto; }
             .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; }
             .confirm-container { width: 90%; }
             #settingsContent .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
             #settingsContent .member-role { margin: 0.5rem 0; }
             #settingsContent .member-actions { margin-top: 0.5rem; width: 100%; justify-content: flex-end; }
             .profile-avatar-section { margin-bottom: 1.5rem; }
             #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; }
             .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; }
             .add-member-form .data-form > div { margin-bottom: 1rem; }
             .add-member-form .data-form > div:last-child { margin-top: 0; }
             #featureSectionsContainer.employee-scheduling .schedule-controls { flex-direction: column; gap: 1rem; align-items: stretch; padding: 0 1rem; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .week-nav { justify-content: space-between; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions { margin-left: 0; width: 100%; }
             #featureSectionsContainer.employee-scheduling .schedule-controls .admin-actions .btn { width: 100%; justify-content: center; }
             #featureSectionsContainer.employee-scheduling .schedule-page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
             #featureSectionsContainer.employee-scheduling .schedule-container { margin: 0 1rem 1rem; }
             #featureSectionsContainer.employee-scheduling .schedule-table { border-spacing: 0; }
             #featureSectionsContainer.employee-scheduling .schedule-table thead th, #featureSectionsContainer.employee-scheduling .schedule-table tbody td { white-space: nowrap; }
             #featureSectionsContainer.employee-scheduling .employee-name { position: sticky !important; left: 0; z-index: 5 !important; border-right: 1px solid var(--card-border-color); background-color: var(--card-bg-color); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--card-bg-color); border-right-color: var(--card-border-color); }
             #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { position: sticky !important; left: 0; z-index: 11 !important; background-color: var(--primary); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { background-color: var(--primary-dark); }
             #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: var(--base-bg-color); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: var(--base-bg-color); }
             #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: var(--primary-light); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name { background-color: #475569; }
             .modal-content { width: 95%; padding: 1.5rem;}
             .notifications-container { width: 100%; max-width: 100%; }
             .sidebar-toggle { top: 10px; left: 10px; }
             .top-nav { padding-top: 60px; }
             #featureSectionsContainer.task-management-feature .controls { flex-direction: column; align-items: stretch; gap: 10px; }
             #featureSectionsContainer.task-management-feature .search-container { margin: 0; }
             #featureSectionsContainer.task-management-feature #add-task-btn { width: 100%; margin-left: 0; order: -1; margin-bottom: 10px; }
             #featureSectionsContainer.task-management-feature .filters { flex-direction: column; width: 100%; gap: 10px; }
             #featureSectionsContainer.task-management-feature .filters select { width: 100%; min-width: unset; }
             #featureSectionsContainer.task-management-feature .task-list { grid-template-columns: 1fr; }
             #featureSectionsContainer.task-management-feature .modal-content { width: 95%; padding: 20px; }
             #featureSectionsContainer.task-management-feature .modal-content .form-row { flex-direction: column; gap: 15px; }
             #featureSectionsContainer.task-management-feature .modal-content .form-row > div { min-width: unset; }
             #featureSectionsContainer.task-management-feature .task-management-content h1 { font-size: 1.8em; }
             #featureSectionsContainer.team-members-feature .team-content-area, #featureSectionsContainer.team-members-feature .team-members-section-header { padding-left: 15px; padding-right: 15px; }
             #featureSectionsContainer.team-members-feature .team-members-section-header h2 { font-size: 1.5rem;}
             #featureSectionsContainer.team-members-feature .team-members-section-header { padding-top: 18px; padding-bottom: 18px; }
             #featureSectionsContainer.team-members-feature .team-filter { max-width: none; }
             #featureSectionsContainer.team-members-feature .team-member-card { flex-direction: column; align-items: flex-start; }
             #featureSectionsContainer.projects-feature .projects-list { grid-template-columns: 1fr; gap: 20px; }
             #featureSectionsContainer.projects-feature .project-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .project-search-input, #featureSectionsContainer.projects-feature .project-filter-select, #featureSectionsContainer.projects-feature .add-project-btn { width: 100%; box-sizing: border-box; }
             #featureSectionsContainer.projects-feature .project-card-image { height: 160px; }
             #featureSectionsContainer.projects-feature .project-name { font-size: 1.25em; }
             #featureSectionsContainer.projects-feature .project-actions .btn { padding: 7px 12px; font-size: 0.8em; }
             #preferencesPanel .theme-options-container { justify-content: center; }
             #featureSectionsContainer.file-sharing-feature .filters-section .col-md-1 { text-align: left !important; margin-top: 0.5rem; }
             #featureSectionsContainer.project-tracking-feature .pt-table .notes-cell { max-width: 150px; }
             #featureSectionsContainer.project-tracking-feature .pt-pagination { justify-content: center; }
             #featureSectionsContainer.reports-analytics-feature .ra-filters-section .row > div { margin-bottom: 0.5rem; }
             #featureSectionsContainer.reports-analytics-feature .ra-export-buttons { text-align: left; margin-top: 0.5rem; }
             #featureSectionsContainer.innovation-hub-feature .hub-header h1 { font-size: 1.5rem; }
             #featureSectionsContainer.innovation-hub-feature #suggestions-list { grid-template-columns: 1fr; }
             #featureSectionsContainer.innovation-hub-feature .hub-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.innovation-hub-feature .hub-controls .form-group, #featureSectionsContainer.innovation-hub-feature .hub-controls button { width: 100%; }
             #featureSectionsContainer.innovation-hub-feature #suggestion-form .form-row { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.innovation-hub-feature #suggestion-form .form-row button { margin-top: 0.5rem; width: 100%; }
         }
         @media (max-width: 480px) {
             .section-header > div { justify-content: center; width: 100%; }
             .welcome-section { padding: 1.5rem; }
             .stats-section { gap: 0.75rem; }
             .stat-card { padding: 1rem; }
             .user-menu { gap: 1rem; }
             .user-name { display: none; }
             .user-status { margin-left: 0; }
             .notifications-footer { flex-direction: column; gap: 0.5rem; }
             .notifications-footer .btn { width: 100%; justify-content: center; }
             #featureSectionsContainer.task-management-feature { padding: 10px; } /* Adjust overall padding */
             #featureSectionsContainer.task-management-feature .card-body { padding: 15px; } /* Adjust inner padding */
             #featureSectionsContainer.task-management-feature .btn { font-size: 0.95em; padding: 9px 15px; }
             #featureSectionsContainer.task-management-feature .modal-content .form-actions .btn { padding: 10px 20px; }
             #featureSectionsContainer.task-management-feature .task-card { padding: 15px; }
             #featureSectionsContainer.task-management-feature .task-card h3 { font-size: 1.15em; }
             #featureSectionsContainer.task-management-feature .task-card p, #featureSectionsContainer.task-management-feature .task-card .description, #featureSectionsContainer.task-management-feature .task-meta { font-size: 0.9em; }
             #featureSectionsContainer.task-management-feature .task-actions button { font-size: 1.1em; margin-left: 8px; }
             #featureSectionsContainer.task-management-feature .modal-content { padding: 20px 15px; }
             #featureSectionsContainer.task-management-feature .modal-content #modal-title { font-size: 1.5em; margin-bottom: 20px; }
             #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: 1fr; gap: 15px; }
             #featureSectionsContainer.team-members-feature .team-member-card { padding: 18px; }
             #featureSectionsContainer.team-members-feature .member-name { font-size: 1.1rem; }
             #featureSectionsContainer.team-members-feature .member-email { font-size: 0.85rem; margin-bottom: 12px; }
             #featureSectionsContainer.team-members-feature .member-role { font-size: 0.8rem; padding: 3px 8px; }
             #featureSectionsContainer.projects-feature .project-actions .btn { flex-grow: 1; justify-content: center; }
             #featureSectionsContainer.file-sharing-feature .action-buttons .btn { padding: 0.3rem 0.7rem; font-size: 0.85rem; }
             #featureSectionsContainer.project-tracking-feature .pt-table tbody td { padding: 0.5rem; }
             #featureSectionsContainer.project-tracking-feature .pt-table .status-badge,
             #featureSectionsContainer.project-tracking-feature .pt-table .priority-badge { padding: 3px 8px; font-size: 0.7rem; }
             #featureSectionsContainer.innovation-hub-feature .hub-header { padding: 1rem 1.5rem; }
             #featureSectionsContainer.innovation-hub-feature .hub-header h1 { font-size: 1.3rem; }
             #featureSectionsContainer.innovation-hub-feature .submission-form-container { padding: 1rem; }
             #featureSectionsContainer.innovation-hub-feature .suggestion-card { padding: 1rem; }
             #featureSectionsContainer.innovation-hub-feature .suggestion-text-display { font-size: 0.95rem; }
         }

        /* Ensure feature container takes up space */
        #featureSectionsContainer { min-height: 400px; }
    </style>
</head>
<body class=""> <!-- JS applies theme -->

    <!-- Hamburger Menu Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Toast/Success Messages -->
    <div class="toast" id="toastMessage">Toast message</div>
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Action successful!</span> </div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="#dashboard" class="logo" data-feature="dashboard">
                <i class="fas fa-users-cog logo-icon"></i>
                <span>TeamFlow</span>
            </a>
             <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar" style="display: none;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>

             <div class="menu-title">Core Features</div>
             <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a> <!-- NEW -->

             <div class="menu-title">Team Tools</div>
             <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a> <!-- Restored -->
             <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a> <!-- NEW -->
             <a href="#deadline-tracker" class="menu-item" data-feature="deadline-tracker"><i class="fas fa-stopwatch"></i><span>Deadline Tracker</span></a> <!-- NEW -->

             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
         <div class="connection-status">
             <div class="status-dot"></div>
             <span>Online</span> <!-- Styling adjusted in CSS -->
         </div>
    </aside>

    <main class="main-content" id="mainContent">
         <nav class="top-nav">
             <div class="search-bar">
                 <i class="fas fa-search search-icon"></i>
                 <input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off">
                 <div class="search-results" id="searchResults"></div>
             </div>
             <div class="user-menu">
                 <div class="notification-icon" id="notificationIcon">
                     <i class="fas fa-bell"></i>
                     <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                 </div>
                 <div class="user-profile" id="userProfileContainer">
                     <div class="user-avatar" id="userAvatar">ME</div>
                     <div class="user-profile-details">
                         <span class="user-name" id="userName">Loading...</span>
                         <span class="user-status">  Connected</span>
                     </div>
                     <div class="user-dropdown" id="userDropdown">
                         <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a>
                         <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a>
                         <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                     </div>
                 </div>
             </div>
         </nav>

         <div class="content-area">
             <!-- Back Button -->
             <div class="back-button" id="backButton" style="display: none;">
                 <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span>
             </div>

             <!-- Dashboard Content -->
             <div id="dashboardContent" class="content-section active">
                 <div class="welcome-section" id="welcomeSection">
                     <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2>
                     <p class="welcome-subtitle">Here's what's happening with your team today.</p>
                     <div class="user-info">
                         <div class="user-info-avatar" id="profileAvatar">U</div>
                         <div class="user-info-details">
                             <div class="user-info-name" id="userInfoName">Loading User...</div>
                             <div class="user-info-title" id="userInfoRoleTitle">Loading Role...</div>
                             <div class="user-info-email">
                                 <i class="fas fa-envelope"></i> <span id="userEmail">loading@email.com</span>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="stats-section" id="statsSection">
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                 </div>
                 <div class="activity-section">
                     <div class="section-header">
                         <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3>
                         <div>
                             <span class="view-all" id="viewAllActivity">Show All</span>
                             <span class="delete-all" id="deleteAllActivity">Delete All</span>
                         </div>
                     </div>
                     <ul class="activity-list" id="activityList">
                         <li style="text-align: center; padding: 2rem; color: var(--gray);"> Loading activities... </li>
                     </ul>
                 </div>
             </div>

             <!-- Profile Content -->
             <div class="content-section" id="profileContent">
                 <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Your personal information and account security settings.</p>
                 <div class="profile-avatar-section">
                     <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--base-text-color);">Avatar</label>
                     <div id="profileAvatarLarge" title="Click to upload photo">ME</div>
                     <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                 </div>
                 <form class="data-form" id="profileForm">
                     <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control" value=""> </div>
                     <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control" value=""> </div>
                     <div class="form-actions">
                         <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button>
                         <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                            <span class="btn-text">Save Changes</span>
                            <span class="spinner" style="display: none;"></span>
                         </button>
                     </div>
                 </form>
             </div>

             <!-- Settings Content -->
             <div class="content-section" id="settingsContent">
                 <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                 <div class="settings-tabs">
                     <div class="settings-tab active" data-tab="preferences">Preferences</div>
                     <div class="settings-tab" data-tab="account">Account</div>
                     <div class="settings-tab" data-tab="security">Security</div>
                     <div class="settings-tab" data-tab="notifications">Notifications</div>
                     <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div>
                     <div class="settings-tab" data-tab="collaboration">Collaboration</div>
                     <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div>
                 </div>

                 <!-- Settings Panels Here (Preferences, Account, Security, etc.) -->
                 <div class="settings-panel active" id="preferencesPanel"> <!-- Preferences Panel -->
                    </div> <div class="settings-panel" id="accountPanel"> <!-- Account Panel -->
                    </div> <div class="settings-panel" id="securityPanel"> <!-- Security Panel -->
                    </div> <div class="settings-panel" id="notificationsPanel"> <!-- Notifications Panel -->
                    </div> <div class="settings-panel" id="teamPanel"> <!-- Team Management Panel -->
                         <div class="team-management">
                             <div class="settings-subsection">
                                 <h4>Team Members</h4>
                                 <div class="team-list" id="teamList"> <p>Loading team members...</p> </div>
                                 <div class="add-member-form">
                                     <h4>Invite New Member</h4>
                                     <form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;">
                                        <div class="form-group"> <label for="inviteEmail">Email</label> <input type="email" id="inviteEmail" class="form-control" required> </div>
                                        <div class="form-group"> <label for="inviteRole">Role</label> <select id="inviteRole" class="form-select" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                                        <button type="submit" class="btn btn-primary">Invite</button>
                                     </form>
                                 </div>
                                 <div class="mt-4 pt-3 border-top" id="deleteAllUsersSection" style="display: none;">
                                     <h5 class="text-danger">Bulk Actions</h5>
                                     <div class="d-flex justify-content-between align-items-center">
                                         <div><p class="mb-0">Delete all non-administrator users.</p><small class="text-muted">This action cannot be undone.</small></div>
                                         <button class="btn btn-danger" id="deleteAllNonAdminUsersBtn"> <i class="fas fa-users-slash"></i> Delete Non-Admins </button>
                                     </div>
                                 </div>
                             </div>
                             <div class="settings-subsection">
                                 <h4>Custom Role Permissions</h4>
                                 <p class="setting-item-description">Define specific permissions for different roles within your team (Feature placeholder - requires backend).</p>
                                 <button class="btn btn-outline" disabled>Manage Permissions</button>
                             </div>
                         </div>
                    </div> <div class="settings-panel" id="collaborationPanel"> <!-- Collaboration Panel -->
                    </div> <div class="settings-panel" id="dangerPanel"> <!-- Danger Zone Panel -->
                 </div>
             </div>

             <!-- Container for dynamically loaded feature sections -->
             <div id="featureSectionsContainer" class="content-section">
                 <!-- Placeholder initially visible -->
                 <div class="placeholder-content" id="featurePlaceholder">
                     <h2 id="featureTitle">Feature Content Area</h2>
                     <p id="featureDescription">Select a feature from the sidebar.</p>
                     <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                     <div class="error-message" style="display: none;"> Failed to load content. </div>
                 </div>
                 <!-- Feature content will be injected here -->
             </div>
         </div>
    </main>

    <!-- Notification Modal -->
    <div class="notifications-modal" id="notificationsModal"> <!-- ... (Modal Content) ... --> </div>
    <!-- Confirm Modal -->
    <div class="confirm-modal" id="confirmModal"> <!-- ... (Modal Content) ... --> </div>
    <!-- Member Add/Edit Modal -->
    <div class="modal" id="memberModal"> <!-- ... (Modal Content) ... --> </div>
    <!-- Project Add/Edit Modal -->
    <div class="modal" id="projectModal"> <!-- ... (Modal Content) ... --> </div>
    <!-- Shift Edit Modal -->
    <div class="modal" id="editShiftModal"> <!-- ... (Modal Content) ... --> </div>
    <!-- Task Management Modal -->
    <div class="modal" id="task-modal"> <!-- ... (Modal Content) ... --> </div>
    <!-- File Sharing Modals -->
    <div class="modal fade" id="uploadFileModal"> <!-- ... (Modal Content) ... --> </div>
    <div class="modal fade" id="filePreviewModal"> <!-- ... (Modal Content) ... --> </div>

    <!-- ========= Feature Templates ========= -->
    <template id="placeholderAssets">
        <div class="placeholder-content">
             <h2>Feature Placeholder</h2>
             <p>This feature is not yet implemented.</p>
        </div>
    </template>
    <template id="taskManagementAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="fileSharingAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="projectTrackingAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="reportsAnalyticsAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="employeeSchedulingAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="teamMembersAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="projectsAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <template id="innovationHubAssets"> <!-- ... (Template Content - unchanged) ... --> </template>
    <!-- ========= END Feature Templates ========= -->


    <!-- JS Libraries (Bootstrap, Chart.js, SweetAlert2, jsPDF, jsPDF-AutoTable) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements (Most are fetched within functions now) ---
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.menu-item');
            const contentSections = document.querySelectorAll('.content-area > .content-section'); // Direct children
            const dashboardContent = document.getElementById('dashboardContent');
            const profileContent = document.getElementById('profileContent');
            const settingsContent = document.getElementById('settingsContent');
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureLoadingEl = featurePlaceholder.querySelector('.loading-indicator');
            const featureErrorEl = featurePlaceholder.querySelector('.error-message');
            const backButton = document.getElementById('backButton');
            const backButtonText = document.getElementById('backButtonText');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const searchInput = document.getElementById('searchInput');
            const searchResultsContainer = document.getElementById('searchResults');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationBadge = document.getElementById('notificationBadge');
            const notificationsModal = document.getElementById('notificationsModal');
            const closeNotifications = document.getElementById('closeNotifications');
            const notificationsBody = document.getElementById('notificationsBody');
            const noNotificationsMessage = document.getElementById('noNotificationsMessage');
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn');
            // Removed notificationSound element
            const activityList = document.getElementById('activityList');
            const viewAllActivity = document.getElementById('viewAllActivity');
            const deleteAllActivity = document.getElementById('deleteAllActivity');
            const statsSection = document.getElementById('statsSection');
            const welcomeSection = document.getElementById('welcomeSection');
            // Profile Elements (Fetched when needed)
            // Settings Elements (Fetched when needed)
            // Modals (Fetched when needed)
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const successMessage = document.getElementById('successMessage');
            const successMessageText = document.getElementById('successMessageText');
            const toastMessage = document.getElementById('toastMessage');
            const logoutLink = document.getElementById('logoutLink');

            // --- State Variables ---
            let currentUser = null;
            let currentFeature = 'dashboard';
            let currentSettingsTab = 'preferences';
            let notifications = [];
            let activities = [];
            let activityIntervalId = null;
            let notificationIntervalId = null;
            let statsIntervalId = null;
            let welcomeBgIntervalId = null;
            let confirmCallback = null;
            let maxActivitiesToShow = 5;
            let showingAllActivities = false;
            let userDropdownOpen = false;
            let showToasts = true;
            let playSounds = false; // Disable sound by default as file is removed
            let currentScheduleWeekOffset = 0;
            let scheduleMinWeekOffset = 0;
            let mockScheduleData = {};
            let currentFeatureCleanup = null;
            let MOCK_PROJECTS_DATA = [];
            let MOCK_USERS = [];
            let MOCK_TASKS = [];

            // --- Mock Data (Embedded) ---
            function loadMockData() {
                 MOCK_USERS = [
                     { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin', twoFaEnabled: false },
                     { id: 2, name: 'Nada Mahmoud', email: 'n.mahmoud@thechefz.co', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'NM', role: 'supervisor', twoFaEnabled: false },
                     { id: 3, name: 'Yousef Ahmed', email: 'y.abbas@thechefz.co', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'YA', role: 'senior', twoFaEnabled: true },
                     { id: 4, name: 'Esraa Lashin', email: 'e.lasheen@thechefz.co', title: 'Member', department: 'Design', phone: '+20155444333', avatar: '', initials: 'EL', role: 'member', twoFaEnabled: false },
                     { id: 5, name: 'Bassant Badr', email: 'b.badr@thechefz.co', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'BB', role: 'member', twoFaEnabled: false },
                 ];
                 MOCK_TASKS = [
                    { id: 201, name: 'Design Homepage Mockup', status: 'Completed', project: 101 },
                    { id: 202, name: 'Develop API Endpoints', status: 'In Progress', project: 101 },
                    { id: 203, name: 'User Testing Phase 1', status: 'Pending', project: 102 },
                    { id: 204, name: 'Create Task Management Feature', status: 'Active', project: 104 },
                ];
                 MOCK_PROJECTS_DATA = [
                    { id: 101, name: 'Project Alpha', status: 'active', participants: "Mohamed Elmenisy|Yousef Ahmed", img: "https://images.unsplash.com/photo-1517048676732-d65bc937f952?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 65, startDate: "2023-08-15", updatedDate: "2024-03-10", editable: true, description: "Main company website overhaul." },
                    { id: 102, name: 'Website Redesign', status: 'completed', participants: "Esraa Lashin|Bassant Badr", img: "https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 100, startDate: "2023-05-01", updatedDate: "2024-01-20", editable: false, description: "Redesign of the public marketing site." },
                    { id: 103, name: 'Mobile App V2', status: 'in-progress', participants: "Yousef Ahmed|Mohamed Elmenisy", img: "https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 20, startDate: "2024-02-20", updatedDate: "2024-03-05", editable: true, description: "Version 2 development for iOS and Android." },
                    { id: 104, name: 'Q4 Marketing Plan', status: 'pending', participants: "Bassant Badr|Nada Mahmoud", img: "https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 0, startDate: "2024-09-01", updatedDate: "2024-03-12", editable: true, description: "Planning for the Q4 marketing campaign." },
                    { id: 105, name: 'Server Migration', status: 'in-progress', participants: "Yousef Ahmed", img: "https://images.unsplash.com/photo-1580894742597-87bc8789db3d?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60", progress: 85, startDate: "2024-01-10", updatedDate: "2024-03-15", editable: true, description: "Migrating servers to new infrastructure." }
                ];
                 console.log("Mock data embedded and loaded.");
            }

            // --- UTILITY FUNCTIONS (Moved to Global Scope) ---
            const addListener = (element, event, handler, options = {}) => {
                if (!element) return;
                element.addEventListener(event, handler, options);
                // Note: Listener cleanup needs to be managed within feature cleanup now
            };
            window.timeAgo = function(timestamp) { /* ... (Same as before) ... */ if(!timestamp)return 'N/A';if(!(timestamp instanceof Date)){const date=new Date(timestamp);if(isNaN(date.getTime()))return 'Invalid Date';timestamp=date;}const now=new Date();const secondsPast=(now.getTime()-timestamp.getTime())/1000;if(secondsPast<10){return 'Just now';}if(secondsPast<60){return parseInt(secondsPast)+'s ago';}if(secondsPast<3600){return parseInt(secondsPast/60)+'m ago';}if(secondsPast<3600*24){return parseInt(secondsPast/3600)+'h ago';}return formatDateForDisplay(timestamp); }
            window.formatDateForDisplay = function(date) { /* ... (Same as before) ... */ if(!date) return 'N/A'; if(!(date instanceof Date)){const parsedDate=new Date(date);if(isNaN(parsedDate.getTime()))return 'N/A';date=parsedDate;}const dateFormat=localStorage.getItem('dateFormat')||'MM/DD/YYYY';const year=date.getFullYear();const month=date.getMonth()+1;const day=date.getDate();const monthPadded=String(month).padStart(2,'0');const dayPadded=String(day).padStart(2,'0');const monthName=date.toLocaleDateString(undefined,{month:'short'});try{switch(dateFormat){case 'DD/MM/YYYY':return `${dayPadded}/${monthPadded}/${year}`;case 'YYYY-MM-DD':return `${year}-${monthPadded}-${dayPadded}`;case 'Month D, YYYY':return `${monthName} ${day}, ${year}`;case 'MM/DD/YYYY':default:return `${monthPadded}/${dayPadded}/${year}`;}}catch(e){console.error("Error formatting date:",e);return `${String(month).padStart(2,'0')}/${String(day).padStart(2,'0')}/${year}`;}}
            window.formatFullDateTime = function(date) { /* ... (Same as before) ... */ if(!date) return 'N/A'; if(!(date instanceof Date)){const parsedDate=new Date(date);if(isNaN(parsedDate.getTime()))return 'N/A';date=parsedDate;}const formattedDate=formatDateForDisplay(date);const timeFormat=localStorage.getItem('timeFormat')||'12h';const options={hour:'numeric',minute:'numeric',hour12:timeFormat==='12h'};try{const formattedTime=date.toLocaleTimeString(undefined,options);return `${formattedDate}, ${formattedTime}`;}catch(e){console.error("Error formatting time:",e);return formattedDate;}}
            window.generateMockActivities = function(count, baseTimestampMillis) { /* ... (Same as before) ... */ const nowMillis=baseTimestampMillis||Date.now();const newActivities=[];let users=MOCK_USERS.map(u=>u.name.split(' ')[0]);if(users.length===0)users.push('System');const actions=['updated profile','completed task','added project','commented on task','uploaded file','joined team'];const icons=['fa-user-edit','fa-check-circle','fa-plus-circle','fa-comment','fa-upload','fa-user-plus'];const tasks=MOCK_TASKS.map(t=>`'${t.name.substring(0,20)}...'`);const projects=MOCK_PROJECTS_DATA.map(p=>`'${p.name}'`);const files=['doc.pdf','img.png','sheet.xlsx','pres.pptx'];for(let i=0;i<count;i++){const user=users[Math.floor(Math.random()*users.length)];const actionIndex=Math.floor(Math.random()*actions.length);let message=`${user} ${actions[actionIndex]}`;if(actions[actionIndex].includes('task')&&tasks.length>0){message+=` ${tasks[Math.floor(Math.random()*tasks.length)]}`;}else if(actions[actionIndex].includes('project')&&projects.length>0){message+=` ${projects[Math.floor(Math.random()*projects.length)]}`;}else if(actions[actionIndex].includes('file')&&files.length>0){message+=` ${files[Math.floor(Math.random()*files.length)]}`;}let timestampMillis;if(count===1){timestampMillis=nowMillis-Math.random()*1000*10;}else{timestampMillis=nowMillis-(Math.random()*1000*3600*(i+1)*1.5+300000);}timestampMillis=Math.min(timestampMillis,nowMillis);newActivities.push({id:nowMillis+i+Math.floor(Math.random()*1000),icon:icons[actionIndex],message:message,timestamp:new Date(timestampMillis),isNew:false});}return count>1?newActivities.sort((a,b)=>b.timestamp-a.timestamp):newActivities; }
            window.generateMockNotifications = function(count, baseTimestampMillis) { /* ... (Same as before) ... */ const nowMillis=baseTimestampMillis||Date.now();const newNotifications=[];const types=[{msg:'New task assigned:',icon:'fa-tasks',type:'task'},{msg:'Project deadline approaching:',icon:'fa-clock',type:'project'},{msg:'Mentioned you:',icon:'fa-comment-dots',type:'comment'},{msg:'System update:',icon:'fa-info-circle',type:'system'},{msg:'File shared:',icon:'fa-file-alt',type:'file'},];const tasks=MOCK_TASKS.map(t=>`'${t.name.substring(0,20)}...'`);const projects=MOCK_PROJECTS_DATA.map(p=>`'${p.name}'`);let users=MOCK_USERS.map(u=>u.name.split(' ')[0]);if(users.length===0)users.push('System');const files=['report.docx','logo.svg','data.csv'];for(let i=0;i<count;i++){const typeInfo=types[Math.floor(Math.random()*types.length)];let message=typeInfo.msg;if(typeInfo.type==='task'&&tasks.length>0)message+=` ${tasks[Math.floor(Math.random()*tasks.length)]}`;else if(typeInfo.type==='project'&&projects.length>0)message+=` ${projects[Math.floor(Math.random()*projects.length)]}`;else if(typeInfo.type==='comment'&&users.length>0)message+=` by ${users[Math.floor(Math.random()*users.length)]}`;else if(typeInfo.type==='file'&&files.length>0&&users.length>0)message+=` ${files[Math.floor(Math.random()*files.length)]} by ${users[Math.floor(Math.random()*users.length)]}`;let timestampMillis;if(count===1){timestampMillis=nowMillis-Math.random()*1000*15;}else{timestampMillis=nowMillis-(Math.random()*1000*3600*(i+1)*1.8+180000);}timestampMillis=Math.min(timestampMillis,nowMillis);newNotifications.push({id:nowMillis+i+10000+Math.floor(Math.random()*1000),icon:typeInfo.icon,message:message,timestamp:new Date(timestampMillis),unread:count===1?true:Math.random()>0.3});}return count>1?newNotifications.sort((a,b)=>b.timestamp-a.timestamp):newNotifications;}
            window.showConfirmModal = function(title, message, onConfirm, buttonClass = 'btn-danger') { /* ... (Same as before) ... */ confirmTitle.textContent=title;confirmMessage.innerHTML=message;confirmCallback=onConfirm;confirmBtn.className='btn';confirmBtn.classList.add(buttonClass);confirmModal.classList.add('active');}
            function hideConfirmModal() { /* ... (Same as before) ... */ confirmModal.classList.remove('active');confirmCallback=null;}
            window.showSuccessMessage = function(message) { /* ... (Same as before) ... */ successMessageText.textContent=message;successMessage.classList.add('show');setTimeout(()=>{successMessage.classList.remove('show');},3000);}
            window.showToast = function(message, type = 'info') { /* ... (Same as before) ... */ if(!showToasts&&type!=='error'){console.log("Toast suppressed:",message);return;}toastMessage.textContent=message;toastMessage.className='toast';if(type==='success'){toastMessage.classList.add('success');}else if(type==='error'){toastMessage.classList.add('error');}toastMessage.classList.add('show');setTimeout(()=>{toastMessage.classList.remove('show');},3000);}
            function getCurrentDate() { return new Date().toISOString().split('T')[0]; }
            function getShiftText(type) { switch (type) { case 'morning': return '9AM-5PM'; case 'afternoon': return '12PM-8PM'; case 'night': return '8PM-4AM'; case 'off': return 'OFF'; case 'sick': return 'Sick'; case 'vacation': return 'Vacation'; default: return 'N/A'; } } // Moved global


            // --- Initialization ---
            function initDashboard() {
                loadMockData(); // Load data first
                currentUser = { ...MOCK_USERS[0] }; // Assume first user logs in
                window.currentUser = currentUser;
                console.log("Initializing dashboard for:", currentUser.name);
                applyStoredPreferences();
                updateUserUI();
                setupEventListeners(); // Use the moved addListener
                loadInitialData();
                handleInitialNavigation();
                startDynamicUpdates();
                setupResponsiveSidebar(); // Should call moved addListener
            }

            // --- FEATURE INITIALIZATION FUNCTIONS (Defined Globally) ---
            window.initializePlaceholderFeature = function(container) { /* ... (Same as before) ... */ console.log("Initializing placeholder feature..."); const h2 = container.querySelector('h2'); const featureId = container.parentElement.dataset.featureId || 'Feature'; const featureName = featureId.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '); if (h2) h2.textContent = featureName; const p = container.querySelector('p'); if (p) p.textContent = `Content for ${featureName} will be loaded here.`; return { cleanup: () => console.log(`Cleaning up placeholder for ${featureName}`) }; }
            window.initializeTaskManagementFeature = function(container) { /* ... (JS Logic from Task Management template) ... */ console.log("Initializing Task Management Feature...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("Task Management card body not found!");return {cleanup:()=>{}};}const taskContentContainer=cardBody.querySelector('.task-management-content');const addTaskBtn=taskContentContainer?.querySelector('#add-task-btn');const taskListDiv=taskContentContainer?.querySelector('#task-list');const searchInput=taskContentContainer?.querySelector('#search-input');const filterStatusSelect=taskContentContainer?.querySelector('#filter-status');const filterPrioritySelect=taskContentContainer?.querySelector('#filter-priority');const filterAssignedToSelect=taskContentContainer?.querySelector('#filter-assigned-to');const taskModal=document.getElementById('task-modal');const closeModalBtns=taskModal?.querySelectorAll('.close-modal, #cancel-btn');const taskForm=taskModal?.querySelector('#task-form');const modalTitle=taskModal?.querySelector('#modal-title');const saveTaskBtn=taskModal?.querySelector('#save-task-btn');const taskIdInput=taskModal?.querySelector('#task-id');const taskNameInput=taskModal?.querySelector('#task-name');const taskDescriptionInput=taskModal?.querySelector('#task-description');const taskLinksInput=taskModal?.querySelector('#task-links');const taskAssignedBySelect=taskModal?.querySelector('#task-assigned-by');const taskAssignedToSelect=taskModal?.querySelector('#task-assigned-to');const taskStartDateInput=taskModal?.querySelector('#task-start-date');const taskDueDateInput=taskModal?.querySelector('#task-due-date');const taskPrioritySelect=taskModal?.querySelector('#task-priority');const taskStatusSelect=taskModal?.querySelector('#task-status');if(!taskContentContainer||!taskListDiv||!taskModal||!taskForm||!addTaskBtn||!searchInput||!filterStatusSelect||!filterPrioritySelect||!filterAssignedToSelect){console.error("Essential Task Management elements missing.");if(taskListDiv)taskListDiv.innerHTML='<p class="no-tasks text-danger">Error loading task components.</p>';return {cleanup:()=>{}};}let tasks=[];let featureListeners=[];const addFeatureListener=(element,event,handler)=>{if(!element)return;element.addEventListener(event,handler);featureListeners.push({element,event,handler});};const loadTasks=()=>{const storedTasks=localStorage.getItem('dashboard_tasks');if(storedTasks){try{tasks=JSON.parse(storedTasks);}catch(e){console.error("Error parsing tasks:",e);tasks=getDefaultTasks();}}else{tasks=getDefaultTasks();}populateAssigneeFilters();renderTasks();};function getDefaultTasks(){return [{id:1,name:"Setup Project Environment",description:"Install Node.js, npm packages, and configure.",links:"https://nodejs.org",assignedBy:"Nada Mahmoud",assignedTo:"Mohamed Elmenisy",startDate:"2024-07-20",dueDate:"2024-07-22",priority:"High",status:"In Progress",completionDate:null},{id:2,name:"Design UI Mockups",description:"Create mockups for main pages using Figma.",links:"https://figma.com",assignedBy:"Yousef Ahmed",assignedTo:"Esraa Lashin",startDate:"2024-07-21",dueDate:"2024-07-25",priority:"Medium",status:"Pending",completionDate:null},{id:3,name:"Develop API Endpoints",description:"Build RESTful APIs.",links:"",assignedBy:"Self Assigned",assignedTo:"Yousef Ahmed",startDate:"2024-07-23",dueDate:"2024-07-30",priority:"High",status:"Pending",completionDate:null},{id:4,name:"Client Meeting Prep",description:"Prepare presentation slides.",links:"",assignedBy:"Nada Mahmoud",assignedTo:"Bassant Badr",startDate:"2024-07-28",dueDate:"2024-07-29",priority:"Medium",status:"Pending",completionDate:null},{id:5,name:"Review Code Submission",description:"Review 'feature/login' branch.",links:"https://github.com, PR #42",assignedBy:"Self Assigned",assignedTo:"Mohamed Elmenisy",startDate:"2024-07-26",dueDate:"2024-07-26",priority:"Low",status:"Completed",completionDate:"2024-07-25"},{id:6,name:"Fix Login Bug (JIRA-123)",description:"Special characters issue.",links:"jira-123",assignedBy:"Yousef Ahmed",assignedTo:"Yousef Ahmed",startDate:"2024-07-15",dueDate:"2024-07-18",priority:"High",status:"In Progress",completionDate:null}];}const saveTasks=()=>{localStorage.setItem('dashboard_tasks',JSON.stringify(tasks));};const formatDate=window.formatDateForDisplay;const getCurrentDate=()=>new Date().toLocaleDateString('en-CA');const isOverdue=(task)=>{if(task.status==='Completed'||!task.dueDate)return false;try{const dueDate=new Date(task.dueDate+'T00:00:00Z');const today=new Date();const todayUTC=new Date(Date.UTC(today.getUTCFullYear(),today.getUTCMonth(),today.getUTCDate()));if(isNaN(dueDate.getTime()))return false;return dueDate<todayUTC;}catch(e){console.error("Error checking overdue:",e);return false;}};function populateAssigneeFilters(){const assigneeSet=new Set(window.MOCK_USERS.map(user=>user.name));if(!filterAssignedToSelect||!taskAssignedToSelect||!taskAssignedBySelect)return;filterAssignedToSelect.innerHTML='<option value="all" selected>All Assignees</option>';taskAssignedToSelect.innerHTML='';taskAssignedBySelect.innerHTML='<option value="Self Assigned">Self Assigned</option>';assigneeSet.forEach(name=>{const option=document.createElement('option');option.value=name;option.textContent=name;filterAssignedToSelect.appendChild(option.cloneNode(true));taskAssignedToSelect.appendChild(option.cloneNode(true));if(name!==window.currentUser?.name){taskAssignedBySelect.appendChild(option.cloneNode(true));}});if(taskAssignedBySelect.value==='Self Assigned'&&window.currentUser){const userOption=taskAssignedBySelect.querySelector(`option[value="${window.currentUser.name}"]`);if(!userOption){const option=document.createElement('option');option.value=window.currentUser.name;option.textContent=window.currentUser.name;taskAssignedBySelect.appendChild(option);}}}const renderTasks=()=>{taskListDiv.innerHTML='';const searchTerm=searchInput.value.toLowerCase();const statusFilter=filterStatusSelect.value;const priorityFilter=filterPrioritySelect.value;const assignedToFilter=filterAssignedToSelect.value;let tasksToDisplay=tasks.filter(task=>{const taskStatus=task.status||'';const taskPriority=task.priority||'';const taskAssignedTo=task.assignedTo||'';const statusMatch=statusFilter==='all'||taskStatus===statusFilter;const priorityMatch=priorityFilter==='all'||taskPriority===priorityFilter;const assignedToMatch=assignedToFilter==='all'||taskAssignedTo===assignedToFilter;const searchMatch=!searchTerm||(task.name||'').toLowerCase().includes(searchTerm)||(task.description||'').toLowerCase().includes(searchTerm)||(task.links||'').toLowerCase().includes(searchTerm)||(task.assignedTo||'').toLowerCase().includes(searchTerm)||(task.assignedBy||'').toLowerCase().includes(searchTerm);return statusMatch&&priorityMatch&&assignedToMatch&&searchMatch;});if(tasksToDisplay.length===0){taskListDiv.innerHTML='<p class="no-tasks" style="grid-column: 1 / -1;">No tasks found matching your criteria.</p>';return;}tasksToDisplay.sort((a,b)=>{const statusOrder={"Pending":1,"In Progress":1,"Completed":2};const statusA=statusOrder[a.status]||3;const statusB=statusOrder[b.status]||3;if(statusA!==statusB)return statusA-statusB;const dateA=a.dueDate?new Date(a.dueDate+'T00:00:00Z'):null;const dateB=b.dueDate?new Date(b.dueDate+'T00:00:00Z'):null;const dateValA=dateA&&!isNaN(dateA)?dateA.getTime():Infinity;const dateValB=dateB&&!isNaN(dateB)?dateB.getTime():Infinity;if(dateValA!==dateValB)return dateValA-dateValB;const priorityOrder={High:3,Medium:2,Low:1};const priorityA=priorityOrder[a.priority]||0;const priorityB=priorityOrder[b.priority]||0;return priorityB-priorityA;});tasksToDisplay.forEach(task=>{const taskCard=document.createElement('div');taskCard.classList.add('task-card');taskCard.dataset.taskId=task.id;if(task.priority)taskCard.classList.add(`priority-${task.priority}`);if(task.status)taskCard.classList.add(`status-${task.status.replace(/\s+/g,'')}`);if(task.status==='Completed')taskCard.classList.add('task-completed');if(isOverdue(task))taskCard.classList.add('task-overdue');const overdue=isOverdue(task);const overdueText=overdue?`<span class="overdue-indicator">(Overdue!)</span>`:'';let linksHTML='N/A';if(task.links&&task.links.trim()){linksHTML=task.links.split(',').map(l=>l.trim()).filter(l=>l).map(link=>{let href=link;let isUrl=false;try{const url=new URL(link.startsWith('http')?link:`http://${link}`);if(url.hostname&&(url.hostname.includes('.')||url.hostname.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/))){isUrl=true;href=url.protocol+"//"+url.hostname+url.pathname+url.search+url.hash;}else{href=link;}}catch(_){isUrl=false;href=link;}const displayText=link.length>35?link.substring(0,32)+'...':link;return isUrl?`<a href="${href}" target="_blank" rel="noopener noreferrer" title="${link}">${displayText}</a>`:`<span title="${link}">${displayText}</span>`;}).join(' ');}taskCard.innerHTML=`<h3>${task.name||'Unnamed'}</h3>${task.description?`<p class="description">${task.description}</p>`:''}<div class="task-meta"><div><span><strong>To:</strong> ${task.assignedTo||'N/A'}</span> <span><strong>By:</strong> ${task.assignedBy||'N/A'}</span></div><div> <span><strong>Start:</strong> ${formatDate(task.startDate)}</span> <span><strong>Due:</strong> ${formatDate(task.dueDate)} ${overdueText}</span> </div><div> <span><strong>Priority:</strong> ${task.priority||'N/A'}</span> <span><strong>Status:</strong> <span class="status-badge status-${(task.status||'').replace(/\s+/g,'')}">${task.status||'N/A'}</span></span> </div>${task.status==='Completed'?`<div><span><strong>Completed:</strong> ${formatDate(task.completionDate)}</span></div>`:''}<div><strong>Links:</strong> <span class="links">${linksHTML}</span></div></div><div class="task-actions"><button class="edit-btn" title="Edit"><i class="fas fa-edit"></i></button><button class="delete-btn" title="Delete"><i class="fas fa-trash-alt"></i></button>${task.status==='Completed'?`<button class="reopen-btn" title="Reopen"><i class="fas fa-undo"></i></button>`:`<button class="complete-btn" title="Complete"><i class="fas fa-check-circle"></i></button>`}</div>`;addFeatureListener(taskCard.querySelector('.edit-btn'),'click',(e)=>{e.stopPropagation();openEditModal(task.id);});addFeatureListener(taskCard.querySelector('.delete-btn'),'click',(e)=>{e.stopPropagation();deleteTask(task.id);});const completeOrReopenBtn=taskCard.querySelector('.complete-btn, .reopen-btn');if(completeOrReopenBtn)addFeatureListener(completeOrReopenBtn,'click',(e)=>{e.stopPropagation();toggleTaskStatus(task.id);});taskListDiv.appendChild(taskCard);});};const showModal=()=>{taskModal.classList.add('active');document.body.style.overflow='hidden';};const hideModal=()=>{taskModal.classList.remove('active');taskForm.reset();taskIdInput.value='';modalTitle.textContent="Add New Task";saveTaskBtn.textContent="Save Task";document.body.style.overflow='';};const openAddModal=()=>{hideModal();modalTitle.textContent="Add New Task";saveTaskBtn.textContent="Save Task";taskStatusSelect.value="Pending";taskPrioritySelect.value="Medium";showModal();taskNameInput.focus();};const openEditModal=(id)=>{const task=tasks.find(t=>t.id===id);if(!task)return;hideModal();modalTitle.textContent="Edit Task";saveTaskBtn.textContent="Update Task";taskIdInput.value=task.id;taskNameInput.value=task.name;taskDescriptionInput.value=task.description||'';taskLinksInput.value=task.links||'';taskAssignedBySelect.value=task.assignedBy;taskAssignedToSelect.value=task.assignedTo;taskStartDateInput.value=task.startDate||'';taskDueDateInput.value=task.dueDate||'';taskPrioritySelect.value=task.priority;taskStatusSelect.value=task.status;showModal();taskNameInput.focus();};const handleFormSubmit=(event)=>{event.preventDefault();const taskId=taskIdInput.value?parseInt(taskIdInput.value):Date.now();const currentTask=tasks.find(t=>t.id===taskId);const newStatus=taskStatusSelect.value;let completionDate=currentTask?.completionDate||null;if(newStatus==='Completed'){if(!taskIdInput.value||(currentTask&&currentTask.status!=='Completed')){completionDate=getCurrentDate();}}else{completionDate=null;}const startDate=taskStartDateInput.value;const dueDate=taskDueDateInput.value;if(startDate&&dueDate&&new Date(dueDate)<new Date(startDate)){alert("Due Date cannot be before Start Date.");taskDueDateInput.focus();return;}const taskData={id:taskId,name:taskNameInput.value.trim(),description:taskDescriptionInput.value.trim(),links:taskLinksInput.value.trim(),assignedBy:taskAssignedBySelect.value,assignedTo:taskAssignedToSelect.value,startDate:startDate||null,dueDate:dueDate||null,priority:taskPrioritySelect.value,status:newStatus,completionDate:completionDate};if(!taskData.name){alert("Task Name is required.");taskNameInput.focus();return;}if(taskIdInput.value){const index=tasks.findIndex(task=>task.id===taskData.id);if(index>-1){tasks[index]=taskData;}else{console.warn(`Task ${taskData.id} not found for edit.`);tasks.push(taskData);}}else{tasks.push(taskData);}saveTasks();renderTasks();hideModal();};const deleteTask=(id)=>{const taskToDelete=tasks.find(t=>t.id===id);window.showConfirmModal(`Delete Task`,`Are you sure you want to delete "${taskToDelete?.name||id}"?`,()=>{tasks=tasks.filter(task=>task.id!==id);saveTasks();renderTasks();window.showToast('Task deleted.','success');},'btn-danger');};const toggleTaskStatus=(id)=>{tasks=tasks.map(task=>{if(task.id===id){if(task.status==='Completed'){return {...task,status:'Pending',completionDate:null};}else{return {...task,status:'Completed',completionDate:getCurrentDate()};}}return task;});saveTasks();renderTasks();window.showToast('Task status updated.','success');};addFeatureListener(addTaskBtn,'click',openAddModal);closeModalBtns.forEach(btn=>addFeatureListener(btn,'click',hideModal));addFeatureListener(taskForm,'submit',handleFormSubmit);const handleOutsideClick=(event)=>{if(event.target===taskModal){hideModal();}};const handleEscapeKey=(event)=>{if(event.key==='Escape'&&taskModal.classList.contains('active')){hideModal();}};addFeatureListener(taskModal,'click',handleOutsideClick);addFeatureListener(document,'keydown',handleEscapeKey); // Use feature listener
                 addFeatureListener(searchInput,'input',renderTasks);addFeatureListener(filterStatusSelect,'change',renderTasks);addFeatureListener(filterPrioritySelect,'change',renderTasks);addFeatureListener(filterAssignedToSelect,'change',renderTasks);loadTasks();const cleanup=()=>{console.log("Cleaning Task Management...");featureListeners.forEach(({element,event,handler})=>{element?.removeEventListener(event,handler);});featureListeners=[];document.removeEventListener('keydown',handleEscapeKey);taskModal?.removeEventListener('click',handleOutsideClick);document.body.style.overflow='';console.log("Task Management cleanup complete.");};return {cleanup};}
            window.initializeFileSharingFeature = function(container) { /* ... (JS Logic from File Sharing template) ... */ console.log("Initializing File Sharing Feature...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("File Sharing card body not found!");return {cleanup:()=>{}};}const fileTableBody=cardBody.querySelector('#fileTableBody');const fileSearchInput=cardBody.querySelector('#fileSearchInput');const fileTypeFilter=cardBody.querySelector('#fileTypeFilter');const uploadDateFilter=cardBody.querySelector('#uploadDateFilter');const userFilter=cardBody.querySelector('#userFilter');const userFilterContainer=cardBody.querySelector('#userFilterContainer');const noResultsRow=cardBody.querySelector('#noResultsRow');const resetFiltersBtn=cardBody.querySelector('#resetFiltersBtn');const recentUploadsSection=cardBody.querySelector('#recentUploadsSection');const uploadFileModalEl=document.getElementById('uploadFileModal');const filePreviewModalEl=document.getElementById('filePreviewModal');if(!fileTableBody||!uploadFileModalEl||!filePreviewModalEl){console.error("File Sharing essential elements not found!");return {cleanup:()=>{}};}const isAdmin=window.currentUser?.role==='admin';if(isAdmin&&userFilterContainer){userFilterContainer.style.display='block';}else if(userFilterContainer){userFilterContainer.style.display='none';}let featureListeners=[];let timeUpdateInterval=null;const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};function populateUploaderFilter(){if(!userFilter)return;const uploaderSet=new Set(window.MOCK_USERS.map(u=>u.name));userFilter.innerHTML='<option value="" selected>All Users</option>';uploaderSet.forEach(name=>{const option=document.createElement('option');option.value=name;option.textContent=name;userFilter.appendChild(option);});}function applyFilters(){const searchTerm=fileSearchInput.value.toLowerCase().trim();const selectedType=fileTypeFilter.value;const selectedDate=uploadDateFilter.value;const selectedUser=userFilter.value;let hasVisibleRows=false;const rows=fileTableBody.querySelectorAll('tr:not(#noResultsRow)');rows.forEach(row=>{const fileNameElement=row.querySelector('.file-name');const uploaderElement=row.querySelector('.uploader-shared');const fileName=fileNameElement?fileNameElement.textContent.toLowerCase():'';const fileType=row.dataset.fileType||'';const uploadDate=row.dataset.uploadDate||'';const uploader=row.dataset.uploader||(uploaderElement?uploaderElement.textContent:'');const nameMatch=searchTerm===''||fileName.includes(searchTerm);const typeMatch=selectedType===''||fileType===selectedType;const dateMatch=selectedDate===''||uploadDate===selectedDate;const userMatch=(!isAdmin||selectedUser===''||uploader===selectedUser);if(nameMatch&&typeMatch&&dateMatch&&userMatch){row.style.display='';hasVisibleRows=true;}else{row.style.display='none';}});if(noResultsRow)noResultsRow.style.display=hasVisibleRows?'none':'';}function resetFilters(){if(fileSearchInput)fileSearchInput.value='';if(fileTypeFilter)fileTypeFilter.value='';if(uploadDateFilter)uploadDateFilter.value='';if(userFilter)userFilter.value='';applyFilters();}function updateRelativeTimes(){if(!recentUploadsSection)return;const timeElements=recentUploadsSection.querySelectorAll('.time-ago');timeElements.forEach(el=>{const timestamp=el.closest('li')?.dataset.timestamp;el.textContent=window.timeAgo(timestamp);});}const handleTableClick=(event)=>{const button=event.target.closest('.action-btn');if(!button)return;if(button.classList.contains('loading'))return;const fileId=button.dataset.fileId;const row=button.closest('tr');const fileNameElement=row?.querySelector('.file-name');const fileName=fileNameElement?fileNameElement.textContent:'this file';if(button.classList.contains('download-btn')){const fileUrl=button.dataset.fileUrl;if(!fileUrl||fileUrl==='path/to/...'){console.error(`Download failed: URL missing for file ID ${fileId}.`);Swal.fire({icon:'error',title:'Download Error',text:'Could not download the file. URL is missing.',timer:2500,showConfirmButton:false});return;}button.classList.add('loading');button.disabled=true;console.log(`Download: ID ${fileId}, URL: ${fileUrl}`);try{const link=document.createElement('a');link.href=fileUrl;link.setAttribute('download',fileName);document.body.appendChild(link);link.click();document.body.removeChild(link);console.log(`Download initiated for: ${fileName}`);}catch(error){console.error('Download error:',error);Swal.fire({icon:'error',title:'Download Failed',text:'An error occurred.'});}finally{setTimeout(()=>{button.classList.remove('loading');button.disabled=false;},500);}}else if(button.classList.contains('delete-btn')){Swal.fire({title:'Are you sure?',html:`Delete file: <br><strong>${fileName}</strong>`,icon:'warning',showCancelButton:true,confirmButtonColor:'var(--success)',cancelButtonColor:'var(--danger)',confirmButtonText:'<i class="fas fa-check me-1"></i> Yes, delete it!',cancelButtonText:'<i class="fas fa-times me-1"></i> Cancel'}).then((result)=>{if(result.isConfirmed){button.classList.add('loading');button.disabled=true;console.log(`Delete: ID ${fileId}`);setTimeout(()=>{const deleteSuccess=Math.random()>0.1;if(deleteSuccess){console.log(`Deleted: ${fileId}`);row.style.opacity='0';setTimeout(()=>{row.remove();applyFilters();Swal.fire('Deleted!',`"${fileName}" has been deleted.`,'success');},300);}else{console.error(`Failed delete: ${fileId}`);button.classList.remove('loading');button.disabled=false;Swal.fire('Error!','Could not delete file.','error');}},1000);}});}};function loadFileData(){const mockFiles=[{id:1,name:"Monthly Performance Report.pdf",type:"PDF",size:"2.5 MB",uploadDate:"2024-05-25T10:30:00Z",tags:["Reports","Monthly"],uploader:"Mohamed Elmenisy",url:"path/to/report.pdf"},{id:2,name:"New Product Photo.jpg",type:"Image",size:"800 KB",uploadDate:"2024-05-24T15:15:00Z",tags:["Products","Design"],uploader:"Nada Mahmoud",url:"path/to/image.jpg"},{id:3,name:"Project Resources.zip",type:"Archive",size:"15.2 MB",uploadDate:"2024-05-23T09:00:00Z",tags:["Project X"],uploader:"Yousef Ahmed",url:"path/to/archive.zip"},{id:4,name:"Meeting Agenda.pdf",type:"PDF",size:"150 KB",uploadDate:"2024-05-22T11:00:00Z",tags:["Meetings"],uploader:"Esraa Lashin",url:"path/to/agenda.pdf"},{id:5,name:"Team Photo.png",type:"Image",size:"1.2 MB",uploadDate:"2024-05-26T09:00:00Z",tags:["Team"],uploader:"Bassant Badr",url:"path/to/team.png"},];fileTableBody.innerHTML='';if(mockFiles.length===0){noResultsRow.style.display='';return;}noResultsRow.style.display='none';mockFiles.forEach(file=>{const row=document.createElement('tr');row.dataset.fileType=file.type;row.dataset.uploadDate=file.uploadDate.split('T')[0];row.dataset.uploader=file.uploader;const getFileIcon=(type)=>{switch(type){case 'PDF':return 'fa-file-pdf text-danger';case 'Image':return 'fa-file-image text-success';case 'Video':return 'fa-file-video text-info';case 'Archive':return 'fa-file-zipper text-warning';case 'Document':return 'fa-file-word text-primary';case 'Spreadsheet':return 'fa-file-excel text-success';default:return 'fa-file text-secondary';}};const tagsHtml=file.tags.map(tag=>`<span class="badge text-bg-secondary me-1">${tag}</span>`).join('');const previewButtonHtml=(file.type==='PDF'||file.type==='Image')?`<button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#filePreviewModal" data-file-type="${file.type}" data-file-url="${file.url}"><i class="fas fa-eye"></i></button>`:'';row.innerHTML=`<td><i class="fas ${getFileIcon(file.type)} file-icon" title="${file.type}"></i></td><td><strong class="file-name">${file.name}</strong><small class="d-block text-muted">Size: ${file.size}</small></td><td class="upload-date">${window.formatFullDateTime(file.uploadDate)}</td><td>${tagsHtml}</td><td class="uploader-shared">${file.uploader}</td><td class="text-center action-buttons"><button class="btn btn-sm btn-outline-success action-btn download-btn" title="Download" data-file-id="${file.id}" data-file-url="${file.url}"><i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>${previewButtonHtml}<button class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete" data-file-id="${file.id}"><i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button></td>`;fileTableBody.appendChild(row);});applyFilters();}const previewModalInstance=new bootstrap.Modal(filePreviewModalEl);const previewContent=filePreviewModalEl.querySelector('#previewContent');const previewFileName=filePreviewModalEl.querySelector('#previewFileName');const previewFileType=filePreviewModalEl.querySelector('#previewFileType');const handlePreviewShow=(event)=>{const button=event.relatedTarget;if(!button||!previewContent||!previewFileName||!previewFileType)return;const fileUrl=button.getAttribute('data-file-url');const fileType=button.getAttribute('data-file-type');const row=button.closest('tr');const fileNameElement=row?.querySelector('.file-name');const fileName=fileNameElement?fileNameElement.textContent:'N/A';previewFileName.textContent=`File Name: ${fileName}`;previewFileType.textContent=`Type: ${fileType?fileType.toUpperCase():'N/A'}`;previewContent.innerHTML='<div class="d-flex justify-content-center align-items-center" style="min-height: 200px;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';if(fileUrl&&fileUrl!=='path/to/...'){setTimeout(()=>{if(fileType==='Image'){previewContent.innerHTML=`<img src="${fileUrl}" class="img-fluid" alt="Preview" style="max-height: 75vh;">`;}else if(fileType==='PDF'){previewContent.innerHTML=`<object data="${fileUrl}" type="application/pdf" width="100%" height="650px"><p class="text-warning p-4">Preview unavailable. Browser might not support PDF embedding. <a href="${fileUrl}" target="_blank" class="btn btn-sm btn-primary mt-2">Download PDF</a></p></object>`;}else{previewContent.innerHTML=`<p class="text-warning p-4">Preview not available for file type (${fileType}).</p>`;}},300);}else{previewContent.innerHTML=`<p class="text-danger p-4">Could not load preview. URL missing or invalid.</p>`;}};const handlePreviewHidden=()=>{if(previewContent)previewContent.innerHTML='';};addFeatureListener(filePreviewModalEl,'show.bs.modal',handlePreviewShow);addFeatureListener(filePreviewModalEl,'hidden.bs.modal',handlePreviewHidden);const startUploadButton=uploadFileModalEl.querySelector('#startUploadButton');const uploadProgressContainer=uploadFileModalEl.querySelector('#uploadProgressContainer');const uploadProgressBar=uploadFileModalEl.querySelector('#uploadProgressBar');const uploadStatus=uploadFileModalEl.querySelector('#uploadStatus');const uploadFileName=uploadFileModalEl.querySelector('#uploadFileName');const uploadPercentage=uploadFileModalEl.querySelector('#uploadPercentage');const fileInputManual=uploadFileModalEl.querySelector('#fileInputManual');const fileInputHidden=uploadFileModalEl.querySelector('#fileInputHidden');const dropZone=uploadFileModalEl.querySelector('#dropZone');const handleUploadStart=()=>{if(!startUploadButton||!uploadProgressContainer||!uploadProgressBar||!uploadStatus||!uploadFileName||!uploadPercentage||!fileInputManual||!fileInputHidden)return;const filesToUpload=fileInputManual.files.length>0?fileInputManual.files:fileInputHidden.files;if(filesToUpload.length===0){Swal.fire('No File Selected','Please select at least one file.','warning');return;}const firstFile=filesToUpload[0];console.log("Starting upload for:",firstFile.name);uploadFileName.textContent=`Uploading: ${firstFile.name}`;uploadProgressContainer.style.display='block';uploadProgressBar.style.width='0%';uploadProgressBar.classList.remove('bg-success','bg-danger');uploadProgressBar.classList.add('progress-bar-animated');uploadPercentage.textContent='0%';uploadStatus.textContent='Initializing...';uploadStatus.className='text-muted d-block mt-1';let progress=0;const interval=setInterval(()=>{progress+=Math.random()*15;progress=Math.min(progress,100);uploadProgressBar.style.width=progress+'%';uploadProgressBar.setAttribute('aria-valuenow',progress);uploadPercentage.textContent=Math.round(progress)+'%';if(progress>=100){clearInterval(interval);const uploadSuccess=Math.random()>0.2;uploadProgressBar.classList.remove('progress-bar-animated');if(uploadSuccess){uploadStatus.textContent='Upload successful!';uploadStatus.className='text-success d-block mt-1 fw-bold';uploadProgressBar.classList.add('bg-success');setTimeout(()=>bootstrap.Modal.getInstance(uploadFileModalEl)?.hide(),1500);loadFileData();}else{uploadStatus.textContent='Upload failed. Please try again.';uploadStatus.className='text-danger d-block mt-1 fw-bold';uploadProgressBar.classList.add('bg-danger');}fileInputManual.value='';fileInputHidden.value='';}},300);};addFeatureListener(startUploadButton,'click',handleUploadStart);if(dropZone){addFeatureListener(dropZone,'dragover',(e)=>{e.preventDefault();dropZone.style.borderColor='var(--success)';});addFeatureListener(dropZone,'dragleave',()=>{dropZone.style.borderColor='var(--primary)';});addFeatureListener(dropZone,'drop',(e)=>{e.preventDefault();dropZone.style.borderColor='var(--primary)';if(e.dataTransfer.files.length>0&&fileInputHidden){fileInputHidden.files=e.dataTransfer.files;dropZone.querySelector('p:last-child').textContent=`${e.dataTransfer.files.length} file(s) selected.`;}});addFeatureListener(dropZone,'click',()=>fileInputHidden?.click());}if(fileInputHidden){addFeatureListener(fileInputHidden,'change',()=>{if(fileInputHidden.files.length>0&&dropZone)dropZone.querySelector('p:last-child').textContent=`${fileInputHidden.files.length} file(s) selected.`;});}if(fileInputManual){addFeatureListener(fileInputManual,'change',()=>{if(fileInputManual.files.length>0&&dropZone){dropZone.querySelector('p:last-child').textContent='Or drag & drop files here';if(fileInputHidden)fileInputHidden.value='';}}); }addFeatureListener(fileSearchInput,'input',applyFilters);addFeatureListener(fileTypeFilter,'change',applyFilters);addFeatureListener(uploadDateFilter,'change',applyFilters);addFeatureListener(userFilter,'change',applyFilters);addFeatureListener(resetFiltersBtn,'click',resetFilters);addFeatureListener(fileTableBody,'click',handleTableClick);populateUploaderFilter();loadFileData();updateRelativeTimes();timeUpdateInterval=setInterval(updateRelativeTimes,60000);const cleanup=()=>{console.log("Cleaning up File Sharing...");clearInterval(timeUpdateInterval);featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];bootstrap.Modal.getInstance(uploadFileModalEl)?.hide();bootstrap.Modal.getInstance(filePreviewModalEl)?.hide();document.querySelectorAll('.modal-backdrop').forEach(el=>el.remove());document.body.classList.remove('modal-open');document.body.style.overflow='';document.body.style.paddingRight='';console.log("File Sharing cleanup complete.");};return {cleanup};}
            window.initializeProjectTrackingFeature = function(container) { /* ... (JS Logic from Project Tracking template) ... */ console.log("Initializing Project Tracking Feature...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("Project Tracking card body not found!");return {cleanup:()=>{}};}const statusFilter=cardBody.querySelector('#project-status-filter');const teamFilter=cardBody.querySelector('#project-team-filter');const priorityFilter=cardBody.querySelector('#project-priority-filter');const resetFiltersBtn=cardBody.querySelector('#resetProjectFiltersBtn');const tableBody=cardBody.querySelector('#projectTableBody');const paginationControls=cardBody.querySelector('#projectPaginationControls');const deadlinesList=cardBody.querySelector('#upcomingDeadlinesList');const tableHeaders=cardBody.querySelectorAll("#projectTrackingTable th[data-sort-by]");const projectStatusPieChartEl=cardBody.querySelector('#projectStatusPieChart');const projectProgressLineChartEl=cardBody.querySelector('#projectProgressLineChart');if(!tableBody||!projectStatusPieChartEl||!projectProgressLineChartEl||!teamFilter){console.error("Essential Project Tracking elements missing!");if(tableBody)tableBody.innerHTML=`<tr><td colspan="8" class="text-center p-4 text-danger">Error loading components.</td></tr>`;return {cleanup:()=>{}};}let projectData=[];let filteredData=[];let currentPage=1;const rowsPerPage=5;let currentSortColumn='endDate';let currentSortDirection='asc';let statusPieChartInstance=null;let progressLineChartInstance=null;let featureListeners=[];const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};const formatDate=window.formatDateForDisplay;const getCssVar=(varName)=>getComputedStyle(document.documentElement).getPropertyValue(varName).trim()||'#888';const rgbaColor=(c,alpha)=>{if(!c)c='#888';if(c.startsWith('rgba'))return c.replace(/[\d\.]+\)$/g,`${alpha})`);if(c.startsWith('#')){const bigint=parseInt(c.slice(1),16);const r=(bigint>>16)&255;const g=(bigint>>8)&255;const b=bigint&255;return `rgba(${r}, ${g}, ${b}, ${alpha})`;}return c;};function getStatusBadgeClass(status){switch(status?.toLowerCase()){case 'completed':return 'status-completed';case 'in progress':return 'status-inprogress';case 'delayed':return 'status-delayed';case 'pending':return 'status-pending';default:return '';}}function getPriorityBadgeClass(priority){switch(priority?.toLowerCase()){case 'high':return 'priority-high';case 'medium':return 'priority-medium';case 'low':return 'priority-low';default:return '';}}function getProgressBgClass(progress){if(progress>=80)return 'bg-progress-high';if(progress>=50)return 'bg-progress-medium';return 'bg-progress-low';}function getProgressTextColor(progress){return (progress>=50&&progress<80)?'#212529':'#fff';}function renderProjectStatusPieChart(data){const ctx=projectStatusPieChartEl.getContext('2d');if(!ctx)return;const statusCounts=data.reduce((acc,project)=>{acc[project.status]=(acc[project.status]||0)+1;return acc;},{});const labels=Object.keys(statusCounts);const chartData=Object.values(statusCounts);const backgroundColors=labels.map(label=>{switch(label.toLowerCase()){case 'completed':return getCssVar('--success');case 'in progress':return getCssVar('--primary');case 'delayed':return getCssVar('--warning');case 'pending':return getCssVar('--gray');default:return getCssVar('--secondary');}});const config={type:'pie',data:{labels:labels,datasets:[{data:chartData,backgroundColor:backgroundColors,borderColor:getCssVar('--card-bg-color'),borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{color:getCssVar('--base-text-color')}}}}};if(statusPieChartInstance)statusPieChartInstance.destroy();statusPieChartInstance=new Chart(ctx,config);}function renderProjectProgressLineChart(){const ctx=projectProgressLineChartEl.getContext('2d');if(!ctx)return;const labels=['Jan','Feb','Mar','Apr','May','Jun'];const data=[20,35,50,60,75,80];const config={type:'line',data:{labels:labels,datasets:[{label:'Overall Progress %',data:data,borderColor:getCssVar('--primary'),backgroundColor:rgbaColor(getCssVar('--primary'),0.1),fill:true,tension:0.3}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,max:100,ticks:{color:getCssVar('--base-text-color')},grid:{color:getCssVar('--card-border-color')}},x:{ticks:{color:getCssVar('--base-text-color')},grid:{color:getCssVar('--card-border-color')}}},plugins:{legend:{display:false}}}};if(progressLineChartInstance)progressLineChartInstance.destroy();progressLineChartInstance=new Chart(ctx,config);}function renderUpcomingDeadlines(data){if(!deadlinesList)return;deadlinesList.innerHTML='';const today=new Date();today.setHours(0,0,0,0);const sevenDaysFromNow=new Date(today);sevenDaysFromNow.setDate(today.getDate()+7);const upcoming=data.filter(project=>{if(!project.endDate||project.status==='Completed')return false;const endDate=new Date(project.endDate+'T00:00:00');return endDate>=today&&endDate<=sevenDaysFromNow;}).sort((a,b)=>new Date(a.endDate)-new Date(b.endDate));if(upcoming.length===0){deadlinesList.innerHTML='<li class="text-muted text-center pt-5">No upcoming deadlines found.</li>';return;}upcoming.forEach(project=>{const li=document.createElement('li');const endDate=new Date(project.endDate+'T00:00:00');const diffTime=Math.abs(endDate-today);const diffDays=Math.ceil(diffTime/(1000*60*60*24));const daysLeftText=diffDays===0?'Due Today':`${diffDays} day${diffDays>1?'s':''} left`;li.innerHTML=`<span>${project.name}</span><span class="text-end"><span class="deadline me-2">${formatDate(project.endDate)}</span><span class="days-left">(${daysLeftText})</span></span>`;deadlinesList.appendChild(li);});}function renderTable(){tableBody.innerHTML='';if(filteredData.length===0){tableBody.innerHTML=`<tr><td colspan="8" class="text-center p-4 text-muted fst-italic">No projects found matching criteria.</td></tr>`;renderPagination();return;}const totalItems=filteredData.length;const totalPages=Math.ceil(totalItems/rowsPerPage);if(currentPage>totalPages&&totalPages>0)currentPage=totalPages;else if(currentPage<1)currentPage=1;const startIndex=(currentPage-1)*rowsPerPage;const endIndex=startIndex+rowsPerPage;const pageData=filteredData.slice(startIndex,endIndex);pageData.forEach(project=>{const row=document.createElement('tr');const statusClass=getStatusBadgeClass(project.status);const priorityClass=getPriorityBadgeClass(project.priority);const progressBg=getProgressBgClass(project.progress);const progressTextClr=getProgressTextColor(project.progress);const teamHtml=project.assignedTeam.map(member=>`<span>${member}</span>`).join('');row.innerHTML=`<td><div class="project-name">${project.name}</div></td><td>${formatDate(project.startDate)}</td><td>${formatDate(project.endDate)}</td><td class="assigned-team">${teamHtml}</td><td class="text-center progress-cell"><div class="progress" role="progressbar" aria-valuenow="${project.progress}" aria-valuemin="0" aria-valuemax="100"><div class="progress-bar ${progressBg}" style="width: ${project.progress}%; color: ${progressTextClr};">${project.progress}%</div></div></td><td class="text-center"><span class="status-badge ${statusClass}">${project.status}</span></td><td class="text-center"><span class="priority-badge ${priorityClass}">${project.priority}</span></td><td class="notes-cell" title="${project.notes||''}">${project.notes||'-'}</td>`;tableBody.appendChild(row);});renderPagination();updateSortIcons();}function renderPagination(){if(!paginationControls)return;paginationControls.innerHTML='';const totalItems=filteredData.length;if(totalItems<=rowsPerPage)return;const totalPages=Math.ceil(totalItems/rowsPerPage);const createButton=(text,page,disabled=false)=>{const button=document.createElement('button');button.className='btn btn-sm btn-outline-secondary';button.innerHTML=text;button.disabled=disabled;addFeatureListener(button,'click',()=>{currentPage=page;renderTable();});return button;};paginationControls.appendChild(createButton('<i class="fas fa-chevron-left"></i> Prev',currentPage-1,currentPage===1));const pageInfo=document.createElement('span');pageInfo.className='pt-page-info';pageInfo.innerHTML=`Page <span class="pt-current-page">${currentPage}</span> of ${totalPages}`;paginationControls.appendChild(pageInfo);paginationControls.appendChild(createButton('Next <i class="fas fa-chevron-right"></i>',currentPage+1,currentPage===totalPages));}function updateSortIcons(){tableHeaders.forEach(th=>{const icon=th.querySelector('.sort-icon');if(!icon)return;const columnKey=th.getAttribute('data-sort-by');icon.classList.remove('fa-sort','fa-sort-up','fa-sort-down','active');if(columnKey===currentSortColumn){icon.classList.add(currentSortDirection==='asc'?'fa-sort-up':'fa-sort-down');icon.classList.add('active');}else{icon.classList.add('fa-sort');}});}function handleSortClick(event){const header=event.currentTarget;const columnKey=header.getAttribute('data-sort-by');if(!columnKey)return;if(currentSortColumn===columnKey){currentSortDirection=currentSortDirection==='asc'?'desc':'asc';}else{currentSortColumn=columnKey;currentSortDirection='asc';}applyFiltersAndSort();}function applyFiltersAndSort(){const statusValue=statusFilter.value;const teamValue=teamFilter.value;const priorityValue=priorityFilter.value;let tempFilteredData=projectData.filter(project=>{const statusMatch=!statusValue||project.status===statusValue;const teamMatch=!teamValue||project.assignedTeam.includes(teamValue);const priorityMatch=!priorityValue||project.priority===priorityValue;return statusMatch&&teamMatch&&priorityMatch;});tempFilteredData.sort((a,b)=>{let valA=a[currentSortColumn];let valB=b[currentSortColumn];if(currentSortColumn==='startDate'||currentSortColumn==='endDate'){valA=new Date(valA||0);valB=new Date(valB||0);}else if(currentSortColumn==='progress'){valA=Number(valA||0);valB=Number(valB||0);}else if(typeof valA==='string'){valA=valA.toLowerCase();}if(typeof valB==='string'){valB=valB.toLowerCase();}else if(currentSortColumn==='priority'){const priorityOrder={'High':3,'Medium':2,'Low':1};valA=priorityOrder[a.priority]||0;valB=priorityOrder[b.priority]||0;}if(valA<valB)return currentSortDirection==='asc'?-1:1;if(valA>valB)return currentSortDirection==='asc'?1:-1;return 0;});filteredData=tempFilteredData;currentPage=1;renderTable();renderProjectStatusPieChart(filteredData);renderUpcomingDeadlines(filteredData);renderProjectProgressLineChart();}function resetFilters(){statusFilter.value='';teamFilter.value='';priorityFilter.value='';applyFiltersAndSort();}function populateTeamFilter(){const teamSet=new Set();projectData.forEach(p=>p.assignedTeam.forEach(member=>teamSet.add(member)));teamFilter.innerHTML='<option value="" selected>All Teams/Members</option>';teamSet.forEach(name=>{const option=document.createElement('option');option.value=name;option.textContent=name;teamFilter.appendChild(option);});}function fetchInitialData(){projectData=[{id:1,name:"Website Overhaul",startDate:"2024-03-01",endDate:"2024-07-30",assignedTeam:["Mohamed Elmenisy","Esraa Lashin"],progress:75,status:"In Progress",priority:"High",notes:"Phase 1 complete, focusing on backend."},{id:2,name:"Mobile App Dev",startDate:"2024-04-15",endDate:"2024-09-15",assignedTeam:["Yousef Ahmed","Bassant Badr"],progress:40,status:"In Progress",priority:"High",notes:"Core features implemented."},{id:3,name:"Marketing Campaign Q3",startDate:"2024-07-01",endDate:"2024-09-30",assignedTeam:["Bassant Badr","Nada Mahmoud"],progress:15,status:"Pending",priority:"Medium",notes:"Planning stage."},{id:4,name:"Server Upgrade",startDate:"2024-05-20",endDate:"2024-06-10",assignedTeam:["Yousef Ahmed"],progress:100,status:"Completed",priority:"Medium",notes:"Completed ahead of schedule."},{id:5,name:"UI Kit Development",startDate:"2024-06-01",endDate:"2024-08-15",assignedTeam:["Esraa Lashin"],progress:60,status:"In Progress",priority:"Low",notes:"Delayed due to scope change."},{id:6,name:"API Documentation",startDate:"2024-07-10",endDate:"2024-07-25",assignedTeam:["Mohamed Elmenisy"],progress:90,status:"Delayed",priority:"Medium",notes:"Awaiting final review."},{id:7,name:"Onboarding Process",startDate:"2024-08-01",endDate:"2024-08-10",assignedTeam:["Nada Mahmoud"],progress:5,status:"Pending",priority:"Low",notes:"Initial draft required."}];populateTeamFilter();applyFiltersAndSort();console.log("Project Tracking data loaded.");}tableHeaders.forEach(th=>addFeatureListener(th,'click',handleSortClick));addFeatureListener(statusFilter,'change',applyFiltersAndSort);addFeatureListener(teamFilter,'change',applyFiltersAndSort);addFeatureListener(priorityFilter,'change',applyFiltersAndSort);addFeatureListener(resetFiltersBtn,'click',resetFilters);fetchInitialData();const cleanup=()=>{console.log("Cleaning up Project Tracking...");if(statusPieChartInstance)statusPieChartInstance.destroy();if(progressLineChartInstance)progressLineChartInstance.destroy();statusPieChartInstance=null;progressLineChartInstance=null;featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];console.log("Project Tracking cleanup complete.");};return {cleanup};}
            window.initializeReportsAnalyticsFeature = function(container) { /* ... (JS Logic from Reports template) ... */ console.log("Initializing Reports & Analytics Feature...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("Reports card body not found!");return {cleanup:()=>{}};}const filterForm=cardBody.querySelector('#reports-filter-form');const startDateInput=cardBody.querySelector('#report-start-date');const endDateInput=cardBody.querySelector('#report-end-date');const periodBtnGroup=cardBody.querySelector('#periodBtnGroup');const tableBody=cardBody.querySelector('#employeeSummaryTableBody');const exportPdfBtn=container.querySelector('#exportPdfBtn');const exportExcelBtn=container.querySelector('#exportExcelBtn');const taskCompletionChartEl=cardBody.querySelector('#taskCompletionChart');const overdueTasksChartEl=cardBody.querySelector('#overdueTasksChart');const filesUploadedChartEl=cardBody.querySelector('#filesUploadedChart');const performanceComparisonChartEl=cardBody.querySelector('#performanceComparisonChart');if(!filterForm||!startDateInput||!endDateInput||!tableBody||!taskCompletionChartEl||!overdueTasksChartEl||!filesUploadedChartEl||!performanceComparisonChartEl||!exportPdfBtn||!exportExcelBtn){console.error("Essential Reports & Analytics elements missing!");if(tableBody)tableBody.innerHTML=`<tr><td colspan="5" class="text-center p-4 text-danger">Error loading components.</td></tr>`;return {cleanup:()=>{}};}const employeePerformanceData=[{id:1,name:"Mohamed Elmenisy",tasksCompleted:85,tasksOverdue:3,filesUploaded:15,activityScore:9.2,performanceMetrics:[8.5,9,7,9.2,8.4]},{id:3,name:"Yousef Ahmed",tasksCompleted:70,tasksOverdue:8,filesUploaded:8,activityScore:7.5,performanceMetrics:[7,6,6,7.5,6.6]},{id:4,name:"Esraa Lashin",tasksCompleted:45,tasksOverdue:12,filesUploaded:5,activityScore:6.1,performanceMetrics:[4.5,5,5,6.1,5.1]},{id:5,name:"Bassant Badr",tasksCompleted:91,tasksOverdue:2,filesUploaded:18,activityScore:9.5,performanceMetrics:[9.1,9.5,8,9.5,9.0]},{id:2,name:"Nada Mahmoud",tasksCompleted:78,tasksOverdue:5,filesUploaded:12,activityScore:8.1,performanceMetrics:[7.8,8,6,8.1,7.5]}];let currentFilteredData=[...employeePerformanceData];let taskCompletionChartInstance=null;let overdueTasksChartInstance=null;let filesUploadedChartInstance=null;let performanceComparisonChartInstance=null;let featureListeners=[];const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};function formatDateInput(date){const d=new Date(date);const month=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');const year=d.getFullYear();return `${year}-${month}-${day}`; }function formatReportDate(dateString){if(!dateString)return 'N/A';const parts=dateString.split('-');if(parts.length===3){return `${parts[1]}/${parts[2]}/${parts[0]}`;}return dateString;}const getCssVar=(varName)=>getComputedStyle(document.documentElement).getPropertyValue(varName).trim()||'#888';const rgbaColor=(c,alpha)=>{if(!c)c='#888';if(c.startsWith('rgba'))return c.replace(/[\d\.]+\)$/g,`${alpha})`);if(c.startsWith('#')){const bigint=parseInt(c.slice(1),16);const r=(bigint>>16)&255;const g=(bigint>>8)&255;const b=bigint&255;return `rgba(${r}, ${g}, ${b}, ${alpha})`;}return c;};function renderTaskCompletionChart(data){const ctx=taskCompletionChartEl.getContext('2d');if(!ctx)return;const avgCompletion=data.length>0?Math.round(data.reduce((sum,emp)=>sum+emp.tasksCompleted,0)/data.length):0;const chartData={labels:['Completed','Remaining'],datasets:[{data:[avgCompletion,100-avgCompletion],backgroundColor:[getCssVar('--success'),'#e9ecef'],borderColor:[getCssVar('--card-bg-color')],borderWidth:2}]};if(taskCompletionChartInstance)taskCompletionChartInstance.destroy();taskCompletionChartInstance=new Chart(ctx,{type:'doughnut',data:chartData,options:{responsive:true,maintainAspectRatio:false,cutout:'70%',plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`${ctx.label}: ${ctx.parsed}%`}}}}});}function renderOverdueTasksChart(data){const ctx=overdueTasksChartEl.getContext('2d');if(!ctx)return;const labels=data.map(emp=>emp.name);const overdueData=data.map(emp=>emp.tasksOverdue);if(overdueTasksChartInstance)overdueTasksChartInstance.destroy();overdueTasksChartInstance=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Overdue Tasks',data:overdueData,backgroundColor:getCssVar('--danger'),borderWidth:0,borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,ticks:{stepSize:2,color:getCssVar('--base-text-color')},grid:{color:getCssVar('--card-border-color')}},x:{ticks:{color:getCssVar('--base-text-color')},grid:{color:getCssVar('--card-border-color')}}},plugins:{legend:{display:false}}}});}function renderFilesUploadedChart(data){const ctx=filesUploadedChartEl.getContext('2d');if(!ctx)return;const labels=data.map(emp=>emp.name);const filesData=data.map(emp=>emp.filesUploaded);if(filesUploadedChartInstance)filesUploadedChartInstance.destroy();filesUploadedChartInstance=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Files Uploaded',data:filesData,backgroundColor:getCssVar('--info'),borderWidth:0,borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',scales:{x:{beginAtZero:true,ticks:{color:getCssVar('--base-text-color')},grid:{color:getCssVar('--card-border-color')}},y:{ticks:{color:getCssVar('--base-text-color')},grid:{color:getCssVar('--card-border-color')}}},plugins:{legend:{display:false}}}});}function renderPerformanceComparisonChart(data){const ctx=performanceComparisonChartEl.getContext('2d');if(!ctx)return;const labels=['Completion','Timeliness','Files Mgmt','Activity','Overall Score'];const datasets=data.map((emp,index)=>{const metricsData=emp.performanceMetrics||[emp.tasksCompleted/10,10-(emp.tasksOverdue/2),emp.filesUploaded/2,emp.activityScore,((emp.tasksCompleted/10)+(10-(emp.tasksOverdue/2))+(emp.filesUploaded/2)+emp.activityScore)/4];const clampedData=metricsData.map(score=>Math.max(0,Math.min(10,score||0)));const colors=[getCssVar('--primary'),getCssVar('--success'),getCssVar('--warning'),getCssVar('--danger'),getCssVar('--info'),getCssVar('--secondary')];const color=colors[index%colors.length];const bgFill=rgbaColor(color,getCssVar('--feature-reports-chart-radar-fill-opacity'));return {label:emp.name,data:clampedData,fill:true,backgroundColor:bgFill,borderColor:color,pointBackgroundColor:color,pointBorderColor:getCssVar('--card-bg-color'),pointHoverBackgroundColor:getCssVar('--card-bg-color'),pointHoverBorderColor:color}});if(performanceComparisonChartInstance)performanceComparisonChartInstance.destroy();performanceComparisonChartInstance=new Chart(ctx,{type:'radar',data:{labels:labels,datasets:datasets},options:{responsive:true,maintainAspectRatio:false,elements:{line:{borderWidth:2}},scales:{r:{angleLines:{display:true,color:getCssVar('--card-border-color')},grid:{color:getCssVar('--card-border-color')},suggestedMin:0,suggestedMax:10,pointLabels:{font:{size:10},color:getCssVar('--base-text-color')},ticks:{backdropColor:getCssVar('--card-bg-color'),stepSize:2,color:getCssVar('--base-text-color'),showLabelBackdrop:false}}},plugins:{legend:{position:'top',labels:{color:getCssVar('--base-text-color')}}}}});}function renderEmployeeSummaryTable(data){tableBody.innerHTML='';if(!data||data.length===0){tableBody.innerHTML=`<tr><td colspan="5" class="text-center p-4 text-muted fst-italic">No employee data found.</td></tr>`;return;}data.forEach((emp)=>{const row=document.createElement('tr');let scoreBadgeClass='text-bg-secondary';let scoreText='Average';if(emp.activityScore>=9){scoreBadgeClass='text-bg-success';scoreText='Excellent';}else if(emp.activityScore>=7.5){scoreBadgeClass='text-bg-warning';scoreText='Good';}else if(emp.activityScore<6.5){scoreBadgeClass='text-bg-danger';scoreText='Needs Improv.';}const completion=emp.tasksCompleted;let progressBgClass='';let progressTextColor='#fff';if(completion>=80){progressBgClass='bg-progress-high';}else if(completion>=50){progressBgClass='bg-progress-medium';progressTextColor='#212529';}else{progressBgClass='bg-progress-low';}row.innerHTML=`<td><div class="employee-name">${emp.name}</div></td><td class="text-center"><div class="progress" role="progressbar" aria-label="Completion rate for ${emp.name}" aria-valuenow="${completion}" aria-valuemin="0" aria-valuemax="100"><div class="progress-bar ${progressBgClass}" style="width: ${completion}%; color: ${progressTextColor};">${completion}%</div></div></td><td class="text-center"><span class="metric-value ${emp.tasksOverdue===0?'text-success':emp.tasksOverdue<=5?'text-warning':'text-danger'}">${emp.tasksOverdue}</span></td><td class="text-center"><span class="metric-value text-info">${emp.filesUploaded}</span></td><td class="text-center"><span class="badge ${scoreBadgeClass}">${scoreText}</span></td>`;tableBody.appendChild(row);});}function applyFilters(){const startDate=startDateInput.value;const endDate=endDateInput.value;console.log("Reports: Applying filters for period:",startDate,"to",endDate);currentFilteredData=[...employeePerformanceData];renderTaskCompletionChart(currentFilteredData);renderOverdueTasksChart(currentFilteredData);renderFilesUploadedChart(currentFilteredData);renderPerformanceComparisonChart(currentFilteredData);renderEmployeeSummaryTable(currentFilteredData);}function setPeriodDates(period){const today=new Date();let startDate,endDate=new Date();switch(period){case 'day':startDate=new Date(today);break;case 'month':startDate=new Date(today.getFullYear(),today.getMonth(),1);break;case 'week':default:const firstDay=today.getDate()-today.getDay()+(today.getDay()===0?-6:1);startDate=new Date(new Date(today).setDate(firstDay));break;}startDateInput.value=formatDateInput(startDate);endDateInput.value=formatDateInput(endDate);applyFilters();}function generateCsv(tableElement,filename='report.csv'){let csv=[];const rows=tableElement.querySelectorAll("thead tr, tbody tr");for(let i=0;i<rows.length;i++){const row=[],cols=rows[i].querySelectorAll("td, th");for(let j=0;j<cols.length;j++){let data=cols[j].innerText.replace(/(\r\n|\n|\r)/gm,"").replace(/(\s\s)/gm," ").trim();if(cols[j].querySelector('.progress')){const progressBar=cols[j].querySelector('.progress-bar');data=progressBar?progressBar.innerText.trim():'0%';}data=data.replace(/"/g,'""');if(data.includes(','))data=`"${data}"`;row.push(data);}csv.push(row.join(","));}const csvFile=new Blob([csv.join("\n")],{type:"text/csv"});const downloadLink=document.createElement("a");downloadLink.download=filename;downloadLink.href=window.URL.createObjectURL(csvFile);downloadLink.style.display="none";document.body.appendChild(downloadLink);downloadLink.click();document.body.removeChild(downloadLink);}function generatePdf(tableElement,filename='report.pdf'){if(typeof jspdf==='undefined'||typeof jspdf.jsPDF==='undefined'){alert('jsPDF library is not loaded.');return;}const{jsPDF}=jspdf;const doc=new jsPDF({orientation:'landscape'});const startDateValue=startDateInput.value;const endDateValue=endDateInput.value;const startDateFormatted=formatReportDate(startDateValue);const endDateFormatted=formatReportDate(endDateValue);const dateRangeText=`Period: ${startDateFormatted} - ${endDateFormatted}`;const reportTitle="Employee Performance Report";doc.setFontSize(16);doc.text(reportTitle,14,16);doc.setFontSize(10);doc.setTextColor(100);doc.text(dateRangeText,14,22);doc.setTextColor(0);if(typeof doc.autoTable!=='function'){alert('jsPDF AutoTable plugin is not loaded.');return;}const head=[['Employee','Completion (%)','Overdue','Files','Score']];const body=[];const rows=tableElement.querySelectorAll("tbody tr");rows.forEach(row=>{const rowData=[];const cells=row.querySelectorAll("td");rowData.push(cells[0]?cells[0].innerText.trim():'');rowData.push(cells[1]?cells[1].querySelector('.progress-bar')?.innerText.trim()||'0%':'0%');rowData.push(cells[2]?cells[2].innerText.trim():'0');rowData.push(cells[3]?cells[3].innerText.trim():'0');rowData.push(cells[4]?cells[4].querySelector('.badge')?.innerText.trim()||'':'');body.push(rowData);});const tableStartY=28;doc.autoTable({head:head,body:body,startY:tableStartY,theme:'grid',styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:'bold'},columnStyles:{0:{cellWidth:60},1:{cellWidth:'auto',halign:'center'},2:{cellWidth:'auto',halign:'center'},3:{cellWidth:'auto',halign:'center'},4:{cellWidth:'auto',halign:'center'}}});doc.save(filename);}setPeriodDates('week');addFeatureListener(filterForm,'submit',(event)=>{event.preventDefault();applyFilters();});addFeatureListener(periodBtnGroup,'change',(event)=>{if(event.target.name==='period'){setPeriodDates(event.target.value);}});addFeatureListener(exportPdfBtn,'click',()=>{const table=cardBody.querySelector('#employeeSummaryTable');if(table){generatePdf(table,`Employee_Summary_${formatDateInput(new Date())}.pdf`);}else{alert('Summary table not found.');}});addFeatureListener(exportExcelBtn,'click',()=>{const table=cardBody.querySelector('#employeeSummaryTable');if(table){generateCsv(table,`Employee_Summary_${formatDateInput(new Date())}.csv`);}else{alert('Summary table not found.');}});applyFilters();const cleanup=()=>{console.log("Cleaning up Reports & Analytics...");if(taskCompletionChartInstance)taskCompletionChartInstance.destroy();if(overdueTasksChartInstance)overdueTasksChartInstance.destroy();if(filesUploadedChartInstance)filesUploadedChartInstance.destroy();if(performanceComparisonChartInstance)performanceComparisonChartInstance.destroy();taskCompletionChartInstance=null;overdueTasksChartInstance=null;filesUploadedChartInstance=null;performanceComparisonChartInstance=null;featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];console.log("Reports & Analytics cleanup complete.");};return {cleanup};}
            window.initializeEmployeeScheduleLogic = function(container) { /* ... (JS Logic from Scheduling template) ... */ console.log("Initializing Employee Schedule Logic...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("Scheduling card body not found!");return {cleanup:()=>{}};}const calculateOffsets=()=>{const today=new Date();const mayFirst2025=new Date(2025,4,1);mayFirst2025.setHours(0,0,0,0);const currentDayOfWeek=today.getDay();const diffToSunday=today.getDate()-currentDayOfWeek;const startOfCurrentWeek=new Date(today);startOfCurrentWeek.setDate(diffToSunday);startOfCurrentWeek.setHours(0,0,0,0);const mayFirstDayOfWeek=mayFirst2025.getDay();const diffToMayFirstSunday=mayFirst2025.getDate()-mayFirstDayOfWeek;const startOfMayFirstWeek=new Date(mayFirst2025);startOfMayFirstWeek.setDate(diffToMayFirstSunday);startOfMayFirstWeek.setHours(0,0,0,0);const msPerDay=24*60*60*1000;const weeksDifference=Math.round((startOfMayFirstWeek.getTime()-startOfCurrentWeek.getTime())/(7*msPerDay));console.log(`Current Week Start: ${startOfCurrentWeek.toDateString()}`);console.log(`Target Week Start: ${startOfMayFirstWeek.toDateString()}`);console.log(`Calculated offset: ${weeksDifference}`);currentScheduleWeekOffset=weeksDifference;scheduleMinWeekOffset=weeksDifference;};calculateOffsets();const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];const weekDisplay=cardBody.querySelector('#weekDisplay');const scheduleTableBody=cardBody.querySelector('#scheduleTableBody');const scheduleThead=cardBody.querySelector('.schedule-table thead tr');const prevWeekBtn=cardBody.querySelector('#prevWeekBtn');const nextWeekBtn=cardBody.querySelector('#nextWeekBtn');const saveScheduleBtn=container.querySelector('#saveScheduleBtn');const sendRemindersBtn=container.querySelector('#sendRemindersBtn');const adminActionsDiv=container.querySelector('#scheduleAdminActions');const editShiftModal=document.getElementById('editShiftModal');const editShiftForm=document.getElementById('editShiftForm');const shiftTypeSelect=document.getElementById('shiftType');const editShiftEmployeeIdInput=document.getElementById('editShiftEmployeeId');const editShiftDayIndexInput=document.getElementById('editShiftDayIndex');const editShiftWeekOffsetInput=document.getElementById('editShiftWeekOffset');const editShiftModalTitle=document.getElementById('editShiftModalTitle');let featureListeners=[];const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};if(window.currentUser?.role==='admin'&&adminActionsDiv){adminActionsDiv.style.display='flex';}function getWeekDates(weekOffset=0){const baseDate=new Date();const startOfWeek=new Date(baseDate);const dayOfWeek=baseDate.getDay();const diff=baseDate.getDate()-dayOfWeek;startOfWeek.setDate(diff+(weekOffset*7));startOfWeek.setHours(0,0,0,0);const dates=[];for(let i=0;i<7;i++){const date=new Date(startOfWeek);date.setDate(startOfWeek.getDate()+i);dates.push(date);}return dates;}window.renderSchedule=function(weekOffset){console.log(`Rendering schedule offset: ${weekOffset}`);if(isNaN(weekOffset)){weekOffset=currentScheduleWeekOffset;}const weekDates=getWeekDates(weekOffset);const start=weekDates[0];const end=weekDates[6];if(weekDisplay)weekDisplay.textContent=`${formatDateForDisplay(start)} - ${formatDateForDisplay(end)}`;if(prevWeekBtn){prevWeekBtn.disabled=weekOffset<=scheduleMinWeekOffset;}if(scheduleThead){scheduleThead.innerHTML='<th>Employee</th>';weekDates.forEach((date,index)=>{scheduleThead.innerHTML+=`<th><div class="day-header"><span class="day-name">${days[index]}</span><span class="day-date">${date.toLocaleDateString(undefined,{month:'short',day:'numeric'})}</span></div></th>`;});}if(scheduleTableBody){scheduleTableBody.innerHTML='';if(MOCK_USERS.length===0){scheduleTableBody.innerHTML=`<tr><td colspan="8">No employees found.</td></tr>`;return;}MOCK_USERS.forEach(employee=>{const row=document.createElement('tr');row.innerHTML=`<td class="employee-name">${employee.name}</td>`;for(let dayIndex=0;dayIndex<7;dayIndex++){const cell=document.createElement('td');const scheduleKey=`${employee.id}-${weekOffset}-${dayIndex}`;const isWeekend=dayIndex===5||dayIndex===6;let shiftType;let isEditable=window.currentUser.role==='admin'&&!isWeekend;if(isWeekend){shiftType='off';mockScheduleData[scheduleKey]='off';cell.classList.add('weekend-cell');}else{if(!mockScheduleData[scheduleKey]){const shiftTypes=['morning','afternoon','night','off','sick','vacation'];mockScheduleData[scheduleKey]=shiftTypes[Math.floor(Math.random()*shiftTypes.length)];}shiftType=mockScheduleData[scheduleKey];}const shiftDiv=document.createElement('div');shiftDiv.classList.add('shift');if(isWeekend){shiftDiv.classList.add('shift-weekend-off');}else{shiftDiv.classList.add(`shift-${shiftType.replace('_','-')}`);}shiftDiv.textContent=getShiftText(shiftType);if(isEditable){shiftDiv.classList.add('editable');shiftDiv.dataset.employeeId=employee.id;shiftDiv.dataset.employeeName=employee.name;shiftDiv.dataset.dayIndex=dayIndex;shiftDiv.dataset.weekOffset=weekOffset;shiftDiv.dataset.date=formatDateForDisplay(weekDates[dayIndex]);shiftDiv.title=`Edit ${employee.name}'s shift`;addFeatureListener(shiftDiv,'click',handleEditShiftClick);}else if(isWeekend){shiftDiv.title="Weekend Off";}cell.appendChild(shiftDiv);row.appendChild(cell);}scheduleTableBody.appendChild(row);});}}function handleEditShiftClick(event){const target=event.target;if(!target.classList.contains('editable'))return;const employeeId=target.dataset.employeeId;const dayIndex=target.dataset.dayIndex;const weekOffset=target.dataset.weekOffset;const employeeName=target.dataset.employeeName;const dateStr=target.dataset.date;const scheduleKey=`${employeeId}-${weekOffset}-${dayIndex}`;const currentShift=mockScheduleData[scheduleKey]||'morning';if(editShiftEmployeeIdInput)editShiftEmployeeIdInput.value=employeeId;if(editShiftDayIndexInput)editShiftDayIndexInput.value=dayIndex;if(editShiftWeekOffsetInput)editShiftWeekOffsetInput.value=weekOffset;if(shiftTypeSelect)shiftTypeSelect.value=currentShift;if(editShiftModalTitle)editShiftModalTitle.textContent=`Edit ${employeeName}'s Shift on ${days[dayIndex]||dateStr}`;if(editShiftModal)editShiftModal.classList.add('active');}addFeatureListener(prevWeekBtn,'click',()=>{if(currentScheduleWeekOffset>scheduleMinWeekOffset){currentScheduleWeekOffset--;renderSchedule(currentScheduleWeekOffset);}});addFeatureListener(nextWeekBtn,'click',()=>{currentScheduleWeekOffset++;renderSchedule(currentScheduleWeekOffset);});addFeatureListener(saveScheduleBtn,'click',()=>{showConfirmModal('Save Schedule','Save changes?',()=>{saveScheduleBtn.disabled=true;saveScheduleBtn.innerHTML='<span class="spinner"></span> Saving...';console.log("Saving schedule...",mockScheduleData);setTimeout(()=>{window.showToast("Schedule saved!","success");saveScheduleBtn.disabled=false;saveScheduleBtn.innerHTML='<i class="fas fa-save"></i> Save Schedule';},1000);},'btn-primary');});addFeatureListener(sendRemindersBtn,'click',handleSendReminders);if(editShiftModal){editShiftModal.querySelectorAll('[data-close-modal]').forEach(btn=>{addFeatureListener(btn,'click',()=>editShiftModal.classList.remove('active'));});addFeatureListener(editShiftModal,'click',(event)=>{if(event.target===editShiftModal){editShiftModal.classList.remove('active');}});}addFeatureListener(editShiftForm,'submit',(event)=>{event.preventDefault();const employeeId=editShiftEmployeeIdInput.value;const dayIndex=editShiftDayIndexInput.value;const weekOffset=editShiftWeekOffsetInput.value;const newShiftType=shiftTypeSelect.value;const scheduleKey=`${employeeId}-${weekOffset}-${dayIndex}`;mockScheduleData[scheduleKey]=newShiftType;renderSchedule(parseInt(weekOffset));if(editShiftModal)editShiftModal.classList.remove('active');window.showToast("Shift updated.");});renderSchedule(currentScheduleWeekOffset);const cleanup=()=>{console.log("Cleaning up Employee Scheduling...");featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];document.getElementById('editShiftModal')?.classList.remove('active');document.querySelectorAll('.modal-backdrop').forEach(el=>el.remove());document.body.classList.remove('modal-open');document.body.style.overflow='';document.body.style.paddingRight='';console.log("Employee Scheduling cleanup complete.");};return {cleanup};}
            window.initializeTeamMembersFeature = function(container) { /* ... (JS Logic from Team Members template) ... */ console.log("Initializing Team Members Feature...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("Team Members card body not found!");return {cleanup:()=>{}};}const searchInput=cardBody.querySelector('#teamSearchInputFeature');const teamListContainer=cardBody.querySelector('#teamListContainerFeature');const addMemberBtn=container.querySelector('#addMemberBtnFeature');let featureListeners=[];const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};function filterTeamMembers(){const filterText=searchInput.value.toLowerCase().trim();const memberCards=teamListContainer.querySelectorAll('.team-member-card');memberCards.forEach(card=>{const name=(card.dataset.name||'').toLowerCase();const role=(card.dataset.role||'').toLowerCase();const email=(card.dataset.email||'').toLowerCase();const isMatch=name.includes(filterText)||role.includes(filterText)||email.includes(filterText);card.classList.toggle('hidden-by-filter',!isMatch);});}loadTeamMembers(cardBody);addFeatureListener(searchInput,'input',filterTeamMembers);if(window.currentUser?.role==='admin'){addFeatureListener(addMemberBtn,'click',()=>openMemberModal());}else if(addMemberBtn){addMemberBtn.style.display='none';}const cleanup=()=>{console.log("Cleaning up Team Members feature listeners...");featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];};return {cleanup};}
            window.initializeProjectsFeature = function(container) { /* ... (JS Logic from Projects template) ... */ console.log("Initializing Projects Feature...");const section=container.querySelector('#projects-section');if(!section){console.error("Projects section not found!");return {cleanup:()=>{}};}const searchInput=section.querySelector('#projectSearchInputFeature');const filterSelect=section.querySelector('#projectFilterSelectFeature');const projectsListContainer=section.querySelector('#projectsListContainerFeature');const addProjectBtn=section.querySelector('#addProjectBtnFeature');let featureListeners=[];const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};const filterHandler=()=>renderProjects(section);const actionHandler=(event)=>{const target=event.target.closest('.btn');if(!target)return;const projectId=target.dataset.projectId;if(!projectId)return;if(target.classList.contains('btn-view')){alert(`Placeholder: View details for Project ID ${projectId}`);}else if(target.classList.contains('btn-edit')){openProjectModal(projectId);}else if(target.classList.contains('btn-delete')){handleDeleteProject(projectId);}};const addHandler=()=>{openProjectModal();};if(window.currentUser?.role!=='admin'&&window.currentUser?.role!=='supervisor'){if(addProjectBtn)addProjectBtn.style.display='none';}else{addFeatureListener(addProjectBtn,'click',addHandler);}renderProjects(section);addFeatureListener(searchInput,'input',filterHandler);addFeatureListener(filterSelect,'change',filterHandler);addFeatureListener(projectsListContainer,'click',actionHandler);const cleanup=()=>{console.log("Cleaning up Projects feature listeners...");featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];};return {cleanup};}
            window.initializeInnovationHubFeature = function(container) { /* ... (JS Logic from Innovation Hub template) ... */ console.log("Initializing Innovation Hub Feature...");const cardBody=container.querySelector('.card-body');if(!cardBody){console.error("Innovation Hub card body not found!");return {cleanup:()=>{}};}const hubContent=cardBody.querySelector('#innovation-hub');if(!hubContent){console.error("Innovation Hub content container not found!");return {cleanup:()=>{}};}const employeeNames=window.MOCK_USERS.map(u=>u.name);const adminUser=window.MOCK_USERS.find(u=>u.role==='admin')?.name||employeeNames[0];let currentUser=window.currentUser?.name||employeeNames[0];const isAdmin=window.currentUser?.role==='admin';const suggestionForm=hubContent.querySelector('#suggestion-form');const suggestionText=hubContent.querySelector('#suggestion-text');const employeeSelect=hubContent.querySelector('#employee-select');const suggestionsList=hubContent.querySelector('#suggestions-list');const filterStatusSelect=hubContent.querySelector('#filter-status');const filterAuthorSelect=hubContent.querySelector('#filter-author');const myIdeasToggle=hubContent.querySelector('#my-ideas-toggle');let featureListeners=[];const addFeatureListener=(element,event,handler,options={})=>{if(!element)return;element.addEventListener(event,handler,options);featureListeners.push({element,event,handler,options});};let suggestionsData=JSON.parse(localStorage.getItem('innovationHubSuggestions'))||[{id:1,text:"Implement a 'quiet hour' policy twice a week for focused work.",author:"Esraa Lashin",date:"2024-05-15",status:"Under Review",reply:""},{id:2,text:"Organize monthly cross-departmental knowledge sharing sessions.",author:"Yousef Ahmed",date:"2024-05-10",status:"Implemented",reply:"Excellent initiative, this is now scheduled!"},{id:3,text:"Upgrade the coffee machine in the break room.",author:"Mohamed Elmenisy",date:"2024-04-28",status:"Rejected",reply:"Budget constraints prevent this at the moment."},{id:4,text:"Create a mentorship program for new hires.",author:"Bassant Badr",date:"2024-05-20",status:"Under Review",reply:""}];const saveData=()=>{localStorage.setItem('innovationHubSuggestions',JSON.stringify(suggestionsData));};const formatDate=(dateString)=>{const date=new Date(dateString);return date.toLocaleDateString('en-CA');};const getStatusClass=(status)=>{switch(status){case "Under Review":return "status-under-review";case "Implemented":return "status-implemented";case "Rejected":return "status-rejected";default:return "";}};const escapeHTML=(str)=>{const div=document.createElement('div');div.appendChild(document.createTextNode(str||''));return div.innerHTML;}const renderSuggestions=()=>{suggestionsList.innerHTML='';const statusFilter=filterStatusSelect.value;const authorFilter=filterAuthorSelect.value;const showMyIdeas=myIdeasToggle.classList.contains('active');const filteredSuggestions=suggestionsData.filter(suggestion=>{const statusMatch=statusFilter==='All'||suggestion.status===statusFilter;const authorMatch=authorFilter==='All'||suggestion.author===authorFilter;const myIdeasMatch=!showMyIdeas||suggestion.author===currentUser;return statusMatch&&authorMatch&&myIdeasMatch;});if(filteredSuggestions.length===0){suggestionsList.innerHTML='<p style="grid-column: 1 / -1; text-align: center; color: var(--secondary-text-color);">No suggestions match the current filters.</p>';}else{filteredSuggestions.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(suggestion=>{const card=document.createElement('div');card.classList.add('suggestion-card');card.dataset.id=suggestion.id;card.innerHTML=`<p class="suggestion-text-display">${escapeHTML(suggestion.text)}</p><div class="suggestion-meta"><span class="author"> ${escapeHTML(suggestion.author)}</span><span class="date"> ${formatDate(suggestion.date)}</span></div><div class="suggestion-status-section">Status: <span class="suggestion-status ${getStatusClass(suggestion.status)}">${escapeHTML(suggestion.status)}</span></div><div class="supervisor-reply-section ${suggestion.reply?'':'hidden'}"><strong>${escapeHTML(adminUser)}'s Reply:</strong><p class="supervisor-reply">${escapeHTML(suggestion.reply)}</p></div><div class="admin-controls"><div class="form-group"><label for="status-select-${suggestion.id}">Change Status:</label><select id="status-select-${suggestion.id}" class="admin-status-select form-select form-select-sm"><option value="Under Review" ${suggestion.status==='Under Review'?'selected':''}>Under Review</option><option value="Implemented" ${suggestion.status==='Implemented'?'selected':''}>Implemented</option><option value="Rejected" ${suggestion.status==='Rejected'?'selected':''}>Rejected</option></select></div><div class="form-group"><label for="reply-input-${suggestion.id}">Add/Edit Reply:</label><textarea id="reply-input-${suggestion.id}" class="admin-reply-input form-control" rows="2">${escapeHTML(suggestion.reply)}</textarea></div><div class="admin-actions"><button class="btn btn-primary btn-sm admin-save-reply">Save Reply</button><button class="btn btn-danger btn-sm admin-delete">Delete</button></div></div>`;suggestionsList.appendChild(card);});}};addFeatureListener(suggestionForm,'submit',(e)=>{e.preventDefault();const text=suggestionText.value.trim();const author=employeeSelect.value;if(!text||!author){alert('Please enter your suggestion and select your name.');return;}const newSuggestion={id:Date.now(),text:text,author:author,date:new Date().toISOString(),status:"Under Review",reply:""};suggestionsData.push(newSuggestion);saveData();renderSuggestions();suggestionForm.reset();employeeSelect.value=currentUser;});addFeatureListener(filterStatusSelect,'change',renderSuggestions);addFeatureListener(filterAuthorSelect,'change',renderSuggestions);addFeatureListener(myIdeasToggle,'click',()=>{myIdeasToggle.classList.toggle('active');if(myIdeasToggle.classList.contains('active')){myIdeasToggle.textContent='Show All Ideas';myIdeasToggle.classList.remove('btn-secondary');myIdeasToggle.classList.add('btn-primary');}else{myIdeasToggle.textContent='Show My Ideas Only';myIdeasToggle.classList.remove('btn-primary');myIdeasToggle.classList.add('btn-secondary');}renderSuggestions();});addFeatureListener(suggestionsList,'click',(e)=>{if(!isAdmin)return;const card=e.target.closest('.suggestion-card');if(!card)return;const suggestionId=parseInt(card.dataset.id);const suggestionIndex=suggestionsData.findIndex(s=>s.id===suggestionId);if(suggestionIndex===-1)return;if(e.target.classList.contains('admin-status-select')){const newStatus=e.target.value;suggestionsData[suggestionIndex].status=newStatus;saveData();const statusBadge=card.querySelector('.suggestion-status');statusBadge.textContent=newStatus;statusBadge.className=`suggestion-status ${getStatusClass(newStatus)}`;}if(e.target.classList.contains('admin-save-reply')){const replyInput=card.querySelector('.admin-reply-input');const newReply=replyInput.value.trim();suggestionsData[suggestionIndex].reply=newReply;saveData();const replySection=card.querySelector('.supervisor-reply-section');const replyText=card.querySelector('.supervisor-reply');if(newReply){replyText.textContent=newReply;replySection.classList.remove('hidden');}else{replySection.classList.add('hidden');}window.showToast('Reply saved.','success');}if(e.target.classList.contains('admin-delete')){if(confirm(`Are you sure you want to delete the suggestion: "${suggestionsData[suggestionIndex].text.substring(0,50)}..."?`)){suggestionsData.splice(suggestionIndex,1);saveData();renderSuggestions();}}});const setupHub=()=>{if(isAdmin){hubContent.classList.add('admin-view');}employeeSelect.innerHTML='<option value="" disabled selected>-- Select Your Name --</option>';filterAuthorSelect.innerHTML='<option value="All">All Authors</option>';employeeNames.forEach(name=>{const option=document.createElement('option');option.value=name;option.textContent=name;employeeSelect.appendChild(option.cloneNode(true));filterAuthorSelect.appendChild(option.cloneNode(true));});if(employeeNames.includes(currentUser)){employeeSelect.value=currentUser;}else{console.warn("Current user not in the employee list for submission.");}renderSuggestions();};setupHub();const cleanup=()=>{console.log("Cleaning up Innovation Hub...");featureListeners.forEach(({element,event,handler,options})=>{element?.removeEventListener(event,handler,options);});featureListeners=[];console.log("Innovation Hub cleanup complete.");};return {cleanup};}

            // --- UI Updates ---
            // ... (updateUserUI, updateProfileForm, formatRole - unchanged)

            // --- Preferences & Settings Logic ---
            // ... (applyStoredPreferences, setTheme, setContrast, applyLanguage, applyDateTimeFormat, applyToastPreference, applySoundPreference - unchanged)

            // --- Navigation & Content Loading ---
            // ... (setActiveFeature, activateSettingsTab, injectStyles, removeInjectedStyles, loadFeatureContent, updateBrowserHistory, handleInitialNavigation - unchanged)

            // --- Data Loading & Simulation ---
            // ... (loadInitialData, loadDashboardStats, updateStatCard, loadRecentActivities, loadNotifications, renderNotifications, loadTeamMembers - unchanged)

            // --- Dynamic Updates Simulation ---
            // ... (startDynamicUpdates, changeWelcomeBackground - unchanged)

            // --- Event Listeners ---
            // ... (setupEventListeners - unchanged, uses the global addListener)

            // --- Profile Logic ---
            // ... (handleAvatarUpload, updateFullNameDisplay, handleProfileSave, handleProfileCancel - unchanged)

             // --- Settings Save Logic ---
            // ... (handleSavePreferences, handleSaveAccountSettings, handleChangePassword, handleSaveSessionSettings, handleSaveNotificationSettings - unchanged)

             // --- 2FA Logic (Simulation) ---
            // ... (update2FA_UI, handleEnable2FA, showAuthAppSetup, showSmsSetup, handleVerifyAuthCode, handleSendSmsCode, handleVerifySmsCode, handleDisable2FA - unchanged)

             // --- Danger Zone Logic ---
            // ... (handleLogoutAllDevices, handleDeleteAccount - unchanged)

             // --- Notification Logic ---
            // ... (markAllNotificationsAsRead, playNotificationSound (now does nothing if sounds disabled) - unchanged)

             // --- Logout Logic ---
            // ... (handleLogout - unchanged)

            // --- Team Management Logic ---
            // ... (handleInviteMember, openMemberModal, handleSaveMember, handleRemoveMember, handleDeleteAllNonAdminUsers - unchanged)

            // --- Project Feature Logic ---
            // ... (handleDeleteProject, openProjectModal, handleSaveProject - unchanged)

            // --- Employee Scheduling Helpers ---
            // ... (handleSendReminders - unchanged)

            // --- Start Application ---
            initDashboard();
        });
    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <!-- CSS الخاص بجدول الموظفين (مطلوب وجوده بنفس المجلد) -->
    <link rel="stylesheet" href="employee-scheduling.css">
    <!-- <link rel="stylesheet" href="projects.css"> -->

    <style>
        /* --- أنماط الداشبورد الأساسية (نسخة كاملة) --- */
        :root {
            --primary: #2563eb; --primary-dark: #1e3a8a; --primary-light: #dbeafe; --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --dark: #1e293b; --light: #f8fafc; --gray: #64748b; --light-gray: #e2e8f0; --white: #ffffff; --sidebar-width: 280px; --sidebar-bg: #1e3a8a; --sidebar-text: rgba(255,255,255,0.9); --sidebar-hover: rgba(255,255,255,0.1); --sidebar-active: rgba(255,255,255,0.2); --sidebar-divider: rgba(255,255,255,0.1); --success: #10b981; --team-manager: #ef4444; --compact-padding: 0.5rem; --normal-padding: 1rem; --spacious-padding: 1.5rem; --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554); --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46); --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8); --welcome-bg-current: var(--welcome-bg-1); --hc-text: #000000; --hc-background: #ffffff; --hc-primary: #0000ff; --hc-secondary: #008000; --hc-link: #0000ee; --hc-border: #000000; --text-color: var(--dark); --schedule-weekend-bg: #f3f4f6; --schedule-weekend-text: #9ca3af;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--primary-light); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }
        body.high-contrast { --dark: var(--hc-text); --light: var(--hc-background); --gray: var(--hc-text); --light-gray: var(--hc-border); --white: var(--hc-background); --primary: var(--hc-primary); --primary-dark: var(--hc-primary); --primary-light: #e0e0ff; --secondary: var(--hc-secondary); --sidebar-bg: var(--hc-background); --sidebar-text: var(--hc-text); --sidebar-hover: #e0e0e0; --sidebar-active: #c0c0c0; --sidebar-divider: var(--hc-border); --text-color: var(--hc-text); color: var(--text-color); background-color: var(--hc-background); }
        body.high-contrast .welcome-section, body.high-contrast .stat-card, body.high-contrast .top-nav, body.high-contrast .sidebar, body.high-contrast .activity-section, body.high-contrast .content-section { background: var(--hc-background); border: 1px solid var(--hc-border); color: var(--text-color); }
        body.high-contrast .btn, body.high-contrast .form-control, body.high-contrast .search-bar input { border: 1px solid var(--hc-border); }
        body.high-contrast .btn-primary { background-color: var(--hc-primary); color: var(--hc-background); }
        body.high-contrast .logo { color: var(--text-color); } body.high-contrast .logo-icon { color: var(--hc-primary); } body.high-contrast .menu-item { color: var(--text-color); border-left-color: transparent; } body.high-contrast .menu-item.active { background-color: #c0c0c0; border-left-color: var(--hc-primary); } body.high-contrast .stat-card { border-left-width: 3px; background: var(--hc-background); } body.high-contrast .welcome-section { background: var(--hc-background); }
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; } .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; } .logo-icon { color: var(--white); font-size: 1.5rem; } .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; } .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; } .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;} .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); } .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;} .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; } .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; } .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; } .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; } @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; } body.spacious .top-nav { padding: var(--spacious-padding) 2rem; } .search-bar { position: relative; width: 400px; } .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--white); color: var(--text-color); } .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); } .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); } .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; } .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; } .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; } .search-result-item i { color: var(--gray); } .search-result-item:hover { background-color: var(--primary-light); } .user-menu { display: flex; align-items: center; gap: 1.5rem; } .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; } .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; } @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } } .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; } .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; } .user-profile-details { display: flex; align-items: center; cursor: pointer; } .user-name { font-weight: 500; color: var(--text-color); } .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); } .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; } @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } } .user-dropdown.active { display: block; } .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; cursor: pointer; } .dropdown-item:hover { background-color: var(--light); } .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; }
        body.compact .content-area { padding: 1rem; } body.spacious .content-area { padding: 3rem; } .welcome-section { background: var(--welcome-bg-current); color: var(--white); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; } body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; } body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; } .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; } body.compact .welcome-title { font-size: 1.25rem; } .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; } body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;} .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; } body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; } .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); } body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; } .user-info-details { flex: 1; } .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;} body.compact .user-info-name { font-size: 1rem; } .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; } .user-info-title.role-admin { color: var(--team-manager); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); } .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; } .user-info-title.role-senior { color: var(--secondary); font-weight: 700; } body.compact .user-info-title { font-size: 0.8rem; } .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; } .user-info-email span { color: inherit; } .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; } body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; } body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; } .stat-card { background: var(--white); border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease; position: relative; overflow: hidden; border-left: 5px solid var(--primary); color: var(--dark); } .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); } .stat-card:nth-child(2) { border-left-color: var(--secondary); background: var(--stat-card-bg-2); } .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); } .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); } body.compact .stat-card { padding: 1rem; } body.spacious .stat-card { padding: 2rem; } .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); } .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; } body.compact .stat-title { font-size: 0.8rem; } .stat-title i { opacity: 0.8; } .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; } .stat-card:nth-child(1) .stat-value { color: #1e40af; } .stat-card:nth-child(2) .stat-value { color: #15803d; } .stat-card:nth-child(3) .stat-value { color: #b45309; } .stat-card:nth-child(4) .stat-value { color: #b91c1c; } body.compact .stat-value { font-size: 1.5rem; } .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; } body.compact .stat-trend { font-size: 0.8rem; } .trend-up { color: var(--secondary); } .trend-down { color: var(--danger); } .trend-neutral { color: var(--gray); } .activity-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; } body.compact .activity-section { padding: 1rem; } body.spacious .activity-section { padding: 2rem; } .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; } body.compact .section-header { margin-bottom: 1rem; } body.spacious .section-header { margin-bottom: 2rem; } .section-title { font-size: 1.25rem; font-weight: 600; color: var(--text-color); } body.compact .section-title { font-size: 1.1rem; } .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; } @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } } .section-header > div { display: flex; align-items: center; gap: 1rem;} .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; } .view-all { color: var(--primary); } .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); } .delete-all { color: var(--danger); } .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); } .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; } .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--light-gray); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; } body.compact .activity-item { padding: 0.75rem 0; } body.spacious .activity-item { padding: 1.25rem 0; } .activity-item:last-child { border-bottom: none; } .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; } @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } } .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; } body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; } .activity-content { flex: 1; } .activity-message { margin-bottom: 0.25rem; color: var(--text-color); } body.compact .activity-message { font-size: 0.9rem; } .activity-time { font-size: 0.8rem; color: var(--gray); } body.compact .activity-time { font-size: 0.7rem; } .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; } .delete-activity { color: var(--danger); cursor: pointer; opacity: 0.6; transition: opacity 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; } .activity-item:hover .delete-activity { opacity: 1; } .delete-activity:hover { opacity: 1; background-color: rgba(239, 68, 68, 0.1); }
        .content-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; }
        .content-section.active { display: block; }
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        body.compact .content-section { padding: 1rem; } body.spacious .content-section { padding: 3rem; } .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; } body.compact .section-main-header { margin-bottom: 1.5rem; } body.spacious .section-main-header { margin-bottom: 3rem; } .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); } body.compact .section-main-title { font-size: 1.25rem; } .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;} .profile-avatar-section { text-align: center; margin-bottom: 2rem; } #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; } #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; } #profileAvatarLarge:hover::after { opacity: 1; } #uploadPhotoButton { display: none; }
        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; } body.compact .data-form { gap: 1rem; } body.spacious .data-form { gap: 2rem; } .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; } body.compact .form-group { margin-bottom: 0.75rem; } body.spacious .form-group { margin-bottom: 1.5rem; } .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; } body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; } .form-control { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; background-color: var(--white); color: var(--text-color); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; } body.compact .form-control { padding: 0.5rem; font-size: 0.9rem; } body.spacious .form-control { padding: 1rem; } .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); } .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; } .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; } body.compact .form-actions { margin-top: 0.5rem; } body.spacious .form-actions { margin-top: 2rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; } body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; } body.spacious .btn { padding: 1rem 2rem; } .btn-primary { background-color: var(--primary); color: white; } .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); } .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); } .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); } .btn-warning { background-color: var(--warning); color: var(--primary-dark); } .btn-warning:hover:not(:disabled) { background-color: #d97706; } .btn-danger { background-color: var(--danger); color: white; } .btn-danger:hover:not(:disabled) { background-color: #dc2626; } .btn-success { background-color: var(--success); color: white; } .btn-success:hover:not(:disabled) { background-color: #0d9f6e; } .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; } body.compact .settings-tabs { margin-bottom: 1.5rem; } body.spacious .settings-tabs { margin-bottom: 3rem; } .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; } body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; } body.spacious .settings-tab { padding: 1rem 2rem; } .settings-tab:hover { color: var(--primary); } .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;} .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; } .settings-panel { display: none; } .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; } @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } } .settings-subsection { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray); } .settings-subsection:first-child { margin-top: 0; padding-top: 0; border-top: none; } .settings-subsection h4 { font-size: 1.1rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 1rem; } .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; } .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; } @media (min-width: 768px) { .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; } } .setting-item-label { font-weight: 500; color: var(--text-color); } .setting-item-description { font-size: 0.9rem; color: var(--gray); margin-top: 0.25rem;} .setting-item-control { flex-shrink: 0; margin-left: 1rem; } @media (max-width: 767px) { .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; } }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; } body.compact .switch { width: 40px; height: 20px; } .switch input { opacity: 0; width: 0; height: 0; } .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; } .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; } body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; } input:checked + .slider { background-color: var(--primary); } input:checked + .slider:before { transform: translateX(26px); } body.compact input:checked + .slider:before { transform: translateX(20px); } .slider.round { border-radius: 34px; } .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; } body.compact .team-management { margin-top: 1rem; } body.spacious .team-management { margin-top: 2rem; } .team-management h3, .add-member-form h4 { color: var(--text-color); margin-bottom: 1rem; } .team-list { margin-top: 1rem; } body.compact .team-list { margin-top: 0.75rem; } body.spacious .team-list { margin-top: 1.5rem; } .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--light-gray); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--white); } body.compact .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; } body.spacious .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; } .team-member-card:hover { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); border-color: var(--primary); } .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; } body.compact .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; } .member-details { flex: 1; min-width: 0; } .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} body.compact .member-name { font-size: 0.9rem; } .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} body.compact .member-email { font-size: 0.8rem; } .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; } body.compact .member-role { font-size: 0.7rem; margin: 0 0.75rem; } .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); } .role-senior { background-color: rgba(37, 99, 235, 0.1); color: var(--primary); } .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); } .role-member { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); } .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; } .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; } .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); } body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; } body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; } .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; } @keyframes spin { to { transform: rotate(360deg); } } .btn .spinner { display: inline-block; } .btn.loading .spinner { display: inline-block; } .btn.loading span.btn-text { display: none; } /* Hide text when loading */ .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }
        body.light-theme { --primary-light: #f1f5f9; --light: #ffffff; --white: #ffffff; --dark: #1e293b; --gray: #64748b; --light-gray: #e2e8f0; --text-color: var(--dark); background-color: var(--primary-light); }
        body.dark-theme { --primary: #3b82f6; --primary-dark: #1e40af; --primary-light: #1e293b; --light: #334155; --white: #0f172a; --dark: #e2e8f0; --gray: #94a3b8; --light-gray: #475569; --text-color: var(--dark); --schedule-weekend-bg: #262f3e; --schedule-weekend-text: #6b7280; background-color: var(--white); color: var(--text-color); }
        body.dark-theme .top-nav { background-color: var(--light); border-bottom-color: var(--light-gray); } body.dark-theme .stat-card, body.dark-theme .activity-section, body.dark-theme .content-section, body.dark-theme .team-member-card, body.dark-theme .add-member-form { background-color: var(--light); border-color: var(--light-gray); } body.dark-theme .search-bar input, body.dark-theme .form-control { background-color: var(--primary-light); border-color: var(--light-gray); color: var(--text-color); } body.dark-theme .form-control[readonly] { background-color: var(--light); opacity: 0.6; } body.dark-theme .search-results { background-color: var(--light); border-color: var(--light-gray); } body.dark-theme .search-result-item { color: var(--text-color); } body.dark-theme .search-result-item:hover { background-color: var(--primary-light); } body.dark-theme .user-dropdown { background-color: var(--light); border-color: var(--light-gray); } body.dark-theme .dropdown-item { color: var(--text-color); } body.dark-theme .dropdown-item:hover { background-color: var(--primary-light); } body.dark-theme .notifications-container { background-color: var(--light); } body.dark-theme .notification-list-item:hover { background-color: var(--primary-light); } body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } body.dark-theme .confirm-container, body.dark-theme .modal-content { background-color: var(--light); color: var(--text-color); } body.dark-theme .theme-option div { border-color: var(--light-gray); } body.dark-theme .theme-option.selected div { border-color: var(--primary); } body.dark-theme .back-button { color: var(--primary); } body.dark-theme .back-button:hover { background-color: var(--light); color: #60a5fa; border-color: var(--primary); } body.dark-theme .notifications-footer { background-color: var(--light); border-top-color: var(--light-gray); } body.dark-theme .welcome-section { background: var(--welcome-bg-current); color: var(--white); } body.dark-theme .welcome-subtitle { color: inherit; opacity: 0.8; } body.dark-theme .user-info-name { color: inherit; } body.dark-theme .user-info-title { color: var(--gray); } body.dark-theme .user-info-title.role-admin { color: var(--team-manager); } body.dark-theme .user-info-email span { color: inherit; } body.dark-theme .stat-card { background: var(--light); color: var(--text-color);} body.dark-theme .stat-title { color: var(--text-color); } body.dark-theme .stat-card:nth-child(1) .stat-value { color: #93c5fd; } body.dark-theme .stat-card:nth-child(2) .stat-value { color: #86efac; } body.dark-theme .stat-card:nth-child(3) .stat-value { color: #fcd34d; } body.dark-theme .stat-card:nth-child(4) .stat-value { color: #fca5a5; } body.dark-theme .activity-icon { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa; } body.dark-theme .activity-item { border-bottom-color: var(--light-gray); } body.dark-theme .activity-message { color: var(--text-color); } body.dark-theme .activity-time { color: var(--gray); } body.dark-theme .activity-item.new-activity { background-color: rgba(59, 130, 246, 0.1); } body.dark-theme .delete-activity:hover { background-color: rgba(239, 68, 68, 0.2); } body.dark-theme .profile-avatar-section label { color: var(--text-color); } body.dark-theme #profileAvatarLarge { background-color: var(--light); color: var(--text-color); border-color: var(--primary-light); } body.dark-theme .profile-header-text { color: var(--gray); } body.dark-theme .placeholder-content { color: var(--gray); border-color: var(--light-gray); } body.dark-theme .placeholder-content h2 { color: var(--text-color); } body.dark-theme .placeholder-content p { color: var(--gray); } body.dark-theme .placeholder-content .error-message { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: var(--text-color); } body.dark-theme .settings-label, body.dark-theme .form-group label { color: var(--text-color); } body.dark-theme .settings-subsection h4 { color: #93c5fd; } body.dark-theme .setting-item-label { color: var(--text-color); } body.dark-theme .setting-item-description { color: var(--gray); } body.dark-theme .theme-option span { color: var(--text-color); } body.dark-theme .qr-code-placeholder { border-color: var(--light-gray); color: var(--gray); } body.dark-theme .danger-zone-item .btn-danger { background-color: #dc2626; } body.dark-theme .danger-zone-item .btn-danger:hover:not(:disabled) { background-color: #b91c1c; } body.dark-theme .danger-zone-item p { color: var(--gray); }
        body.dark-theme .checkbox-group { border-color: var(--light-gray); } body.dark-theme .checkbox-group label { color: var(--text-color); } body.dark-theme .confirm-title { color: var(--text-color); } body.dark-theme .confirm-message { color: var(--gray); } body.dark-theme .modal-title { color: #93c5fd; } body.dark-theme .team-member-card .member-name { color: var(--text-color); } body.dark-theme .team-member-card .member-email { color: var(--gray); } body.dark-theme .search-result-item strong { color: var(--text-color); } body.dark-theme .user-name { color: var(--text-color); }
        .theme-options-container { display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap; } .theme-option { display: flex; flex-direction: column; align-items: center; cursor: pointer; } .theme-option .theme-preview { width: 60px; height: 40px; border: 2px solid var(--light-gray); border-radius: 6px; transition: border-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; } .theme-option .theme-label { text-align: center; display: block; margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-color); } .theme-option:hover .theme-preview { border-color: var(--primary); } .theme-option.selected .theme-preview { border-color: var(--primary); border-width: 3px; } .theme-preview.light-preview { background-color: #f8fafc; color: #1e293b; } .theme-preview.dark-preview { background-color: #0f172a; color: #e2e8f0; } .theme-preview.system-preview { background: linear-gradient(45deg, #f8fafc 50%, #0f172a 50%); color: var(--gray); }
        .two-fa-status { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; } .two-fa-status .status-indicator { width: 10px; height: 10px; border-radius: 50%; } .two-fa-status .status-indicator.enabled { background-color: var(--success); } .two-fa-status .status-indicator.disabled { background-color: var(--danger); } .two-fa-setup { border: 1px dashed var(--light-gray); padding: 1.5rem; border-radius: 6px; margin-top: 1rem; background-color: var(--light); } .qr-code-placeholder { width: 150px; height: 150px; border: 2px dashed var(--light-gray); display: flex; align-items: center; justify-content: center; text-align: center; color: var(--gray); font-size: 0.9rem; margin: 1rem auto; } .two-fa-actions { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; }
         .danger-zone-item { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border: 1px solid var(--danger); background-color: rgba(239, 68, 68, 0.05); border-radius: 8px; margin-bottom: 1rem; flex-wrap: wrap; } .danger-zone-item div { max-width: 100%; flex-grow: 1; margin-right: 1rem; } @media (min-width: 768px) { .danger-zone-item div { max-width: 70%; } } .danger-zone-item h5 { color: var(--danger); margin-bottom: 0.25rem; } .danger-zone-item p { color: var(--gray); font-size: 0.9rem; } .danger-zone-item .btn { flex-shrink: 0; margin-top: 0.5rem; }
        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; } .notifications-modal.active { display: flex; } .notifications-container { width: 400px; max-width: 100%; background-color: var(--white); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; } @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } } .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; } .notifications-title { font-size: 1.25rem; font-weight: 600; } .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; } .notifications-body { flex-grow: 1; overflow-y: auto; } .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--light-gray); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; cursor: pointer; position: relative; } .notification-list-item:hover { background-color: var(--light); } .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; } body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } .notification-list-item:last-child { border-bottom: none; } .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; } body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa;} .notification-content { flex: 1; min-width: 0; } .notification-message { margin-bottom: 0.25rem; color: var(--text-color); line-height: 1.4; } .notification-time { font-size: 0.8rem; color: var(--gray); } .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--white); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; } .notification-list-item:hover .delete-notification { opacity: 0.6; } .delete-notification:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); } body.dark-theme .delete-notification { background: var(--light); } body.dark-theme .delete-notification:hover { background: rgba(239, 68, 68, 0.2); } .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); } .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--light); flex-wrap: wrap; gap: 0.5rem; }
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); } .confirm-modal.active { display: flex; } .confirm-container { background-color: var(--white); border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; } @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } } .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-color); } .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--gray); } .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); } .success-message.show { transform: translateX(0); } .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; } .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); } .back-button i { transition: transform 0.2s; font-size: 0.8rem; } .back-button:hover i { transform: translateX(-3px); }
        #notificationSound { display: none; } .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--light-gray); border-radius: 8px; margin-top: 2rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; } .placeholder-content h2 { color: var(--text-color); margin-bottom: 1rem; } .placeholder-content p { color: var(--gray); } .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; } .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1050; justify-content: center; align-items: center; padding: 20px; } .modal.active { display: flex; } .modal-content { background-color: var(--white); width: 100%; max-width: 500px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out; color: var(--text-color); } .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--light-gray); } .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--primary-dark); } body.dark-theme .modal-title { color: #93c5fd; } .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;} .close-modal:hover { color: var(--danger); } @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; } .toast.show { opacity: 1; bottom: 30px; } .toast.success { background-color: var(--success); } .toast.error { background-color: var(--danger); } body.dark-theme .toast { background-color: var(--light); color: var(--text-color); } body.dark-theme .toast.success { background-color: var(--success); color: white; } body.dark-theme .toast.error { background-color: var(--danger); color: white; }
        @media (max-width: 992px) { .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; } .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); } .main-content { margin-left: 0; } .search-bar { width: 250px; } .team-member-card { flex-wrap: wrap; } .main-content.sidebar-active { margin-left: 250px; } .sidebar-toggle { display: block; position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } .top-nav { padding-left: 60px; } }
        @media (min-width: 993px) { .sidebar-toggle { display: none; } }
        @media (max-width: 768px) { .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; } .search-bar { width: 100%; order: 2; } .user-menu { width: 100%; justify-content: space-between; order: 1; } .content-area { padding: 1.5rem; } .data-form { grid-template-columns: 1fr; } .form-actions { grid-column: span 1; } .user-info { flex-direction: column; text-align: center; } .user-info-avatar { margin-bottom: 1rem; } .stats-section { grid-template-columns: 1fr; } .settings-tabs { flex-wrap: nowrap; overflow-x: auto; } .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; } .confirm-container { width: 90%; } .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; } .member-role { margin: 0.5rem 0; } .member-actions { margin-top: 0.5rem; } .profile-avatar-section { margin-bottom: 1.5rem; } #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; } .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; } .add-member-form .data-form > div { margin-bottom: 1rem; } .add-member-form .data-form > div:last-child { margin-top: 0; } .modal-content { width: 95%; padding: 1.5rem;} .notifications-container { width: 100%; max-width: 100%; } .sidebar-toggle { top: 10px; left: 10px; } .top-nav { padding-top: 60px; } }
        @media (max-width: 480px) { .section-header > div { justify-content: center; width: 100%; } .welcome-section { padding: 1.5rem; } .stats-section { gap: 0.75rem; } .stat-card { padding: 1rem; } .user-menu { gap: 1rem; } .user-name { display: none; } .user-status { margin-left: 0; } .notifications-footer { flex-direction: column; gap: 0.5rem; } .notifications-footer .btn { width: 100%; justify-content: center; } }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid var(--light-gray); border-radius: 6px; } .checkbox-group label { display: flex; align-items: center; gap: 0.5rem; font-weight: normal; font-size: 0.9rem; margin-bottom: 0; color: var(--text-color); } .checkbox-group input[type="checkbox"] { width: auto; margin-right: 0.25rem; } .settings-link { color: var(--primary); text-decoration: none; cursor: pointer; } .settings-link:hover { text-decoration: underline; color: var(--primary-dark); }
        /* --- نهاية أنماط الداشبورد الأساسية --- */

        /* إخفاء الأقسام المضمنة غير النشطة */
        .content-section:not(.active) {
             display: none;
        }
    </style>
</head>
<body class=""> <!-- Theme class added by JS -->

    <!-- Audio, Toast, Success elements -->
    <audio id="notificationSound" preload="auto"><source src="assets/notification.mp3" type="audio/mpeg"></audio>
    <div class="toast" id="toastMessage">Toast message</div>
    <div class="success-message" id="successMessage"><i class="fas fa-check-circle"></i><span id="successMessageText">Success!</span></div>

    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar"><i class="fas fa-bars"></i></button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo"> <i class="fas fa-users-cog logo-icon"></i> <span>TeamFlow</span> </div>
            <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar"> <i class="fas fa-times"></i> </button>
        </div>
        <div class="sidebar-menu">
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reportsAnalytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="teamMembersView"> <i class="fas fa-users"></i><span>Team Members</span> </a>
             <div class="menu-title">Core Features</div>
             <a href="#file-sharing" class="menu-item" data-feature="fileSharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
             <a href="#data-management" class="menu-item" data-feature="dataManagement"><i class="fas fa-database"></i><span>Data Management</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="projectTracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="taskManagement"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <div class="menu-title">Team Tools</div>
             <a href="#employee-scheduling" class="menu-item" data-feature="employeeScheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="teamCalendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
             <a href="#deadline-tracking" class="menu-item" data-feature="deadlineTracking"><i class="fas fa-clock"></i><span>Deadline Tracking</span></a>
             <a href="#innovation-hub" class="menu-item" data-feature="innovationHub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>
             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
        <div class="connection-status"> <div class="status-dot"></div> <span>Online</span> </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Top Nav -->
        <nav class="top-nav">
             <div class="search-bar"> <i class="fas fa-search search-icon"></i> <input type="text" placeholder="Search..." id="searchInput" autocomplete="off"> <div class="search-results" id="searchResults"></div> </div>
             <div class="user-menu"> <div class="notification-icon" id="notificationIcon"> <i class="fas fa-bell"></i> <span class="notification-badge" id="notificationBadge" style="display: none;">0</span> </div> <div class="user-profile" id="userProfileContainer"> <div class="user-avatar" id="userAvatar">U</div> <div class="user-profile-details"> <span class="user-name" id="userName">User</span> <span class="user-status"> • Connected</span> </div> <div class="user-dropdown" id="userDropdown"> <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a> <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a> <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a> </div> </div> </div>
        </nav>

        <!-- Content Area -->
        <div class="content-area">
            <div class="back-button" id="backButton" style="display: none;"> <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span> </div>

            <!-- STATIC Dashboard Section -->
            <div id="dashboardContent" class="content-section active">
                 <div class="welcome-section" id="welcomeSection"> <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2> <p class="welcome-subtitle">Overview of your team activities.</p> <div class="user-info"> <div class="user-info-avatar" id="profileAvatar">U</div> <div class="user-info-details"> <div class="user-info-name" id="userInfoName">Loading...</div> <div class="user-info-title" id="userInfoRoleTitle">Loading...</div> <div class="user-info-email"> <i class="fas fa-envelope"></i> <span id="userEmail">loading...</span> </div> </div> </div> </div>
                 <div class="stats-section" id="statsSection"> <!-- Populated by JS --> </div>
                 <div class="activity-section"> <div class="section-header"> <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3> <div> <span class="view-all" id="viewAllActivity" style="display: none;">Show All</span> <span class="delete-all" id="deleteAllActivity" style="display: none;">Delete All</span> </div> </div> <ul class="activity-list" id="activityList"> <!-- Populated by JS --> </ul> </div>
            </div>

            <!-- STATIC Profile Section -->
            <div id="profileContent" class="content-section">
                 <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Manage your personal information and avatar.</p>
                 <div class="profile-avatar-section"> <label class="settings-label">Avatar</label> <div id="profileAvatarLarge" title="Click to upload photo">U</div> <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;"> </div>
                 <form class="data-form" id="profileForm"> <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control"> </div> <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control"> </div> <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" readonly> </div> <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control"> </div> <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" readonly> </div> <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control"> </div> <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control"> </div> <div class="form-actions"> <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button> <button type="submit" class="btn btn-primary" id="saveProfileBtn"> <span class="btn-text">Save Changes</span> <span class="spinner" style="display: none;"></span> </button> </div> </form>
            </div>

             <!-- STATIC Settings Section -->
            <div id="settingsContent" class="content-section">
                 <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                 <div class="settings-tabs"> <div class="settings-tab active" data-tab="preferences">Preferences</div> <div class="settings-tab" data-tab="account">Account</div> <div class="settings-tab" data-tab="security">Security</div> <div class="settings-tab" data-tab="notifications">Notifications</div> <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div> <div class="settings-tab" data-tab="collaboration">Collaboration</div> <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div> </div>
                 <!-- Settings Panels - Content populated by JS or static -->
                 <div class="settings-panel active" id="preferencesPanel"> <!-- Preferences Content --> </div>
                 <div class="settings-panel" id="accountPanel"> <!-- Account Content --> </div>
                 <div class="settings-panel" id="securityPanel"> <!-- Security Content --> </div>
                 <div class="settings-panel" id="notificationsPanel"> <!-- Notifications Content --> </div>
                 <div class="settings-panel" id="teamPanel"> <!-- Team Management Content --> </div>
                 <div class="settings-panel" id="collaborationPanel"> <!-- Collaboration Content --> </div>
                 <div class="settings-panel" id="dangerPanel"> <!-- Danger Zone Content --> </div>
            </div>

            <!-- ======================================= -->
            <!-- == EMBEDDED Employee Scheduling Section == -->
            <!-- ======================================= -->
            <div id="employeeSchedulingContent" class="content-section feature-section">
                <!-- HTML الخاص بـ Employee Scheduling -->
                <div class="employee-schedule-section">
                    <div class="schedule-page-header section-main-header">
                        <h2 class="schedule-page-title section-main-title">Employee Scheduling</h2>
                        <button class="btn btn-primary" id="saveScheduleBtn" style="display: none;"> <i class="fas fa-save"></i> Save Schedule </button>
                    </div>
                    <div class="schedule-controls">
                        <button class="btn btn-outline" id="prevWeekBtn"><i class="fas fa-chevron-left"></i> Prev</button>
                        <span id="weekDisplay" style="margin: 0 1rem; font-weight: 500;">Loading...</span>
                        <button class="btn btn-outline" id="nextWeekBtn">Next <i class="fas fa-chevron-right"></i></button>
                        <button class="btn btn-success" id="sendRemindersBtn" style="margin-left: auto; display: none;"> <i class="fas fa-envelope"></i> Send Reminders </button>
                        <button class="btn btn-secondary" id="addNewEmployeeBtn_schedule" style="display: none;"> <i class="fas fa-user-plus"></i> Add Employee </button>
                    </div>
                    <div class="schedule-container">
                        <table class="schedule-table">
                            <thead> <tr> <th>Employee</th> <!-- Day headers added by JS --> </tr> </thead>
                            <tbody id="scheduleTableBody"> <tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">Loading schedule...</td></tr> </tbody>
                        </table>
                    </div>
                    <!-- Shift Edit Modal (Scoped within this section) -->
                    <div class="modal" id="editShiftModal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 class="modal-title" id="editShiftModalTitle">Edit Shift</h3>
                                <button class="close-modal" data-close-modal>×</button>
                            </div>
                            <form id="editShiftForm">
                                <input type="hidden" id="editShiftEmployeeId">
                                <input type="hidden" id="editShiftDayIndex">
                                <input type="hidden" id="editShiftWeekOffset">
                                <div class="form-group">
                                    <label for="shiftEmployeeNameDisplay">Employee</label>
                                    <input type="text" id="shiftEmployeeNameDisplay" class="form-control" readonly style="background-color: var(--light-gray); cursor: default;">
                                </div>
                                <div class="form-group">
                                    <label for="shiftTypeSelect">Shift Type</label>
                                    <select id="shiftTypeSelect" class="form-control">
                                        <option value="morning">Morning (9AM-5PM)</option>
                                        <option value="afternoon">Afternoon (12PM-8PM)</option>
                                        <option value="night">Night (8PM-4AM)</option>
                                        <option value="off">Day Off</option>
                                        <option value="sick">Sick Leave</option>
                                        <option value="vacation">Vacation</option>
                                    </select>
                                </div>
                                <div class="form-actions">
                                     <button type="button" class="btn btn-danger" id="deleteShiftBtn_modal" style="margin-right: auto;">Delete Shift</button> <!-- Moved delete to left -->
                                     <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                                     <button type="submit" class="btn btn-primary">Save Shift</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div> <!-- End #employeeSchedulingContent -->

             <!-- ======================================= -->
            <!-- == EMBEDDED Placeholder Sections == -->
            <!-- ======================================= -->
            <div id="projectsContent" class="content-section feature-section"><h2>Projects (Coming Soon)</h2><p>Project list and details.</p></div>
            <div id="reportsAnalyticsContent" class="content-section feature-section"><h2>Reports & Analytics (Coming Soon)</h2><p>Charts and data visualization.</p></div>
            <div id="teamMembersViewContent" class="content-section feature-section"><h2>Team Members (Coming Soon)</h2><p>A dedicated view for team members list/grid.</p></div>
            <div id="fileSharingContent" class="content-section feature-section"><h2>File Sharing (Coming Soon)</h2><p>Upload, browse, and manage shared files.</p></div>
            <div id="dataManagementContent" class="content-section feature-section"><h2>Data Management (Coming Soon)</h2><p>Manage application data.</p></div>
            <div id="projectTrackingContent" class="content-section feature-section"><h2>Project Tracking (Coming Soon)</h2><p>Gantt charts, timelines, etc.</p></div>
            <div id="taskManagementContent" class="content-section feature-section"><h2>Task Management (Coming Soon)</h2><p>Kanban board or task list view.</p></div>
            <div id="teamCalendarContent" class="content-section feature-section"><h2>Team Calendar (Coming Soon)</h2><p>View team events and schedules.</p></div>
            <div id="deadlineTrackingContent" class="content-section feature-section"><h2>Deadline Tracking (Coming Soon)</h2><p>Monitor upcoming deadlines.</p></div>
            <div id="innovationHubContent" class="content-section feature-section"><h2>Innovation Hub (Coming Soon)</h2><p>Idea submission and voting.</p></div>

        </div> <!-- End .content-area -->
    </main>

    <!-- Modals -->
    <div class="notifications-modal" id="notificationsModal"> <!-- Notifications content --> </div>
    <div class="confirm-modal" id="confirmModal"> <!-- Confirmation content --> </div>
    <div class="modal" id="editMemberModal"> <!-- Edit Member content --> </div>


    <script>
        // ==========================================
        //          DASHBOARD CORE SCRIPT
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM References (Selected as needed) ---
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const navLinks = document.querySelectorAll('.menu-item, .dropdown-item[data-feature]'); // All navigation links
            const allContentSections = document.querySelectorAll('.content-area > .content-section');
            const backButton = document.getElementById('backButton');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const logoutLink = document.getElementById('logoutLink');
            const toastMessage = document.getElementById('toastMessage');
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const notificationSound = document.getElementById('notificationSound');
            // ... (add other general references as needed)

            // --- State Variables ---
            let currentUser = null;
            let teamMembers = [];
            let currentFeature = 'dashboard';
            let currentSettingsTab = 'preferences';
            let confirmCallback = null;
            let showToasts = true;
            let playSounds = true;
            let featureInitialized = {}; // Track which component initializers have run

            // --- Mock Data ---
            const MOCK_USERS_DATA = [ { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin' }, { id: 2, name: 'Yousef Ahmed', email: 'yousef@example.com', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'YA', role: 'supervisor' }, { id: 3, name: 'Esraa Lashin', email: 'esraa@example.com', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'EL', role: 'senior' }, { id: 4, name: 'Bassant Badr', email: 'bassant@example.com', title: 'Junior Designer', department: 'Design', phone: '+20155444333', avatar: '', initials: 'BB', role: 'member' }, { id: 5, name: 'Nada Mahmoud', email: 'nada@example.com', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'NM', role: 'member' }, ];

            // --- Initialization ---
            function initDashboard() {
                currentUser = MOCK_USERS_DATA.find(u => u.role === 'admin') || MOCK_USERS_DATA[0];
                teamMembers = MOCK_USERS_DATA;
                if (!currentUser) { console.error("Fatal: No current user."); return; }
                applyStoredPreferences(); // Theme etc. first
                updateUserUI();
                setupEventListeners();
                handleInitialNavigation(); // Activate section based on hash or default
                // loadInitialDashboardData(); // Load stats, activity etc. for dashboard view
                // startDynamicUpdates(); // If needed
                setupResponsiveSidebar();
                 // Load initial settings panel content (if settings is the initial view)
                 if (currentFeature === 'settings') {
                     initializeSettingsPanels(); // Ensure settings panels are populated
                 }
            }

            // --- UI Update & Preferences ---
            function updateUserUI() { /* ... (Populate user elements like top nav, welcome card) ... */ }
            function applyStoredPreferences() { /* ... (Apply theme, contrast, etc. from localStorage) ... */
                const storedTheme = localStorage.getItem('theme') || 'system';
                 setTheme(storedTheme);
            }
            function setTheme(theme) { /* ... (Apply theme classes to body) ... */
                document.body.className = ''; // Clear previous
                 if (theme === 'system') {
                     const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                     setTheme(prefersDark ? 'dark' : 'light'); // Resolve system
                     return; // Prevent saving 'system' itself
                 }
                 document.body.classList.add(`${theme}-theme`);
                 localStorage.setItem('theme', theme);
                 // Update theme selector UI in settings
                 const themeOptions = document.querySelectorAll('.theme-option');
                 themeOptions.forEach(opt => { opt.classList.toggle('selected', opt.dataset.theme === theme); });
            }

             // --- Navigation & Content Activation ---
             function setActiveFeature(featureId, settingsTab = null, skipHistory = false) {
                 console.log(`Activating: ${featureId} ${settingsTab ? '/ '+settingsTab : ''}`);
                 currentFeature = featureId;
                 currentSettingsTab = featureId === 'settings' ? (settingsTab || 'preferences') : null;

                 // --- RBAC Check ---
                 // (Add role checks here if needed before proceeding)

                 // --- Update Menu ---
                 navLinks.forEach(link => {
                     link.classList.toggle('active', link.getAttribute('data-feature') === featureId);
                 });

                 // --- Show/Hide Content Sections ---
                 let sectionActivated = false;
                 allContentSections.forEach(section => {
                     const sectionId = section.id;
                     const expectedId = `${featureId}Content`; // Convention: featureId + "Content"

                     if (sectionId === expectedId) {
                         section.classList.add('active');
                         section.style.display = 'block';
                         sectionActivated = true;

                         // --- Call Initializer (if needed and not already run) ---
                         const initializerKey = featureId.replace(/-/g, '_'); // Convert kebab-case if used in data-feature
                         if (featureInitialized.hasOwnProperty(initializerKey) && !featureInitialized[initializerKey]) {
                             const initializerFunctionName = `initialize${capitalizeFirstLetter(toCamelCase(featureId))}`;
                             if (typeof window[initializerFunctionName] === 'function') {
                                 try {
                                     console.log(`Calling initializer: ${initializerFunctionName}`);
                                     window[initializerFunctionName](); // No need to pass data, use globals
                                     featureInitialized[initializerKey] = true;
                                 } catch (e) { console.error(`Error initializing ${featureId}:`, e); }
                             } else { console.warn(`Initializer ${initializerFunctionName} not found.`); }
                         }
                         // If settings, activate the correct tab
                         if (featureId === 'settings') {
                             activateSettingsTab(currentSettingsTab);
                         }
                     } else {
                         section.classList.remove('active');
                         section.style.display = 'none';
                     }
                 });

                 if (!sectionActivated) {
                     console.warn(`No section found for ID: ${featureId}Content. Defaulting to dashboard.`);
                     setActiveFeature('dashboard', null, true); // Go back to safety
                     return;
                 }

                 // --- Update Back Button ---
                 if (backButton) { backButton.style.display = featureId !== 'dashboard' ? 'flex' : 'none'; }

                 // --- Update History ---
                 if (!skipHistory) { updateBrowserHistory(featureId, currentSettingsTab); }

                 closeMobileSidebar();
             }

            function activateSettingsTab(tabId) {
                // (Show/hide settings panels and update tab styles)
                 currentSettingsTab = tabId;
                 document.querySelectorAll('.settings-tab').forEach(tab => {
                     tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                 });
                 document.querySelectorAll('.settings-panel').forEach(panel => {
                     panel.classList.toggle('active', panel.id === `${tabId}Panel`);
                 });
                 // Initialize content if needed
                 if (tabId === 'team' && !featureInitialized.settings_team) {
                     loadTeamMembers(); // Example: load team list when tab first shown
                     featureInitialized.settings_team = true;
                 }
                 // ... initialize other panels as needed ...
            }

            function updateBrowserHistory(featureId, settingsTab) { /* ... (Same as before - use replaceState or pushState) ... */
                let hash = `#${featureId}`;
                if (featureId === 'settings' && settingsTab) { hash += `-${settingsTab}`; }
                if (window.location.hash !== hash) { window.history.replaceState({ feature: featureId, tab: settingsTab }, '', hash); }
            }

            function handleInitialNavigation() { /* ... (Same as before - parse hash, call setActiveFeature) ... */
                const hash = window.location.hash.substring(1);
                let featureId = 'dashboard'; let settingsTab = null;
                if (hash) {
                    if (hash.startsWith('settings-')) {
                        featureId = 'settings';
                        settingsTab = hash.split('-')[1] || 'preferences';
                        // Validate tabId exists before using it
                        if (!document.getElementById(`${settingsTab}Panel`)) settingsTab = 'preferences';
                    } else if (document.getElementById(`${hash}Content`)) { // Check if section exists
                        featureId = hash;
                    }
                }
                setActiveFeature(featureId, settingsTab, true);
            }
            window.addEventListener('popstate', handleInitialNavigation);


            // --- Component Initializers ---

            // ==================================================
            // == EMPLOYEE SCHEDULING COMPONENT LOGIC =========
            // ==================================================
            function initializeEmployeeScheduling() {
                // Prevent multiple initializations
                if (featureInitialized.employeeScheduling) return;
                console.log("Initializing Employee Scheduling Component...");

                const section = document.getElementById('employeeSchedulingContent');
                if (!section) { console.error("Employee Scheduling section not found!"); return; }

                // --- DOM Elements (Scoped) ---
                const weekDisplay = section.querySelector('#weekDisplay');
                const scheduleTableBody = section.querySelector('#scheduleTableBody');
                const scheduleThead = section.querySelector('.schedule-table thead tr');
                const prevWeekBtn = section.querySelector('#prevWeekBtn');
                const nextWeekBtn = section.querySelector('#nextWeekBtn');
                const saveScheduleBtn = section.querySelector('#saveScheduleBtn');
                const sendRemindersBtn = section.querySelector('#sendRemindersBtn');
                const addNewEmployeeBtn = section.querySelector('#addNewEmployeeBtn_schedule');
                const editShiftModal = section.querySelector('#editShiftModal');
                const editShiftForm = section.querySelector('#editShiftForm');
                const shiftTypeSelect = section.querySelector('#shiftTypeSelect');
                const editShiftEmployeeIdInput = section.querySelector('#editShiftEmployeeId');
                const editShiftDayIndexInput = section.querySelector('#editShiftDayIndex');
                const editShiftWeekOffsetInput = section.querySelector('#editShiftWeekOffset');
                const editShiftModalTitle = section.querySelector('#editShiftModalTitle');
                const shiftEmployeeNameDisplay = section.querySelector('#shiftEmployeeNameDisplay');
                const deleteShiftBtnModal = section.querySelector('#deleteShiftBtn_modal');

                // Check elements
                if (!weekDisplay || !scheduleTableBody || !scheduleThead || !prevWeekBtn || !nextWeekBtn || !editShiftModal || !editShiftForm || !shiftTypeSelect || !deleteShiftBtnModal) {
                    console.error("Schedule Init Error: Missing essential elements.");
                    section.innerHTML = `<div class='placeholder-content error'>Error: Required elements missing.</div>`;
                    return; // Stop initialization
                }

                // --- State & Data ---
                let currentScheduleWeekOffset = 0;
                let mockScheduleData = {}; // Load from localStorage or API if available
                const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                const fullDays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

                // --- Helper Functions (Scoped or reuse global) ---
                const getWeekDates = (offset = 0) => { /* ... */ const sunday = getWeekStartDate(offset); const dates = []; for (let i = 0; i < 7; i++) { const date = new Date(sunday); date.setDate(sunday.getDate() + i); dates.push(date); } return dates; };
                const getWeekStartDate = (offset = 0) => { /* ... */ const today = new Date(); const day = today.getDay(); const diff = today.getDate() - day + (offset * 7); const sunday = new Date(today); sunday.setDate(diff); sunday.setHours(0,0,0,0); return sunday; };
                const formatDateForDisplay = (date) => { /* ... */ if (!(date instanceof Date)) return ''; return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }); };
                const getShiftText = (type) => { /* ... */ switch(type){ case 'morning':return'9A-5P'; case 'afternoon':return'12P-8P'; case 'night':return'8P-4A'; case 'off':return'OFF'; case 'sick':return'Sick'; case 'vacation':return'Vacation'; default:return'N/A';}};

                // --- Rendering ---
                function renderSchedule(weekOffset) {
                    console.log(`Schedule: Rendering offset ${weekOffset}`);
                    const weekDates = getWeekDates(weekOffset);
                    weekDisplay.textContent = `${formatDateForDisplay(weekDates[0])} - ${formatDateForDisplay(weekDates[6])}`;
                    // Add button disabling logic if needed (e.g., based on date range)
                    prevWeekBtn.disabled = false;
                    nextWeekBtn.disabled = false;

                    // Render Header
                    scheduleThead.innerHTML = '<th>Employee</th>';
                    weekDates.forEach((date, i) => { scheduleThead.innerHTML += `<th><div class="day-header"><span class="day-name">${days[i]}</span><span class="day-date">${formatDateForDisplay(date)}</span></div></th>`; });

                    // Render Body
                    scheduleTableBody.innerHTML = '';
                    if (!teamMembers || teamMembers.length === 0) { scheduleTableBody.innerHTML = `<tr><td colspan="8">No team members.</td></tr>`; return; }

                    teamMembers.forEach(employee => {
                        const row = scheduleTableBody.insertRow();
                        // Employee Cell
                        const nameCell = row.insertCell();
                        nameCell.className = 'employee-name';
                        nameCell.textContent = employee.name || 'Unknown';

                        // Day Cells
                        for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                            const cell = row.insertCell();
                            const scheduleKey = `${employee.id}-${weekOffset}-${dayIndex}`;
                            const isWeekend = dayIndex === 5 || dayIndex === 6; // Fri/Sat
                            const canEdit = !isWeekend && ['admin', 'supervisor'].includes(currentUser.role);

                            let shiftType = mockScheduleData[scheduleKey];
                            if (!shiftType) {
                                shiftType = isWeekend ? 'off' : 'morning'; // Default
                                mockScheduleData[scheduleKey] = shiftType;
                            }
                            if(isWeekend) cell.classList.add('weekend-cell');

                            // Shift Div
                            const shiftDiv = document.createElement('div');
                            shiftDiv.className = `shift ${isWeekend ? 'shift-weekend-off' : `shift-${shiftType.replace('_', '-')}`}`;
                            shiftDiv.textContent = getShiftText(shiftType);
                            shiftDiv.title = shiftDiv.textContent;

                            if (canEdit) {
                                shiftDiv.classList.add('editable');
                                shiftDiv.dataset.employeeId = employee.id;
                                shiftDiv.dataset.employeeName = employee.name;
                                shiftDiv.dataset.dayIndex = dayIndex;
                                shiftDiv.dataset.weekOffset = weekOffset;
                                shiftDiv.dataset.date = formatDateForDisplay(weekDates[dayIndex]);
                                shiftDiv.title = `Edit ${employee.name}'s shift`;
                                // Listener added via delegation below
                            }
                            cell.appendChild(shiftDiv);
                        }
                    });
                } // end renderSchedule

                // --- Event Handlers (Scoped) ---
                function handleWeekChange(direction) { /* ... (update currentScheduleWeekOffset, call renderSchedule) ... */ currentScheduleWeekOffset += direction; renderSchedule(currentScheduleWeekOffset); }
                function handleSaveSchedule() { /* ... (call showConfirmModal, simulate save) ... */ showConfirmModal('Save Schedule', 'Save changes?', () => { console.log("Saving schedule:", mockScheduleData); showToast('Schedule saved (simulated).', 'success'); }); }
                function handleSendReminders() { /* ... (construct email simulation logic) ... */ console.log("Sending reminders..."); showToast('Reminders sent (simulated).'); }
                function handleAddNewEmployee() { /* ... (navigate to settings/team) ... */ showToast("Redirecting to Team Management..."); setActiveFeature('settings', 'team'); }

                 function handleEditShiftClick(event) {
                     const target = event.target.closest('.shift.editable');
                     if (!target) return;
                      // Populate modal... (same logic)
                     const { employeeId, employeeName, dayIndex, weekOffset, date } = target.dataset;
                     const scheduleKey = `${employeeId}-${weekOffset}-${dayIndex}`;
                     const currentShift = mockScheduleData[scheduleKey] || 'morning';

                     editShiftEmployeeIdInput.value = employeeId;
                     editShiftDayIndexInput.value = dayIndex;
                     editShiftWeekOffsetInput.value = weekOffset;
                     shiftTypeSelect.value = currentShift;
                     shiftEmployeeNameDisplay.value = employeeName;
                     editShiftModalTitle.textContent = `Edit Shift: ${employeeName} on ${fullDays[dayIndex]} (${date})`;
                     deleteShiftBtnModal.style.display = ['admin', 'supervisor'].includes(currentUser.role) ? 'inline-flex' : 'none';
                     editShiftModal?.classList.add('active');
                 }

                 function handleShiftFormSubmit(event) {
                     event.preventDefault();
                     const employeeId = editShiftEmployeeIdInput.value;
                     const dayIndex = editShiftDayIndexInput.value;
                     const weekOffset = editShiftWeekOffsetInput.value;
                     const newShiftType = shiftTypeSelect.value;
                     const scheduleKey = `${employeeId}-${weekOffset}-${dayIndex}`;
                     mockScheduleData[scheduleKey] = newShiftType;
                     renderSchedule(parseInt(weekOffset));
                     editShiftModal?.classList.remove('active');
                     showToast("Shift updated.", "success");
                 }

                  function handleDeleteShift() {
                     const employeeId = editShiftEmployeeIdInput.value;
                     const dayIndex = editShiftDayIndexInput.value;
                     const weekOffset = editShiftWeekOffsetInput.value;
                     const employeeName = shiftEmployeeNameDisplay.value;
                     showConfirmModal('Delete Shift', `Delete shift for ${employeeName}? (Will be set to OFF)`, () => {
                         const scheduleKey = `${employeeId}-${weekOffset}-${dayIndex}`;
                         mockScheduleData[scheduleKey] = 'off';
                         renderSchedule(parseInt(weekOffset));
                         editShiftModal?.classList.remove('active');
                         showToast("Shift deleted (set to OFF).", "success");
                     }, 'btn-danger');
                  }


                // --- Attach Listeners (Scoped) ---
                prevWeekBtn.addEventListener('click', () => handleWeekChange(-1));
                nextWeekBtn.addEventListener('click', () => handleWeekChange(1));
                if (saveScheduleBtn) saveScheduleBtn.addEventListener('click', handleSaveSchedule);
                if (sendRemindersBtn) sendRemindersBtn.addEventListener('click', handleSendReminders);
                if (addNewEmployeeBtn) addNewEmployeeBtn.addEventListener('click', handleAddNewEmployee);
                editShiftForm.addEventListener('submit', handleShiftFormSubmit);
                deleteShiftBtnModal.addEventListener('click', handleDeleteShift);

                 // Use event delegation for editable shift clicks
                 scheduleTableBody.addEventListener('click', handleEditShiftClick);

                 // Modal close buttons
                 section.querySelectorAll('[data-close-modal]').forEach(btn => {
                     btn.addEventListener('click', () => btn.closest('.modal')?.classList.remove('active'));
                 });
                 editShiftModal.addEventListener('click', (e) => { if (e.target === editShiftModal) editShiftModal.classList.remove('active'); });


                // --- Initial Render ---
                renderSchedule(currentScheduleWeekOffset);

                // Mark as initialized
                // featureInitialized.employeeScheduling = true; // Moved this to setActiveFeature

                console.log("Employee Scheduling Component Initialized.");
            } // End initializeEmployeeScheduling

            // ==================================================
            // == Settings Panels Initialization ===============
            // ==================================================
            // Function to populate static content of settings panels
            function initializeSettingsPanels() {
                if (featureInitialized.settings) return; // Already initialized
                console.log("Initializing Settings Panels Content...");

                // --- Populate Preferences Panel ---
                const prefsPanel = document.getElementById('preferencesPanel');
                if (prefsPanel) {
                    // (Copy the relevant HTML structure from finaaaal.txt for the Preferences panel here)
                    // Ensure IDs for inputs/selects/buttons match those used in JS handlers
                    prefsPanel.innerHTML = `
                        <div class="settings-subsection">
                            <h4>Appearance</h4>
                            <div class="form-group">
                                <label class="settings-label">Theme</label>
                                <div class="theme-options-container">
                                    <div class="theme-option" data-theme="light"><div class="theme-preview light-preview"><i class="fas fa-sun"></i></div><span class="theme-label">Light</span></div>
                                    <div class="theme-option" data-theme="dark"><div class="theme-preview dark-preview"><i class="fas fa-moon"></i></div><span class="theme-label">Dark</span></div>
                                    <div class="theme-option" data-theme="system"><div class="theme-preview system-preview"><i class="fas fa-desktop"></i></div><span class="theme-label">System</span></div>
                                </div>
                            </div>
                            <div class="setting-item"><div><span class="setting-item-label">High Contrast Mode</span><p class="setting-item-description">Increase text visibility.</p></div><div class="setting-item-control"><label class="switch"><input type="checkbox" id="highContrastToggle"><span class="slider round"></span></label></div></div>
                        </div>
                        <div class="settings-subsection">
                             <h4>Localization & Formats</h4>
                             <div class="data-form">
                                <div class="form-group"><label for="languageSelect">Language</label><select id="languageSelect" class="form-control"><option value="en">English (US)</option><option value="ar">العربية</option><option value="es">Español</option></select></div>
                                <div class="form-group"><label for="regionSelect">Timezone</label><select id="regionSelect" class="form-control"><option value="utc">UTC</option><option value="est">EST (UTC-5)</option><option value="pst">PST (UTC-8)</option><option value="cet">CET (UTC+1)</option><option value="eet">EET (UTC+2)</option><option value="ast">AST (UTC+3)</option></select></div>
                                <div class="form-group"><label for="timeFormatSelect">Time Format</label><select id="timeFormatSelect" class="form-control"><option value="12h">12-hour</option><option value="24h">24-hour</option></select></div>
                                <div class="form-group"><label for="dateFormatSelect">Date Format</label><select id="dateFormatSelect" class="form-control"><option value="MM/DD/YYYY">MM/DD/YYYY</option><option value="DD/MM/YYYY">DD/MM/YYYY</option><option value="YYYY-MM-DD">YYYY-MM-DD</option><option value="Month D, YYYY">Month D, YYYY</option></select></div>
                             </div>
                         </div>
                         <div class="settings-subsection">
                             <h4>Notifications & Sounds</h4>
                            <div class="setting-item"><div><span class="setting-item-label">Enable Toast Messages</span><p class="setting-item-description">Show brief confirmation popups.</p></div><div class="setting-item-control"><label class="switch"><input type="checkbox" id="toastToggle"><span class="slider round"></span></label></div></div>
                            <div class="setting-item"><div><span class="setting-item-label">Enable Sound Notifications</span><p class="setting-item-description">Play sound for alerts.</p></div><div class="setting-item-control"><label class="switch"><input type="checkbox" id="soundToggle"><span class="slider round"></span></label></div></div>
                         </div>
                        <div class="form-actions"><button type="button" class="btn btn-primary" id="savePreferencesBtn">Save Preferences</button></div>
                    `;
                    // Re-attach listeners specific to these elements
                     prefsPanel.querySelectorAll('.theme-option').forEach(option => option.addEventListener('click', () => setTheme(option.dataset.theme)));
                     document.getElementById('highContrastToggle')?.addEventListener('change', (e) => setContrast(e.target.checked));
                     document.getElementById('languageSelect')?.addEventListener('change', (e) => applyLanguage(e.target.value));
                     document.getElementById('regionSelect')?.addEventListener('change', (e) => localStorage.setItem('region', e.target.value));
                     const applyDateTimeListener = () => applyDateTimeFormat(document.getElementById('timeFormatSelect').value, document.getElementById('dateFormatSelect').value);
                     document.getElementById('timeFormatSelect')?.addEventListener('change', applyDateTimeListener);
                     document.getElementById('dateFormatSelect')?.addEventListener('change', applyDateTimeListener);
                     document.getElementById('toastToggle')?.addEventListener('change', (e) => applyToastPreference(e.target.checked));
                     document.getElementById('soundToggle')?.addEventListener('change', (e) => applySoundPreference(e.target.checked));
                     document.getElementById('savePreferencesBtn')?.addEventListener('click', handleSavePreferences); // Placeholder handler
                 }

                // --- Populate Account Panel ---
                 const accountPanel = document.getElementById('accountPanel');
                 if (accountPanel) {
                    // (Copy relevant HTML structure from finaaaal.txt)
                    accountPanel.innerHTML = `
                         <div class="settings-subsection"><h4>Account Information</h4><div class="data-form"><div class="form-group"><label for="accountEmail">Current Email</label><input type="email" id="accountEmail" class="form-control" readonly></div><div class="form-group"><label for="changeEmail">New Email Address</label><input type="email" id="changeEmail" class="form-control" placeholder="Unavailable in demo" disabled></div></div><p style="margin-top:1rem;">Password changes: <a href="#settings-security" data-feature="settings" data-tab-target="security" class="settings-link">Security Tab</a>.</p></div>
                         <div class="settings-subsection"><h4>Account Notifications</h4><div class="setting-item"><div><span class="setting-item-label">Enable Account Activity Alerts</span><p class="setting-item-description">Receive emails for password changes, new logins, etc.</p></div><div class="setting-item-control"><label class="switch"><input type="checkbox" id="accountNotificationsToggle"><span class="slider round"></span></label></div></div></div>
                         <div class="form-actions"><button type="button" class="btn btn-primary" id="saveAccountSettingsBtn">Save Account Settings</button></div>
                    `;
                     // Re-attach listeners
                     document.getElementById('saveAccountSettingsBtn')?.addEventListener('click', handleSaveAccountSettings);
                 }

                // --- Populate Security Panel ---
                 const securityPanel = document.getElementById('securityPanel');
                 if (securityPanel) {
                    // (Copy relevant HTML structure from finaaaal.txt)
                    securityPanel.innerHTML = `
                         <div class="settings-subsection"><h4>Password</h4><form class="data-form" id="changePasswordForm"><div class="form-group"><label for="currentPassword">Current Password</label><input type="password" id="currentPassword" class="form-control"></div><div class="form-group"><label for="newPassword">New Password</label><input type="password" id="newPassword" class="form-control"></div><div class="form-group"><label for="confirmPassword">Confirm New Password</label><input type="password" id="confirmPassword" class="form-control"></div><div class="form-actions"><button type="submit" class="btn btn-primary">Change Password</button></div></form></div>
                         <div class="settings-subsection"><h4>Two-Factor Authentication (2FA)</h4><div class="two-fa-status"><span class="status-indicator disabled" id="twoFaStatusIndicator"></span><span id="twoFaStatusText">2FA is currently Disabled</span></div><p class="setting-item-description">Add extra security using an authenticator app or SMS.</p><div id="twoFaSetupSection"><button class="btn btn-primary" id="enable2faBtn">Enable 2FA</button><div class="two-fa-setup" id="twoFaSetupOptions" style="display:none;"><h5>Choose Method:</h5><div class="two-fa-actions"><button class="btn btn-outline" id="setupAuthAppBtn"><i class="fas fa-mobile-alt"></i> Authenticator App</button><button class="btn btn-outline" id="setupSmsBtn"><i class="fas fa-sms"></i> SMS</button></div><div id="authAppSetup" style="display: none; margin-top: 1.5rem;"><p>1. Scan QR code.</p><div class="qr-code-placeholder">QR Placeholder</div><p>2. Enter code.</p><div class="form-group"><label for="authCode">Verification Code</label><input type="text" id="authCode" class="form-control" placeholder="123456" maxlength="6"></div><button class="btn btn-primary" id="verifyAuthCodeBtn">Verify & Enable</button></div><div id="smsSetup" style="display: none; margin-top: 1.5rem;"><p>1. Send code to <span id="userPhoneNumberForSms"></span>.</p><button class="btn btn-primary" id="sendSmsCodeBtn">Send Code</button><div class="form-group" style="margin-top: 1rem; display: none;" id="smsCodeInputGroup"><label for="smsCode">SMS Code</label><input type="text" id="smsCode" class="form-control" placeholder="123456" maxlength="6"></div><button class="btn btn-primary" id="verifySmsCodeBtn" style="display: none;">Verify & Enable</button></div></div></div><div id="twoFaManagementSection" style="display: none;"><p>2FA is enabled.</p><div class="two-fa-actions"><button class="btn btn-danger" id="disable2faBtn">Disable 2FA</button></div></div></div>
                         <div class="settings-subsection"><h4>Session Management</h4><div class="data-form"><div class="form-group"><label for="sessionDuration">Session Duration (min)</label><input type="number" id="sessionDuration" class="form-control" value="60" min="15"></div><div class="form-group"><label for="idleTimeout">Idle Timeout (min)</label><input type="number" id="idleTimeout" class="form-control" value="15" min="5"></div></div><div class="form-actions"><button type="button" class="btn btn-primary" id="saveSessionSettingsBtn">Save Session Settings</button></div></div>
                    `;
                     // Re-attach listeners
                     document.getElementById('changePasswordForm')?.addEventListener('submit', handleChangePassword);
                     document.getElementById('enable2faBtn')?.addEventListener('click', handleEnable2FA);
                     document.getElementById('setupAuthAppBtn')?.addEventListener('click', showAuthAppSetup);
                     document.getElementById('setupSmsBtn')?.addEventListener('click', showSmsSetup);
                     document.getElementById('verifyAuthCodeBtn')?.addEventListener('click', handleVerifyAuthCode);
                     document.getElementById('sendSmsCodeBtn')?.addEventListener('click', handleSendSmsCode);
                     document.getElementById('verifySmsCodeBtn')?.addEventListener('click', handleVerifySmsCode);
                     document.getElementById('disable2faBtn')?.addEventListener('click', handleDisable2FA);
                     document.getElementById('saveSessionSettingsBtn')?.addEventListener('click', handleSaveSessionSettings);
                 }

                // --- Populate Notifications Panel ---
                 const notifsPanel = document.getElementById('notificationsPanel');
                 if (notifsPanel) {
                     // (Copy relevant HTML structure from finaaaal.txt)
                     notifsPanel.innerHTML = `
                        <div class="settings-subsection"><h4>Notification Delivery</h4><div class="setting-item"><div><span class="setting-item-label">Enable Email Notifications</span></div><div class="setting-item-control"><label class="switch"><input type="checkbox" id="emailNotificationsToggle"><span class="slider round"></span></label></div></div><div class="setting-item"><div><span class="setting-item-label">Enable In-App Notifications</span></div><div class="setting-item-control"><label class="switch"><input type="checkbox" id="inAppNotificationsToggle"><span class="slider round"></span></label></div></div></div>
                        <div class="settings-subsection"><h4>Notification Types (In-App/Email)</h4><p class="setting-item-description">Choose which events trigger notifications.</p><div class="checkbox-group"><label><input type="checkbox" name="notificationType" value="task_assigned" checked> Task Assigned</label><label><input type="checkbox" name="notificationType" value="task_comment" checked> Task Comment/Mention</label><label><input type="checkbox" name="notificationType" value="project_update" checked> Project Update</label><label><input type="checkbox" name="notificationType" value="deadline_reminder" checked> Deadline Reminder</label><label><input type="checkbox" name="notificationType" value="file_shared"> File Shared</label><label><input type="checkbox" name="notificationType" value="system_announcement" checked> System Announcement</label></div></div>
                        <div class="form-actions"><button type="button" class="btn btn-primary" id="saveNotificationSettingsBtn">Save Notification Settings</button></div>
                    `;
                    // Re-attach listeners
                     document.getElementById('saveNotificationSettingsBtn')?.addEventListener('click', handleSaveNotificationSettings);
                 }

                // --- Populate Team Panel ---
                const teamPanel = document.getElementById('teamPanel');
                if (teamPanel) {
                    teamPanel.innerHTML = `
                        <div class="settings-subsection"><h4>Team Members</h4><div class="team-list" id="teamList"><p>Loading team members...</p></div></div>
                        <div class="settings-subsection add-member-form"><h4>Invite New Member</h4><form id="inviteMemberForm" class="data-form"><div class="form-group"><label for="inviteEmail">Email</label><input type="email" id="inviteEmail" class="form-control" required></div><div class="form-group"><label for="inviteRole">Role</label><select id="inviteRole" class="form-control" required><option value="member">Member</option><option value="supervisor">Supervisor</option><option value="senior">Senior</option><option value="admin">Admin</option></select></div><div class="form-actions"><button type="submit" class="btn btn-primary">Invite</button></div></form></div>
                    `;
                    // Re-attach listeners
                     document.getElementById('inviteMemberForm')?.addEventListener('submit', handleInviteMember);
                     // Delegation listener for edit/remove buttons will be added in setupEventListeners
                     loadTeamMembers(); // Load the list now that the container exists
                }

                 // --- Populate Collaboration Panel (Placeholder) ---
                 const collabPanel = document.getElementById('collaborationPanel');
                 if (collabPanel) {
                     collabPanel.innerHTML = `<h3>Collaboration (Coming Soon)</h3><p>Integrations and sharing settings.</p>`;
                 }

                 // --- Populate Danger Zone Panel ---
                 const dangerPanel = document.getElementById('dangerPanel');
                 if (dangerPanel) {
                    dangerPanel.innerHTML = `
                        <h3 class="section-title" style="color: var(--danger);">Danger Zone</h3><p>Irreversible actions. Proceed with caution.</p>
                        <div class="danger-zone-item"><div><h5>Logout From All Devices</h5><p>End all other active sessions.</p></div><button class="btn btn-warning" id="logoutAllDevicesBtn">Logout Everywhere</button></div>
                        <div class="danger-zone-item"><div><h5>Delete Account</h5><p>Permanently delete your account and all data.</p></div><button class="btn btn-danger" id="deleteAccountBtn">Delete My Account</button></div>
                    `;
                    // Re-attach listeners
                     document.getElementById('logoutAllDevicesBtn')?.addEventListener('click', handleLogoutAllDevices);
                     document.getElementById('deleteAccountBtn')?.addEventListener('click', handleDeleteAccount);
                 }

                 featureInitialized.settings = true; // Mark settings as initialized
                 // Apply stored preferences to the newly added settings elements
                 applyStoredPreferences();
                 // Ensure the correct tab is showing after populating
                 activateSettingsTab(currentSettingsTab);
             }

            // --- Utility Functions ---
            // (capitalizeFirstLetter, toCamelCase, timeAgo, formatDateForDisplay, formatFullDateTime, etc.)
            // Keep these helper functions available globally within the script scope

            // --- Call Initialization ---
            initDashboard();

        }); // End DOMContentLoaded
    </script>

</body>
</html>

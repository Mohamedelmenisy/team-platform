<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">

    <style>
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e3a8a;
            --primary-light: #dbeafe;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;  /* Default Text Color (Dark in Light Mode) */
            --light: #f8fafc;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --white: #ffffff;
            --sidebar-width: 280px;
            --sidebar-bg: #1e3a8a;
            --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1);
            --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1);
            --success: #10b981;
            --team-manager: #ef4444; /* Keep for role color */
            --compact-padding: 0.5rem;
            --normal-padding: 1rem;
            --spacious-padding: 1.5rem;
            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); /* Light Blue */
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); /* Light Green */
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); /* Light Yellow */
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); /* Light Red */
            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1); /* Default welcome bg */

            /* High Contrast Variables (Initial basic setup) */
            --hc-text: #000000;
            --hc-background: #ffffff;
            --hc-primary: #0000ff;
            --hc-secondary: #008000;
            --hc-link: #0000ee;
            --hc-border: #000000;

            /* Text Color Variable - Aliased to existing variables */
            --text-color: var(--dark);

             /* Schedule specific (used by both dashboard and injected schedule) */
             --schedule-weekend-bg: #f3f4f6; /* Light gray for weekend cells */
             --schedule-weekend-text: #9ca3af; /* Muted text for weekend OFF */
        }
        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--primary-light); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* High Contrast Mode */
        body.high-contrast {
             --dark: var(--hc-text);
             --light: var(--hc-background);
             --gray: var(--hc-text); /* Adjust as needed */
             --light-gray: var(--hc-border);
             --white: var(--hc-background);
             --primary: var(--hc-primary);
             --primary-dark: var(--hc-primary);
             --primary-light: #e0e0ff; /* Lighter blue for hc bg */
             --secondary: var(--hc-secondary);
             --sidebar-bg: var(--hc-background);
             --sidebar-text: var(--hc-text);
             --sidebar-hover: #e0e0e0;
             --sidebar-active: #c0c0c0;
             --sidebar-divider: var(--hc-border);
             --text-color: var(--hc-text); /* High contrast text */
             color: var(--text-color);
             background-color: var(--hc-background);
             /* Add more overrides as needed */
        }
         body.high-contrast .welcome-section,
         body.high-contrast .stat-card,
         body.high-contrast .top-nav,
         body.high-contrast .sidebar,
         body.high-contrast .activity-section,
         body.high-contrast .content-section {
             background: var(--hc-background);
             border: 1px solid var(--hc-border);
             color: var(--text-color);
         }
          body.high-contrast .btn,
          body.high-contrast .form-control,
          body.high-contrast .search-bar input {
              border: 1px solid var(--hc-border);
          }
          body.high-contrast .btn-primary { background-color: var(--hc-primary); color: var(--hc-background); }
          body.high-contrast .logo { color: var(--text-color); }
          body.high-contrast .logo-icon { color: var(--hc-primary); }
          body.high-contrast .menu-item { color: var(--text-color); border-left-color: transparent; }
          body.high-contrast .menu-item.active { background-color: #c0c0c0; border-left-color: var(--hc-primary); }
          body.high-contrast .stat-card { border-left-width: 3px; background: var(--hc-background); } /* Reset gradient */
          body.high-contrast .welcome-section { background: var(--hc-background); }
          /* High Contrast Schedule */
          body.high-contrast #featureSectionsContainer.employee-scheduling .schedule-table thead th { background-color: var(--hc-primary); color: var(--hc-background); border-bottom-color: var(--hc-border); }
          body.high-contrast #featureSectionsContainer.employee-scheduling .schedule-table tbody td { border-color: var(--hc-border); color: var(--hc-text); }
          body.high-contrast #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--hc-background); border-right-color: var(--hc-border); color: var(--hc-text); }
          body.high-contrast #featureSectionsContainer.employee-scheduling .day-name { color: var(--hc-background); } /* Text on primary */
          body.high-contrast #featureSectionsContainer.employee-scheduling .day-date { color: rgba(255,255,255,0.8); } /* Adjust if needed */
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift { border: 1px solid var(--hc-border); } /* Add border for visibility */
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift-morning { background-color: #e0e0ff; color: #00008b; } /* Adjust colors */
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift-afternoon { background-color: #e0f0e0; color: #004d00; }
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift-night { background-color: #f0e0f0; color: #4b0082; }
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift-off { background-color: #e0ffe0; color: #006400; }
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift-sick { background-color: #ffe0e0; color: #8b0000; }
          body.high-contrast #featureSectionsContainer.employee-scheduling .shift-vacation { background-color: #fff0e0; color: #8b4513; }
          body.high-contrast #featureSectionsContainer.employee-scheduling .modal-content { background-color: var(--hc-background); color: var(--hc-text); border: 1px solid var(--hc-border);}


        /* --- Sidebar Styles --- */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--white); color: var(--text-color); } /* Use text-color */
        .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; } /* Use text-color */
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--text-color); } /* Use text-color */
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; } /* Use text-color */
        .dropdown-item:hover { background-color: var(--light); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; } /* Adjusted height */
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section {
            background: var(--welcome-bg-current); /* Use variable */
            color: var(--white); /* Welcome section text is white by design */
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; /* Smooth background transition */
        }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--team-manager); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--secondary); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card {
            background: var(--white); /* Default */
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 5px solid var(--primary); /* Colored border instead of top gradient */
            color: var(--dark); /* Ensure text inside uses appropriate theme color */
        }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--secondary); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }

        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; } /* Use text-color */
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        /* Stat value colors are specific and contrast should be checked manually */
        .stat-card:nth-child(1) .stat-value { color: #1e40af; }
        .stat-card:nth-child(2) .stat-value { color: #15803d; }
        .stat-card:nth-child(3) .stat-value { color: #b45309; }
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; }

        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--text-color); } /* Use text-color */
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; } /* Added max-height and scroll */
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--light-gray); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--text-color); } /* Use text-color */
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--gray); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        /* Delete icon visible by default */
        .delete-activity {
            color: var(--danger);
            cursor: pointer;
            opacity: 0.6; /* Visible by default */
            transition: opacity 0.2s, background-color 0.2s;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .activity-item:hover .delete-activity {
             opacity: 1; /* Already visible, just make fully opaque on hover */
        }
        .delete-activity:hover {
            opacity: 1; background-color: rgba(239, 68, 68, 0.1);
        }

        /* --- Profile & Settings Sections Styles --- */
        .content-section { /* Shared styles */ background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; } /* Hidden by default */
        .content-section.active { display: block; } /* Shown when active */
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 1rem; /* Added wrap and gap */}
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; } /* Hide the button, use avatar click */

        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; } /* Use text-color */
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; background-color: var(--white); color: var(--text-color); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; } /* Use text-color */
        body.compact .form-control { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control { padding: 1rem; }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; } /* Added justify-content */
        body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--primary-dark); } /* Warning button style */
        .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: #dc2626; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: #0d9f6e; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; }
        @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        /* Settings Sub-section */
        .settings-subsection {
             margin-top: 2rem;
             padding-top: 1.5rem;
             border-top: 1px solid var(--light-gray);
        }
        .settings-subsection:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        .settings-subsection h4 {
             font-size: 1.1rem;
             font-weight: 600;
             color: var(--primary-dark);
             margin-bottom: 1rem;
        }
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; } /* Added wrap */
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; /* Default: Label takes full width */ }
        @media (min-width: 768px) { /* On larger screens, allow side-by-side */
            .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; }
        }
        .setting-item-label { font-weight: 500; color: var(--text-color); } /* Use text-color */
        .setting-item-description { font-size: 0.9rem; color: var(--gray); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
         @media (max-width: 767px) { /* Stack control below on small screens */
            .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; }
        }


        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--text-color); margin-bottom: 1rem; } /* Use text-color */
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--light-gray); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--white); }
        body.compact .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        .team-member-card:hover { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); border-color: var(--primary); }
        .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        .member-details { flex: 1; min-width: 0; }
        .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} /* Use text-color */
        body.compact .member-name { font-size: 0.9rem; }
        .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact .member-email { font-size: 0.8rem; }
        .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; }
        body.compact .member-role { font-size: 0.7rem; margin: 0 0.75rem; }
        .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .role-senior { background-color: rgba(37, 99, 235, 0.1); color: var(--primary); }
        .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .role-member { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        /* Invite form layout adjustment (already likely handled by this CSS) */
        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; /* Make spinner visible when inside button */ }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span { margin-left: 0.5rem; } /* Space between spinner and text */

        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }
        .loading-text { display: none; font-size: 0.9rem; color: var(--gray); margin-left: 0.5rem; }

        /* --- Theme Styles & Responsive --- */
        body.light-theme { --primary-light: #f1f5f9; --light: #ffffff; --white: #ffffff; --dark: #1e293b; --gray: #64748b; --light-gray: #e2e8f0; --text-color: var(--dark); background-color: var(--primary-light); }
        body.dark-theme {
            --primary: #3b82f6;
            --primary-dark: #1e40af;
            --primary-light: #1e293b;
            --light: #334155; /* Slightly lighter background for cards/sections */
            --white: #0f172a; /* Darkest background for body */
            --dark: #e2e8f0; /* Light text */
            --gray: #94a3b8; /* Lighter gray text */
            --light-gray: #475569; /* Darker borders/dividers */
            --text-color: var(--dark); /* Update text-color for dark mode */
            --schedule-weekend-bg: #262f3e; /* Darker gray for weekend cells */
            --schedule-weekend-text: #6b7280; /* Muted dark text for weekend OFF */
            background-color: var(--white); /* Use darkest for body */
            color: var(--text-color); /* Default text color */
        }
        /* Dark Theme Overrides */
        body.dark-theme .top-nav { background-color: var(--light); border-bottom-color: var(--light-gray); } /* Lighter BG for nav */
        body.dark-theme .stat-card, body.dark-theme .activity-section, body.dark-theme .content-section, body.dark-theme .team-member-card, body.dark-theme .add-member-form { background-color: var(--light); border-color: var(--light-gray); } /* Lighter BG for content cards */
        body.dark-theme .search-bar input, body.dark-theme .form-control { background-color: var(--primary-light); border-color: var(--light-gray); color: var(--text-color); } /* Even darker BG for inputs */
        body.dark-theme .form-control[readonly] { background-color: var(--light); opacity: 0.6; }
        body.dark-theme .search-results { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .search-result-item { color: var(--text-color); } /* Ensure search result text is light */
        body.dark-theme .search-result-item:hover { background-color: var(--primary-light); }
        body.dark-theme .user-dropdown { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .dropdown-item { color: var(--text-color); } /* Ensure dropdown text is light */
        body.dark-theme .dropdown-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notifications-container { background-color: var(--light); } /* Lighter BG for notifications panel */
        body.dark-theme .notification-list-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } /* Slightly more visible unread */
        body.dark-theme .confirm-container, body.dark-theme .modal-content { background-color: var(--light); color: var(--text-color); } /* Modal background and default text */
        body.dark-theme .theme-option div { border-color: var(--light-gray); }
        body.dark-theme .theme-option.selected div { border-color: var(--primary); }
        body.dark-theme .back-button { color: var(--primary); } /* Use primary color for link */
        body.dark-theme .back-button:hover { background-color: var(--light); color: #60a5fa; border-color: var(--primary); }
        body.dark-theme .notifications-footer { background-color: var(--light); border-top-color: var(--light-gray); }
        body.dark-theme .welcome-section { background: var(--welcome-bg-current); color: var(--white); } /* Welcome section retains white text */
        body.dark-theme .welcome-subtitle { color: inherit; opacity: 0.8; } /* Inherit white */
        body.dark-theme .user-info-name { color: inherit; } /* Inherit white */
        body.dark-theme .user-info-title { color: var(--gray); } /* Role title uses gray */
        body.dark-theme .user-info-title.role-admin { color: var(--team-manager); }
        body.dark-theme .user-info-email span { color: inherit; } /* Inherit white */
        body.dark-theme .stat-card { background: var(--light); color: var(--text-color);} /* Dark theme stat card background, ensure text color */
        body.dark-theme .stat-title { color: var(--text-color); } /* Ensure stat title is light */
        /* Specific stat value colors adjusted for dark theme */
        body.dark-theme .stat-card:nth-child(1) .stat-value { color: #93c5fd; }
        body.dark-theme .stat-card:nth-child(2) .stat-value { color: #86efac; }
        body.dark-theme .stat-card:nth-child(3) .stat-value { color: #fcd34d; }
        body.dark-theme .stat-card:nth-child(4) .stat-value { color: #fca5a5; }
        body.dark-theme .activity-icon { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa; } /* Adjust icon color */
        body.dark-theme .activity-item { border-bottom-color: var(--light-gray); }
        body.dark-theme .activity-message { color: var(--text-color); } /* Activity text */
        body.dark-theme .activity-time { color: var(--gray); } /* Activity time */
        body.dark-theme .activity-item.new-activity { background-color: rgba(59, 130, 246, 0.1); }
        body.dark-theme .delete-activity:hover { background-color: rgba(239, 68, 68, 0.2); }
        body.dark-theme .profile-avatar-section label { color: var(--text-color); } /* Text label */
        body.dark-theme #profileAvatarLarge { background-color: var(--light); color: var(--text-color); border-color: var(--primary-light); }
        body.dark-theme .profile-header-text { color: var(--gray); } /* Profile intro text */
        body.dark-theme .placeholder-content { color: var(--gray); border-color: var(--light-gray); }
        body.dark-theme .placeholder-content h2 { color: var(--text-color); }
        body.dark-theme .placeholder-content p { color: var(--gray); }
        body.dark-theme .placeholder-content .error-message { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: var(--text-color); } /* Ensure error text readable */
        body.dark-theme .settings-label, body.dark-theme .form-group label { color: var(--text-color); } /* Form labels */
        body.dark-theme .settings-subsection h4 { color: #93c5fd; } /* Lighter primary */
        body.dark-theme .setting-item-label { color: var(--text-color); } /* Setting item title */
        body.dark-theme .setting-item-description { color: var(--gray); } /* Setting item description */
        body.dark-theme .theme-option span { color: var(--text-color); } /* Theme label text */
        body.dark-theme .qr-code-placeholder { border-color: var(--light-gray); color: var(--gray); }
        body.dark-theme .danger-zone-item .btn-danger { background-color: #dc2626; } /* Ensure danger button stands out */
        body.dark-theme .danger-zone-item .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        body.dark-theme .danger-zone-item p { color: var(--gray); } /* Danger zone description */

        /* Dark Theme Employee Scheduling Specifics (Scoped) */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th { background-color: var(--primary); color: white; border-bottom-color: var(--primary-dark); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td { color: var(--text-color); border-color: var(--light-gray); background-color: var(--white); } /* Default dark cell bg */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td { background-color: var(--primary-light); } /* Darker even row background */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td { background-color: #475569; } /* Hover effect */
        body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name { background-color: var(--white); border-right-color: var(--light-gray); color: var(--text-color); } /* Dark sticky column bg */
        body.dark-theme #featureSectionsContainer.employee-scheduling .day-name { color: white; } /* Keep day name white */
        body.dark-theme #featureSectionsContainer.employee-scheduling .day-date { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift { /* Adjust shift colors for dark mode */
             /* Base shift style in dark mode */
             background-color: var(--light);
             color: var(--text-color);
             border: 1px solid var(--light-gray);
        }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-morning { background-color: #1e3a8a; color: #dbeafe; border-color: #3b82f6; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-afternoon { background-color: #047857; color: #a7f3d0; border-color: #34d399; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-night { background-color: #4c1d95; color: #e9d5ff; border-color: #a78bfa; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-off { background-color: #064e3b; color: #d1fae5; border-color: #6ee7b7; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-sick { background-color: #7f1d1d; color: #fee2e2; border-color: #fca5a5; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-vacation { background-color: #7c2d12; color: #ffedd5; border-color: #fdba74; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-weekend-off { color: var(--schedule-weekend-text); background-color: transparent; border-color: transparent; }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td.weekend-cell { background-color: var(--schedule-weekend-bg); } /* Dark weekend bg */
        body.dark-theme #featureSectionsContainer.employee-scheduling .toast { background-color: var(--light); color: var(--text-color); } /* Dark theme toast specifically for schedule */


        body.dark-theme .checkbox-group { border-color: var(--light-gray); }
        body.dark-theme .checkbox-group label { color: var(--text-color); } /* Checkbox label text */
        body.dark-theme .confirm-title { color: var(--text-color); }
        body.dark-theme .confirm-message { color: var(--gray); }
        body.dark-theme .modal-title { color: #93c5fd; } /* Lighter primary */
        body.dark-theme .team-member-card .member-name { color: var(--text-color); }
        body.dark-theme .team-member-card .member-email { color: var(--gray); }
        body.dark-theme .search-result-item strong { color: var(--text-color); } /* Ensure bold text is readable */
        body.dark-theme .user-name { color: var(--text-color); } /* Top nav user name */


        /* Theme Selection Styles */
        .theme-options-container { display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap; } /* Added wrap */
        .theme-option { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .theme-option .theme-preview { width: 60px; height: 40px; border: 2px solid var(--light-gray); border-radius: 6px; transition: border-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .theme-option .theme-label { text-align: center; display: block; margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-color); } /* Use text-color */
        .theme-option:hover .theme-preview { border-color: var(--primary); }
        .theme-option.selected .theme-preview { border-color: var(--primary); border-width: 3px; }
        /* Specific theme previews */
        .theme-preview.light-preview { background-color: #f8fafc; color: #1e293b; }
        .theme-preview.dark-preview { background-color: #0f172a; color: #e2e8f0; }
        .theme-preview.system-preview { background: linear-gradient(45deg, #f8fafc 50%, #0f172a 50%); color: var(--gray); }


        /* 2FA Setup Styles */
        .two-fa-status { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .two-fa-status .status-indicator { width: 10px; height: 10px; border-radius: 50%; }
        .two-fa-status .status-indicator.enabled { background-color: var(--success); }
        .two-fa-status .status-indicator.disabled { background-color: var(--danger); }
        .two-fa-setup { border: 1px dashed var(--light-gray); padding: 1.5rem; border-radius: 6px; margin-top: 1rem; background-color: var(--light); }
        .qr-code-placeholder { width: 150px; height: 150px; border: 2px dashed var(--light-gray); display: flex; align-items: center; justify-content: center; text-align: center; color: var(--gray); font-size: 0.9rem; margin: 1rem auto; }
        .two-fa-actions { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; } /* Added wrap */

        /* Danger Zone Styles */
         .danger-zone-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 1.5rem;
             border: 1px solid var(--danger);
             background-color: rgba(239, 68, 68, 0.05);
             border-radius: 8px;
             margin-bottom: 1rem;
             flex-wrap: wrap; /* Allow wrapping */
         }
         .danger-zone-item div { max-width: 100%; flex-grow: 1; margin-right: 1rem; /* Space before button */ }
         @media (min-width: 768px) { /* Limit width on larger screens */
            .danger-zone-item div { max-width: 70%; }
         }
         .danger-zone-item h5 { color: var(--danger); margin-bottom: 0.25rem; }
         .danger-zone-item p { color: var(--gray); font-size: 0.9rem; }
         .danger-zone-item .btn { flex-shrink: 0; /* Prevent button shrinking */ margin-top: 0.5rem; /* Space when wrapped */}


        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; }
        .notifications-modal.active { display: flex; }
        .notifications-container { width: 400px; max-width: 100%; background-color: var(--white); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; }
        .notifications-title { font-size: 1.25rem; font-weight: 600; }
        .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; }
        .notifications-body { flex-grow: 1; overflow-y: auto; }
        .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--light-gray); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; /* Align top */ cursor: pointer; position: relative; }
        .notification-list-item:hover { background-color: var(--light); }
        .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; } /* Adjusted unread bg slightly */
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } /* Dark theme unread */
        .notification-list-item:last-child { border-bottom: none; }
        .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa;}
        .notification-content { flex: 1; min-width: 0; }
        .notification-message { margin-bottom: 0.25rem; color: var(--text-color); line-height: 1.4; } /* Use text-color */
        .notification-time { font-size: 0.8rem; color: var(--gray); }
        .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; /* Hidden by default */ transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--white); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .notification-list-item:hover .delete-notification { opacity: 0.6; } /* Show on hover */
        .delete-notification:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        body.dark-theme .delete-notification { background: var(--light); }
        body.dark-theme .delete-notification:hover { background: rgba(239, 68, 68, 0.2); }
        .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); }
        .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--light); flex-wrap: wrap; gap: 0.5rem; } /* Added wrap */
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .confirm-modal.active { display: flex; }
        .confirm-container { background-color: var(--white); border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-color); } /* Use text-color */
        .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--gray); }
        .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-message.show { transform: translateX(0); }
        .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); }
        .back-button i { transition: transform 0.2s; font-size: 0.8rem; }
        .back-button:hover i { transform: translateX(-3px); }
        #notificationSound { display: none; }
        .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--light-gray); border-radius: 8px; margin-top: 2rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; }
        .placeholder-content h2 { color: var(--text-color); margin-bottom: 1rem; } /* Use text-color */
        .placeholder-content p { color: var(--gray); } /* Ensure placeholder text uses gray */
        .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; }
        .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }

        /* --- Employee Scheduling Scoped Styles --- */
        /* Styles for the schedule table *within* the loaded container */
        /* Most styles are now handled by the inline <style> block injected from employee-schedule.txt */
        /* However, we can keep some base container/scoping styles here */
        #featureSectionsContainer.employee-scheduling {
            /* Add any dashboard-level overrides or container styles if needed */
            padding: 0; /* Remove default padding if schedule has its own */
        }
        /* Example: Ensure buttons from schedule use dashboard variables */
        #featureSectionsContainer.employee-scheduling .btn-primary {
            background-color: var(--primary);
            color: white;
        }
         #featureSectionsContainer.employee-scheduling .btn-primary:hover {
            background-color: var(--primary-dark);
        }
         #featureSectionsContainer.employee-scheduling .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        #featureSectionsContainer.employee-scheduling .btn-outline:hover {
            background-color: var(--primary-light);
        }
        /* Ensure modals loaded by schedule use dashboard variables */
        #featureSectionsContainer.employee-scheduling .modal-content {
            background-color: var(--white);
            color: var(--text-color);
        }
         body.dark-theme #featureSectionsContainer.employee-scheduling .modal-content {
             background-color: var(--light);
             color: var(--text-color);
         }
        #featureSectionsContainer.employee-scheduling .modal-title {
             color: var(--primary-dark);
        }
         body.dark-theme #featureSectionsContainer.employee-scheduling .modal-title {
             color: #93c5fd; /* Lighter primary in dark mode */
         }


        /* --- Generic Modal Styles (used by Edit Member & Schedule Shift Edit) --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); z-index: 1050; /* Higher than confirm modal */
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: var(--white); width: 100%; max-width: 600px; /* Increased width slightly */
            border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out;
            color: var(--text-color); /* Default text color for modal content */
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--light-gray);
        }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--primary-dark); }
        body.dark-theme .modal-title { color: #93c5fd; }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;}
        .close-modal:hover { color: var(--danger); }

        .toast { /* Generic toast style */ position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; }
        .toast.show { opacity: 1; bottom: 30px; }
        .toast.success { background-color: var(--success); }
        .toast.error { background-color: var(--danger); }
        body.dark-theme .toast { background-color: var(--light); color: var(--text-color); } /* Dark theme toast */
        body.dark-theme .toast.success { background-color: var(--success); color: white; }
        body.dark-theme .toast.error { background-color: var(--danger); color: white; }

        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }


        /* Responsive Overrides */
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; }
            .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
            .main-content { margin-left: 0; }
            .search-bar { width: 250px; }
            .team-member-card { flex-wrap: wrap; }
            .main-content.sidebar-active { margin-left: 250px; } /* Adjust main content when sidebar is open */
            .sidebar-toggle { display: block; /* Show hamburger */ position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
            .top-nav { padding-left: 60px; } /* Make space for hamburger */
        }
        @media (min-width: 993px) {
             .sidebar-toggle { display: none; } /* Hide hamburger on larger screens */
        }

        @media (max-width: 768px) {
            .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; /* Reset padding */ }
            .search-bar { width: 100%; order: 2; }
            .user-menu { width: 100%; justify-content: space-between; order: 1; }
            .content-area { padding: 1.5rem; }
            .data-form { grid-template-columns: 1fr; }
            .form-actions { grid-column: span 1; }
            .user-info { flex-direction: column; text-align: center; }
            .user-info-avatar { margin-bottom: 1rem; }
            .stats-section { grid-template-columns: 1fr; }
            .settings-tabs { flex-wrap: nowrap; overflow-x: auto; } /* Prevent wrapping, allow scroll */
            .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; } /* Prevent shrinking */
            /* setting-item handled above for better wrapping */
            .confirm-container { width: 90%; }
            .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .member-role { margin: 0.5rem 0; }
            .member-actions { margin-top: 0.5rem; }
            .profile-avatar-section { margin-bottom: 1.5rem; }
            #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; }
            /* Ensure invite form fields stack nicely */
            .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; }
            .add-member-form .data-form > div { margin-bottom: 1rem; }
            .add-member-form .data-form > div:last-child { margin-top: 0; } /* Remove extra space above button */
            /* Schedule mobile fixes (within injected content) */
            #featureSectionsContainer.employee-scheduling .schedule-controls { flex-direction: column; gap: 1rem; align-items: stretch; }
            #featureSectionsContainer.employee-scheduling .schedule-controls .btn { width: 100%; justify-content: center; }
            #featureSectionsContainer.employee-scheduling .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
            #featureSectionsContainer.employee-scheduling .employee-name { position: static !important; /* Ensure it's not sticky */ border-right: none; border-bottom: 2px solid var(--gray); }
            #featureSectionsContainer.employee-scheduling .schedule-table tbody td { border-right: none; }
            /* This might be tricky with inline styles, but attempt it */
             #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { position: sticky; left: 0; z-index: 11 !important; background-color: var(--primary); }
             body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th:first-child { background-color: var(--primary); }

            .modal-content { width: 95%; padding: 1.5rem;}
            .notifications-container { width: 100%; max-width: 100%; }
            .sidebar-toggle { top: 10px; left: 10px; }
            .top-nav { padding-top: 60px; /* Make space for hamburger */ }
        }
        @media (max-width: 480px) {
            .section-header > div { justify-content: center; width: 100%; }
            .welcome-section { padding: 1.5rem; }
            .stats-section { gap: 0.75rem; }
            .stat-card { padding: 1rem; }
            .user-menu { gap: 1rem; }
            .user-name { display: none; } /* Hide name on very small screens */
            .user-status { margin-left: 0; }
            .notifications-footer { flex-direction: column; gap: 0.5rem; }
            .notifications-footer .btn { width: 100%; justify-content: center; }
        }
         /* Checkbox Group for Notification Types */
         .checkbox-group {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
             gap: 0.75rem;
             margin-top: 0.5rem;
             padding: 0.5rem;
             border: 1px solid var(--light-gray);
             border-radius: 6px;
         }
         .checkbox-group label {
             display: flex;
             align-items: center;
             gap: 0.5rem;
             font-weight: normal; /* Override form-group label weight */
             font-size: 0.9rem;
             margin-bottom: 0; /* Override form-group label margin */
             color: var(--text-color); /* Ensure label text color */
         }
         .checkbox-group input[type="checkbox"] {
             width: auto; /* Override form-control width */
             margin-right: 0.25rem;
         }
         /* Simple link style for settings panel internal links */
         .settings-link {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
         }
         .settings-link:hover {
            text-decoration: underline;
            color: var(--primary-dark);
         }

    </style>
</head>
<!-- Apply theme class from localStorage -->
<body class=""> <!-- Start with no specific theme, JS will apply -->

    <audio id="notificationSound" preload="auto">
        <source src="assets/notification.mp3" type="audio/mpeg"> <!-- Check this path -->
        Your browser does not support the audio element.
    </audio>

    <!-- Hamburger Menu Toggle (Visible on smaller screens) -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Success/Toast message container -->
    <div class="toast" id="toastMessage">Toast message</div>
    <!-- Success message (Specific style from original) -->
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Action successful!</span> </div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-users-cog logo-icon"></i>
                <span>TeamFlow</span>
            </div>
             <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar" style="display: none; background: none; border: none; color: white; font-size: 1.2rem; position: absolute; top: 1.5rem; right: 1rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
             <!-- Sidebar items remain the same -->
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>
             <div class="menu-title">Core Features</div>
             <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
             <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <div class="menu-title">Team Tools</div>
             <!-- Make sure this data-feature matches the one used in loadFeatureContent -->
             <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
             <a href="#deadline-tracking" class="menu-item" data-feature="deadline-tracking"><i class="fas fa-clock"></i><span>Deadline Tracking</span></a>
             <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>
             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
         <div class="connection-status">
             <div class="status-dot"></div>
             <span>Online</span>
         </div>
    </aside>

    <main class="main-content" id="mainContent">
         <nav class="top-nav">
             <div class="search-bar">
                 <i class="fas fa-search search-icon"></i>
                 <input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off">
                 <div class="search-results" id="searchResults">
                    <!-- Search results will be populated here -->
                 </div>
             </div>
             <div class="user-menu">
                 <div class="notification-icon" id="notificationIcon">
                     <i class="fas fa-bell"></i>
                     <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                 </div>
                 <div class="user-profile" id="userProfileContainer">
                     <div class="user-avatar" id="userAvatar">ME</div>
                     <div class="user-profile-details">
                         <span class="user-name" id="userName">Loading...</span>
                         <span class="user-status">  Connected</span>
                     </div>
                     <div class="user-dropdown" id="userDropdown">
                         <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a>
                         <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a>
                         <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                     </div>
                 </div>
             </div>
         </nav>

         <div class="content-area">
             <!-- Back Button - Text dynamically updated -->
             <div class="back-button" id="backButton" style="display: none;">
                 <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span>
             </div>

             <!-- Dashboard Content -->
             <div id="dashboardContent" class="content-section active">
                 <!-- Dashboard specific content remains here -->
                 <div class="welcome-section" id="welcomeSection">
                     <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2>
                     <p class="welcome-subtitle">Here's what's happening with your team today.</p>
                     <div class="user-info">
                         <div class="user-info-avatar" id="profileAvatar">U</div>
                         <div class="user-info-details">
                             <div class="user-info-name" id="userInfoName">Loading User...</div>
                             <div class="user-info-title" id="userInfoRoleTitle">Loading Role...</div>
                             <div class="user-info-email">
                                 <i class="fas fa-envelope"></i> <span id="userEmail">loading@email.com</span>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="stats-section" id="statsSection">
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                 </div>
                 <div class="activity-section">
                     <div class="section-header">
                         <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3>
                         <div>
                             <span class="view-all" id="viewAllActivity">Show All</span>
                             <span class="delete-all" id="deleteAllActivity">Delete All</span>
                         </div>
                     </div>
                     <ul class="activity-list" id="activityList">
                         <li style="text-align: center; padding: 2rem; color: var(--gray);"> Loading activities... </li>
                     </ul>
                 </div>
             </div>

             <!-- Profile Content -->
             <div class="content-section" id="profileContent">
                <!-- Profile specific content remains here -->
                 <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Your personal information and account security settings.</p>
                 <div class="profile-avatar-section">
                     <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color);">Avatar</label>
                     <div id="profileAvatarLarge" title="Click to upload photo">ME</div>
                     <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                 </div>
                 <form class="data-form" id="profileForm">
                     <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control" value=""> </div>
                     <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control" value=""> </div>
                     <div class="form-actions">
                         <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button>
                         <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                            <span class="btn-text">Save Changes</span>
                            <span class="spinner" style="display: none;"></span>
                         </button>
                     </div>
                 </form>
             </div>

             <!-- Settings Content -->
             <div class="content-section" id="settingsContent">
                <!-- Settings specific content remains here -->
                 <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                 <div class="settings-tabs">
                     <div class="settings-tab active" data-tab="preferences">Preferences</div>
                     <div class="settings-tab" data-tab="account">Account</div>
                     <div class="settings-tab" data-tab="security">Security</div>
                     <div class="settings-tab" data-tab="notifications">Notifications</div>
                     <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div>
                     <div class="settings-tab" data-tab="collaboration">Collaboration</div>
                     <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div>
                 </div>
                 <!-- Preferences Panel -->
                 <div class="settings-panel active" id="preferencesPanel">
                    <!-- Preferences content... -->
                     <div class="settings-subsection">
                         <h4>Appearance</h4>
                         <div class="form-group">
                             <label class="settings-label">Theme</label>
                             <div class="theme-options-container">
                                 <div class="theme-option" data-theme="light">
                                     <div class="theme-preview light-preview"><i class="fas fa-sun"></i></div>
                                     <span class="theme-label">Light</span>
                                 </div>
                                 <div class="theme-option" data-theme="dark">
                                     <div class="theme-preview dark-preview"><i class="fas fa-moon"></i></div>
                                     <span class="theme-label">Dark</span>
                                 </div>
                                 <div class="theme-option" data-theme="system">
                                    <div class="theme-preview system-preview"><i class="fas fa-desktop"></i></div>
                                    <span class="theme-label">System</span>
                                 </div>
                             </div>
                         </div>
                         <div class="setting-item">
                            <div>
                                <span class="setting-item-label">High Contrast Mode</span>
                                <p class="setting-item-description">Increase text visibility for accessibility.</p>
                            </div>
                            <div class="setting-item-control">
                                <label class="switch">
                                    <input type="checkbox" id="highContrastToggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Localization</h4>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group">
                                 <label for="languageSelect">Language</label>
                                 <select id="languageSelect" class="form-control">
                                     <option value="en">English (US)</option>
                                     <option value="ar"> (Arabic)</option>
                                     <option value="es">Espaol (Spanish)</option>
                                 </select>
                             </div>
                             <div class="form-group">
                                 <label for="regionSelect">Region / Timezone</label>
                                 <select id="regionSelect" class="form-control">
                                     <option value="utc">UTC</option>
                                     <option value="est">EST (UTC-5)</option>
                                     <option value="pst">PST (UTC-8)</option>
                                     <option value="cet">CET (UTC+1)</option>
                                     <option value="eet">EET (UTC+2)</option>
                                     <option value="ast">AST (UTC+3) - Riyadh</option>
                                 </select>
                             </div>
                         </div>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group">
                                 <label for="timeFormatSelect">Time Format</label>
                                 <select id="timeFormatSelect" class="form-control">
                                     <option value="12h">12-hour (e.g., 3:00 PM)</option>
                                     <option value="24h">24-hour (e.g., 15:00)</option>
                                 </select>
                             </div>
                              <div class="form-group">
                                 <label for="dateFormatSelect">Date Format</label>
                                 <select id="dateFormatSelect" class="form-control">
                                     <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                     <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                     <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                     <option value="Month D, YYYY">Month D, YYYY</option>
                                 </select>
                             </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Messages & Sounds</h4>
                         <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Enable Toast Notifications</span>
                                 <p class="setting-item-description">Show brief confirmation messages for actions.</p>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="toastToggle" checked>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                         <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Enable Sound Notifications</span>
                                 <p class="setting-item-description">Play a sound for new notifications and activities.</p>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="soundToggle" checked>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                         <div class="form-group">
                             <label for="notificationToneSelect">Notification Tone</label>
                             <select id="notificationToneSelect" class="form-control" disabled>
                                 <option value="default">Default</option>
                             </select>
                             <p class="setting-item-description">Select the sound to play for notifications (Requires enabling sound).</p>
                         </div>
                         <div class="form-group">
                             <label class="settings-label">Keyboard Shortcuts</label>
                             <p class="setting-item-description">View or customize keyboard shortcuts (Feature placeholder).</p>
                             <button class="btn btn-outline btn-sm" disabled>View Shortcuts</button>
                         </div>
                     </div>
                     <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;">
                         <button type="button" class="btn btn-primary" id="savePreferencesBtn">Save Preferences</button>
                     </div>
                 </div>
                 <!-- Account Panel -->
                 <div class="settings-panel" id="accountPanel">
                    <!-- Account content... -->
                    <div class="settings-subsection">
                         <h4>Account Information</h4>
                         <div class="data-form">
                             <div class="form-group">
                                 <label for="accountEmail">Current Email</label>
                                 <input type="email" id="accountEmail" class="form-control" value="" readonly>
                             </div>
                             <div class="form-group">
                                <label for="changeEmail">New Email Address</label>
                                <input type="email" id="changeEmail" class="form-control" placeholder="Enter new email" disabled>
                                <p class="setting-item-description">Changing email requires backend verification.</p>
                            </div>
                             <div class="form-group" style="grid-column: span 2;">
                                <label for="accountConfirmPassword">Confirm Password (to change email)</label>
                                <input type="password" id="accountConfirmPassword" class="form-control" placeholder="Enter current password" disabled>
                            </div>
                            <div class="form-actions" style="grid-column: span 2;">
                                <button type="button" class="btn btn-primary" id="saveAccountEmailBtn" disabled>Change Email Address</button>
                            </div>
                         </div>
                         <p style="margin-top: 1rem;">Note: Password changes are managed under the <a href="#settings-security" data-feature="settings" data-tab-target="security" class="settings-link">Security Tab</a>.</p>
                     </div>
                     <div class="settings-subsection">
                         <h4>Account Notifications</h4>
                         <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Enable Account Notifications</span>
                                 <p class="setting-item-description">Receive email alerts for important account activities.</p>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="accountNotificationsToggle" checked>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                     </div>
                     <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;">
                         <button type="button" class="btn btn-primary" id="saveAccountSettingsBtn">Save Account Settings</button>
                     </div>
                 </div>
                 <!-- Security Panel -->
                 <div class="settings-panel" id="securityPanel">
                    <!-- Security content... -->
                     <div class="settings-subsection">
                         <h4>Password</h4>
                         <form class="data-form" id="changePasswordForm">
                             <div class="form-group">
                                 <label for="currentPassword">Current Password</label>
                                 <input type="password" id="currentPassword" class="form-control">
                             </div>
                             <div class="form-group">
                                 <label for="newPassword">New Password</label>
                                 <input type="password" id="newPassword" class="form-control">
                             </div>
                             <div class="form-group">
                                 <label for="confirmPassword">Confirm New Password</label>
                                 <input type="password" id="confirmPassword" class="form-control">
                             </div>
                             <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Change Password</button>
                             </div>
                         </form>
                     </div>
                     <div class="settings-subsection">
                         <h4>Two-Factor Authentication (2FA)</h4>
                         <div class="two-fa-status">
                             <span class="status-indicator disabled" id="twoFaStatusIndicator"></span>
                             <span id="twoFaStatusText">2FA is currently Disabled</span>
                         </div>
                         <p class="setting-item-description">Add an extra layer of security to your account.</p>
                         <div id="twoFaSetupSection" style="display: block;">
                             <button class="btn btn-primary" id="enable2faBtn">Enable 2FA</button>
                             <div class="two-fa-setup" id="twoFaSetupOptions" style="display:none;">
                                 <h5>Choose Setup Method:</h5>
                                 <div class="two-fa-actions">
                                      <button class="btn btn-outline" id="setupAuthAppBtn"><i class="fas fa-mobile-alt"></i> Authenticator App</button>
                                      <button class="btn btn-outline" id="setupSmsBtn"><i class="fas fa-sms"></i> SMS Message</button>
                                 </div>
                                 <div id="authAppSetup" style="display: none; margin-top: 1.5rem;">
                                     <p>1. Scan this QR code with your authenticator app.</p>
                                     <div class="qr-code-placeholder">QR Code</div>
                                     <p>2. Enter the 6-digit code generated by your app.</p>
                                     <div class="form-group">
                                        <label for="authCode">Verification Code</label>
                                        <input type="text" id="authCode" class="form-control" placeholder="123456" maxlength="6">
                                    </div>
                                     <button class="btn btn-primary" id="verifyAuthCodeBtn">Verify & Enable</button>
                                 </div>
                                 <div id="smsSetup" style="display: none; margin-top: 1.5rem;">
                                     <p>1. We'll send a code via SMS to <span id="userPhoneNumberForSms"></span>.</p>
                                     <button class="btn btn-primary" id="sendSmsCodeBtn">Send Code</button>
                                     <div class="form-group" style="margin-top: 1rem; display: none;" id="smsCodeInputGroup">
                                        <label for="smsCode">SMS Verification Code</label>
                                        <input type="text" id="smsCode" class="form-control" placeholder="123456" maxlength="6">
                                     </div>
                                     <button class="btn btn-primary" id="verifySmsCodeBtn" style="display: none;">Verify & Enable</button>
                                 </div>
                             </div>
                         </div>
                         <div id="twoFaManagementSection" style="display: none;">
                              <p>2FA is enabled. Manage recovery codes or disable.</p>
                              <div class="two-fa-actions">
                                 <button class="btn btn-outline" disabled>View Recovery Codes</button>
                                 <button class="btn btn-danger" id="disable2faBtn">Disable 2FA</button>
                             </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Session Management</h4>
                         <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group">
                                <label for="sessionDuration">Session Duration (minutes)</label>
                                <input type="number" id="sessionDuration" class="form-control" value="60" min="15">
                                <p class="setting-item-description">Set how long a login session remains active.</p>
                            </div>
                            <div class="form-group">
                                <label for="idleTimeout">Idle Timeout (minutes)</label>
                                <input type="number" id="idleTimeout" class="form-control" value="15" min="5">
                                <p class="setting-item-description">Automatically logout after inactivity.</p>
                            </div>
                         </div>
                         <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;">
                             <button type="button" class="btn btn-primary" id="saveSessionSettingsBtn">Save Session Settings</button>
                         </div>
                     </div>
                 </div>
                 <!-- Notifications Panel -->
                 <div class="settings-panel" id="notificationsPanel">
                    <!-- Notifications content... -->
                      <div class="settings-subsection">
                         <h4>Notification Delivery</h4>
                         <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Enable Email Notifications</span>
                                 <p class="setting-item-description">Receive summaries and important alerts via email.</p>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="emailNotificationsToggle" checked>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                         <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Enable In-App Notifications</span>
                                 <p class="setting-item-description">Show notifications within the TeamFlow interface.</p>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="inAppNotificationsToggle" checked>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                          <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Enable Push Notifications (Mobile/Desktop)</span>
                                 <p class="setting-item-description">Receive notifications outside the app (Requires setup).</p>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="pushNotificationsToggle" disabled>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Notification Types</h4>
                         <p class="setting-item-description">Choose which types of notifications you want to receive.</p>
                         <div class="checkbox-group">
                            <label><input type="checkbox" name="notificationType" value="task_assigned" checked> Task Assigned</label>
                            <label><input type="checkbox" name="notificationType" value="task_comment" checked> Task Comment/Mention</label>
                            <label><input type="checkbox" name="notificationType" value="project_update" checked> Project Update</label>
                            <label><input type="checkbox" name="notificationType" value="deadline_reminder" checked> Deadline Reminder</label>
                            <label><input type="checkbox" name="notificationType" value="file_shared"> File Shared</label>
                            <label><input type="checkbox" name="notificationType" value="system_announcement" checked> System Announcement</label>
                         </div>
                     </div>
                     <div class="settings-subsection">
                        <h4>Sound & Priority (Linked to Preferences)</h4>
                         <p class="setting-item-description">Sound settings are managed under the <a href="#settings-preferences" data-feature="settings" data-tab-target="preferences" class="settings-link">Preferences Tab</a>.</p>
                         <div class="form-group">
                            <label for="notificationPriority">Minimum Notification Priority</label>
                            <select id="notificationPriority" class="form-control" disabled>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                            <p class="setting-item-description">Only show notifications above a certain priority level (Placeholder).</p>
                         </div>
                     </div>
                      <div class="form-actions" style="grid-column: span 1; justify-content: flex-end;">
                         <button type="button" class="btn btn-primary" id="saveNotificationSettingsBtn">Save Notification Settings</button>
                     </div>
                 </div>
                 <!-- Team Management Panel -->
                 <div class="settings-panel" id="teamPanel">
                    <!-- Team management content... -->
                    <div class="team-management">
                         <div class="settings-subsection">
                             <h4>Team Members</h4>
                             <div class="team-list" id="teamList"> <p>Loading team members...</p> </div>
                             <div class="add-member-form">
                                 <h4>Invite New Member</h4>
                                 <form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;">
                                    <div class="form-group"> <label for="inviteEmail">Email</label> <input type="email" id="inviteEmail" class="form-control" required> </div>
                                    <div class="form-group"> <label for="inviteRole">Role</label> <select id="inviteRole" class="form-control" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                                    <button type="submit" class="btn btn-primary">Invite</button>
                                 </form>
                             </div>
                         </div>
                         <div class="settings-subsection">
                             <h4>Custom Role Permissions</h4>
                             <p class="setting-item-description">Define permissions for different roles (Placeholder).</p>
                             <button class="btn btn-outline" disabled>Manage Permissions</button>
                         </div>
                     </div>
                 </div>
                 <!-- Collaboration Panel -->
                 <div class="settings-panel" id="collaborationPanel">
                    <!-- Collaboration content... -->
                    <div class="settings-subsection">
                         <h4>External Integrations</h4>
                         <p class="setting-item-description">Connect TeamFlow with other applications (Placeholder).</p>
                         <div class="integration-list" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                            <button class="btn btn-outline" disabled><i class="fab fa-slack"></i> Connect Slack</button>
                            <button class="btn btn-outline" disabled><i class="fab fa-google-drive"></i> Connect Google Drive</button>
                            <button class="btn btn-outline" disabled><i class="fab fa-github"></i> Connect GitHub</button>
                         </div>
                     </div>
                      <div class="settings-subsection">
                         <h4>Sharing & Invitations</h4>
                         <p class="setting-item-description">Manage external sharing settings (Placeholder).</p>
                         <div class="setting-item">
                             <div>
                                 <span class="setting-item-label">Allow External Sharing Links</span>
                             </div>
                             <div class="setting-item-control">
                                 <label class="switch">
                                     <input type="checkbox" id="externalSharingToggle" disabled>
                                     <span class="slider round"></span>
                                 </label>
                             </div>
                         </div>
                         <button class="btn btn-outline" disabled>Manage Pending Invites</button>
                      </div>
                 </div>
                 <!-- Danger Zone Panel -->
                 <div class="settings-panel" id="dangerPanel">
                    <!-- Danger zone content... -->
                    <h3 class="section-title" style="color: var(--danger);">Danger Zone</h3>
                     <p>These actions are permanent and cannot be undone.</p>
                     <div class="danger-zone-item">
                         <div>
                            <h5>Logout From All Devices</h5>
                            <p>Log out of all active sessions on other devices.</p>
                         </div>
                         <button class="btn btn-warning" id="logoutAllDevicesBtn">Logout Everywhere</button>
                     </div>
                     <div class="danger-zone-item">
                         <div>
                            <h5>Delete Account</h5>
                            <p>Permanently delete your account and all associated data.</p>
                         </div>
                         <button class="btn btn-danger" id="deleteAccountBtn">Delete My Account</button>
                     </div>
                 </div>
             </div>

             <!-- Container for dynamically loaded feature sections -->
             <div id="featureSectionsContainer" class="content-section">
                 <!-- Content loaded dynamically here -->
                 <div class="placeholder-content" id="featurePlaceholder">
                     <h2 id="featureTitle">Feature Content Area</h2>
                     <p id="featureDescription">Select a feature from the sidebar.</p>
                     <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                     <div class="error-message" style="display: none;"> Failed to load content. </div>
                 </div>
             </div>
         </div>
    </main>

    <!-- Notification Modal -->
    <div class="notifications-modal" id="notificationsModal">
         <div class="notifications-container">
             <div class="notifications-header">
                 <h3 class="notifications-title">Notifications</h3>
                 <button class="close-notifications" id="closeNotifications" aria-label="Close Notifications"></button>
             </div>
             <div class="notifications-body" id="notificationsBody">
                 <div class="no-notifications-message" id="noNotificationsMessage">Loading notifications...</div>
             </div>
             <div class="notifications-footer">
                 <button class="btn btn-outline btn-sm" id="markAllReadBtn">Mark All as Read</button>
                 <button class="btn btn-danger btn-sm" id="deleteAllNotificationsBtn">Delete All</button>
             </div>
         </div>
    </div>

    <!-- Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
         <div class="confirm-container">
             <h3 class="confirm-title" id="confirmTitle">Confirm Action</h3>
             <div class="confirm-message" id="confirmMessage">Are you sure you want to proceed?</div>
             <div class="confirm-actions">
                 <button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button>
                 <button class="btn btn-danger" id="confirmBtn">Confirm</button>
             </div>
         </div>
    </div>

    <!-- Edit Member Modal -->
    <div class="modal" id="editMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="editMemberModalTitle">Edit Team Member</h3>
                <button class="close-modal" data-close-modal>&times;</button>
            </div>
            <form id="editMemberForm">
                <input type="hidden" id="editMemberId">
                 <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                     <div class="form-group">
                         <label for="editMemberFirstName">First Name</label>
                         <input type="text" id="editMemberFirstName" class="form-control">
                     </div>
                     <div class="form-group">
                         <label for="editMemberLastName">Last Name</label>
                         <input type="text" id="editMemberLastName" class="form-control">
                     </div>
                     <div class="form-group">
                         <label for="editMemberEmail">Email</label>
                         <input type="email" id="editMemberEmail" class="form-control" readonly>
                     </div>
                     <div class="form-group">
                         <label for="editMemberRole">Role</label>
                         <select id="editMemberRole" class="form-control">
                             <option value="member">Member</option>
                             <option value="supervisor">Supervisor</option>
                             <option value="senior">Senior</option>
                             <option value="admin">Admin</option>
                         </select>
                     </div>
                      <div class="form-group">
                         <label for="editMemberTitle">Job Title</label>
                         <input type="text" id="editMemberTitle" class="form-control">
                     </div>
                      <div class="form-group">
                         <label for="editMemberDepartment">Department</label>
                         <input type="text" id="editMemberDepartment" class="form-control">
                     </div>
                 </div>
                <div class="form-actions" style="grid-column: span 1;">
                     <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                     <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements ---
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.menu-item');
            const contentSections = document.querySelectorAll('.content-area > .content-section'); // Direct children only
            const dashboardContent = document.getElementById('dashboardContent');
            const profileContent = document.getElementById('profileContent');
            const settingsContent = document.getElementById('settingsContent');
            // Container for dynamically loaded features
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            // Placeholder elements WITHIN the dynamic container
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureTitleEl = document.getElementById('featureTitle');
            const featureDescEl = document.getElementById('featureDescription');
            const featureLoadingEl = featurePlaceholder.querySelector('.loading-indicator');
            const featureErrorEl = featurePlaceholder.querySelector('.error-message');

            const backButton = document.getElementById('backButton');
            const backButtonText = document.getElementById('backButtonText');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const searchInput = document.getElementById('searchInput');
            const searchResultsContainer = document.getElementById('searchResults');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationBadge = document.getElementById('notificationBadge');
            const notificationsModal = document.getElementById('notificationsModal');
            const closeNotifications = document.getElementById('closeNotifications');
            const notificationsBody = document.getElementById('notificationsBody');
            const noNotificationsMessage = document.getElementById('noNotificationsMessage');
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn');
            const notificationSound = document.getElementById('notificationSound');
            const activityList = document.getElementById('activityList');
            const viewAllActivity = document.getElementById('viewAllActivity');
            const deleteAllActivity = document.getElementById('deleteAllActivity');
            const statsSection = document.getElementById('statsSection');
            const welcomeSection = document.getElementById('welcomeSection');

            // Profile Elements
            const profileForm = document.getElementById('profileForm');
            const profileAvatarLarge = document.getElementById('profileAvatarLarge');
            const profileAvatarInput = document.getElementById('profileAvatarInput');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const fullNameDisplay = document.getElementById('fullNameDisplay');
            const jobTitleInput = document.getElementById('jobTitle');
            const emailDisplay = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const departmentInput = document.getElementById('department');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const cancelProfileBtn = document.getElementById('cancelProfileBtn');

            // Settings Elements
            const themeOptions = document.querySelectorAll('.theme-option');
            const highContrastToggle = document.getElementById('highContrastToggle');
            const languageSelect = document.getElementById('languageSelect');
            const regionSelect = document.getElementById('regionSelect');
            const timeFormatSelect = document.getElementById('timeFormatSelect');
            const dateFormatSelect = document.getElementById('dateFormatSelect');
            const toastToggle = document.getElementById('toastToggle');
            const soundToggle = document.getElementById('soundToggle');
            const notificationToneSelect = document.getElementById('notificationToneSelect');
            const savePreferencesBtn = document.getElementById('savePreferencesBtn');
            const accountEmailDisplay = document.getElementById('accountEmail');
            const changeEmailInput = document.getElementById('changeEmail');
            const accountConfirmPasswordInput = document.getElementById('accountConfirmPassword');
            const saveAccountEmailBtn = document.getElementById('saveAccountEmailBtn');
            const accountNotificationsToggle = document.getElementById('accountNotificationsToggle');
            const saveAccountSettingsBtn = document.getElementById('saveAccountSettingsBtn');
            const changePasswordForm = document.getElementById('changePasswordForm');
            const enable2faBtn = document.getElementById('enable2faBtn');
            const twoFaSetupSection = document.getElementById('twoFaSetupSection');
            const twoFaManagementSection = document.getElementById('twoFaManagementSection');
            const twoFaStatusIndicator = document.getElementById('twoFaStatusIndicator');
            const twoFaStatusText = document.getElementById('twoFaStatusText');
            const twoFaSetupOptions = document.getElementById('twoFaSetupOptions');
            const setupAuthAppBtn = document.getElementById('setupAuthAppBtn');
            const setupSmsBtn = document.getElementById('setupSmsBtn');
            const authAppSetup = document.getElementById('authAppSetup');
            const smsSetup = document.getElementById('smsSetup');
            const verifyAuthCodeBtn = document.getElementById('verifyAuthCodeBtn');
            const userPhoneNumberForSms = document.getElementById('userPhoneNumberForSms');
            const sendSmsCodeBtn = document.getElementById('sendSmsCodeBtn');
            const smsCodeInputGroup = document.getElementById('smsCodeInputGroup');
            const verifySmsCodeBtn = document.getElementById('verifySmsCodeBtn');
            const disable2faBtn = document.getElementById('disable2faBtn');
            const saveSessionSettingsBtn = document.getElementById('saveSessionSettingsBtn');
            const emailNotificationsToggle = document.getElementById('emailNotificationsToggle');
            const inAppNotificationsToggle = document.getElementById('inAppNotificationsToggle');
            const pushNotificationsToggle = document.getElementById('pushNotificationsToggle');
            const notificationTypeCheckboxes = document.querySelectorAll('input[name="notificationType"]');
            const saveNotificationSettingsBtn = document.getElementById('saveNotificationSettingsBtn');
            const logoutAllDevicesBtn = document.getElementById('logoutAllDevicesBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');

            // Modals & Messages
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const successMessage = document.getElementById('successMessage');
            const successMessageText = document.getElementById('successMessageText');
            const toastMessage = document.getElementById('toastMessage');
            const editMemberModal = document.getElementById('editMemberModal');
            const editMemberForm = document.getElementById('editMemberForm');
            const logoutLink = document.getElementById('logoutLink');

            // --- State Variables ---
            let currentUser = null;
            let currentFeature = 'dashboard';
            let currentSettingsTab = 'preferences';
            let notifications = [];
            let activities = [];
            let activityIntervalId = null;
            let notificationIntervalId = null;
            let statsIntervalId = null;
            let welcomeBgIntervalId = null;
            let confirmCallback = null;
            let maxActivitiesToShow = 5;
            let showingAllActivities = false;
            let userDropdownOpen = false;
            let showToasts = true;
            let playSounds = true;
            // Schedule specific state is now managed WITHIN the loaded schedule's script

            // --- Mock Data ---
            let MOCK_USERS = [
                 { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin', twoFaEnabled: false },
                 { id: 2, name: 'Yousef Ahmed', email: 'yousef@example.com', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'YA', role: 'supervisor', twoFaEnabled: false },
                 { id: 3, name: 'Esraa Lashin', email: 'esraa@example.com', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'EL', role: 'senior', twoFaEnabled: true },
                 { id: 4, name: 'Bassant Badr', email: 'bassant@example.com', title: 'Junior Designer', department: 'Design', phone: '+20155444333', avatar: '', initials: 'BB', role: 'member', twoFaEnabled: false },
                 { id: 5, name: 'Nada Mahmoud', email: 'nada@example.com', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'NM', role: 'member', twoFaEnabled: false },
            ];
            const MOCK_PROJECTS = [ /* ... projects ... */ ];
            const MOCK_TASKS = [ /* ... tasks ... */ ];

             // --- Initialization ---
             function initDashboard() {
                 currentUser = { ...MOCK_USERS[0] };
                 console.log("Initializing dashboard for:", currentUser.name);
                 applyStoredPreferences();
                 updateUserUI();
                 setupEventListeners();
                 loadInitialData();
                 handleInitialNavigation();
                 startDynamicUpdates();
                 setupResponsiveSidebar();
             }

            // --- UI Updates ---
            function updateUserUI() {
                // (Keep the existing updateUserUI function as it is)
                // It updates dashboard elements based on currentUser
                 if (!currentUser) return;
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = currentUser.initials;
                 if (currentUser.avatar) { /* ... avatar logic ... */ } else { /* ... initials logic ... */ }
                document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0];
                document.getElementById('userInfoName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('profileAvatar').textContent = currentUser.initials;
                 if (currentUser.avatar) { /* ... avatar logic ... */ } else { /* ... initials logic ... */ }
                const roleTitle = document.getElementById('userInfoRoleTitle');
                roleTitle.textContent = formatRole(currentUser.role);
                roleTitle.className = `user-info-title role-${currentUser.role}`;
                updateProfileForm();
                profileAvatarLarge.textContent = currentUser.initials;
                 if (currentUser.avatar) { /* ... avatar logic ... */ } else { /* ... initials logic ... */ }
                if (accountEmailDisplay) accountEmailDisplay.value = currentUser.email;
                const teamSettingsTab = document.getElementById('teamSettingsTab');
                const dangerZoneTab = document.getElementById('dangerZoneTab');
                 if (currentUser.role === 'admin') { /* ... admin UI logic ... */ } else { /* ... non-admin UI logic ... */ }
                update2FA_UI();
                 if (userPhoneNumberForSms) userPhoneNumberForSms.textContent = currentUser.phone || 'Not Available';
            }

            function updateProfileForm() {
                 // (Keep the existing updateProfileForm function)
                 if (!currentUser) return;
                 const nameParts = currentUser.name.split(' ');
                 firstNameInput.value = nameParts[0] || '';
                 lastNameInput.value = nameParts.slice(1).join(' ') || '';
                 fullNameDisplay.value = currentUser.name;
                 jobTitleInput.value = currentUser.title || '';
                 emailDisplay.value = currentUser.email || '';
                 phoneInput.value = currentUser.phone || '';
                 departmentInput.value = currentUser.department || '';
            }

            function formatRole(role) {
                 if (!role) return 'Member';
                 return role.charAt(0).toUpperCase() + role.slice(1);
            }

            // --- Preferences & Settings Logic ---
            function applyStoredPreferences() { /* (Keep existing logic) */ }
            function setTheme(theme) { /* (Keep existing logic) */ }
            function setContrast(enabled) { /* (Keep existing logic) */ }
            function applyLanguage(lang) { /* (Keep existing logic) */ }
            function applyDateTimeFormat(timeFormat, dateFormat) { /* (Keep existing logic) */ }
            function applyToastPreference(enabled) { /* (Keep existing logic) */ }
            function applySoundPreference(enabled) { /* (Keep existing logic) */ }

            // --- Navigation & Content Loading ---
            function setActiveFeature(featureId, settingsTab = null, skipHistory = false) {
                console.log(`Navigating to: ${featureId}` + (settingsTab ? ` / Tab: ${settingsTab}` : ''));
                currentFeature = featureId;

                menuItems.forEach(item => {
                    item.classList.toggle('active', item.getAttribute('data-feature') === featureId);
                });

                // Hide all *static* content sections first
                dashboardContent.classList.remove('active');
                profileContent.classList.remove('active');
                settingsContent.classList.remove('active');
                // Also hide the dynamic container initially
                featureSectionsContainer.classList.remove('active');
                featureSectionsContainer.innerHTML = ''; // Clear dynamic content
                featureSectionsContainer.classList.remove('employee-scheduling'); // Remove specific classes

                // Show the correct section
                let targetSection = null;
                let isDynamicFeature = false;

                if (featureId === 'dashboard') {
                    targetSection = dashboardContent;
                    backButton.style.display = 'none';
                } else if (featureId === 'profile') {
                    targetSection = profileContent;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    updateProfileForm();
                } else if (featureId === 'settings') {
                    targetSection = settingsContent;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    currentSettingsTab = settingsTab || (currentUser.role === 'admin' ? 'preferences' : 'preferences');
                    if (currentUser.role !== 'admin' && (currentSettingsTab === 'team' || currentSettingsTab === 'danger')) {
                         currentSettingsTab = 'preferences';
                    }
                    activateSettingsTab(currentSettingsTab);
                    update2FA_UI();
                } else {
                    // Handle dynamic features - Load into feature container
                    isDynamicFeature = true;
                    targetSection = featureSectionsContainer; // This container will be activated
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    loadFeatureContent(featureId); // Load the specific content
                }

                if (targetSection) {
                    targetSection.classList.add('active');
                }

                 // Close sidebar on mobile
                 if (window.innerWidth <= 992 && sidebar.classList.contains('active')) { /* ... close sidebar logic ... */ }
                 // Close user dropdown
                 if (userDropdown) userDropdown.classList.remove('active');
                 userDropdownOpen = false;

                 if (!skipHistory) {
                    updateBrowserHistory(featureId, featureId === 'settings' ? currentSettingsTab : null);
                 }
            }

            function activateSettingsTab(tabId) { /* (Keep existing logic) */ }

            // THIS IS THE KEY MODIFICATION
            function loadFeatureContent(featureId) {
                const menuItem = Array.from(menuItems).find(item => item.getAttribute('data-feature') === featureId);
                const featureName = menuItem ? menuItem.querySelector('span').textContent : 'Feature';

                // Show loading state in the container
                featureSectionsContainer.innerHTML = ''; // Clear previous
                featureSectionsContainer.classList.remove('employee-scheduling'); // Reset classes
                featureSectionsContainer.appendChild(featurePlaceholder); // Add placeholder back
                featurePlaceholder.style.display = 'flex';
                featureLoadingEl.style.display = 'block';
                featureErrorEl.style.display = 'none';
                featureTitleEl.textContent = `Loading ${featureName}...`;
                featureDescEl.textContent = '';
                console.log(`Loading content for: ${featureName}`);

                // Simulate loading delay
                setTimeout(() => {
                    try {
                        let contentHTML = '';
                        let requiresManualScriptExecution = false;
                        let scriptContent = ''; // To hold extracted script if needed

                        // === Load Employee Schedule Content ===
                        if (featureId === 'employee-scheduling') {
                            featureSectionsContainer.classList.add('employee-scheduling'); // Add scoping class

                            // Get the HTML content from the provided 'employee-schedule.txt'
                            // IMPORTANT: In a real app, you'd fetch this via AJAX. Here, we hardcode it.
                            contentHTML = `
                                <!-- START OF INJECTED employee-schedule.txt CONTENT -->
                                <!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Employee Schedule | Team Management Platform</title> <link rel="stylesheet" href="https: <style> :root { --primary: #2563eb; --primary-dark: #1e3a8a; --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --dark: #1e293b; --light: #f8fafc; --gray: #64748b; --light-gray: #e2e8f0; --white: #ffffff; } * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; } body { background-color: var(--light); color: var(--dark); } header { background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%); color: white; padding: 1.5rem 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } .header-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; } .logo { font-size: 1.5rem; font-weight: 700; } .user-menu { display: flex; align-items: center; gap: 1rem; } .user-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: var(--white); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--primary); } .main-container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; } .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; /* Added wrap/gap */ } .page-title { font-size: 1.8rem; color: var(--primary-dark); font-weight: 700; } .schedule-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; background-color: var(--white); padding: 1rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); flex-wrap: wrap; gap: 1rem; /* Added wrap/gap */ } .week-navigation { display: flex; align-items: center; gap: 1rem; } .week-display { font-weight: 600; min-width: 200px; text-align: center; } .btn { padding: 0.5rem 1rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 0.5rem; } .btn-primary { background-color: var(--primary); color: white; } .btn-primary:hover { background-color: var(--primary-dark); } .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); } .btn-outline:hover { background-color: var(--light-gray); } .btn-danger { background-color: var(--danger); color: white; } .btn-danger:hover { background-color: #dc2626; } .schedule-container { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow-x: auto; } .schedule-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; } .schedule-table thead th { padding: 1rem 0.5rem; text-align: center; background-color: var(--primary); color: white; font-weight: 600; position: sticky; top: 0; z-index: 10; /* Ensure header stays on top */ } .schedule-table tbody td { padding: 0.5rem; text-align: center; background-color: var(--white); border: 1px solid var(--light-gray); } .schedule-table tbody tr { margin-bottom: 8px; } .employee-name { font-weight: 600; text-align: left; position: sticky; left: 0; background-color: var(--white); padding: 0.5rem 1rem; white-space: nowrap; z-index: 5; /* Ensure name stays above scrolling cells */ border-right: 1px solid var(--light-gray); } .shift { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500; white-space: nowrap; display: inline-block; /* Ensure bg color applies */ } .shift-morning { background-color: #dbeafe; color: #1e40af; } .shift-afternoon { background-color: #e0f2fe; color: #0c4a6e; } .shift-night { background-color: #ede9fe; color: #5b21b6; } .day-off { background-color: #f0fdf4; color: #166534; } .sick-leave { background-color: #fee2e2; color: #991b1b; } .vacation { background-color: #ffedd5; color: #9a3412; } .day-header { display: flex; flex-direction: column; gap: 0.25rem; } .day-name { font-weight: 600; font-size: 0.9rem; } .day-date { font-size: 0.8rem; opacity: 0.9; } .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1050; /* Ensure higher than sticky header */ justify-content: center; align-items: center; } .modal-content { background-color: var(--white); width: 90%; max-width: 600px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 2rem; max-height: 90vh; overflow-y: auto; } .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; } .modal-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); } .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray); } .form-group { margin-bottom: 1.5rem; } .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--dark); } .form-control { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; } .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); } .form-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; } .admin-controls { position: relative; } .edit-shift { cursor: pointer; color: var(--primary); font-size: 0.8rem; display: none; /* Hidden initially, shown on hover by CSS */ } .admin-controls:hover .edit-shift { display: inline; } .toast { position: fixed; bottom: 20px; right: 20px; background-color: var(--primary); color: white; padding: 1rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 1100; display: none; max-width: 300px; } .toast.show { display: block; animation: fadeIn 0.3s, fadeOut 0.3s 2.7s; } @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } } @media (max-width: 768px) { .schedule-controls { flex-direction: column; gap: 1rem; align-items: flex-start; } .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; } .employee-name { position: static; /* Override sticky on mobile */ border-right: none; border-bottom: 1px solid var(--light-gray); /* Separator */ } } </style> </head> <body> <header style="display:none;"> <!-- Hide schedule's own header --> </header> <div class="main-container"> <div class="page-header"> <h1 class="page-title">Employee Schedule</h1> <div> <!-- Add Employee / Edit / Delete Buttons (Visual Placeholders) --> <button class="btn btn-success" id="scheduleAddEmployeeBtn" title="Add New Employee (Placeholder)"> <i class="fas fa-plus"></i> Add Employee </button> <button class="btn btn-warning" id="scheduleEditEmployeeBtn" title="Edit Selected Employee (Placeholder)" disabled> <i class="fas fa-edit"></i> Edit Employee </button> <button class="btn btn-danger" id="scheduleDeleteEmployeeBtn" title="Delete Selected Employee (Placeholder)" disabled> <i class="fas fa-trash"></i> Delete Employee </button> </div> </div> <div class="schedule-controls"> <div class="week-navigation"> <button class="btn btn-outline" id="prevWeekBtn"> <i class="fas fa-chevron-left"></i> </button> <div class="week-display" id="weekDisplay">May 6 - May 12, 2025</div> <button class="btn btn-outline" id="nextWeekBtn"> <i class="fas fa-chevron-right"></i> </button> </div> <button class="btn btn-primary" id="saveScheduleBtn" style="display: none;"> <i class="fas fa-save"></i> Save Schedule </button> <button class="btn btn-secondary" id="sendRemindersBtn" style="display: none; background-color: var(--secondary);"> <i class="fas fa-envelope"></i> Send Reminders </button> </div> <div class="schedule-container"> <table class="schedule-table"> <thead> <tr> <th>Employee</th> <th> <div class="day-header"> <span class="day-name">Mon</span> <span class="day-date">May 6</span> </div> </th> <th> <div class="day-header"> <span class="day-name">Tue</span> <span class="day-date">May 7</span> </div> </th> <th> <div class="day-header"> <span class="day-name">Wed</span> <span class="day-date">May 8</span> </div> </th> <th> <div class="day-header"> <span class="day-name">Thu</span> <span class="day-date">May 9</span> </div> </th> <th> <div class="day-header"> <span class="day-name">Fri</span> <span class="day-date">May 10</span> </div> </th> <th> <div class="day-header"> <span class="day-name">Sat</span> <span class="day-date">May 11</span> </div> </th> <th> <div class="day-header"> <span class="day-name">Sun</span> <span class="day-date">May 12</span> </div> </th> </tr> </thead> <tbody> <!-- Rows loaded by JS --> </tbody> </table> </div> </div> <div class="toast" id="toastNotification"></div> <div class="modal" id="employeeModal"> <!-- Add/Edit Employee Modal (from schedule file - currently basic) --> <div class="modal-content"> <div class="modal-header"> <h2 class="modal-title">Manage Employee</h2> <button class="close-modal" id="closeEmployeeModal">&times;</button> </div> <form id="employeeForm"> <div class="form-group"> <label for="empName">Full Name</label> <input type="text" id="empName" class="form-control" required> </div> <div class="form-group"> <label for="empEmail">Email</label> <input type="email" id="empEmail" class="form-control" required> </div> <div class="form-group"> <label for="empPosition">Position</label> <input type="text" id="empPosition" class="form-control" required> </div> <div class="form-group"> <label for="empRole">Role</label> <select id="empRole" class="form-control" required> <option value="employee">Employee</option> <option value="supervisor">Supervisor</option> <option value="admin">Admin</option> </select> </div> <div class="form-actions"> <button type="button" class="btn btn-outline" id="cancelEmployeeBtn">Cancel</button> <button type="submit" class="btn btn-primary">Save Employee</button> </div> </form> </div> </div> <div class="modal" id="shiftModal"> <!-- Shift Edit Modal --> <div class="modal-content"> <div class="modal-header"> <h2 class="modal-title">Edit Shift</h2> <button class="close-modal" id="closeShiftModal">&times;</button> </div> <form id="shiftForm"> <div class="form-group"> <label for="shiftEmployee">Employee</label> <input type="text" id="shiftEmployee" class="form-control" readonly> </div> <div class="form-group"> <label for="shiftDate">Date</label> <input type="date" id="shiftDate" class="form-control" required> </div> <div class="form-group"> <label for="shiftType">Shift Type</label> <select id="shiftType" class="form-control" required> <option value="morning">Morning (9AM-5PM)</option> <option value="afternoon">Afternoon (12PM-8PM)</option> <option value="night">Night (5PM-1AM)</option> <option value="day-off">Day Off</option> <option value="sick-leave">Sick Leave</option> <option value="vacation">Vacation</option> <option value="custom">Custom</option> </select> </div> <div class="form-group" id="customShiftGroup" style="display: none;"> <label for="customShift">Custom Shift Times</label> <input type="text" id="customShift" class="form-control" placeholder="e.g., 10AM-6PM"> </div> <div class="form-group"> <label for="shiftNotes">Notes</label> <textarea id="shiftNotes" class="form-control" rows="3"></textarea> </div> <div class="form-actions"> <button type="button" class="btn btn-danger" id="deleteShiftBtn">Delete Shift</button> <button type="button" class="btn btn-outline" id="cancelShiftBtn">Cancel</button> <button type="submit" class="btn btn-primary">Save Changes</button> </div> </form> </div> </div> <script> /* Schedule Specific Script - executed when injected */ document.addEventListener('DOMContentLoaded', function() { /* Ensure this runs after main dashboard potentially sets currentUser */ console.log("Executing Employee Schedule Script..."); /* DOM elements specific to the schedule view */ const employeeModal = document.getElementById('employeeModal'); const shiftModal = document.getElementById('shiftModal'); const addEmployeeBtn = document.getElementById('scheduleAddEmployeeBtn'); /* Use new ID */ const sendRemindersBtn = document.getElementById('sendRemindersBtn'); const closeEmployeeModal = document.getElementById('closeEmployeeModal'); const closeShiftModal = document.getElementById('closeShiftModal'); const cancelEmployeeBtn = document.getElementById('cancelEmployeeBtn'); const cancelShiftBtn = document.getElementById('cancelShiftBtn'); const employeeForm = document.getElementById('employeeForm'); const shiftForm = document.getElementById('shiftForm'); const shiftTypeSelect = document.getElementById('shiftType'); /* Renamed */ const customShiftGroup = document.getElementById('customShiftGroup'); const deleteShiftBtn = document.getElementById('deleteShiftBtn'); const prevWeekBtn = document.getElementById('prevWeekBtn'); const nextWeekBtn = document.getElementById('nextWeekBtn'); const weekDisplay = document.getElementById('weekDisplay'); const saveScheduleBtn = document.getElementById('saveScheduleBtn'); const scheduleTableBody = document.querySelector('.schedule-table tbody'); const shiftDateInput = document.getElementById('shiftDate'); const toastNotification = document.getElementById('toastNotification'); /* Check if main dashboard provides a toast function */ /* Access global dashboard data if needed (use cautiously) */ const scheduleCurrentUser = window.currentUser || { name: "Admin User", email: "admin@company.com", role: "admin" }; /* Fallback */ const scheduleMockUsers = window.MOCK_USERS || [ /* Provide fallback if needed */ { id: 1, name: 'Mohamed Elmenisy', email: 'mohamed@example.com' }, { id: 2, name: 'Yousef', email: 'yousef@example.com' }, { id: 3, name: 'Esraa Lashin', email: 'esraa@example.com' }, { id: 4, name: 'Bassant Badr', email: 'bassant@example.com' }, { id: 5, name: 'Nada Mahmoud', email: 'nada@example.com'} ]; /* Use mock users from global scope */ /* Use global toast function if available */ const showScheduleToast = window.showToast || function(message, type = 'success') { console.log(`SCHEDULE TOAST (${type}): ${message}`); if (toastNotification) { toastNotification.textContent = message; toastNotification.style.backgroundColor = type === 'success' ? 'var(--primary)' : 'var(--danger)'; toastNotification.classList.add('show'); setTimeout(() => { toastNotification.classList.remove('show'); }, 3000); } }; /* --- Schedule State --- */ let currentScheduleWeekStart = new Date(2025, 4, 5); /* Initial date (May 5th 2025 is a Monday) */ const scheduleMinDate = new Date(2025, 4, 1); const scheduleMaxDate = new Date(2025, 4, 31); /* --- Schedule Functions --- */ function updateWeekDisplayAndTable() { const weekEnd = new Date(currentScheduleWeekStart); weekEnd.setDate(weekEnd.getDate() + 6); const options = { month: 'short', day: 'numeric' }; const startStr = currentScheduleWeekStart.toLocaleDateString('en-US', options); const endStr = weekEnd.toLocaleDateString('en-US', options); const year = currentScheduleWeekStart.getFullYear(); if(weekDisplay) weekDisplay.textContent = `${startStr} - ${endStr}, ${year}`; /* Update header dates */ const headerDateCells = document.querySelectorAll('.day-date'); const headerDayCells = document.querySelectorAll('.day-name'); const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']; const tempDate = new Date(currentScheduleWeekStart); headerDateCells.forEach((cell, index) => { const dateStr = tempDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); cell.textContent = dateStr; if (headerDayCells[index]) headerDayCells[index].textContent = days[index]; tempDate.setDate(tempDate.getDate() + 1); }); /* Disable nav buttons */ const prevWeek = new Date(currentScheduleWeekStart); prevWeek.setDate(prevWeek.getDate() - 7); if(prevWeekBtn) prevWeekBtn.disabled = prevWeek < scheduleMinDate; const nextWeek = new Date(weekEnd); nextWeek.setDate(nextWeek.getDate() + 1); if(nextWeekBtn) nextWeekBtn.disabled = nextWeek > scheduleMaxDate; renderScheduleTable(); /* Re-render table content */ } function renderScheduleTable() { if (!scheduleTableBody) return; scheduleTableBody.innerHTML = ''; /* Clear existing rows */ scheduleMockUsers.forEach(emp => { const row = document.createElement('tr'); const nameCell = document.createElement('td'); nameCell.classList.add('employee-name'); nameCell.textContent = emp.name; row.appendChild(nameCell); const tempDate = new Date(currentScheduleWeekStart); for (let i = 0; i < 7; i++) { const cell = document.createElement('td'); cell.classList.add('admin-controls'); /* Add controls class */ const shiftDiv = document.createElement('div'); shiftDiv.classList.add('shift'); /* --- Mock Shift Logic --- */ const dayOfWeek = tempDate.getDay(); /* 0=Sun, 1=Mon,... */ let shiftType = 'morning'; /* Default */ let shiftText = '9AM-5PM'; if (emp.id === 1) { /* Mohamed */ if (i === 2) { shiftType = 'afternoon'; shiftText = '12PM-8PM'; } else if (i === 4) { shiftType = 'day-off'; shiftText = 'OFF'; } else if (i >= 5) { shiftType = 'night'; shiftText = '5PM-1AM'; } } else if (emp.id === 2) { /* Yousef */ if (i === 0 || i === 3) { shiftType = 'afternoon'; shiftText = '12PM-8PM'; } else if (i >= 5) { shiftType = 'day-off'; shiftText = 'OFF'; } } else if (emp.id === 3) { /* Esraa */ if (i < 2) { shiftType = 'night'; shiftText = '5PM-1AM'; } else if (i === 2) { shiftType = 'day-off'; shiftText = 'OFF'; } else if (i === 4) { shiftType = 'afternoon'; shiftText = '12PM-8PM'; } else if (i === 6) { shiftType = 'sick-leave'; shiftText = 'SICK'; } } else if (emp.id === 4) { /* Bassant */ if (i < 2) { shiftType = 'vacation'; shiftText = 'VAC'; } else if (i === 3 || i === 4) { shiftType = 'night'; shiftText = '5PM-1AM'; } else if (i === 5) { shiftType = 'day-off'; shiftText = 'OFF'; } } else { /* Default for new users like Nada */ if (dayOfWeek === 0 || dayOfWeek === 6) { /* Sun/Sat */ shiftType = 'day-off'; shiftText = 'OFF'; } else { shiftType = 'morning'; shiftText = '9AM-5PM'; } } /* --- End Mock Shift --- */ shiftDiv.classList.add(`shift-${shiftType}`); shiftDiv.textContent = shiftText; cell.appendChild(shiftDiv); /* Add Edit Link if Admin/Supervisor */ if (scheduleCurrentUser.role === 'admin' || scheduleCurrentUser.role === 'supervisor') { const editSpan = document.createElement('span'); editSpan.classList.add('edit-shift'); editSpan.dataset.emp = emp.id; editSpan.dataset.dayIndex = i; /* Store day index (0-6) */ editSpan.textContent = '(edit)'; editSpan.addEventListener('click', handleEditShiftClick); cell.appendChild(editSpan); } row.appendChild(cell); tempDate.setDate(tempDate.getDate() + 1); } scheduleTableBody.appendChild(row); }); } function handleEditShiftClick(event) { if (scheduleCurrentUser.role !== 'admin' && scheduleCurrentUser.role !== 'supervisor') return; const empId = parseInt(event.target.getAttribute('data-emp')); const dayIndex = parseInt(event.target.getAttribute('data-day-index')); const employee = scheduleMockUsers.find(e => e.id === empId); const shiftCell = event.target.closest('td'); const shiftDiv = shiftCell.querySelector('.shift'); if (employee && shiftDiv && dayIndex >= 0 && dayIndex < 7) { const date = new Date(currentScheduleWeekStart); date.setDate(date.getDate() + dayIndex); document.getElementById('shiftEmployee').value = employee.name; const formattedDate = date.toISOString().split('T')[0]; shiftDateInput.value = formattedDate; shiftDateInput.min = '2025-05-01'; shiftDateInput.max = '2025-05-31'; /* Determine current type from class */ let currentType = 'morning'; /* Default */ if (shiftDiv.classList.contains('shift-afternoon')) currentType = 'afternoon'; else if (shiftDiv.classList.contains('shift-night')) currentType = 'night'; else if (shiftDiv.classList.contains('day-off')) currentType = 'day-off'; else if (shiftDiv.classList.contains('sick-leave')) currentType = 'sick-leave'; else if (shiftDiv.classList.contains('vacation')) currentType = 'vacation'; shiftTypeSelect.value = currentType; /* Store cell info for saving */ shiftModal.dataset.empId = empId; shiftModal.dataset.dayIndex = dayIndex; shiftModal.dataset.cellId = shiftCell.id || `cell-${empId}-${dayIndex}`; if (!shiftCell.id) shiftCell.id = shiftModal.dataset.cellId; /* Assign temporary ID if needed */ shiftModal.style.display = 'flex'; } } /* --- Schedule Event Listeners --- */ if (prevWeekBtn) prevWeekBtn.addEventListener('click', function() { currentScheduleWeekStart.setDate(currentScheduleWeekStart.getDate() - 7); updateWeekDisplayAndTable(); }); if (nextWeekBtn) nextWeekBtn.addEventListener('click', function() { currentScheduleWeekStart.setDate(currentScheduleWeekStart.getDate() + 7); updateWeekDisplayAndTable(); }); if(shiftTypeSelect) shiftTypeSelect.addEventListener('change', function() { if(customShiftGroup) customShiftGroup.style.display = this.value === 'custom' ? 'block' : 'none'; }); /* Add Employee Button (Opens a simple modal for now) */ if(addEmployeeBtn) addEmployeeBtn.addEventListener('click', function() { console.log("Add employee button clicked (Schedule scope)"); if (employeeModal) { document.getElementById('employeeForm').reset(); /* Clear form */ document.querySelector('#employeeModal .modal-title').textContent = "Add New Employee"; employeeModal.style.display = 'flex'; } else { showScheduleToast("Employee management modal not found.", "error"); } }); if(closeEmployeeModal) closeEmployeeModal.addEventListener('click', function() { if(employeeModal) employeeModal.style.display = 'none'; }); if(cancelEmployeeBtn) cancelEmployeeBtn.addEventListener('click', function() { if(employeeModal) employeeModal.style.display = 'none'; }); if(closeShiftModal) closeShiftModal.addEventListener('click', function() { if(shiftModal) shiftModal.style.display = 'none'; }); if(cancelShiftBtn) cancelShiftBtn.addEventListener('click', function() { if(shiftModal) shiftModal.style.display = 'none'; }); /* Handle backdrop click for modals */ window.addEventListener('click', function(event) { if (event.target === employeeModal) employeeModal.style.display = 'none'; if (event.target === shiftModal) shiftModal.style.display = 'none'; }); /* Employee Form Submit (Basic Add/Update Simulation) */ if(employeeForm) employeeForm.addEventListener('submit', function(e) { e.preventDefault(); const name = document.getElementById('empName').value; /* Simulate adding/updating - In real app, update MOCK_USERS and re-render */ showScheduleToast(`Employee ${name} saved (simulated).`); employeeModal.style.display = 'none'; renderScheduleTable(); /* Re-render to show changes */ }); /* Shift Edit Form Submit */ if(shiftForm) shiftForm.addEventListener('submit', function(e) { e.preventDefault(); const shiftTypeValue = shiftTypeSelect.value; const customShift = document.getElementById('customShift').value; const empId = shiftModal.dataset.empId; const dayIndex = shiftModal.dataset.dayIndex; const cellId = shiftModal.dataset.cellId; const currentCell = document.getElementById(cellId); const employeeName = document.getElementById('shiftEmployee').value; if (currentCell) { const existingShift = currentCell.querySelector('.shift'); if (existingShift) currentCell.removeChild(existingShift); let shiftDiv = document.createElement('div'); shiftDiv.className = 'shift'; let shiftText = ''; switch(shiftTypeValue) { case 'morning': shiftDiv.classList.add('shift-morning'); shiftText = '9AM-5PM'; break; case 'afternoon': shiftDiv.classList.add('shift-afternoon'); shiftText = '12PM-8PM'; break; case 'night': shiftDiv.classList.add('shift-night'); shiftText = '5PM-1AM'; break; case 'day-off': shiftDiv.classList.add('day-off'); shiftText = 'OFF'; break; case 'sick-leave': shiftDiv.classList.add('sick-leave'); shiftText = 'SICK'; break; case 'vacation': shiftDiv.classList.add('vacation'); shiftText = 'VAC'; break; case 'custom': shiftDiv.classList.add('shift-morning'); /* Default style for custom */ shiftText = customShift || 'Custom'; break; default: shiftDiv.classList.add('shift-morning'); shiftText = '9AM-5PM'; break; } shiftDiv.textContent = shiftText; const editLink = currentCell.querySelector('.edit-shift'); currentCell.insertBefore(shiftDiv, editLink); /* Also update mock data if needed for persistence simulation */ /* TODO: Update mockScheduleData if using it */ showScheduleToast(`Shift for ${employeeName} updated!`); } shiftModal.style.display = 'none'; }); /* Delete Shift Button */ if(deleteShiftBtn) deleteShiftBtn.addEventListener('click', function() { const employeeName = document.getElementById('shiftEmployee').value; const cellId = shiftModal.dataset.cellId; const currentCell = document.getElementById(cellId); if (currentCell) { const shiftDiv = currentCell.querySelector('.shift'); if (shiftDiv) { currentCell.removeChild(shiftDiv); showScheduleToast(`Shift for ${employeeName} deleted!`, 'danger'); } } shiftModal.style.display = 'none'; }); /* Save Schedule Button */ if(saveScheduleBtn) saveScheduleBtn.addEventListener('click', function() { /* Use global function if available */ showScheduleToast('Schedule saved (simulated)!'); }); /* Send Reminders Button */ if(sendRemindersBtn) sendRemindersBtn.addEventListener('click', function() { /* Use global function if available */ const subject = encodeURIComponent('Upcoming Work Schedule Reminder'); const body = encodeURIComponent(`Dear Team,\n\nThis is a reminder of your upcoming work schedule for the week of ${weekDisplay ? weekDisplay.textContent : 'this week'}.\n\nPlease review your shifts.\n\nBest regards,\n${scheduleCurrentUser.name}`); const recipientEmails = scheduleMockUsers.map(e => e.email).join(','); const mailtoLink = `mailto:?bcc=${recipientEmails}&subject=${subject}&body=${body}`; try { window.open(mailtoLink, '_blank').focus(); } catch (e) { console.error("Could not open mailto link", e); showScheduleToast("Could not open email client.", "error"); } showScheduleToast('Reminder email prepared (simulated).'); }); /* Initial setup */ if (scheduleCurrentUser.role === 'admin' || scheduleCurrentUser.role === 'supervisor') { if(saveScheduleBtn) saveScheduleBtn.style.display = 'flex'; if(sendRemindersBtn) sendRemindersBtn.style.display = 'flex'; /* Add/Edit/Delete buttons already visible */ } updateWeekDisplayAndTable(); /* Initial render */ }); /* End of Schedule Specific Script */ </script> </body> </html>
                                <!-- END OF INJECTED employee-schedule.txt CONTENT -->
                            `;
                            // This content includes its own <style> and <script>
                            // When injected via innerHTML, the browser handles parsing them.
                        }
                        // Add cases for other features here
                        // else if (featureId === 'projects') { ... }
                        else {
                            // Default placeholder for unimplemented features
                            featureSectionsContainer.innerHTML = ''; // Clear loading
                            featurePlaceholder.style.display = 'flex';
                            featureTitleEl.textContent = featureName;
                            featureDescEl.textContent = `Content for ${featureName} would be loaded here. This feature is not yet implemented.`;
                            featureSectionsContainer.appendChild(featurePlaceholder); // Re-add placeholder
                        }

                        // Inject the final HTML
                        if (contentHTML) {
                            featureSectionsContainer.innerHTML = contentHTML;
                            // NOTE: Scripts included via innerHTML might not execute reliably in all browsers/scenarios.
                            // The provided schedule.txt has its script inside <body> which usually works.
                            // A more robust method involves parsing the HTML, finding script tags, creating new script elements, and appending them.
                            // For this example, relying on the browser's parsing of the injected content.
                        }

                    } catch (error) {
                        console.error(`Error loading feature ${featureId}:`, error);
                        featureSectionsContainer.innerHTML = ''; // Clear
                        featurePlaceholder.style.display = 'flex';
                        featureLoadingEl.style.display = 'none';
                        featureErrorEl.textContent = `Failed to load ${featureName}. Error: ${error.message}`;
                        featureErrorEl.style.display = 'block';
                        featureSectionsContainer.appendChild(featurePlaceholder); // Show placeholder with error
                    }
                }, 300); // Reduced delay slightly
            }


            function updateBrowserHistory(featureId, settingsTab = null) { /* (Keep existing logic) */ }
            function handleInitialNavigation() { /* (Keep existing logic) */ }
            window.addEventListener('popstate', function(event) { handleInitialNavigation(); });

            // --- Data Loading & Simulation ---
            function loadInitialData() { /* (Keep existing logic - loads dashboard stats, activities, notifs) */ }
            function loadDashboardStats() { /* (Keep existing logic) */ }
            function updateStatCard(id, title, iconClass, value, trendPercent) { /* (Keep existing logic) */ }
            function loadRecentActivities(showAll = false) { /* (Keep existing logic) */ }
            function loadNotifications() { /* (Keep existing logic) */ }
            function renderNotifications() { /* (Keep existing logic) */ }
            function loadTeamMembers() { /* (Keep existing logic - for settings panel) */ }

            // --- Dynamic Updates Simulation ---
            function startDynamicUpdates() { /* (Keep existing logic - intervals for stats, activity, notifs, welcome bg) */ }
            function changeWelcomeBackground() { /* (Keep existing logic) */ }

            // --- Event Listeners ---
            function setupEventListeners() {
                // (Keep ALL existing event listeners for sidebar, menu, back button, user dropdown, search,
                // notifications modal, activity list, profile form, settings controls, 2FA, danger zone,
                // confirm modal, team management modals etc.)
                // **No schedule-specific listeners should be here anymore.**
                 if (sidebarToggle) sidebarToggle.addEventListener('click', () => { /* ... */ });
                 if (closeSidebar) closeSidebar.addEventListener('click', () => { /* ... */ });
                 document.addEventListener('click', (event) => { /* ... close sidebar ... */ });
                 menuItems.forEach(item => { item.addEventListener('click', function(e) { /* ... setActiveFeature ... */ }); });
                 document.body.addEventListener('click', function(e) { /* ... settings tabs/links ... */ });
                 backButton.addEventListener('click', function() { setActiveFeature('dashboard'); });
                 userProfileContainer.addEventListener('click', function(e) { /* ... dropdown toggle ... */ });
                 document.addEventListener('click', function(event) { /* ... close dropdown ... */ });
                 searchInput.addEventListener('input', handleSearch);
                 searchInput.addEventListener('focus', handleSearch);
                 document.addEventListener('click', (event) => { /* ... hide search results ... */ });
                 searchResultsContainer.addEventListener('click', (event) => { /* ... handle search click ... */ });
                 notificationIcon.addEventListener('click', () => { /* ... show notifications modal ... */ });
                 closeNotifications.addEventListener('click', () => { /* ... hide notifications modal ... */ });
                 notificationsModal.addEventListener('click', (event) => { /* ... hide notifications modal backdrop ... */ });
                 notificationsBody.addEventListener('click', (event) => { /* ... handle notification item/delete click ... */ });
                 markAllReadBtn.addEventListener('click', markAllNotificationsAsRead);
                 deleteAllNotificationsBtn.addEventListener('click', () => { /* ... confirm delete all notifications ... */ });
                 activityList.addEventListener('click', (event) => { /* ... handle activity delete click ... */ });
                 viewAllActivity.addEventListener('click', () => { loadRecentActivities(!showingAllActivities); });
                 deleteAllActivity.addEventListener('click', () => { /* ... confirm delete all activities ... */ });
                 profileAvatarLarge.addEventListener('click', () => { profileAvatarInput.click(); });
                 profileAvatarInput.addEventListener('change', handleAvatarUpload);
                 profileForm.addEventListener('submit', handleProfileSave);
                 cancelProfileBtn.addEventListener('click', handleProfileCancel);
                 firstNameInput.addEventListener('input', updateFullNameDisplay);
                 lastNameInput.addEventListener('input', updateFullNameDisplay);
                 logoutLink.addEventListener('click', handleLogout);
                 const teamListContainer = document.getElementById('teamList');
                 if (teamListContainer) { teamListContainer.addEventListener('click', (event) => { /* ... handle edit/remove member clicks ... */ }); }
                 if (editMemberForm) { editMemberForm.addEventListener('submit', handleEditMemberSave); }
                 if(editMemberModal) { editMemberModal.querySelectorAll('[data-close-modal]').forEach(btn => { /* ... */ }); editMemberModal.addEventListener('click', (event) => { /* ... */ }); }
                 const inviteMemberForm = document.getElementById('inviteMemberForm');
                 if (inviteMemberForm) { inviteMemberForm.addEventListener('submit', handleInviteMember); }
                 themeOptions.forEach(option => { option.addEventListener('click', () => setTheme(option.dataset.theme)); });
                 if (highContrastToggle) highContrastToggle.addEventListener('change', (e) => setContrast(e.target.checked));
                 if (languageSelect) languageSelect.addEventListener('change', (e) => applyLanguage(e.target.value));
                 if (regionSelect) regionSelect.addEventListener('change', (e) => localStorage.setItem('region', e.target.value));
                 if (timeFormatSelect || dateFormatSelect) { const applyDateTimeListener = () => { /* ... */ }; if (timeFormatSelect) timeFormatSelect.addEventListener('change', applyDateTimeListener); if (dateFormatSelect) dateFormatSelect.addEventListener('change', applyDateTimeListener); }
                 if (toastToggle) toastToggle.addEventListener('change', (e) => applyToastPreference(e.target.checked));
                 if (soundToggle) soundToggle.addEventListener('change', (e) => applySoundPreference(e.target.checked));
                 if(savePreferencesBtn) savePreferencesBtn.addEventListener('click', handleSavePreferences);
                 if(changePasswordForm) changePasswordForm.addEventListener('submit', handleChangePassword);
                 if(saveAccountSettingsBtn) saveAccountSettingsBtn.addEventListener('click', handleSaveAccountSettings);
                 if(saveSessionSettingsBtn) saveSessionSettingsBtn.addEventListener('click', handleSaveSessionSettings);
                 if(saveNotificationSettingsBtn) saveNotificationSettingsBtn.addEventListener('click', handleSaveNotificationSettings);
                 if (enable2faBtn) enable2faBtn.addEventListener('click', handleEnable2FA);
                 if (setupAuthAppBtn) setupAuthAppBtn.addEventListener('click', showAuthAppSetup);
                 if (setupSmsBtn) setupSmsBtn.addEventListener('click', showSmsSetup);
                 if (verifyAuthCodeBtn) verifyAuthCodeBtn.addEventListener('click', handleVerifyAuthCode);
                 if (sendSmsCodeBtn) sendSmsCodeBtn.addEventListener('click', handleSendSmsCode);
                 if (verifySmsCodeBtn) verifySmsCodeBtn.addEventListener('click', handleVerifySmsCode);
                 if (disable2faBtn) disable2faBtn.addEventListener('click', handleDisable2FA);
                 if(logoutAllDevicesBtn) logoutAllDevicesBtn.addEventListener('click', handleLogoutAllDevices);
                 if(deleteAccountBtn) deleteAccountBtn.addEventListener('click', handleDeleteAccount);
                 cancelConfirmBtn.addEventListener('click', hideConfirmModal);
                 confirmBtn.addEventListener('click', () => { if (confirmCallback) confirmCallback(); hideConfirmModal(); });
            }

            // --- Specific Feature Logic ---
            function setupResponsiveSidebar() { /* (Keep existing logic) */ }

            // --- Search Logic ---
            function handleSearch() { /* (Keep existing logic) */ }

            // --- Profile Logic ---
            function handleAvatarUpload(event) { /* (Keep existing logic) */ }
            function updateFullNameDisplay() { /* (Keep existing logic) */ }
            function handleProfileSave(event) { /* (Keep existing logic) */ }
            function handleProfileCancel() { /* (Keep existing logic) */ }

            // --- Settings Save Logic ---
            function handleSavePreferences() { /* (Keep existing logic) */ }
            function handleSaveAccountSettings() { /* (Keep existing logic) */ }
            function handleChangePassword(event) { /* (Keep existing logic) */ }
            function handleSaveSessionSettings() { /* (Keep existing logic) */ }
            function handleSaveNotificationSettings() { /* (Keep existing logic) */ }

            // --- 2FA Logic ---
            function update2FA_UI() { /* (Keep existing logic) */ }
            function handleEnable2FA() { /* (Keep existing logic) */ }
            function showAuthAppSetup() { /* (Keep existing logic) */ }
            function showSmsSetup() { /* (Keep existing logic) */ }
            function handleVerifyAuthCode() { /* (Keep existing logic) */ }
            function handleSendSmsCode() { /* (Keep existing logic) */ }
            function handleVerifySmsCode() { /* (Keep existing logic) */ }
            function handleDisable2FA() { /* (Keep existing logic) */ }

            // --- Danger Zone Logic ---
            function handleLogoutAllDevices() { /* (Keep existing logic) */ }
            function handleDeleteAccount() { /* (Keep existing logic) */ }

            // --- Notification Logic ---
            function markAllNotificationsAsRead() { /* (Keep existing logic) */ }
            function playNotificationSound() { /* (Keep existing logic) */ }

            // --- Logout Logic ---
            function handleLogout(event) { /* (Keep existing logic) */ }

            // --- Team Management Logic (in Settings) ---
            function handleInviteMember(event) { /* (Keep existing logic) */ }
            function openEditMemberModal(memberId) { /* (Keep existing logic) */ }
            function handleEditMemberSave(event) { /* (Keep existing logic) */ }

            // --- Employee Scheduling ---
            // NOTE: The specific functions like getEmployeeScheduleHTML, initializeEmployeeScheduleLogic,
            // renderSchedule, handleEditShiftClick etc. are NO LONGER DEFINED HERE.
            // They are now part of the script block that gets injected by loadFeatureContent
            // when 'employee-scheduling' is loaded.

             // --- Utility Functions ---
             // Make utilities globally accessible if needed by injected scripts
             window.timeAgo = timeAgo;
             window.formatDateForDisplay = formatDateForDisplay;
             window.formatFullDateTime = formatFullDateTime;
             window.showToast = showToast; // Expose the main toast function
             window.showConfirmModal = showConfirmModal; // Expose confirm modal
             window.showSuccessMessage = showSuccessMessage; // Expose success message
             window.currentUser = currentUser; // Expose current user data
             window.MOCK_USERS = MOCK_USERS; // Expose mock users data (careful with mutations)


            function timeAgo(timestamp) { /* (Keep existing logic) */ }
            function formatDateForDisplay(date) { /* (Keep existing logic) */ }
            function formatFullDateTime(date) { /* (Keep existing logic) */ }
            function generateMockActivities(count, baseTimestampMillis) { /* (Keep existing logic) */ }
            function generateMockNotifications(count, baseTimestampMillis) { /* (Keep existing logic) */ }
            function showConfirmModal(title, message, onConfirm, buttonClass = 'btn-danger') { /* (Keep existing logic) */ }
            function hideConfirmModal() { /* (Keep existing logic) */ }
            function showSuccessMessage(message) { /* (Keep existing logic) */ }
            function showToast(message, type = 'info') { /* (Keep existing logic) */ }


            // --- Start Application ---
            initDashboard();

             // Expose MOCK_USERS and currentUser globally AFTER initDashboard sets currentUser
             window.currentUser = currentUser;
             window.MOCK_USERS = MOCK_USERS; // Make it available for the schedule script
        });
    </script>
</body>
</html>

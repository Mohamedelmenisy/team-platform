<!DOCTYPE html>
<!-- Add lang="ar" and dir="rtl" if your dashboard is primarily Arabic -->
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome (Dashboard already includes it) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <!-- Use a consistent version -->
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">

    <style>
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e3a8a;
            --primary-light: #dbeafe;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;  /* Default Text Color (Dark in Light Mode) */
            --light: #f8fafc;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --white: #ffffff;
            --sidebar-width: 280px;
            --sidebar-bg: #1e3a8a;
            --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1);
            --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1);
            --success: #10b981;
            --team-manager: #ef4444; /* Keep for role color */
            --compact-padding: 0.5rem;
            --normal-padding: 1rem;
            --spacious-padding: 1.5rem;
            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); /* Light Blue */
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); /* Light Green */
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); /* Light Yellow */
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); /* Light Red */
            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1); /* Default welcome bg */

            /* High Contrast Variables (Initial basic setup) */
            --hc-text: #000000;
            --hc-background: #ffffff;
            --hc-primary: #0000ff;
            --hc-secondary: #008000;
            --hc-link: #0000ee;
            --hc-border: #000000;

            /* Text Color Variable (for request ✅ 2️⃣) - Aliased to existing variables */
            --text-color: var(--dark);

             /* Schedule specific */
             --schedule-weekend-bg: #f3f4f6; /* Light gray for weekend cells */
             --schedule-weekend-text: #9ca3af; /* Muted text for weekend OFF */

             /* Added Project Variables (Using Dashboard Variables) */
            --card-bg: var(--white);
            --body-bg: var(--primary-light); /* Use dashboard's light bg */
            --border-color: var(--light-gray);
            --shadow-color: rgba(0, 0, 0, 0.07);
            --shadow-hover-color: rgba(0, 0, 0, 0.1);
            --input-bg: var(--white);
            --input-border: var(--light-gray);
            --input-focus-border: var(--primary);
            --input-focus-shadow: rgba(37, 99, 235, 0.1);
            --heading-color: var(--dark);
            --text-muted: var(--gray);
            --primary-text: var(--white); /* Text on primary bg */
            --progress-bar-bg: var(--light-gray);
            --pin-btn-color: var(--gray);
            --pin-btn-active-color: var(--primary);
            --avatar-bg: var(--light-gray);
            --avatar-text: var(--primary-dark);
            --tooltip-bg: var(--dark);
            --tooltip-text: var(--light);
            --modal-backdrop-bg: rgba(0, 0, 0, 0.5);
            --section-divider-border: var(--light-gray);
            --title-wrapper-bg: var(--card-bg);
            --title-wrapper-accent: var(--primary);

             /* Project Status & Progress Colors (Light) - Aligned with dashboard vars */
            --status-planned-bg: #e0e7ff;
            --status-planned-text: #4338ca;
            --status-planned-progress: #6366f1;
            --status-in-progress-bg: #fffbeb;
            --status-in-progress-text: #b45309;
            --status-in-progress-progress: var(--warning); /* Use dashboard warning */
            --status-completed-bg: #d1fae5;
            --status-completed-text: #047857;
            --status-completed-progress: var(--success); /* Use dashboard success */
            --status-on-hold-bg: #f3f4f6;
            --status-on-hold-text: #4b5563;
            --status-on-hold-progress: var(--gray); /* Use dashboard gray */

             /* Project Deadline Colors (Light) */
            --deadline-near-color: #f97316; /* Orange */
            --deadline-overdue-color: var(--danger); /* Use dashboard danger */

            /* Project Action Button Specifics */
            --edit-btn-bg: var(--status-in-progress-progress);
            --edit-btn-text: var(--white); /* White text on orange */
            --edit-btn-hover: #d97706;
            --delete-btn-bg: var(--danger);
            --delete-btn-text: var(--white);
            --delete-btn-hover: #dc2626;

            /* Added Team Member Variables (Using Dashboard Variables) */
            --team-bg: var(--light); /* Use dashboard light background */
            --team-card-bg: var(--white);
            --team-card-hover-bg: #fdfdfd; /* Slight change */
            --team-border-color: var(--light-gray);
            --team-shadow-color: rgba(0, 0, 0, 0.05);
            --team-hover-shadow-color: rgba(0, 0, 0, 0.08);
            --team-text-primary: var(--dark); /* Dashboard's dark text */
            --team-text-secondary: var(--gray); /* Dashboard's gray text */
            --team-title-text: var(--dark);
            --team-title-bg: var(--light-gray); /* Use light gray for title bg */
            --team-admin-color: var(--danger); /* Use dashboard danger */
            --team-supervisor-color: var(--primary); /* Use dashboard primary */
            --team-senior-color: var(--success); /* Use dashboard success */
            --team-member-color: var(--gray); /* Use dashboard gray */
            --team-card-border-radius: 12px;
            --team-section-padding: 30px;
            --team-card-padding: 22px;
            --team-grid-gap: 28px;

        }
        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--body-bg); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* --- High Contrast Styles --- */
        body.high-contrast {
             --dark: var(--hc-text);
             --light: var(--hc-background);
             --gray: var(--hc-text);
             --light-gray: var(--hc-border);
             --white: var(--hc-background);
             --primary: var(--hc-primary);
             --primary-dark: var(--hc-primary);
             --primary-light: #e0e0ff;
             --secondary: var(--hc-secondary);
             --success: var(--hc-secondary); /* Map success to hc secondary */
             --danger: #ff0000; /* Pure red for hc danger */
             --warning: #ffa500; /* Orange for hc warning */
             --sidebar-bg: var(--hc-background);
             --sidebar-text: var(--hc-text);
             --sidebar-hover: #e0e0e0;
             --sidebar-active: #c0c0c0;
             --sidebar-divider: var(--hc-border);
             --text-color: var(--hc-text); /* High contrast text */
             --card-bg: var(--hc-background); /* Ensure card bg is hc background */
             --border-color: var(--hc-border);
             --input-bg: var(--hc-background);
             --input-border: var(--hc-border);
             --input-focus-border: var(--hc-primary);
             --input-focus-shadow: rgba(0, 0, 255, 0.25);
             --heading-color: var(--hc-text);
             --text-muted: var(--hc-text);
             --primary-text: var(--hc-background); /* Text on primary bg */
             --progress-bar-bg: var(--hc-border);
             --avatar-bg: var(--hc-border);
             --avatar-text: var(--hc-text);
             --tooltip-bg: var(--hc-text);
             --tooltip-text: var(--hc-background);
             --modal-backdrop-bg: rgba(0, 0, 0, 0.7);
             --section-divider-border: var(--hc-border);
             --title-wrapper-bg: var(--hc-background);
             --title-wrapper-accent: var(--hc-primary);
             --team-bg: var(--hc-background);
             --team-card-bg: var(--hc-background);
             --team-border-color: var(--hc-border);
             --team-text-primary: var(--hc-text);
             --team-text-secondary: var(--hc-text);
             --team-title-text: var(--hc-text);
             --team-title-bg: var(--hc-background);
             --team-admin-color: #ff0000; /* High contrast colors */
             --team-supervisor-color: #0000ff;
             --team-senior-color: #008000;
             --team-member-color: #000000;


             color: var(--text-color);
             background-color: var(--hc-background);
        }
        body.high-contrast .welcome-section,
        body.high-contrast .stat-card,
        body.high-contrast .top-nav,
        body.high-contrast .sidebar,
        body.high-contrast .activity-section,
        body.high-contrast .content-section,
        body.high-contrast #featureSectionsContainer.projects-feature .project-card, /* Scope hc */
        body.high-contrast #featureSectionsContainer.projects-feature .projects-header,
        body.high-contrast #featureSectionsContainer.projects-feature .project-controls,
        body.high-contrast #featureSectionsContainer.projects-feature .projects-title-wrapper,
        body.high-contrast #featureSectionsContainer.projects-feature .confirmation-modal,
        body.high-contrast #featureSectionsContainer.team-members-feature .team-members-section,
        body.high-contrast #featureSectionsContainer.team-members-feature .team-member-card,
        body.high-contrast #featureSectionsContainer.team-members-feature .team-members-section h2
         {
             background: var(--hc-background);
             border: 1px solid var(--hc-border);
             color: var(--text-color);
             background-image: none !important; /* Remove gradients */
         }
        body.high-contrast .btn,
        body.high-contrast .form-control,
        body.high-contrast .search-bar input,
        body.high-contrast #featureSectionsContainer.projects-feature .project-search-input, /* Scope hc */
        body.high-contrast #featureSectionsContainer.projects-feature .project-filter-select,
        body.high-contrast #featureSectionsContainer.projects-feature .project-actions .btn,
        body.high-contrast #featureSectionsContainer.projects-feature .modal-footer .btn,
        body.high-contrast #featureSectionsContainer.team-members-feature .team-filter input[type="text"],
        body.high-contrast #featureSectionsContainer.team-members-feature .member-role
         {
             border: 1px solid var(--hc-border);
             background-color: var(--hc-background);
             color: var(--hc-text);
         }
         body.high-contrast .btn-primary { background-color: var(--hc-primary); color: var(--hc-background); border: 1px solid var(--hc-border); }
         body.high-contrast .btn-danger { background-color: #ff0000; color: var(--hc-background); border: 1px solid var(--hc-border); }
         body.high-contrast .btn-warning { background-color: #ffa500; color: var(--hc-text); border: 1px solid var(--hc-border); }
         body.high-contrast .btn-success { background-color: #008000; color: var(--hc-background); border: 1px solid var(--hc-border); }
         body.high-contrast .btn-outline { border: 1px solid var(--hc-border); color: var(--hc-text); background: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.projects-feature .project-actions .btn-view { background-color: var(--hc-primary); color: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.projects-feature .project-actions .btn-edit { background-color: #ffa500; color: var(--hc-text); }
         body.high-contrast #featureSectionsContainer.projects-feature .project-actions .btn-delete { background-color: #ff0000; color: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.projects-feature .btn-confirm-delete { background-color: #ff0000; color: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.projects-feature .btn-cancel-delete { background-color: #e0e0e0; color: var(--hc-text); }
         body.high-contrast #featureSectionsContainer.team-members-feature .member-role.role-admin { background-color: #ff0000; color: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.team-members-feature .member-role.role-supervisor { background-color: #0000ff; color: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.team-members-feature .member-role.role-senior { background-color: #008000; color: var(--hc-background); }
         body.high-contrast #featureSectionsContainer.team-members-feature .member-role.role-member { background-color: #000000; color: var(--hc-background); }

         body.high-contrast .logo { color: var(--text-color); }
         body.high-contrast .logo-icon { color: var(--hc-primary); }
         body.high-contrast .menu-item { color: var(--text-color); border-left-color: transparent; }
         body.high-contrast .menu-item.active { background-color: #c0c0c0; border-left-color: var(--hc-primary); }
         body.high-contrast .stat-card { border-left-width: 3px; background: var(--hc-background); }
         body.high-contrast .welcome-section { background: var(--hc-background); color: var(--text-color); } /* Welcome text hc */
         body.high-contrast .welcome-subtitle,
         body.high-contrast .user-info-name,
         body.high-contrast .user-info-email span { color: var(--text-color); }
         body.high-contrast .progress-bar-container { background: var(--hc-border); }
         body.high-contrast .progress-bar { background: var(--hc-primary); }
         body.high-contrast .project-deadline.deadline-near span,
         body.high-contrast .project-deadline.deadline-near i { color: #ffa500; } /* HC Orange */
         body.high-contrast .project-deadline.deadline-overdue span,
         body.high-contrast .project-deadline.deadline-overdue i { color: #ff0000; } /* HC Red */
         body.high-contrast .project-status-tag { border: 1px solid var(--hc-border); }
         body.high-contrast .project-status-tag.status-planned { background: #e0e0ff; color: #00008b; }
         body.high-contrast .project-status-tag.status-in-progress { background: #fffacd; color: #8b4513; }
         body.high-contrast .project-status-tag.status-completed { background: #98fb98; color: #006400; }
         body.high-contrast .project-status-tag.status-on-hold { background: #d3d3d3; color: #000000; }
         body.high-contrast .team-member { background: var(--hc-border); color: var(--hc-text); border-color: var(--hc-background); }


        /* --- Sidebar Styles --- */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--white); color: var(--text-color); } /* Use text-color */
        .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; } /* Use text-color */
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--text-color); } /* Use text-color */
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; } /* Use text-color */
        .dropdown-item:hover { background-color: var(--light); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; } /* Adjusted height */
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section {
            background: var(--welcome-bg-current); /* Use variable */
            color: var(--white); /* Welcome section text is white by design */
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; /* Smooth background transition */
        }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--team-manager); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--secondary); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card {
            background: var(--white); /* Default */
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 5px solid var(--primary); /* Colored border instead of top gradient */
            color: var(--dark); /* Ensure text inside uses appropriate theme color */
        }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--secondary); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }

        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        /* .stat-card::before removed */
        .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; } /* Use text-color */
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { /* Color set dynamically or removed if not needed per card */ opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        /* Stat value colors are specific and contrast should be checked manually */
        .stat-card:nth-child(1) .stat-value { color: #1e40af; }
        .stat-card:nth-child(2) .stat-value { color: #15803d; }
        .stat-card:nth-child(3) .stat-value { color: #b45309; }
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; }

        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--text-color); } /* Use text-color */
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; } /* Added max-height and scroll */
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--light-gray); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--text-color); } /* Use text-color */
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--gray); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        /* Delete icon visible by default */
        .delete-activity {
            color: var(--danger);
            cursor: pointer;
            opacity: 0.6; /* Visible by default */
            transition: opacity 0.2s, background-color 0.2s;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .activity-item:hover .delete-activity {
             opacity: 1; /* Already visible, just make fully opaque on hover */
        }
        .delete-activity:hover {
            opacity: 1; background-color: rgba(239, 68, 68, 0.1);
        }

        /* --- Profile & Settings Sections Styles --- */
        .content-section { /* Shared styles already applied */ background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; } /* Hidden by default */
        .content-section.active { display: block; } /* Shown when active */
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; }
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; } /* Hide the button, use avatar click */

        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; } /* Use text-color */
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; background-color: var(--white); color: var(--text-color); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; } /* Use text-color */
        body.compact .form-control { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control { padding: 1rem; }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; } /* Added justify-content */
        body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--primary-dark); } /* Warning button style */
        .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: #dc2626; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: #0d9f6e; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; }
        @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        /* Settings Sub-section */
        .settings-subsection {
             margin-top: 2rem;
             padding-top: 1.5rem;
             border-top: 1px solid var(--light-gray);
        }
        .settings-subsection:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        .settings-subsection h4 {
             font-size: 1.1rem;
             font-weight: 600;
             color: var(--primary-dark);
             margin-bottom: 1rem;
        }
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; } /* Added wrap */
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; /* Default: Label takes full width */ }
        @media (min-width: 768px) { /* On larger screens, allow side-by-side */
            .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; }
        }
        .setting-item-label { font-weight: 500; color: var(--text-color); } /* Use text-color */
        .setting-item-description { font-size: 0.9rem; color: var(--gray); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
         @media (max-width: 767px) { /* Stack control below on small screens */
            .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; }
        }


        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--text-color); margin-bottom: 1rem; } /* Use text-color */
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--light-gray); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--white); }
        body.compact .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        .team-member-card:hover { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); border-color: var(--primary); }
        .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        .member-details { flex: 1; min-width: 0; }
        .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} /* Use text-color */
        body.compact .member-name { font-size: 0.9rem; }
        .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact .member-email { font-size: 0.8rem; }
        .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; }
        body.compact .member-role { font-size: 0.7rem; margin: 0 0.75rem; }
        .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .role-senior { background-color: rgba(37, 99, 235, 0.1); color: var(--primary); }
        .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .role-member { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        /* Invite form layout adjustment (already likely handled by this CSS) */
        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; /* Make spinner visible when inside button */ }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span { margin-left: 0.5rem; } /* Space between spinner and text */

        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }
        .loading-text { display: none; font-size: 0.9rem; color: var(--gray); margin-left: 0.5rem; }

        /* --- Theme Styles & Responsive --- */
        body.light-theme { --primary-light: #f1f5f9; --light: #ffffff; --white: #ffffff; --dark: #1e293b; --gray: #64748b; --light-gray: #e2e8f0; --text-color: var(--dark); background-color: var(--primary-light); }
        body.dark-theme {
            --primary: #3b82f6;
            --primary-dark: #1e40af;
            --primary-light: #1e293b;
            --light: #334155; /* Slightly lighter background for cards/sections */
            --white: #0f172a; /* Darkest background for body */
            --dark: #e2e8f0; /* Light text */
            --gray: #94a3b8; /* Lighter gray text */
            --light-gray: #475569; /* Darker borders/dividers */
            --text-color: var(--dark); /* Update text-color for dark mode */
            --schedule-weekend-bg: #262f3e; /* Darker gray for weekend cells */
            --schedule-weekend-text: #6b7280; /* Muted dark text for weekend OFF */
             /* Project Variable Overrides for Dark Mode */
             --card-bg: var(--light);
             --body-bg: var(--white); /* Use darkest for body */
             --border-color: var(--light-gray);
             --shadow-color: rgba(0, 0, 0, 0.2);
             --shadow-hover-color: rgba(0, 0, 0, 0.3);
             --input-bg: var(--primary-light);
             --input-border: var(--light-gray);
             --input-focus-border: #60a5fa;
             --input-focus-shadow: rgba(96, 165, 250, 0.25);
             --heading-color: var(--dark);
             --text-muted: var(--gray);
             --progress-bar-bg: var(--light-gray);
             --pin-btn-color: var(--gray);
             --pin-btn-active-color: var(--primary);
             --avatar-bg: var(--light-gray);
             --avatar-text: var(--dark);
             --tooltip-bg: var(--dark); /* Light tooltip on dark bg */
             --tooltip-text: var(--light);
             --modal-backdrop-bg: rgba(0, 0, 0, 0.7);
             --section-divider-border: var(--light-gray);
             --title-wrapper-bg: var(--card-bg);
             --title-wrapper-accent: var(--primary);
             /* Project Status & Progress Colors (Dark) */
             --status-planned-bg: #3730a3;
             --status-planned-text: #c7d2fe;
             --status-planned-progress: #818cf8;
             --status-in-progress-bg: #78350f;
             --status-in-progress-text: #fde68a;
             --status-in-progress-progress: #fbbf24; /* Dark warning */
             --status-completed-bg: #064e3b;
             --status-completed-text: #a7f3d0;
             --status-completed-progress: #34d399; /* Dark success */
             --status-on-hold-bg: #374151;
             --status-on-hold-text: #d1d5db;
             --status-on-hold-progress: var(--gray);
             /* Project Deadline Colors (Dark) */
             --deadline-near-color: #fb923c; /* Lighter Orange */
             --deadline-overdue-color: #f87171; /* Lighter Red (danger) */
              /* Project Action Button Specifics (Dark) */
             --edit-btn-bg: var(--status-in-progress-progress);
             --edit-btn-text: #1f2937; /* Dark text might be better */
             --edit-btn-hover: #f59e0b;
             --delete-btn-bg: var(--deadline-overdue-color); /* Use lighter red var */
             --delete-btn-text: var(--dark); /* Use dark text */
             --delete-btn-hover: #ef4444;

             /* Team Member Variable Overrides for Dark Mode */
            --team-bg: var(--white);
            --team-card-bg: var(--light);
            --team-border-color: var(--light-gray);
            --team-text-primary: var(--dark);
            --team-text-secondary: var(--gray);
            --team-title-text: var(--dark);
            --team-title-bg: var(--light);
            --team-admin-color: #f87171; /* Lighter red */
            --team-supervisor-color: #60a5fa; /* Lighter blue */
            --team-senior-color: #34d399; /* Lighter green */
            --team-member-color: var(--gray);


            background-color: var(--white); /* Use darkest for body */
            color: var(--text-color); /* Default text color */
        }
        /* Dark Theme General Overrides */
        body.dark-theme .top-nav { background-color: var(--light); border-bottom-color: var(--light-gray); } /* Lighter BG for nav */
        body.dark-theme .stat-card, body.dark-theme .activity-section, body.dark-theme .content-section, body.dark-theme .team-member-card, body.dark-theme .add-member-form { background-color: var(--light); border-color: var(--light-gray); } /* Lighter BG for content cards */
        body.dark-theme .search-bar input, body.dark-theme .form-control { background-color: var(--primary-light); border-color: var(--light-gray); color: var(--text-color); } /* Even darker BG for inputs */
        body.dark-theme .form-control[readonly] { background-color: var(--light); opacity: 0.6; }
        body.dark-theme .search-results { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .search-result-item { color: var(--text-color); } /* Ensure search result text is light */
        body.dark-theme .search-result-item:hover { background-color: var(--primary-light); }
        body.dark-theme .user-dropdown { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .dropdown-item { color: var(--text-color); } /* Ensure dropdown text is light */
        body.dark-theme .dropdown-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notifications-container { background-color: var(--light); } /* Lighter BG for notifications panel */
        body.dark-theme .notification-list-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } /* Slightly more visible unread */
        body.dark-theme .confirm-container, body.dark-theme .modal-content { background-color: var(--light); color: var(--text-color); } /* Modal background and default text */
        body.dark-theme .theme-option div { border-color: var(--light-gray); }
        body.dark-theme .theme-option.selected div { border-color: var(--primary); }
        body.dark-theme .back-button { color: var(--primary); } /* Use primary color for link */
        body.dark-theme .back-button:hover { background-color: var(--light); color: #60a5fa; border-color: var(--primary); }
        body.dark-theme .notifications-footer { background-color: var(--light); border-top-color: var(--light-gray); }
        body.dark-theme .welcome-section { background: var(--welcome-bg-current); color: var(--white); } /* Welcome section retains white text */
        body.dark-theme .welcome-subtitle { color: inherit; opacity: 0.8; } /* Inherit white */
        body.dark-theme .user-info-name { color: inherit; } /* Inherit white */
        body.dark-theme .user-info-title { color: var(--gray); } /* Role title uses gray */
        body.dark-theme .user-info-title.role-admin { color: var(--team-manager); }
        body.dark-theme .user-info-email span { color: inherit; } /* Inherit white */
        body.dark-theme .stat-card { background: var(--light); color: var(--text-color);} /* Dark theme stat card background, ensure text color */
        body.dark-theme .stat-title { color: var(--text-color); } /* Ensure stat title is light */
        /* Specific stat value colors adjusted for dark theme */
        body.dark-theme .stat-card:nth-child(1) .stat-value { color: #93c5fd; }
        body.dark-theme .stat-card:nth-child(2) .stat-value { color: #86efac; }
        body.dark-theme .stat-card:nth-child(3) .stat-value { color: #fcd34d; }
        body.dark-theme .stat-card:nth-child(4) .stat-value { color: #fca5a5; }
        body.dark-theme .activity-icon { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa; } /* Adjust icon color */
        body.dark-theme .activity-item { border-bottom-color: var(--light-gray); }
        body.dark-theme .activity-message { color: var(--text-color); } /* Activity text */
        body.dark-theme .activity-time { color: var(--gray); } /* Activity time */
        body.dark-theme .activity-item.new-activity { background-color: rgba(59, 130, 246, 0.1); }
        body.dark-theme .delete-activity:hover { background-color: rgba(239, 68, 68, 0.2); }
        body.dark-theme .profile-avatar-section label { color: var(--text-color); } /* Text label */
        body.dark-theme #profileAvatarLarge { background-color: var(--light); color: var(--text-color); border-color: var(--primary-light); }
        body.dark-theme .profile-header-text { color: var(--gray); } /* Profile intro text */
        body.dark-theme .placeholder-content { color: var(--gray); border-color: var(--light-gray); }
        body.dark-theme .placeholder-content h2 { color: var(--text-color); }
        body.dark-theme .placeholder-content p { color: var(--gray); }
        body.dark-theme .placeholder-content .error-message { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: var(--text-color); } /* Ensure error text readable */
        body.dark-theme .settings-label, body.dark-theme .form-group label { color: var(--text-color); } /* Form labels */
        body.dark-theme .settings-subsection h4 { color: #93c5fd; } /* Lighter primary */
        body.dark-theme .setting-item-label { color: var(--text-color); } /* Setting item title */
        body.dark-theme .setting-item-description { color: var(--gray); } /* Setting item description */
        body.dark-theme .theme-option span { color: var(--text-color); } /* Theme label text */
        body.dark-theme .qr-code-placeholder { border-color: var(--light-gray); color: var(--gray); }
        body.dark-theme .danger-zone-item .btn-danger { background-color: #dc2626; } /* Ensure danger button stands out */
        body.dark-theme .danger-zone-item .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        body.dark-theme .danger-zone-item p { color: var(--gray); } /* Danger zone description */

        /* Dark Theme Employee Scheduling Specifics */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table thead th, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table thead th { background-color: var(--primary); color: white; border-bottom-color: var(--primary-dark);}
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table tbody td { color: var(--text-color); border-color: var(--light-gray); } /* Ensure table cell text is light */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table tbody tr:nth-child(even) td,
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:nth-child(even) td.employee-name, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table tbody tr:nth-child(even) td.employee-name { background-color: var(--primary-light); } /* Darker even row background */
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table tbody tr:hover td,
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody tr:hover td.employee-name, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table tbody tr:hover td.employee-name { background-color: #475569; } /* Hover effect */
        body.dark-theme #featureSectionsContainer.employee-scheduling .employee-name, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .employee-name { background-color: var(--white); border-right-color: var(--light-gray); color: var(--text-color); } /* Dark sticky column bg */
        body.dark-theme #featureSectionsContainer.employee-scheduling .day-name, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .day-name { color: white; } /* Keep day name white */
        body.dark-theme #featureSectionsContainer.employee-scheduling .day-date, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .day-date { color: var(--gray); }
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .shift { /* Adjust shift colors for dark mode if needed, current ones might be okay */ }
        body.dark-theme #featureSectionsContainer.employee-scheduling .schedule-table tbody td.weekend-cell, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .schedule-table tbody td.weekend-cell { background-color: var(--schedule-weekend-bg); } /* Dark weekend bg */
        body.dark-theme #featureSectionsContainer.employee-scheduling .shift-weekend-off, /* Apply to task mgmt too */
        body.dark-theme #featureSectionsContainer.task-management-feature .shift-weekend-off { color: var(--schedule-weekend-text); background-color: transparent; border-color: transparent; }

        /* Dark Theme Task Management Specific Overrides (Based on original task.txt CSS) */
        /* These are integrated into the generic dark theme section above now */

        /* Dark Theme Project Section Overrides */
        body.dark-theme #featureSectionsContainer.projects-feature .project-card { background-color: var(--card-bg); border-color: var(--border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .projects-title-wrapper { background-color: var(--title-wrapper-bg); border-left-color: var(--title-wrapper-accent); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-controls { background-color: var(--card-bg); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-search-input,
        body.dark-theme #featureSectionsContainer.projects-feature .project-filter-select { background-color: var(--input-bg); border-color: var(--input-border); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .add-project-btn { background-color: var(--primary-color); color: var(--primary-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .add-project-btn:hover { background-color: var(--primary-hover); }
        body.dark-theme #featureSectionsContainer.projects-feature .pin-project-btn { background: rgba(0, 0, 0, 0.4); color: var(--pin-btn-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .pin-project-btn:hover { background: var(--primary-color); color: var(--primary-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .pin-project-btn.active { background: var(--primary-color); color: var(--primary-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-name { color: var(--heading-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .progress-bar-container { background-color: var(--progress-bar-bg); }
        body.dark-theme #featureSectionsContainer.projects-feature .progress-bar { color: var(--primary-text); /* Default text color */}
        body.dark-theme #featureSectionsContainer.projects-feature .status-in-progress ~ .progress-bar-container .progress-bar { color: var(--dark); /* Dark text on yellow bar */}
        body.dark-theme #featureSectionsContainer.projects-feature .project-info { color: var(--text-muted); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-info i { color: var(--text-muted); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-participants span { background-color: color-mix(in srgb, var(--card-bg) 80%, var(--text-muted) 20%); color: var(--text-color); border-color: var(--border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-status { /* Use dark mode status vars */ }
        body.dark-theme #featureSectionsContainer.projects-feature .project-status.status-planned { background-color: var(--status-planned-bg); color: var(--status-planned-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-status.status-in-progress { background-color: var(--status-in-progress-bg); color: var(--status-in-progress-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-status.status-completed { background-color: var(--status-completed-bg); color: var(--status-completed-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-status.status-on-hold { background-color: var(--status-on-hold-bg); color: var(--status-on-hold-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions { border-top-color: var(--border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn { /* Use dark mode button vars */ }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn-view { background-color: var(--primary-color); color: var(--primary-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn-view:hover { background-color: var(--primary-hover); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn-edit { background-color: var(--edit-btn-bg); color: var(--edit-btn-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn-edit:hover { background-color: var(--edit-btn-hover); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn-delete { background-color: var(--delete-btn-bg); color: var(--delete-btn-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-actions .btn-delete:hover { background-color: var(--delete-btn-hover); }
        body.dark-theme #featureSectionsContainer.projects-feature .confirmation-modal { background-color: var(--card-bg); border-color: var(--border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .modal-header h3 { color: var(--heading-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .modal-body p { color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .btn-confirm-delete { background-color: var(--delete-btn-bg); color: var(--delete-btn-text); }
        body.dark-theme #featureSectionsContainer.projects-feature .btn-confirm-delete:hover { background-color: var(--delete-btn-hover); }
        body.dark-theme #featureSectionsContainer.projects-feature .btn-cancel-delete { background-color: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .btn-cancel-delete:hover { background-color: var(--border-color); }
        body.dark-theme #featureSectionsContainer.projects-feature .project-filter-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%239ca3af'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E");
        }

        /* Dark Theme Team Members Overrides */
        body.dark-theme #featureSectionsContainer.team-members-feature .team-members-section { background-color: var(--team-bg); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-members-section h2 { background-color: var(--team-title-bg); color: var(--team-title-text); border-bottom-color: var(--team-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-filter input[type="text"] { background-color: var(--input-bg); border-color: var(--input-border); color: var(--text-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-filter input[type="text"]:focus { border-color: var(--input-focus-border); box-shadow: 0 0 0 3px var(--input-focus-shadow); }
        body.dark-theme #featureSectionsContainer.team-members-feature .team-member-card { background-color: var(--team-card-bg); border-color: var(--team-border-color); }
        body.dark-theme #featureSectionsContainer.team-members-feature .member-name { color: var(--team-text-primary); }
        body.dark-theme #featureSectionsContainer.team-members-feature .member-email { color: var(--team-text-secondary); }
        /* Role badge colors already use variables handled in dark theme mapping */


        body.dark-theme .checkbox-group { border-color: var(--light-gray); }
        body.dark-theme .checkbox-group label { color: var(--text-color); } /* Checkbox label text */
        body.dark-theme .confirm-title { color: var(--text-color); }
        body.dark-theme .confirm-message { color: var(--gray); }
        body.dark-theme .modal-title { color: #93c5fd; } /* Lighter primary */
        body.dark-theme .team-member-card .member-name { color: var(--text-color); }
        body.dark-theme .team-member-card .member-email { color: var(--gray); }
        body.dark-theme .search-result-item strong { color: var(--text-color); } /* Ensure bold text is readable */
        body.dark-theme .user-name { color: var(--text-color); } /* Top nav user name */

        /* ========================================== */
        /* === INTEGRATED PROJECTS SECTION STYLES === */
        /* ========================================== */

        /* Scoping class */
        #featureSectionsContainer.projects-feature {
            /* Add any specific container styles if needed, e.g., remove padding if component has its own */
             padding: 0; /* Remove default section padding */
             background-color: transparent; /* Let component control its bg */
             box-shadow: none; /* Remove default section shadow */
             border-radius: 0;
        }

        /* Reuse dashboard classes where possible, scope specific styles */
        #featureSectionsContainer.projects-feature #projects-section {
            width: 100%; /* Take full width */
            max-width: 100%; /* Override component's max-width */
            margin: 0 auto; /* Remove component margin */
            padding: 2rem; /* Add padding like content-area */
            transition: padding 0.3s ease;
        }
        body.compact #featureSectionsContainer.projects-feature #projects-section { padding: 1rem; }
        body.spacious #featureSectionsContainer.projects-feature #projects-section { padding: 3rem; }

        #featureSectionsContainer.projects-feature .projects-header {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            margin-bottom: 30px; gap: 20px;
        }

        #featureSectionsContainer.projects-feature .projects-title-wrapper {
            background-color: var(--title-wrapper-bg); padding: 18px 30px; border-radius: 10px;
            box-shadow: 0 3px 6px var(--shadow-color); flex-grow: 1;
            border-left: 6px solid var(--title-wrapper-accent);
            transition: background-color 0.3s ease, border-color 0.3s ease; min-width: 250px;
        }
        #featureSectionsContainer.projects-feature .projects-title-wrapper h2 {
            color: var(--heading-color); margin: 0; font-weight: 600;
            font-size: 1.9em; transition: color 0.3s ease; white-space: nowrap;
        }

        #featureSectionsContainer.projects-feature .project-controls {
            display: flex; flex-wrap: wrap; align-items: center; gap: 12px; padding: 12px 15px;
            background-color: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 5px var(--shadow-color);
            transition: background-color 0.3s ease;
        }

        #featureSectionsContainer.projects-feature .project-search-input,
        #featureSectionsContainer.projects-feature .project-filter-select {
            /* Use existing dashboard .form-control styles maybe? Or keep specific */
            padding: 10px 14px; border: 1px solid var(--input-border); border-radius: 6px;
            font-size: 0.95em; background-color: var(--input-bg); color: var(--text-color);
            transition: all 0.2s ease;
        }
        #featureSectionsContainer.projects-feature .project-search-input:focus,
        #featureSectionsContainer.projects-feature .project-filter-select:focus {
            outline: none; border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px var(--input-focus-shadow);
        }
        #featureSectionsContainer.projects-feature .project-search-input { min-width: 220px; }
        #featureSectionsContainer.projects-feature .project-filter-select {
             appearance: none; -webkit-appearance: none; -moz-appearance: none;
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%236c757d'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E");
             background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.1em 1.1em;
             padding-right: 2.5rem;
        }
        /* Dark mode arrow already handled by general dark theme rules */

        #featureSectionsContainer.projects-feature .add-project-btn {
             /* Use dashboard .btn styling and add specifics */
             padding: 10px 20px; font-size: 0.95em; white-space: nowrap;
             background-color: var(--primary-color); color: var(--primary-text);
             border: none; border-radius: 6px; font-weight: 500; cursor: pointer;
             transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px;
        }
        #featureSectionsContainer.projects-feature .add-project-btn i { font-size: 1em; }
        #featureSectionsContainer.projects-feature .add-project-btn:hover {
            background-color: var(--primary-hover); transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
        }

        #featureSectionsContainer.projects-feature .pinned-projects-divider {
            margin: 40px 0 25px 0; border: 0; border-top: 1px solid var(--section-divider-border);
            text-align: center; transition: border-color 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .pinned-projects-divider span {
            background-color: var(--body-bg); color: var(--text-muted); padding: 0 15px;
            position: relative; top: -0.7em; font-size: 0.9em; text-transform: uppercase;
            letter-spacing: 0.5px; font-weight: 500;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #featureSectionsContainer.projects-feature #pinned-projects-list:empty + .pinned-projects-divider { display: none; }
        #featureSectionsContainer.projects-feature #pinned-projects-list:empty { margin-bottom: 0; }

        #featureSectionsContainer.projects-feature #pinned-projects-list,
        #featureSectionsContainer.projects-feature #regular-projects-list {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 30px;
        }

        #featureSectionsContainer.projects-feature .project-card {
            background-color: var(--card-bg); border-radius: 12px; border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px var(--shadow-color); overflow: hidden; display: flex;
            flex-direction: column; transition: all 0.3s ease; position: relative;
        }
        #featureSectionsContainer.projects-feature .project-card:hover {
            transform: translateY(-5px); box-shadow: 0 10px 25px var(--shadow-hover-color);
            border-color: color-mix(in srgb, var(--border-color), var(--primary-color) 20%);
        }

        #featureSectionsContainer.projects-feature .pin-project-btn {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255, 255, 255, 0.7); /* Light mode default */
            border: none; border-radius: 50%; width: 32px; height: 32px;
            display: inline-flex; align-items: center; justify-content: center;
            color: var(--pin-btn-color); cursor: pointer; z-index: 5;
            transition: all 0.2s ease; font-size: 0.9em; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
         /* Dark mode background handled by dark theme variable overrides */
        #featureSectionsContainer.projects-feature .pin-project-btn:hover {
            background: var(--primary-color); color: var(--primary-text); transform: scale(1.1);
        }
        #featureSectionsContainer.projects-feature .pin-project-btn.active {
            background: var(--pin-btn-active-color); color: var(--primary-text);
        }
        #featureSectionsContainer.projects-feature .pin-project-btn.active:hover {
             background: var(--primary-hover);
        }

        #featureSectionsContainer.projects-feature .project-card-image {
            height: 190px; background-size: cover; background-position: center; position: relative;
        }
        #featureSectionsContainer.projects-feature .project-card-image::before { /* Optional subtle gradient overlay */
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 50%;
            background: linear-gradient(to top, rgba(0,0,0,0.2), transparent);
            opacity: 0.7; transition: opacity 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .project-card:hover .project-card-image::before { opacity: 0.4; }

        #featureSectionsContainer.projects-feature .project-card-body {
            padding: 20px 25px 25px 25px; display: flex; flex-direction: column; flex-grow: 1;
        }

        #featureSectionsContainer.projects-feature .project-name {
            font-size: 1.45em; font-weight: 600; color: var(--heading-color);
            margin-top: 0; margin-bottom: 8px; transition: color 0.3s ease; line-height: 1.3;
        }

        #featureSectionsContainer.projects-feature .progress-bar-container {
            width: 100%; height: 8px; background-color: var(--progress-bar-bg); border-radius: 4px;
            overflow: hidden; margin-bottom: 18px; transition: background-color 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .progress-bar {
            height: 100%; border-radius: 4px; transition: width 0.4s ease, background-color 0.3s ease;
            text-align: center; color: var(--primary-text); font-size: 0.7em; font-weight: 600; line-height: 8px;
            display: flex; align-items: center; justify-content: flex-end; padding-right: 5px;
            overflow: hidden; white-space: nowrap;
        }
        /* Status specific progress bar colors (using project vars mapped to dashboard vars) */
        #featureSectionsContainer.projects-feature .status-planned ~ .progress-bar-container .progress-bar { background-color: var(--status-planned-progress); }
        #featureSectionsContainer.projects-feature .status-in-progress ~ .progress-bar-container .progress-bar { background-color: var(--status-in-progress-progress); color: #1f2937; /* Dark text on yellow */ }
        #featureSectionsContainer.projects-feature .status-completed ~ .progress-bar-container .progress-bar { background-color: var(--status-completed-progress); }
        #featureSectionsContainer.projects-feature .status-on-hold ~ .progress-bar-container .progress-bar { background-color: var(--status-on-hold-progress); }


        #featureSectionsContainer.projects-feature .project-info-grid {
            display: grid; grid-template-columns: auto 1fr; gap: 8px 15px; margin-bottom: 18px;
            font-size: 0.9em; color: var(--text-muted); align-items: center;
        }
        #featureSectionsContainer.projects-feature .project-info-grid i {
            color: var(--text-muted); width: 16px; text-align: center;
            margin-right: 0; font-size: 1em; transition: color 0.3s ease;
        }

        #featureSectionsContainer.projects-feature .project-team { display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
        #featureSectionsContainer.projects-feature .team-member {
            display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px;
            border-radius: 50%; background-color: var(--avatar-bg); color: var(--avatar-text);
            font-size: 0.75em; font-weight: 600; border: 2px solid var(--card-bg); margin-left: -8px;
            position: relative; cursor: default; transition: all 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .team-member:first-child { margin-left: 0; }
        #featureSectionsContainer.projects-feature .team-member img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        #featureSectionsContainer.projects-feature .team-member::after { /* Tooltip */
            content: attr(data-tooltip); position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%);
            background-color: var(--tooltip-bg); color: var(--tooltip-text); padding: 5px 10px;
            border-radius: 4px; font-size: 0.85em; white-space: nowrap; opacity: 0; visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease; z-index: 10;
        }
        #featureSectionsContainer.projects-feature .team-member:hover::after { opacity: 1; visibility: visible; }

        #featureSectionsContainer.projects-feature .project-deadline span { font-weight: 500; }
        #featureSectionsContainer.projects-feature .project-deadline.deadline-near span,
        #featureSectionsContainer.projects-feature .project-deadline.deadline-near i { color: var(--deadline-near-color); }
        #featureSectionsContainer.projects-feature .project-deadline.deadline-overdue span,
        #featureSectionsContainer.projects-feature .project-deadline.deadline-overdue i { color: var(--deadline-overdue-color); font-weight: 600;}

        #featureSectionsContainer.projects-feature .project-dates { font-size: 0.85em; }

        #featureSectionsContainer.projects-feature .project-status-tag {
            display: inline-block; padding: 4px 12px; border-radius: 15px; font-size: 0.75em;
            font-weight: 600; text-transform: uppercase; margin-top: auto; margin-bottom: 15px;
            align-self: flex-start; transition: background-color 0.3s ease, color 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .status-planned { background-color: var(--status-planned-bg); color: var(--status-planned-text); }
        #featureSectionsContainer.projects-feature .status-in-progress { background-color: var(--status-in-progress-bg); color: var(--status-in-progress-text); }
        #featureSectionsContainer.projects-feature .status-completed { background-color: var(--status-completed-bg); color: var(--status-completed-text); }
        #featureSectionsContainer.projects-feature .status-on-hold { background-color: var(--status-on-hold-bg); color: var(--status-on-hold-text); }

        #featureSectionsContainer.projects-feature .project-actions {
            padding-top: 15px; border-top: 1px solid var(--border-color); display: flex; gap: 10px;
            margin-top: auto; transition: border-color 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .project-actions .btn {
            /* Use dashboard .btn styling as base, then customize */
            flex-grow: 1; padding: 8px 10px; font-size: 0.85em;
        }
        #featureSectionsContainer.projects-feature .project-actions .btn i { font-size: 0.95em; }

        #featureSectionsContainer.projects-feature .btn-view { background-color: var(--primary-color); color: var(--primary-text); }
        #featureSectionsContainer.projects-feature .btn-view:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        #featureSectionsContainer.projects-feature .btn-edit { background-color: var(--edit-btn-bg); color: var(--edit-btn-text); }
        #featureSectionsContainer.projects-feature .btn-edit:hover { background-color: var(--edit-btn-hover); transform: translateY(-1px); }
        #featureSectionsContainer.projects-feature .btn-delete { background-color: var(--delete-btn-bg); color: var(--delete-btn-text); }
        #featureSectionsContainer.projects-feature .btn-delete:hover { background-color: var(--delete-btn-hover); transform: translateY(-1px); }
        #featureSectionsContainer.projects-feature .project-actions .btn:disabled,
        #featureSectionsContainer.projects-feature .project-actions .btn[disabled] {
            opacity: 0.6; cursor: not-allowed; transform: none;
            background-color: var(--status-on-hold-progress); color: var(--status-on-hold-text); box-shadow: none;
        }

        /* Project Confirmation Modal Styles (Scoped) */
        #featureSectionsContainer.projects-feature .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--modal-backdrop-bg); display: none; justify-content: center;
            align-items: center; z-index: 1055; /* Ensure above other content but below toast maybe */
            opacity: 0; transition: opacity 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .modal-backdrop.active { display: flex; opacity: 1; }
        #featureSectionsContainer.projects-feature .confirmation-modal {
            background-color: var(--card-bg); padding: 30px 35px; border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); width: 90%; max-width: 480px;
            z-index: 1056; border: 1px solid var(--border-color); transform: scale(0.95); opacity: 0;
            transition: all 0.3s ease;
        }
        #featureSectionsContainer.projects-feature .modal-backdrop.active .confirmation-modal { transform: scale(1); opacity: 1; }
        #featureSectionsContainer.projects-feature .modal-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        #featureSectionsContainer.projects-feature .modal-header i { font-size: 1.8em; color: var(--delete-btn-bg); }
        #featureSectionsContainer.projects-feature .modal-header h3 { margin: 0; color: var(--heading-color); font-size: 1.4em; font-weight: 600; }
        #featureSectionsContainer.projects-feature .modal-body p { margin: 0 0 10px 0; color: var(--text-color); font-size: 1em; line-height: 1.6; }
        #featureSectionsContainer.projects-feature .modal-body strong { color: var(--heading-color); font-weight: 600; }
        #featureSectionsContainer.projects-feature .modal-body #projectNameToDelete { font-style: italic; }
        #featureSectionsContainer.projects-feature .modal-footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 25px; }
        #featureSectionsContainer.projects-feature .modal-footer .btn { padding: 10px 22px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 0.95em; border: none; transition: all 0.2s ease; }
        #featureSectionsContainer.projects-feature .btn-confirm-delete { background-color: var(--delete-btn-bg); color: var(--delete-btn-text); }
        #featureSectionsContainer.projects-feature .btn-confirm-delete:hover { background-color: var(--delete-btn-hover); transform: translateY(-1px);}
        #featureSectionsContainer.projects-feature .btn-cancel-delete { background-color: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); }
        #featureSectionsContainer.projects-feature .btn-cancel-delete:hover { background-color: var(--border-color); transform: translateY(-1px);}

        /* Project Responsive */
         @media (max-width: 992px) {
             #featureSectionsContainer.projects-feature .projects-header { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .projects-title-wrapper { width: auto; }
             #featureSectionsContainer.projects-feature .project-controls { justify-content: flex-start; }
         }
         @media (max-width: 768px) {
              #featureSectionsContainer.projects-feature #projects-section { padding: 1.5rem; }
             #featureSectionsContainer.projects-feature .project-controls { flex-direction: column; align-items: stretch; }
             #featureSectionsContainer.projects-feature .project-search-input,
             #featureSectionsContainer.projects-feature .project-filter-select,
             #featureSectionsContainer.projects-feature .add-project-btn { width: 100%; }
             #featureSectionsContainer.projects-feature #pinned-projects-list,
             #featureSectionsContainer.projects-feature #regular-projects-list { grid-template-columns: 1fr; gap: 25px; }
             #featureSectionsContainer.projects-feature .project-card-image { height: 170px; }
             #featureSectionsContainer.projects-feature .project-name { font-size: 1.3em; }
             #featureSectionsContainer.projects-feature .project-info-grid { font-size: 0.85em; }
             #featureSectionsContainer.projects-feature .team-member { width: 26px; height: 26px; font-size: 0.7em; margin-left: -6px;}
             #featureSectionsContainer.projects-feature .project-actions .btn { font-size: 0.8em; padding: 7px 8px; }
             #featureSectionsContainer.projects-feature .confirmation-modal { padding: 20px 25px; }
             #featureSectionsContainer.projects-feature .modal-header h3 { font-size: 1.2em; }
             #featureSectionsContainer.projects-feature .modal-body p { font-size: 0.95em; }
             #featureSectionsContainer.projects-feature .modal-footer .btn { padding: 8px 18px; font-size: 0.9em;}
         }
         @media (max-width: 480px) {
            #featureSectionsContainer.projects-feature #projects-section { padding: 1rem; }
            #featureSectionsContainer.projects-feature .team-member { width: 24px; height: 24px; font-size: 0.65em; margin-left: -5px;}
         }


        /* ============================================= */
        /* === INTEGRATED TEAM MEMBERS SECTION STYLES === */
        /* ============================================= */
        #featureSectionsContainer.team-members-feature {
            padding: 0; background-color: transparent; box-shadow: none; border-radius: 0;
        }

        /* Use dashboard vars, scope selectors */
        #featureSectionsContainer.team-members-feature .team-members-section {
            background-color: var(--team-bg); /* Mapped to --light */
            border-radius: var(--team-card-border-radius); /* 12px */
            max-width: 100%; /* Take full width of container */
            margin: 0 auto; /* No extra margin */
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            overflow: hidden;
        }

        #featureSectionsContainer.team-members-feature .team-members-section h2 {
            background-color: var(--team-title-bg); /* Mapped to --light-gray */
            color: var(--team-title-text); /* Mapped to --dark */
            margin: 0;
            padding: 22px var(--team-section-padding); /* 30px */
            font-size: 1.7rem;
            font-weight: 600;
            text-align: left;
            letter-spacing: 0.3px;
            border-bottom: 1px solid #d1d5db; /* Consistent border */
             transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        #featureSectionsContainer.team-members-feature .team-content-area {
            padding: var(--team-section-padding); /* 30px */
        }

        #featureSectionsContainer.team-members-feature .team-filter {
            margin-bottom: 35px;
            max-width: 400px;
        }

        #featureSectionsContainer.team-members-feature .team-filter input[type="text"] {
            width: 100%; padding: 12px 18px; border: 1px solid var(--input-border);
            border-radius: 8px; background-color: var(--input-bg); box-sizing: border-box;
            font-size: 0.95rem; transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03); color: var(--text-color);
        }
        #featureSectionsContainer.team-members-feature .team-filter input[type="text"]::placeholder { color: var(--gray); }
        #featureSectionsContainer.team-members-feature .team-filter input[type="text"]:focus {
            outline: none; border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px var(--input-focus-shadow);
        }

        #featureSectionsContainer.team-members-feature .team-members-list {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--team-grid-gap); /* 28px */
        }

        #featureSectionsContainer.team-members-feature .team-member-card {
            display: flex; flex-direction: column; align-items: flex-start;
            background-color: var(--team-card-bg); /* Mapped to --white */
            border: 1px solid var(--team-border-color); /* Mapped to --light-gray */
            border-radius: var(--team-card-border-radius); /* 12px */
            padding: var(--team-card-padding); /* 22px */
            box-shadow: 0 3px 8px var(--team-shadow-color);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out, background-color 0.3s ease;
            overflow: hidden;
        }

        #featureSectionsContainer.team-members-feature .team-member-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px var(--team-hover-shadow-color);
            border-color: #d1d5db; /* Consistent hover border */
        }

        #featureSectionsContainer.team-members-feature .member-info { width: 100%; }

        #featureSectionsContainer.team-members-feature .member-name {
            font-size: 1.15rem; font-weight: 600; color: var(--team-text-primary); /* Mapped to --dark */
            margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            transition: color 0.3s ease;
        }

        #featureSectionsContainer.team-members-feature .member-email {
            font-size: 0.88rem; color: var(--team-text-secondary); /* Mapped to --gray */
            margin: 0 0 14px 0; word-break: break-all; line-height: 1.4;
            transition: color 0.3s ease;
        }

        #featureSectionsContainer.team-members-feature .member-role {
            font-size: 0.85rem; font-weight: 500; margin: 0; padding: 4px 10px;
            border-radius: 6px; display: inline-block; line-height: 1.3; color: #fff; /* Keep white text on badges */
            transition: background-color 0.3s ease;
        }

        /* Role Specific Colors (Using dashboard vars) */
        #featureSectionsContainer.team-members-feature .member-role.role-admin { background-color: var(--team-admin-color); } /* --danger */
        #featureSectionsContainer.team-members-feature .member-role.role-supervisor { background-color: var(--team-supervisor-color); } /* --primary */
        #featureSectionsContainer.team-members-feature .member-role.role-senior { background-color: var(--team-senior-color); } /* --success */
        #featureSectionsContainer.team-members-feature .member-role.role-member { background-color: var(--team-member-color); } /* --gray */

        #featureSectionsContainer.team-members-feature .team-member-card.hidden-by-filter { display: none; }

        /* Team Members Responsive */
         @media (max-width: 768px) {
             #featureSectionsContainer.team-members-feature .team-members-list {
                grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
                gap: 20px;
             }
             #featureSectionsContainer.team-members-feature .team-content-area,
             #featureSectionsContainer.team-members-feature .team-members-section h2 {
                 padding-left: 20px; padding-right: 20px;
             }
             #featureSectionsContainer.team-members-feature .team-members-section h2 { font-size: 1.5rem; padding-top: 18px; padding-bottom: 18px; }
             #featureSectionsContainer.team-members-feature .team-filter { max-width: none; }
         }
         @media (max-width: 576px) {
            #featureSectionsContainer.team-members-feature .team-members-section { margin: 15px auto; padding: 0;} /* Adjust section margin/padding */
            #featureSectionsContainer.team-members-feature .team-content-area,
            #featureSectionsContainer.team-members-feature .team-members-section h2 {
                 padding-left: 15px; padding-right: 15px;
             }
            #featureSectionsContainer.team-members-feature .team-members-section h2 { font-size: 1.4rem; padding-top: 15px; padding-bottom: 15px; }
            #featureSectionsContainer.team-members-feature .team-members-list { grid-template-columns: 1fr; gap: 15px; }
            #featureSectionsContainer.team-members-feature .team-member-card { padding: 18px; } /* Use correct var? --team-card-padding: 22px; */
            #featureSectionsContainer.team-members-feature .member-name { font-size: 1.1rem; }
            #featureSectionsContainer.team-members-feature .member-email { font-size: 0.85rem; margin-bottom: 12px; }
            #featureSectionsContainer.team-members-feature .member-role { font-size: 0.8rem; padding: 3px 8px; }
         }


        /* --- Theme/Mode Specific Dark Overrides (Keep at end) --- */
        body.dark-theme { /* Existing dark theme overrides */ }
        body.dark-theme #featureSectionsContainer.projects-feature { /* Project Dark overrides */ }
        body.dark-theme #featureSectionsContainer.team-members-feature { /* Team Dark overrides */ }

        /* --- END INTEGRATED STYLES --- */

        /* --- Remaining Dashboard Styles (Keep As Is) --- */
        /* Employee Scheduling */
        #featureSectionsContainer.employee-scheduling .schedule-page-header { margin-bottom: 1.5rem; }
        /* ... other employee scheduling styles ... */
        /* Task Management */
        #featureSectionsContainer.task-management-feature .task-page-header { /* ... */ }
        #featureSectionsContainer.task-management-feature .task-management-content { /* ... */ }
        /* ... other task management styles ... */
        /* Generic Modals */
        .modal { /* ... */ }
        .modal-content { /* ... */ }
        /* Toasts */
        .toast { /* ... */ }
        /* Responsive Overrides */
        @media (max-width: 992px) { /* ... */ }
        @media (max-width: 768px) { /* ... */ }
        @media (max-width: 480px) { /* ... */ }
        /* Checkbox Group */
        .checkbox-group { /* ... */ }
        /* Settings Link */
        .settings-link { /* ... */ }
        /* Placeholder Content */
        .placeholder-content { /* ... */ }
        .d-none { display: none !important; }

    </style>
</head>
<body class=""> <!-- Start with no specific theme, JS will apply -->

    <audio id="notificationSound" preload="auto">
        <source src="assets/notification.mp3" type="audio/mpeg"> <!-- Check this path -->
        Your browser does not support the audio element.
    </audio>

    <!-- Hamburger Menu Toggle (Visible on smaller screens) -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Success/Toast message container -->
    <div class="toast" id="toastMessage">Toast message</div>
    <!-- Success message (Specific style from original) -->
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Action successful!</span> </div>

    <aside class="sidebar" id="sidebar">
        <!-- Sidebar Content (No changes needed here) -->
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-users-cog logo-icon"></i>
                <span>TeamFlow</span>
            </div>
             <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar" style="display: none; background: none; border: none; color: white; font-size: 1.2rem; position: absolute; top: 1.5rem; right: 1rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
             <div class="menu-title">Navigation</div>
             <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
             <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
             <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
             <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>
             <div class="menu-title">Core Features</div>
             <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
             <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a>
             <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
             <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
             <div class="menu-title">Team Tools</div>
             <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
             <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
             <a href="#deadline-tracking" class="menu-item" data-feature="deadline-tracking"><i class="fas fa-clock"></i><span>Deadline Tracking</span></a>
             <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>
             <div class="menu-divider"></div>
             <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
             <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
         </div>
         <div class="connection-status">
             <div class="status-dot"></div>
             <span>Online</span>
         </div>
    </aside>

    <main class="main-content" id="mainContent">
         <nav class="top-nav">
            <!-- Top Nav Content (No changes needed here) -->
             <div class="search-bar">
                 <i class="fas fa-search search-icon"></i>
                 <input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off">
                 <div class="search-results" id="searchResults"></div>
             </div>
             <div class="user-menu">
                 <div class="notification-icon" id="notificationIcon">
                     <i class="fas fa-bell"></i>
                     <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                 </div>
                 <div class="user-profile" id="userProfileContainer">
                     <div class="user-avatar" id="userAvatar">ME</div>
                     <div class="user-profile-details">
                         <span class="user-name" id="userName">Loading...</span>
                         <span class="user-status"> • Connected</span>
                     </div>
                     <div class="user-dropdown" id="userDropdown">
                         <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a>
                         <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a>
                         <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                     </div>
                 </div>
             </div>
         </nav>

         <div class="content-area">
             <!-- Back Button -->
             <div class="back-button" id="backButton" style="display: none;">
                 <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span>
             </div>

             <!-- Dashboard Content -->
             <div id="dashboardContent" class="content-section active">
                 <!-- Dashboard content remains the same -->
                 <div class="welcome-section" id="welcomeSection">
                     <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2>
                     <p class="welcome-subtitle">Here's what's happening with your team today.</p>
                     <div class="user-info">
                         <div class="user-info-avatar" id="profileAvatar">U</div>
                         <div class="user-info-details">
                             <div class="user-info-name" id="userInfoName">Loading User...</div>
                             <div class="user-info-title" id="userInfoRoleTitle">Loading Role...</div>
                             <div class="user-info-email">
                                 <i class="fas fa-envelope"></i> <span id="userEmail">loading@email.com</span>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="stats-section" id="statsSection">
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                     <div class="stat-card"> <div class="stat-title"><i class="fas fa-spinner fa-spin"></i>Loading...</div> <div class="stat-value"><span>-</span></div> </div>
                 </div>
                 <div class="activity-section">
                     <div class="section-header">
                         <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3>
                         <div>
                             <span class="view-all" id="viewAllActivity">Show All</span>
                             <span class="delete-all" id="deleteAllActivity">Delete All</span>
                         </div>
                     </div>
                     <ul class="activity-list" id="activityList">
                         <li style="text-align: center; padding: 2rem; color: var(--gray);"> Loading activities... </li>
                     </ul>
                 </div>
             </div>

             <!-- Profile Content -->
             <div class="content-section" id="profileContent">
                 <!-- Profile content remains the same -->
                  <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Your personal information and account security settings.</p>
                 <div class="profile-avatar-section">
                     <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color);">Avatar</label>
                     <div id="profileAvatarLarge" title="Click to upload photo">ME</div>
                     <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                 </div>
                 <form class="data-form" id="profileForm">
                     <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control" value=""> </div>
                     <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" value="" readonly> </div>
                     <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control" value=""> </div>
                     <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control" value=""> </div>
                     <div class="form-actions">
                         <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button>
                         <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                            <span class="btn-text">Save Changes</span>
                            <span class="spinner" style="display: none;"></span>
                         </button>
                     </div>
                 </form>
             </div>

             <!-- Settings Content -->
             <div class="content-section" id="settingsContent">
                 <!-- Settings content remains the same -->
                  <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                 <div class="settings-tabs">
                     <div class="settings-tab active" data-tab="preferences">Preferences</div>
                     <div class="settings-tab" data-tab="account">Account</div>
                     <div class="settings-tab" data-tab="security">Security</div>
                     <div class="settings-tab" data-tab="notifications">Notifications</div>
                     <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div>
                     <div class="settings-tab" data-tab="collaboration">Collaboration</div>
                     <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div>
                 </div>
                 <!-- Settings Panels remain the same -->
                  <div class="settings-panel active" id="preferencesPanel"> /* ... Preferences ... */ </div>
                  <div class="settings-panel" id="accountPanel"> /* ... Account ... */ </div>
                  <div class="settings-panel" id="securityPanel"> /* ... Security ... */ </div>
                  <div class="settings-panel" id="notificationsPanel"> /* ... Notifications ... */ </div>
                  <div class="settings-panel" id="teamPanel"> /* ... Team Management ... */
                     <div class="team-management">
                         <div class="settings-subsection">
                             <h4>Team Members</h4>
                             <div class="team-list" id="teamList"> <p>Loading team members...</p> </div>
                             <div class="add-member-form">
                                 <h4>Invite New Member</h4>
                                 <form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;">
                                    <div class="form-group"> <label for="inviteEmail">Email</label> <input type="email" id="inviteEmail" class="form-control" required> </div>
                                    <div class="form-group"> <label for="inviteRole">Role</label> <select id="inviteRole" class="form-control" required> <option value="member">Member</option> <option value="supervisor">Supervisor</option> <option value="senior">Senior</option> <option value="admin">Admin</option> </select> </div>
                                    <button type="submit" class="btn btn-primary">Invite</button>
                                 </form>
                             </div>
                         </div>
                         <div class="settings-subsection">
                             <h4>Custom Role Permissions</h4>
                             <p class="setting-item-description">Define specific permissions for different roles within your team (Feature placeholder - requires backend).</p>
                             <button class="btn btn-outline" disabled>Manage Permissions</button>
                         </div>
                     </div>
                  </div>
                  <div class="settings-panel" id="collaborationPanel"> /* ... Collaboration ... */ </div>
                  <div class="settings-panel" id="dangerPanel"> /* ... Danger Zone ... */ </div>
             </div>

             <!-- NEW: Container for other feature sections -->
             <div id="featureSectionsContainer" class="content-section">
                 <!-- Content for Projects, Team Members, etc., loaded dynamically here -->
                 <div class="placeholder-content" id="featurePlaceholder">
                     <h2 id="featureTitle">Feature Content Area</h2>
                     <p id="featureDescription">Select a feature from the sidebar.</p>
                     <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                     <div class="error-message" style="display: none;"> Failed to load content. </div>
                 </div>
             </div>
         </div><!-- /content-area -->
    </main>

    <!-- Notification Modal -->
    <div class="notifications-modal" id="notificationsModal">
         <!-- Notification modal content remains the same -->
          <div class="notifications-container">
             <div class="notifications-header">
                 <h3 class="notifications-title">Notifications</h3>
                 <button class="close-notifications" id="closeNotifications" aria-label="Close Notifications">×</button>
             </div>
             <div class="notifications-body" id="notificationsBody">
                 <div class="no-notifications-message" id="noNotificationsMessage">Loading notifications...</div>
             </div>
             <div class="notifications-footer">
                 <button class="btn btn-outline btn-sm" id="markAllReadBtn">Mark All as Read</button>
                 <button class="btn btn-danger btn-sm" id="deleteAllNotificationsBtn">Delete All</button>
             </div>
         </div>
    </div>

    <!-- Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
         <!-- Confirm modal content remains the same -->
          <div class="confirm-container">
             <h3 class="confirm-title" id="confirmTitle">Confirm Action</h3>
             <div class="confirm-message" id="confirmMessage">Are you sure you want to proceed?</div>
             <div class="confirm-actions">
                 <button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button>
                 <button class="btn btn-danger" id="confirmBtn">Confirm</button>
             </div>
         </div>
    </div>

    <!-- Edit Member Modal -->
    <div class="modal" id="editMemberModal">
         <!-- Edit member modal content remains the same -->
          <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="editMemberModalTitle">Edit Team Member</h3>
                <button class="close-modal" data-close-modal>&times;</button>
            </div>
            <form id="editMemberForm">
                <input type="hidden" id="editMemberId">
                 <div class="data-form" style="grid-template-columns: 1fr 1fr;">
                     <div class="form-group">
                         <label for="editMemberFirstName">First Name</label>
                         <input type="text" id="editMemberFirstName" class="form-control">
                     </div>
                     <div class="form-group">
                         <label for="editMemberLastName">Last Name</label>
                         <input type="text" id="editMemberLastName" class="form-control">
                     </div>
                     <div class="form-group">
                         <label for="editMemberEmail">Email</label>
                         <input type="email" id="editMemberEmail" class="form-control" readonly>
                     </div>
                     <div class="form-group">
                         <label for="editMemberRole">Role</label>
                         <select id="editMemberRole" class="form-control">
                             <option value="member">Member</option>
                             <option value="supervisor">Supervisor</option>
                             <option value="senior">Senior</option>
                             <option value="admin">Admin</option>
                         </select>
                     </div>
                      <div class="form-group">
                         <label for="editMemberTitle">Job Title</label>
                         <input type="text" id="editMemberTitle" class="form-control">
                     </div>
                      <div class="form-group">
                         <label for="editMemberDepartment">Department</label>
                         <input type="text" id="editMemberDepartment" class="form-control">
                     </div>
                 </div>
                <div class="form-actions" style="grid-column: span 1;">
                     <button type="button" class="btn btn-outline" data-close-modal>Cancel</button>
                     <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>


    <!-- ======================= TEMPLATES for Feature Content ========================== -->
    <template id="projectsTemplate">
        <section id="projects-section"> <!-- Main container from project component -->
            <!-- Section Header -->
            <div class="projects-header">
                <div class="projects-title-wrapper">
                    <h2>Projects Overview</h2>
                </div>
                <div class="project-controls">
                    <input type="search" placeholder="Search by name or team..." class="project-search-input" id="projectSearchInput">
                    <select class="project-filter-select" id="projectFilterSelect">
                        <option value="all">All Statuses</option>
                        <option value="planned">Planned</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                    <button class="btn add-project-btn" onclick="alert('Placeholder: Open Add Project Form/Modal')">
                        <i class="fas fa-plus-circle"></i> Add Project
                    </button>
                </div>
            </div>

            <!-- Pinned Projects Area -->
            <div id="pinned-projects-list">
                <!-- Pinned project cards will be moved here by JS -->
            </div>

            <!-- Divider -->
            <hr class="pinned-projects-divider" />

            <!-- Regular Projects List -->
            <div id="regular-projects-list">
                <!-- Sample Project Card 1: In Progress -->
                <div class="project-card" data-project-id="alpha001" data-status="in-progress" data-pinned="false" data-participants="Alice B.|Bob K.|Charlie M." data-deadline="2024-07-30">
                    <button class="pin-project-btn" title="Pin Project"><i class="fas fa-thumbtack"></i></button>
                    <div class="project-card-image" style="background-image: url('https://images.unsplash.com/photo-1517048676732-d65bc937f952?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60');"></div>
                    <div class="project-card-body">
                        <h3 class="project-name">Project Alpha</h3>
                        <div class="progress-bar-container" title="Progress: 65%">
                            <div class="progress-bar" style="width: 65%;">65%</div>
                        </div>
                        <div class="project-info-grid">
                            <i class="fas fa-users" title="Team"></i>
                            <div class="project-team">
                                <span class="team-member" data-tooltip="Alice Wonderland"><img src="https://via.placeholder.com/28/FFA07A/FFFFFF?text=A" alt="Alice B."/></span>
                                <span class="team-member" data-tooltip="Bob Kelso">BK</span>
                                <span class="team-member" data-tooltip="Charlie Munger">CM</span>
                            </div>
                            <i class="fas fa-calendar-check" title="Deadline"></i>
                            <div class="project-deadline" id="deadline-alpha001"> <span>Jul 30, 2024</span> </div>
                            <i class="fas fa-calendar-alt" title="Timeline"></i>
                            <div class="project-dates"> Started: Aug 15, 2023 </div>
                        </div>
                        <div class="project-status-tag status-in-progress">In Progress</div>
                        <div class="project-actions">
                            <button class="btn btn-view" onclick="alert('View Project Alpha')"><i class="fas fa-eye"></i> View</button>
                            <button class="btn btn-edit" onclick="alert('Edit Project Alpha')"><i class="fas fa-pencil-alt"></i> Edit</button>
                            <button class="btn btn-delete"><i class="fas fa-trash-alt"></i> Delete</button>
                        </div>
                    </div>
                </div>
                 <!-- Sample Project Card 2: Completed -->
                <div class="project-card" data-project-id="web002" data-status="completed" data-pinned="false" data-participants="David L.|Eva G." data-deadline="2024-01-20">
                    <button class="pin-project-btn" title="Pin Project"><i class="fas fa-thumbtack"></i></button>
                    <div class="project-card-image" style="background-image: url('https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60');"></div>
                    <div class="project-card-body">
                        <h3 class="project-name">Website Redesign</h3>
                        <div class="progress-bar-container" title="Progress: 100%"><div class="progress-bar" style="width: 100%;">100%</div></div>
                        <div class="project-info-grid">
                            <i class="fas fa-users" title="Team"></i>
                            <div class="project-team">
                                <span class="team-member" data-tooltip="David Lean">DL</span>
                                <span class="team-member" data-tooltip="Eva Green"><img src="https://via.placeholder.com/28/90EE90/FFFFFF?text=E" alt="Eva G."/></span>
                            </div>
                            <i class="fas fa-calendar-check" title="Deadline"></i>
                            <div class="project-deadline" id="deadline-web002"><span>Jan 20, 2024</span></div>
                            <i class="fas fa-calendar-alt" title="Timeline"></i>
                            <div class="project-dates">Started: May 01, 2023</div>
                        </div>
                        <div class="project-status-tag status-completed">Completed</div>
                        <div class="project-actions">
                            <button class="btn btn-view" onclick="alert('View Website Redesign')"><i class="fas fa-eye"></i> View</button>
                            <button class="btn btn-edit" disabled><i class="fas fa-pencil-alt"></i> Edit</button>
                            <button class="btn btn-delete"><i class="fas fa-trash-alt"></i> Delete</button>
                        </div>
                    </div>
                </div>
                <!-- Add more sample cards as needed -->
            </div>
        </section>
        <!-- Project Confirmation Modal (already styled and scoped) -->
        <div class="modal-backdrop" id="deleteConfirmationBackdrop">
            <div class="confirmation-modal" id="deleteConfirmationModal" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDescription">
                <div class="modal-header"> <i class="fas fa-exclamation-triangle"></i> <h3 id="modalTitle">Confirm Deletion</h3> </div>
                <div class="modal-body">
                    <p id="modalDescription">Are you sure you want to delete this project? This action cannot be undone.</p>
                    <p><strong>Project:</strong> <span id="projectNameToDelete"></span></p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-cancel-delete" id="cancelDeleteBtn">Cancel</button>
                    <button class="btn btn-confirm-delete" id="confirmDeleteBtn">Delete Project</button>
                </div>
            </div>
        </div>
    </template>

    <template id="teamMembersTemplate">
        <div class="team-members-section"> <!-- Main container from team component -->
            <!-- Title -->
            <h2>Team Members</h2>
            <!-- Content Area -->
            <div class="team-content-area">
                <!-- Filter Input -->
                <div class="team-filter">
                    <input type="text" id="teamSearchInput" placeholder="Search team members by name, role, or email..." aria-label="Search team members">
                </div>
                <!-- List of Team Members -->
                <div class="team-members-list" id="teamListContainer">
                    <!-- Member Card: Mohamed Elmenisy -->
                    <div class="team-member-card" data-name="Mohamed Elmenisy" data-role="Admin" data-email="m.elsayed@thechefz.co">
                        <div class="member-info">
                            <h4 class="member-name">Mohamed Elmenisy</h4>
                            <p class="member-email">m.elsayed@thechefz.co</p>
                            <span class="member-role role-admin">Admin</span>
                        </div>
                    </div>
                    <!-- Member Card: Nada Mahmoud -->
                    <div class="team-member-card" data-name="Nada Mahmoud" data-role="Supervisor" data-email="n.mahmoud@thechefz.co">
                        <div class="member-info">
                            <h4 class="member-name">Nada Mahmoud</h4>
                            <p class="member-email">n.mahmoud@thechefz.co</p>
                            <span class="member-role role-supervisor">Supervisor</span>
                        </div>
                    </div>
                    <!-- Member Card: Yousef Ahmed -->
                    <div class="team-member-card" data-name="Yousef Ahmed" data-role="Senior" data-email="y.abbas@thechefz.co">
                        <div class="member-info">
                            <h4 class="member-name">Yousef Ahmed</h4>
                            <p class="member-email">y.abbas@thechefz.co</p>
                            <span class="member-role role-senior">Senior</span>
                        </div>
                    </div>
                     <!-- Member Card: Esraa Lashin -->
                    <div class="team-member-card" data-name="Esraa Lashin" data-role="Member" data-email="e.lasheen@thechefz.co">
                        <div class="member-info">
                            <h4 class="member-name">Esraa Lashin</h4>
                            <p class="member-email">e.lasheen@thechefz.co</p>
                            <span class="member-role role-member">Member</span>
                        </div>
                    </div>
                    <!-- Member Card: Bassant Badr -->
                    <div class="team-member-card" data-name="Bassant Badr" data-role="Member" data-email="b.badr@thechefz.co">
                        <div class="member-info">
                            <h4 class="member-name">Bassant Badr</h4>
                            <p class="member-email">b.badr@thechefz.co</p>
                            <span class="member-role role-member">Member</span>
                        </div>
                    </div>
                    <!-- Add more member cards as needed -->
                </div> <!-- End team-members-list -->
            </div> <!-- End team-content-area -->
        </div> <!-- End team-members-section -->
    </template>

    <!-- Container for Task Management CSS and JS (Remains the same) -->
    <template id="taskManagementAssets">
        <style id="task-management-styles"> /* ... Task CSS ... */ </style>
        <script> function initializeTaskManagementFeature(container) { /* ... Task JS ... */ } </script>
    </template>
    <!-- ======================= END OF TEMPLATES ========================== -->


    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements (Keep existing + Add new template refs) ---
            const sidebar = document.getElementById('sidebar');
            // ... (all other existing DOM element variables) ...
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureTitleEl = document.getElementById('featureTitle');
            const featureDescEl = document.getElementById('featureDescription');
            const featureLoadingEl = featurePlaceholder.querySelector('.loading-indicator');
            const featureErrorEl = featurePlaceholder.querySelector('.error-message');
            // Template References
            const projectsTemplate = document.getElementById('projectsTemplate');
            const teamMembersTemplate = document.getElementById('teamMembersTemplate');
            const taskManagementAssetsTemplate = document.getElementById('taskManagementAssets');


            // --- State Variables (Keep existing) ---
            let currentUser = null;
            let currentFeature = 'dashboard';
            let currentSettingsTab = 'preferences';
            // ... (all other existing state variables) ...
            let currentFeatureCleanup = null; // Stores cleanup for current feature


            // --- Mock Data (Keep existing) ---
            let MOCK_USERS = [ /* ... */ ];
            const MOCK_PROJECTS = [ /* ... */ ];
            const MOCK_TASKS = [ /* ... */ ];
            let mockScheduleData = {};
            // ADD Mock project data if needed by the project feature's JS
            let mockProjectData = [
                { projectId: "alpha001", status: "in-progress", pinned: false, participants: "Alice B.|Bob K.|Charlie M.", deadline: "2024-07-30", name: "Project Alpha", progress: 65, startDate: "2023-08-15", team: [{initials: "A", name: "Alice Wonderland", img: "https://via.placeholder.com/28/FFA07A/FFFFFF?text=A"}, {initials: "BK", name: "Bob Kelso"}, {initials: "CM", name: "Charlie Munger"}], image: "https://images.unsplash.com/photo-1517048676732-d65bc937f952?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60" },
                { projectId: "web002", status: "completed", pinned: true, participants: "David L.|Eva G.", deadline: "2024-01-20", name: "Website Redesign", progress: 100, startDate: "2023-05-01", team: [{initials: "DL", name: "David Lean"}, {initials: "E", name: "Eva Green", img: "https://via.placeholder.com/28/90EE90/FFFFFF?text=E"}], image: "https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60"},
                { projectId: "mobile003", status: "in-progress", pinned: false, participants: "Frank H.|Grace P.|Heidi R.|Ian S.", deadline: "2024-06-15", name: "Mobile App V2", progress: 20, startDate: "2024-02-20", team: [{initials: "FH", name: "Frank Herbert"}, {initials: "G", name: "Grace P.", img:"https://via.placeholder.com/28/ADD8E6/000000?text=G"}, {initials: "HR", name: "Heidi R."}, {initials: "IS", name: "Ian S."}, {initials:"+1", name:"More (+1)"}], image: "https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60" },
                { projectId: "mktg004", status: "planned", pinned: false, participants: "Marketing Team", deadline: "2024-09-01", name: "Q4 Marketing Plan", progress: 0, startDate: "2024-07-01", team: [{initials: "MTL", name: "Marketing Team Lead"}, {initials: "MS1", name: "Marketing Specialist 1"}, {initials: "MS2", name: "Marketing Specialist 2"}], image: "https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60" },
                { projectId: "infra005", status: "on-hold", pinned: false, participants: "Infra Team", deadline: "2024-12-31", name: "Server Migration", progress: 40, startDate: "2024-01-10", team: [{initials: "LD", name: "Lead DevOps"}, {initials: "SA", name: "Sys Admin"}], image: "https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60" },
            ];


            // --- Initialization (Keep existing) ---
            function initDashboard() { /* ... */ }

            // --- UI Updates (Keep existing) ---
            function updateUserUI() { /* ... */ }
            function updateProfileForm() { /* ... */ }
            function formatRole(role) { /* ... */ }

            // --- Preferences & Settings Logic (Keep existing) ---
            function applyStoredPreferences() { /* ... */ }
            function setTheme(theme) { /* ... */ }
            function setContrast(enabled) { /* ... */ }
            function applyLanguage(lang) { /* ... */ }
            function applyDateTimeFormat(timeFormat, dateFormat) { /* ... */ }
            function applyToastPreference(enabled) { /* ... */ }
            function applySoundPreference(enabled) { /* ... */ }


            // --- Navigation & Content Loading (MODIFIED) ---
            function setActiveFeature(featureId, settingsTab = null, skipHistory = false) {
                console.log(`Navigating to: ${featureId}` + (settingsTab ? ` / Tab: ${settingsTab}` : ''));

                // --- Cleanup previous feature ---
                removeTaskManagementStyles(); // Remove specific styles if they exist
                removeInjectedStyles('injected-projects-styles'); // Cleanup project styles
                removeInjectedStyles('injected-team-members-styles'); // Cleanup team styles
                if (typeof currentFeatureCleanup === 'function') {
                    currentFeatureCleanup(); // Call the cleanup function for the previous feature
                    currentFeatureCleanup = null; // Reset cleanup function
                }
                // --- End Cleanup ---

                currentFeature = featureId;

                // Update Menu Items
                menuItems.forEach(item => {
                    item.classList.toggle('active', item.getAttribute('data-feature') === featureId);
                });

                // Hide all top-level content sections first
                contentSections.forEach(section => section.classList.remove('active'));

                // Reset feature container before loading new content
                featureSectionsContainer.innerHTML = ''; // Clear dynamic content
                featureSectionsContainer.className = 'content-section'; // Reset classes
                featurePlaceholder.style.display = 'flex'; // Show placeholder temporarily
                featureLoadingEl.style.display = 'none';
                featureErrorEl.style.display = 'none';
                featureSectionsContainer.appendChild(featurePlaceholder); // Re-add placeholder

                // Show the correct section
                let targetSection = null;
                let isFeatureSection = false; // Flag to know if we loaded into the feature container

                if (featureId === 'dashboard') {
                    targetSection = dashboardContent;
                    backButton.style.display = 'none';
                } else if (featureId === 'profile') {
                    targetSection = profileContent;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    updateProfileForm();
                } else if (featureId === 'settings') {
                    targetSection = settingsContent;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    currentSettingsTab = settingsTab || (currentUser.role === 'admin' ? 'preferences' : 'preferences');
                    if (currentUser.role !== 'admin' && (currentSettingsTab === 'team' || currentSettingsTab === 'danger')) {
                        currentSettingsTab = 'preferences';
                    }
                    activateSettingsTab(currentSettingsTab);
                    update2FA_UI();
                }
                // --- NEW: Handle Projects and Team Members ---
                else if (featureId === 'projects') {
                    targetSection = featureSectionsContainer;
                    isFeatureSection = true;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    loadProjectsFeature(); // Load the projects content and JS
                }
                 else if (featureId === 'team-members-view') {
                    targetSection = featureSectionsContainer;
                    isFeatureSection = true;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    loadTeamMembersFeature(); // Load the team members content and JS
                }
                // --- End New Features ---
                else {
                    // Handle other generic features
                    isFeatureSection = true;
                    targetSection = featureSectionsContainer;
                    backButton.style.display = 'flex';
                    backButtonText.textContent = 'Back to Dashboard';
                    loadGenericFeatureContent(featureId); // Use the modified generic loader
                }

                // Activate the target section container
                if (targetSection) {
                    targetSection.classList.add('active');
                }

                // If a feature was loaded into the container, hide the placeholder
                if (isFeatureSection) {
                    featurePlaceholder.style.display = 'none';
                }


                // Close sidebar on mobile after navigation
                if (window.innerWidth <= 992 && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    mainContent.classList.remove('sidebar-active');
                    if(closeSidebar) closeSidebar.style.display = 'none';
                }

                // Close user dropdown if open
                if(userDropdown && userDropdown.classList.contains('active')) {
                    userDropdown.classList.remove('active');
                    userDropdownOpen = false;
                }

                if (!skipHistory) {
                    updateBrowserHistory(featureId, featureId === 'settings' ? currentSettingsTab : null);
                }
            }

            function activateSettingsTab(tabId) { /* ... Keep existing logic ... */ }

            // MODIFIED: Renamed and simplified generic loader
            function loadGenericFeatureContent(featureId) {
                 const menuItem = Array.from(menuItems).find(item => item.getAttribute('data-feature') === featureId);
                 const featureName = menuItem ? menuItem.querySelector('span').textContent : featureId;

                 featureSectionsContainer.innerHTML = ''; // Clear previous content
                 featureSectionsContainer.appendChild(featurePlaceholder); // Add placeholder back
                 featurePlaceholder.style.display = 'flex'; // Show placeholder
                 featureLoadingEl.style.display = 'none';
                 featureErrorEl.style.display = 'none';
                 featureTitleEl.textContent = featureName;
                 featureDescEl.textContent = `Content for ${featureName} would be loaded here. This feature is not yet implemented.`;
                 // No JS initialization or cleanup needed for placeholder content
                 currentFeatureCleanup = null;
             }

            function updateBrowserHistory(featureId, settingsTab = null) { /* ... Keep existing logic ... */ }
            function handleInitialNavigation() { /* ... Keep existing logic ... */ }
            window.addEventListener('popstate', function(event) { handleInitialNavigation(); }); // Keep existing


             // --- NEW: Feature Loader Functions ---
             function loadProjectsFeature() {
                 console.log("Loading Projects feature...");
                 if (!projectsTemplate) {
                     console.error("Projects template not found!");
                     featureSectionsContainer.innerHTML = '<p class="error-message">Error: Projects feature could not be loaded.</p>';
                     return;
                 }

                 // 1. Inject HTML
                 featureSectionsContainer.innerHTML = ''; // Clear placeholder
                 featureSectionsContainer.classList.add('projects-feature'); // Add scoping class
                 const content = projectsTemplate.content.cloneNode(true);
                 featureSectionsContainer.appendChild(content);

                 // 2. Initialize JavaScript (Assume defined globally or accessible)
                 if (typeof initializeProjectsFeature === 'function') {
                    currentFeatureCleanup = initializeProjectsFeature(featureSectionsContainer); // Pass container
                 } else {
                     console.error("initializeProjectsFeature is not defined!");
                 }
             }

             function loadTeamMembersFeature() {
                 console.log("Loading Team Members feature...");
                 if (!teamMembersTemplate) {
                     console.error("Team Members template not found!");
                     featureSectionsContainer.innerHTML = '<p class="error-message">Error: Team Members feature could not be loaded.</p>';
                     return;
                 }

                 // 1. Inject HTML
                 featureSectionsContainer.innerHTML = ''; // Clear placeholder
                 featureSectionsContainer.classList.add('team-members-feature'); // Add scoping class
                 const content = teamMembersTemplate.content.cloneNode(true);
                 featureSectionsContainer.appendChild(content);

                 // 2. Initialize JavaScript
                  if (typeof initializeTeamMembersFeature === 'function') {
                    currentFeatureCleanup = initializeTeamMembersFeature(featureSectionsContainer); // Pass container
                 } else {
                     console.error("initializeTeamMembersFeature is not defined!");
                 }
             }

             // --- Utility to remove dynamically injected styles ---
             function removeInjectedStyles(styleId) {
                 const styleElement = document.getElementById(styleId);
                 if (styleElement) {
                     styleElement.remove();
                     console.log(`Removed styles: ${styleId}`);
                 }
             }

            // --- Data Loading & Simulation (Keep existing) ---
            function loadInitialData() { /* ... */ }
            function loadDashboardStats() { /* ... */ }
            function updateStatCard(id, title, iconClass, value, trendPercent) { /* ... */ }
            function loadRecentActivities(showAll = false) { /* ... */ }
            function loadNotifications() { /* ... */ }
            function renderNotifications() { /* ... */ }
            function loadTeamMembers() { /* ... */ }

            // --- Dynamic Updates Simulation (Keep existing) ---
            function startDynamicUpdates() { /* ... */ }
            function changeWelcomeBackground() { /* ... */ }

            // --- Event Listeners Setup (Keep existing, ensure delegation works) ---
            function setupEventListeners() { /* ... */ }

            // --- Search Logic (Keep existing) ---
            function handleSearch() { /* ... */ }

            // --- Profile Logic (Keep existing) ---
            function handleAvatarUpload(event) { /* ... */ }
            function updateFullNameDisplay() { /* ... */ }
            function handleProfileSave(event) { /* ... */ }
            function handleProfileCancel() { /* ... */ }

            // --- Settings Save Logic (Keep existing) ---
            function handleSavePreferences() { /* ... */ }
            function handleSaveAccountSettings() { /* ... */ }
            function handleChangePassword(event) { /* ... */ }
            function handleSaveSessionSettings() { /* ... */ }
            function handleSaveNotificationSettings() { /* ... */ }

            // --- 2FA Logic (Keep existing) ---
            function update2FA_UI() { /* ... */ }
            function handleEnable2FA() { /* ... */ }
            function showAuthAppSetup() { /* ... */ }
            function showSmsSetup() { /* ... */ }
            function handleVerifyAuthCode() { /* ... */ }
            function handleSendSmsCode() { /* ... */ }
            function handleVerifySmsCode() { /* ... */ }
            function handleDisable2FA() { /* ... */ }

            // --- Danger Zone Logic (Keep existing) ---
            function handleLogoutAllDevices() { /* ... */ }
            function handleDeleteAccount() { /* ... */ }

            // --- Notification Logic (Keep existing) ---
            function markAllNotificationsAsRead() { /* ... */ }
            function playNotificationSound() { /* ... */ }

            // --- Logout Logic (Keep existing) ---
            function handleLogout(event) { /* ... */ }

            // --- Team Management Logic (Keep existing, ensure selectors are correct within settings) ---
            function handleInviteMember(event) { /* ... */ }
            function openEditMemberModal(memberId) { /* ... */ }
            function handleEditMemberSave(event) { /* ... */ }

            // --- Employee Scheduling (Keep existing, loadHTML is now replaced) ---
            function getEmployeeScheduleHTML() { /* ... */ }
            function initializeEmployeeScheduleLogic() { /* ... */ }
            function handleSendReminders() { /* ... */ }

            // --- Task Management Loading (Keep existing) ---
            function loadTaskManagementFeature() { /* ... */ }
            function removeTaskManagementStyles() { /* ... */ }

            // --- Utility Functions (Keep existing) ---
            function timeAgo(timestamp) { /* ... */ }
            function formatDateForDisplay(date) { /* ... */ }
            function formatFullDateTime(date) { /* ... */ }
            function generateMockActivities(count, baseTimestampMillis) { /* ... */ }
            function generateMockNotifications(count, baseTimestampMillis) { /* ... */ }
            function showConfirmModal(title, message, onConfirm, buttonClass = 'btn-danger') { /* ... */ }
            function hideConfirmModal() { /* ... */ }
            function showSuccessMessage(message) { /* ... */ }
            function showToast(message, type = 'info') { /* ... */ }


            // --- Start Application ---
            initDashboard(); // Calls all setup functions

        }); // End DOMContentLoaded

        // =============================================================
        // === START: JavaScript Logic for Projects Feature ==========
        // =============================================================
        function initializeProjectsFeature(container) { // Pass the container (#featureSectionsContainer)
            console.log("Initializing Projects Feature Logic...");

            // --- DOM Elements (Scoped to container) ---
            const searchInput = container.querySelector('#projectSearchInput');
            const filterSelect = container.querySelector('#projectFilterSelect');
            const pinnedListContainer = container.querySelector('#pinned-projects-list');
            const regularListContainer = container.querySelector('#regular-projects-list');
            const modalBackdrop = container.querySelector('#deleteConfirmationBackdrop'); // Modal is inside template now
            const modal = container.querySelector('#deleteConfirmationModal');
            const confirmDeleteBtn = container.querySelector('#confirmDeleteBtn');
            const cancelDeleteBtn = container.querySelector('#cancelDeleteBtn');
            const projectNameToDeleteSpan = container.querySelector('#projectNameToDelete');
             // Ensure all containers exist
             if (!searchInput || !filterSelect || !pinnedListContainer || !regularListContainer || !modalBackdrop || !modal) {
                 console.error("Projects feature: One or more essential elements not found in container.");
                 return () => {}; // Return empty cleanup
             }

            let cardToDelete = null;
            let allProjectCards = []; // Will be populated after render/data load

            // --- Project Data Handling (Use mock data defined globally for now) ---
            let currentProjects = [...mockProjectData]; // Use a copy

            // --- Functions ---
            function renderProjects() {
                 console.log("Rendering projects...");
                 pinnedListContainer.innerHTML = '';
                 regularListContainer.innerHTML = '';
                 allProjectCards = []; // Clear the cache

                 const searchTerm = searchInput.value.toLowerCase().trim();
                 const selectedStatus = filterSelect.value;

                 let projectsToDisplay = currentProjects.filter(project => {
                     const statusMatch = (selectedStatus === 'all' || project.status === selectedStatus);
                     const nameMatch = project.name.toLowerCase().includes(searchTerm);
                     const participantsMatch = (project.participants || '').toLowerCase().includes(searchTerm);
                     // Add search in team members if needed
                     const teamMatch = project.team.some(member => member.name.toLowerCase().includes(searchTerm));

                     return statusMatch && (nameMatch || participantsMatch || teamMatch);
                 });

                 if (projectsToDisplay.length === 0) {
                     regularListContainer.innerHTML = '<p class="placeholder-content" style="grid-column: 1 / -1; padding: 1rem; border: none; text-align:center; color: var(--gray);">No projects found matching your criteria.</p>';
                 }

                  // Sort: Pinned first, then by status (custom order?), then maybe deadline or name
                 projectsToDisplay.sort((a, b) => {
                     // Pinned projects always come first
                     const pinnedA = a.pinned ? 0 : 1;
                     const pinnedB = b.pinned ? 0 : 1;
                     if (pinnedA !== pinnedB) return pinnedA - pinnedB;

                      // Add other sorting logic here if needed (e.g., by deadline, name)
                     // Example: Sort by name alphabetically after pinning
                     return a.name.localeCompare(b.name);
                 });


                 projectsToDisplay.forEach(project => {
                     const card = createProjectCard(project);
                     if (project.pinned) {
                         pinnedListContainer.appendChild(card);
                     } else {
                         regularListContainer.appendChild(card);
                     }
                     allProjectCards.push(card); // Add to cache after creation
                 });

                  // Add event listeners after rendering cards
                  updateAllDeadlineStylesForProjects(); // Update deadline colors
                  attachProjectCardListeners(); // Attach pin/delete listeners
                  checkEmptyPinnedListForProjects(); // Check divider visibility
            }

            function createProjectCard(project) {
                const card = document.createElement('div');
                card.classList.add('project-card');
                card.dataset.projectId = project.projectId;
                card.dataset.status = project.status;
                card.dataset.pinned = project.pinned;
                card.dataset.participants = project.participants;
                card.dataset.deadline = project.deadline;

                // Team HTML
                 let teamHTML = project.team.map(member => {
                     const avatarContent = member.img
                         ? `<img src="${member.img}" alt="${member.initials}"/>`
                         : member.initials;
                     return `<span class="team-member" data-tooltip="${member.name}">${avatarContent}</span>`;
                 }).join('');

                 // Status Tag Class
                 const statusClass = project.status.replace(/\s+/g, '-').toLowerCase(); // e.g., in-progress

                 // Deadline Overdue/Near Check (Simplified inline)
                 let deadlineClass = '';
                 let deadlineTitle = '';
                 if (project.deadline) {
                     const deadlineDate = new Date(project.deadline + 'T00:00:00');
                     const today = new Date();
                     today.setHours(0, 0, 0, 0);
                     deadlineDate.setHours(0,0,0,0);
                     const timeDiff = deadlineDate.getTime() - today.getTime();
                     const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                     if (daysDiff < 0) {
                         deadlineClass = 'deadline-overdue';
                         deadlineTitle = `Overdue by ${Math.abs(daysDiff)} day(s)`;
                     } else if (daysDiff <= 7) {
                         deadlineClass = 'deadline-near';
                         deadlineTitle = `Due in ${daysDiff} day(s)`;
                     } else {
                          deadlineTitle = `Due on ${formatDateForDisplay(deadlineDate)}`;
                     }
                 }

                card.innerHTML = `
                    <button class="pin-project-btn ${project.pinned ? 'active' : ''}" title="${project.pinned ? 'Unpin' : 'Pin'} Project">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    <div class="project-card-image" style="background-image: url('${project.image || 'https://via.placeholder.com/400x190/cccccc/969696?text=No+Image'}');"></div>
                    <div class="project-card-body">
                        <h3 class="project-name">${project.name}</h3>
                        <div class="progress-bar-container" title="Progress: ${project.progress}%">
                            <div class="progress-bar" style="width: ${project.progress}%;">${project.progress}%</div>
                        </div>
                        <div class="project-info-grid">
                            <i class="fas fa-users" title="Team"></i>
                            <div class="project-team">${teamHTML}</div>

                            <i class="fas fa-calendar-check" title="Deadline"></i>
                            <div class="project-deadline ${deadlineClass}" title="${deadlineTitle}">
                                <span>${formatDateForDisplay(project.deadline) || 'N/A'}</span>
                            </div>

                            <i class="fas fa-calendar-alt" title="Timeline"></i>
                            <div class="project-dates">
                                Started: ${formatDateForDisplay(project.startDate) || 'N/A'}
                            </div>
                        </div>
                        <div class="project-status-tag status-${statusClass}">${project.status.replace('-', ' ')}</div>
                        <div class="project-actions">
                            <button class="btn btn-view" onclick="alert('View ${project.name}')"><i class="fas fa-eye"></i> View</button>
                            <button class="btn btn-edit" onclick="alert('Edit ${project.name}')" ${project.status === 'completed' ? 'disabled' : ''}><i class="fas fa-pencil-alt"></i> Edit</button>
                            <button class="btn btn-delete"><i class="fas fa-trash-alt"></i> Delete</button>
                        </div>
                    </div>
                `;
                return card;
            }

            function updateAllDeadlineStylesForProjects() {
                container.querySelectorAll('.project-card[data-deadline]').forEach(card => {
                    const deadlineElement = card.querySelector('.project-deadline');
                    const deadlineDateStr = card.dataset.deadline;
                    if (!deadlineElement || !deadlineDateStr) return;

                    const deadlineDate = new Date(deadlineDateStr + 'T00:00:00');
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                     deadlineDate.setHours(0,0,0,0);
                    const timeDiff = deadlineDate.getTime() - today.getTime();
                    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

                    deadlineElement.classList.remove('deadline-near', 'deadline-overdue');
                    let titleText = `Due on ${formatDateForDisplay(deadlineDate)}`;
                    if (daysDiff < 0) {
                        deadlineElement.classList.add('deadline-overdue');
                        titleText = `Overdue by ${Math.abs(daysDiff)} day(s)`;
                    } else if (daysDiff <= 7) {
                        deadlineElement.classList.add('deadline-near');
                         titleText = `Due in ${daysDiff} day(s)`;
                    }
                    deadlineElement.title = titleText;
                });
            }

            function checkEmptyPinnedListForProjects() {
                const divider = container.querySelector('.pinned-projects-divider');
                if(divider) {
                    const visiblePinnedCards = pinnedListContainer.querySelectorAll('.project-card').length;
                    divider.style.display = visiblePinnedCards > 0 ? 'block' : 'none';
                }
            }

            function togglePinProject(projectId) {
                 const projectIndex = currentProjects.findIndex(p => p.projectId === projectId);
                 if (projectIndex > -1) {
                     currentProjects[projectIndex].pinned = !currentProjects[projectIndex].pinned;
                     // Save changes if needed (e.g., update mockProjectData or send to backend)
                     mockProjectData = [...currentProjects]; // Update the "source" data too for persistence in this demo
                     renderProjects(); // Re-render the list
                     showToast(`Project ${currentProjects[projectIndex].pinned ? 'pinned' : 'unpinned'}.`);
                 }
             }

            function deleteProject(projectId) {
                const projectIndex = currentProjects.findIndex(p => p.projectId === projectId);
                if (projectIndex > -1) {
                    const projectName = currentProjects[projectIndex].name;
                     showConfirmModal( // Use the *dashboard's* confirm modal
                         'Confirm Project Deletion',
                         `Are you sure you want to delete project: <strong>${projectName}</strong>? This cannot be undone.`,
                         () => {
                             console.log(`Deleting project ${projectId}`);
                             // Simulate backend delete
                             setTimeout(() => {
                                 currentProjects.splice(projectIndex, 1);
                                 // Update "source" data
                                 mockProjectData = [...currentProjects];
                                 renderProjects(); // Re-render
                                 showToast(`Project "${projectName}" deleted.`, 'success');
                             }, 500);
                         },
                         'btn-danger' // Use danger style for delete button
                     );
                }
            }


            // --- Project Card Event Listener Handling ---
            function handleProjectCardClick(event) {
                 const target = event.target;
                 const card = target.closest('.project-card');
                 if (!card) return;
                 const projectId = card.dataset.projectId;

                 // Handle Pin Button Click
                 if (target.closest('.pin-project-btn')) {
                     event.stopPropagation(); // Prevent other card actions
                     togglePinProject(projectId);
                     return;
                 }
                 // Handle Delete Button Click
                 if (target.closest('.btn-delete')) {
                      event.stopPropagation();
                      deleteProject(projectId);
                     return;
                 }
                 // Handle View/Edit placeholder clicks (already have onclick)
                 // If view/edit were handled by JS, add cases here:
                 // if (target.closest('.btn-view')) { ... }
                 // if (target.closest('.btn-edit')) { ... }
             }

            // Attach delegated listeners to the list containers
            function attachProjectCardListeners() {
                 pinnedListContainer.removeEventListener('click', handleProjectCardClick); // Remove old listener first
                 regularListContainer.removeEventListener('click', handleProjectCardClick);
                 pinnedListContainer.addEventListener('click', handleProjectCardClick);
                 regularListContainer.addEventListener('click', handleProjectCardClick);
            }


            // --- Modal Logic (Using dashboard's modal functions) ---
             // Delete confirmation modal setup (specific to projects section)
            function setupProjectDeleteModal() {
                if (cancelDeleteBtn) cancelDeleteBtn.addEventListener('click', closeProjectConfirmationModal);
                if (confirmDeleteBtn) confirmDeleteBtn.addEventListener('click', () => {
                    if (cardToDelete) {
                         deleteProject(cardToDelete.dataset.projectId); // Call project delete function
                    }
                    closeProjectConfirmationModal(); // Close after initiating delete
                 });
                 if (modalBackdrop) modalBackdrop.addEventListener('click', (event) => {
                     if (event.target === modalBackdrop) {
                         closeProjectConfirmationModal();
                     }
                 });
            }
             function openProjectConfirmationModal(cardElement) {
                 cardToDelete = cardElement;
                 const projectName = cardToDelete.querySelector('.project-name')?.textContent || 'this project';
                 if (projectNameToDeleteSpan) projectNameToDeleteSpan.textContent = projectName;
                 if (modalBackdrop) modalBackdrop.classList.add('active');
             }
             function closeProjectConfirmationModal() {
                 if (modalBackdrop) modalBackdrop.classList.remove('active');
                 cardToDelete = null;
                 if (projectNameToDeleteSpan) projectNameToDeleteSpan.textContent = '';
             }
             // Re-attach delete listeners to cards - handled in renderProjects via attachProjectCardListeners

            // --- Initial Setup ---
            renderProjects(); // Initial render
            setupProjectDeleteModal(); // Setup the modal buttons (needed once)

            // --- Event Listeners for Filters ---
            searchInput.addEventListener('input', renderProjects);
            filterSelect.addEventListener('change', renderProjects);

             // Attach card listeners initially
            attachProjectCardListeners();

            // --- Cleanup Function ---
            const cleanup = () => {
                console.log("Cleaning up Projects feature listeners...");
                searchInput?.removeEventListener('input', renderProjects);
                filterSelect?.removeEventListener('change', renderProjects);
                pinnedListContainer?.removeEventListener('click', handleProjectCardClick);
                regularListContainer?.removeEventListener('click', handleProjectCardClick);
                // No need to remove modal button listeners as modal is removed with the container
                // If escape key listener was added *globally* by this feature, remove it here.
            };

            return cleanup;
        }
        // =============================================================
        // === END: JavaScript Logic for Projects Feature ============
        // =============================================================


        // =============================================================
        // === START: JavaScript Logic for Team Members Feature ======
        // =============================================================
        function initializeTeamMembersFeature(container) {
            console.log("Initializing Team Members Feature Logic...");

             // --- DOM Elements (Scoped to container) ---
            const searchInput = container.querySelector('#teamSearchInput');
            const teamListContainer = container.querySelector('#teamListContainer');

             if (!searchInput || !teamListContainer) {
                 console.error("Team Members feature: Search input or list container not found.");
                 return () => {}; // Return empty cleanup
             }

            const memberCards = teamListContainer.querySelectorAll('.team-member-card'); // Get cards *after* HTML is injected

             // --- Filter Function ---
            function filterTeamMembers() {
                 const filterText = searchInput.value.toLowerCase().trim();

                 memberCards.forEach(card => {
                    const name = (card.dataset.name || '').toLowerCase();
                    const role = (card.dataset.role || '').toLowerCase();
                    const email = (card.dataset.email || '').toLowerCase();

                    const isMatch = name.includes(filterText) ||
                                  role.includes(filterText) ||
                                  email.includes(filterText);

                    // Use CSS class for hiding instead of direct style manipulation
                    // Requires a CSS rule: .hidden-by-filter { display: none; }
                    // Add this rule to the main CSS if it doesn't exist
                    card.classList.toggle('hidden-by-filter', !isMatch);
                    card.style.display = isMatch ? 'flex' : 'none'; // Or keep using direct style
                 });
            }

             // --- Event Listeners ---
             searchInput.addEventListener('input', filterTeamMembers);

            // --- Initial Filter (Optional) ---
            // filterTeamMembers(); // Apply filter on load if needed

             // --- Cleanup Function ---
            const cleanup = () => {
                console.log("Cleaning up Team Members feature listeners...");
                searchInput?.removeEventListener('input', filterTeamMembers);
                 // Reset card visibility if using direct styles
                 memberCards.forEach(card => card.style.display = 'flex');
            };

            return cleanup;
        }
        // =============================================================
        // === END: JavaScript Logic for Team Members Feature ========
        // =============================================================


    </script>
</body>
</html>

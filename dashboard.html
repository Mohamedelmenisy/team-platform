<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Dashboard</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        /* --- Global Dashboard Styles --- */
        :root {
            /* Base App Colors */
            --app-primary: #0d6efd; --app-secondary: #6c757d; --app-success: #198754; --app-danger: #dc3545; --app-warning: #ffc107; --app-info: #0dcaf0; --app-purple: #6f42c1; --app-orange: #fd7e14; --app-teal: #20c997; --app-light: #f8f9fa; --app-dark: #212529; --app-hover-bg: #eef4ff; --app-header-bg: linear-gradient(90deg, hsla(217, 91%, 60%, 1) 0%, hsla(245, 100%, 70%, 1) 100%);
            /* Chart Colors */
            --chart-green: #4CAF50; --chart-blue: #2196F3; --chart-orange: #FFC107; --chart-red: #F44336; --chart-gray: #9E9E9E; --chart-purple: #9C27B0; --chart-cyan: #00BCD4;
            --chart-background: #F5F7FA;
            /* Opacity for fills */
            --chart-fill-opacity: 0.7; --chart-radar-fill-opacity: 0.15;
            /* Status & Priority Colors (Project Tracking) */
            --status-completed-bg: rgba(76, 175, 80, 0.15); --status-completed-text: #388E3C; --status-inprogress-bg: rgba(33, 150, 243, 0.15); --status-inprogress-text: #1976D2; --status-delayed-bg: rgba(255, 193, 7, 0.15); --status-delayed-text: #FFA000; --status-pending-bg: rgba(158, 158, 158, 0.15); --status-pending-text: #616161;
            --priority-high-bg: rgba(244, 67, 54, 0.15); --priority-high-text: #D32F2F; --priority-medium-bg: rgba(255, 193, 7, 0.15); --priority-medium-text: #FFA000; --priority-low-bg: rgba(76, 175, 80, 0.15); --priority-low-text: #388E3C;

            --sidebar-width: 260px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5; /* Consistent background */
            margin: 0;
            display: flex;
            min-height: 100vh;
        }

        #sidebar {
            width: var(--sidebar-width);
            background-color: var(--app-dark);
            color: #ccc;
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            overflow-y: auto;
            transition: width 0.3s ease;
        }

        #sidebar .logo {
            text-align: center;
            padding: 0 15px 20px 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
        }
        #sidebar .logo h4 {
            color: #fff;
            margin: 0;
            font-weight: 600;
        }
        #sidebar .logo i {
             color: var(--app-primary);
             margin-right: 8px;
        }


        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #sidebar ul li a {
            display: block;
            color: #ccc;
            text-decoration: none;
            padding: 12px 20px;
            transition: background-color 0.2s ease, color 0.2s ease, padding-left 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #sidebar ul li a i {
            margin-right: 12px;
            width: 20px; /* Icon alignment */
            text-align: center;
        }

        #sidebar ul li a:hover {
            background-color: #495057;
            color: #fff;
            padding-left: 25px;
        }

        #sidebar ul li a.active {
            background-color: var(--app-primary);
            color: #fff;
            font-weight: 500;
             padding-left: 25px;
        }

        #main-content {
            margin-left: var(--sidebar-width);
            padding: 25px;
            flex-grow: 1;
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            position: relative; /* For absolute positioned elements within sections */
        }

        /* Section Styling & Transition */
        .dashboard-section {
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            max-width: 1300px; /* Optional: constrain width */
            margin: 0 auto;   /* Optional: center content */
        }

        .dashboard-section.active {
            opacity: 1;
        }

        /* Ensure fancy titles are consistent */
        .dm-fancy-title, .pt-fancy-title, .fs-fancy-header-title, .ra-fancy-title {
            background: var(--app-header-bg);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px; /* Consistent bottom margin */
            border-bottom: none; /* Override any border */
        }
        .dm-fancy-title i, .pt-fancy-title i, .fs-fancy-header-title i, .ra-fancy-title i {
            margin-right: 10px;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 0; /* Hide sidebar */
            }
            #sidebar {
                 width: 0;
                 padding: 0;
                 overflow: hidden;
            }
             #main-content {
                 margin-left: 0;
                 padding: 15px;
             }
             /* Consider adding a toggle button for mobile */
        }


        /* --- Consolidated Styles from Files --- */

        /* === Data Management (datamanagemnt.txt) Styles === */
        #data-management-section { background-color: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* max-width: 1200px; */ /* Removed max-width here, handled by main-content */ margin: 0 auto; }
        .dm-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .dm-actions { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; }
        .dm-actions button, .dm-search-filter input[type="search"], .dm-search-filter select { padding: 10px 15px; border-radius: 5px; border: 1px solid #bdc3c7; font-size: 14px; height: 40px; box-sizing: border-box; }
        .dm-actions button { background-color: #3498db; color: white; cursor: pointer; transition: background-color 0.3s ease, transform 0.1s ease; display: inline-flex; align-items: center; border: none; }
        .dm-actions button:hover { background-color: #2980b9; transform: translateY(-1px); }
        .dm-actions button:active { transform: scale(0.98); }
        .dm-actions button i { margin-right: 8px; }
        .dm-actions button.dm-import-btn { background-color: #2ecc71; }
        .dm-actions button.dm-import-btn:hover { background-color: #27ae60; }
        .dm-actions button.dm-export-btn { background-color: #f39c12; }
        .dm-actions button.dm-export-btn:hover { background-color: #e67e22; }
        .dm-search-filter { display: flex; align-items: center; flex-grow: 1; min-width: 250px; flex-wrap: wrap; gap: 10px; }
        .dm-search-filter input[type="search"] { flex-grow: 1; min-width: 180px; }
        .dm-search-filter select { min-width: 150px; flex-grow: 1; }
        .dm-table-container { overflow-x: auto; }
        .dm-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .dm-table th, .dm-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ecf0f1; white-space: nowrap; }
        .dm-table th { background-color: #f8f9fa; font-weight: 600; color: #555; cursor: default; }
        .dm-table th i { margin-left: 5px; font-size: 0.8em; color: #bdc3c7; }
        .dm-table th:first-child, .dm-table td:first-child { width: 1%; white-space: nowrap; text-align: center; }
        .dm-table td:last-child { white-space: nowrap; width: 1%; text-align: center; }
        .dm-table tbody tr:hover { background-color: #f1f1f1; }
        .dm-table .dm-status { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; text-transform: capitalize; display: inline-block; text-align: center; min-width: 60px; }
        .dm-table .dm-status-active { background-color: #e8f5e9; color: #388e3c; }
        .dm-table .dm-status-pending { background-color: #fff3e0; color: #f57c00; }
        .dm-table .dm-status-inactive { background-color: #fce4ec; color: #d81b60; }
        .dm-table .dm-row-actions button { background: none; border: none; cursor: pointer; padding: 5px; margin: 0 4px; font-size: 16px; transition: color 0.2s ease, transform 0.1s ease; }
        .dm-table .dm-row-actions button:active { transform: scale(0.9); }
        .dm-table .dm-row-actions .dm-view-btn { color: #27ae60; }
        .dm-table .dm-row-actions .dm-edit-btn { color: #2980b9; }
        .dm-table .dm-row-actions .dm-delete-btn { color: #c0392b; }
        .dm-table .dm-row-actions .dm-view-btn:hover { color: #2ecc71; }
        .dm-table .dm-row-actions .dm-edit-btn:hover { color: #3498db; }
        .dm-table .dm-row-actions .dm-delete-btn:hover { color: #e74c3c; }
        .dm-pagination { display: flex; justify-content: center; align-items: center; margin-top: 20px; flex-wrap: wrap; gap: 5px; }
        .dm-pagination button, .dm-pagination span { padding: 8px 12px; border: 1px solid #ddd; background-color: #fff; border-radius: 4px; font-size: 14px; }
        .dm-pagination button { cursor: pointer; transition: background-color 0.2s ease; }
        .dm-pagination button:hover:not(:disabled) { background-color: #eee; }
        .dm-pagination button:disabled { cursor: not-allowed; opacity: 0.6; background-color: #f8f9fa; }
        .dm-pagination span.dm-page-info { border: none; background: none; padding: 8px 5px; }
        .dm-pagination span.dm-current-page { font-weight: bold; }
        .dm-table tbody tr.selected-row { background-color: #e0f2fe !important; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1050; /* Ensure above sidebar potentially */ opacity: 0; transition: opacity 0.3s ease; }
        .modal-content { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); width: 90%; max-width: 500px; position: relative; max-height: 80vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #aaa; transition: color 0.2s ease; }
        .modal-close-btn:hover { color: #333; }
        .modal-content h3 { margin-top: 0; color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        #add-edit-form label, #view-modal dt { display: block; margin-bottom: 5px; font-weight: 600; color: #555; margin-top: 15px; }
        #add-edit-form input[type="text"], #add-edit-form select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        #add-edit-form select { height: 40px; }
        #add-edit-form .form-actions { margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px; }
        #add-edit-form button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; transition: background-color 0.3s ease; }
        #add-edit-form .save-btn { background-color: #2ecc71; color: white; }
        #add-edit-form .save-btn:hover { background-color: #27ae60; }
        #add-edit-form .cancel-btn { background-color: #bdc3c7; color: #333; }
        #add-edit-form .cancel-btn:hover { background-color: #a9b4bb; }
        #view-modal dl { margin: 0; }
        #view-modal dt { margin-top: 10px; }
        #view-modal dd { margin-left: 0; margin-bottom: 10px; padding: 5px 8px; background-color: #f8f9fa; border: 1px solid #eee; border-radius: 4px; word-wrap: break-word; }
        #view-modal .dm-status { display: inline-block; }
        #message-box { position: fixed; top: 20px; right: 20px; background-color: #333; color: white; padding: 15px 25px; border-radius: 5px; box-shadow: 0 3px 8px rgba(0,0,0,0.2); z-index: 1055; /* Ensure above modals */ min-width: 250px; text-align: center; opacity: 0; transform: translateX(100%); transition: opacity 0.5s ease, transform 0.5s ease; visibility: hidden; }
        #message-box.show { opacity: 1; transform: translateX(0); visibility: visible; }
        #message-box.success { background-color: #2ecc71; }
        #message-box.error { background-color: #e74c3c; }
        #message-box.info { background-color: #3498db; }
        .swal2-confirm { background-color: #2ecc71 !important; color: white !important; }
        .swal2-cancel { background-color: #e74c3c !important; color: white !important; }
        @media (max-width: 992px) { /* DM Specific */ }
        @media (max-width: 768px) { /* DM Specific */
            .dm-toolbar { flex-direction: column; align-items: stretch; }
            .dm-search-filter { width: 100%; min-width: unset; margin-bottom: 15px; }
            .dm-search-filter input[type="search"], .dm-search-filter select { width: 100%; min-width: unset; }
            .dm-actions { width: 100%; display: flex; justify-content: space-around; gap: 10px; }
            .dm-actions button { flex-grow: 1; font-size: 13px; padding: 10px 8px; }
            .dm-actions button i { margin-right: 5px; }
            /* .modal-content { width: 95%; padding: 20px; } */ /* Handled globally potentially */
            #message-box { width: calc(100% - 40px); right: 10px; left: 10px; top: 10px; transform: translateY(-100%); }
            #message-box.show { transform: translateY(0); }
        }

        /* === Project Tracking (Project Tracking.txt) Styles === */
        #project-tracking-section .card { border: none; border-radius: 0.5rem; margin-bottom: 1.5rem; background: none; box-shadow: none; } /* Remove card bg/shadow */
        #project-tracking-section .card-header { background-color: #ffffff; border-bottom: 1px solid #e9ecef; padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; border-radius: 0.5rem 0.5rem 0 0; /* Rounded top corners */ }
        .pt-filters-section { background-color: #ffffff; padding: 0.75rem 1.25rem; border-radius: 0.375rem; border: 1px solid #e9ecef; margin-bottom: 1.5rem; }
        .pt-filters-section .form-label { font-size: 0.8rem; color: var(--app-secondary); margin-bottom: 0.25rem; font-weight: 500; }
        .pt-filters-section .form-select-sm { font-size: 0.875rem; }
        #resetProjectFiltersBtn { /* Uses btn-outline-secondary */ }
        .pt-visualizations .chart-container { background-color: var(--chart-background); padding: 20px; border-radius: 0.5rem; border: 1px solid #e9ecef; height: 300px; display: flex; flex-direction: column; margin-bottom: 1.5rem; }
        .pt-visualizations .chart-container canvas { max-width: 100%; height: auto; flex-grow: 1; }
        .pt-visualizations .chart-title { font-weight: 600; color: var(--app-secondary); margin-bottom: 15px; font-size: 0.9rem; text-align: center; }
        .pt-reminders { background-color: #ffffff; padding: 15px; border-radius: 0.5rem; border: 1px solid #e9ecef; height: 300px; display: flex; flex-direction: column; }
        .pt-reminders h6 { color: var(--app-primary); font-weight: 600; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .pt-reminders ul { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        .pt-reminders li { padding: 8px 5px; border-bottom: 1px dashed #eee; font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s ease; }
        .pt-reminders li:last-child { border-bottom: none; }
        .pt-reminders li:hover { background-color: var(--app-hover-bg); }
        .pt-reminders .deadline { font-size: 0.8em; color: var(--app-danger); font-weight: 500; }
        .pt-reminders .days-left { font-size: 0.75em; color: var(--app-secondary); font-style: italic; }
        .pt-table-container { background-color: #ffffff; padding: 20px; border-radius: 0.5rem; border: 1px solid #e9ecef; }
        .pt-table-container h5 { color: var(--app-primary); margin-bottom: 15px; font-weight: 600; }
        .pt-table thead { background-color: var(--app-light) !important; color: var(--app-secondary); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; }
        .pt-table tbody td { vertical-align: middle; font-size: 0.875rem; padding: 0.7rem 0.75rem; }
        .pt-table th[data-sort-by] { cursor: pointer; }
        .pt-table th .sort-icon { margin-left: 5px; color: #ccc; font-size: 0.8em; display: inline-block; width: 10px; text-align: center; }
        .pt-table th .sort-icon.active { color: var(--app-primary); }
        .pt-table .project-name { font-weight: 500; color: var(--app-dark); }
        .pt-table .assigned-team span { display: inline-block; background-color: #eee; color: #555; font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; margin-right: 3px; margin-bottom: 2px; white-space: nowrap; }
        .pt-table .progress-cell { min-width: 120px; }
        .pt-table .progress { height: 14px; background-color: #e9ecef; border-radius: 7px; overflow: hidden; position: relative; }
        .pt-table .progress-bar { font-size: 0.9rem; font-weight: bold; line-height: 14px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .pt-table .progress-bar.bg-progress-high { background-color: var(--chart-green) !important; color: white; }
        .pt-table .progress-bar.bg-progress-medium { background-color: var(--chart-orange) !important; color: #212529; }
        .pt-table .progress-bar.bg-progress-low { background-color: var(--chart-red) !important; color: white; }
        .pt-table .status-badge, .pt-table .priority-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: capitalize; display: inline-block; text-align: center; }
        .pt-table .status-completed { background-color: var(--status-completed-bg); color: var(--status-completed-text); }
        .pt-table .status-inprogress { background-color: var(--status-inprogress-bg); color: var(--status-inprogress-text); }
        .pt-table .status-delayed { background-color: var(--status-delayed-bg); color: var(--status-delayed-text); }
        .pt-table .status-pending { background-color: var(--status-pending-bg); color: var(--status-pending-text); }
        .pt-table .priority-high { background-color: var(--priority-high-bg); color: var(--priority-high-text); }
        .pt-table .priority-medium { background-color: var(--priority-medium-bg); color: var(--priority-medium-text); }
        .pt-table .priority-low { background-color: var(--priority-low-bg); color: var(--priority-low-text); }
        .pt-table .notes-cell { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: help; }
        .pt-pagination { display: flex; justify-content: center; align-items: center; margin-top: 20px; flex-wrap: wrap; gap: 5px; }
        .pt-pagination button, .pt-pagination span { padding: 8px 12px; border: 1px solid #ddd; background-color: #fff; border-radius: 4px; font-size: 14px; }
        .pt-pagination button { cursor: pointer; transition: background-color 0.2s ease; }
        .pt-pagination button:hover:not(:disabled) { background-color: #eee; }
        .pt-pagination button:disabled { cursor: not-allowed; opacity: 0.6; background-color: #f8f9fa; }
        .pt-pagination span.pt-page-info { border: none; background: none; padding: 8px 5px; }
        .pt-pagination span.pt-current-page { font-weight: bold; }
        @media (max-width: 992px) { .pt-visualizations .chart-container, .pt-reminders { height: 280px; } }
        @media (max-width: 768px) { /* PT Specific */
             #project-tracking-section .card-header { flex-direction: column; align-items: flex-start; }
             .pt-filters-section .row > div { margin-bottom: 10px; }
             .pt-visualizations .col-md-4, .pt-visualizations .col-md-8 { width: 100%; }
             .pt-reminders { margin-bottom: 1.5rem; }
             .pt-table .notes-cell { max-width: 100px; }
        }


        /* === File Sharing (filesharing.txt) Styles === */
        /* Added fs- prefix to avoid conflicts */
        #file-sharing-section { /* Container for the component */ }
        .fs-card { border: none; border-radius: 0.5rem; background-color: #ffffff; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); margin-bottom: 1.5rem; }
        .fs-card-header { background-color: #ffffff; border-bottom: 1px solid #e9ecef; padding: 0.75rem 1.25rem; border-radius: 0.5rem 0.5rem 0 0; }
        .fs-fancy-header-title { background: var(--app-header-bg); color: white; padding: 10px 20px; border-radius: 50px; display: inline-block; font-weight: 600; font-size: 1.1rem; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease; }
        .fs-fancy-header-title:hover { transform: scale(1.02); }
        .fs-card-header .d-flex { align-items: center; }
        .fs-file-icon { font-size: 1.6rem; vertical-align: middle; margin-right: 10px; width: 25px; text-align: center; }
        .fs-file-icon.text-danger { color: var(--app-danger) !important; }
        .fs-file-icon.text-success { color: var(--app-success) !important; }
        .fs-file-icon.text-warning { color: var(--app-warning) !important; }
        .fs-file-icon.text-primary { color: var(--app-primary) !important; }
        .fs-file-icon.text-info { color: var(--app-info) !important; }
        .fs-action-buttons .btn { margin: 0 3px; transition: all 0.2s ease-in-out; border-radius: 50px; padding: 0.25rem 0.6rem; font-size: 0.8rem; }
        .fs-action-buttons .btn:hover { transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .fs-action-btn .loading-spinner { display: none; margin: 0 2px; }
        .fs-action-btn.loading .original-icon { display: none; }
        .fs-action-btn.loading .loading-spinner { display: inline-block; }
        .fs-filters-section { background-color: #ffffff; padding: 1rem 1.25rem; border-radius: 0.375rem; border: 1px solid #e9ecef; margin-bottom: 1.5rem; }
        .fs-filters-section .form-label { font-size: 0.8rem; color: var(--app-secondary); margin-bottom: 0.25rem; }
        .fs-filters-section .form-control-sm, .fs-filters-section .form-select-sm { font-size: 0.875rem; }
        #fs-recentUploadsSection { background-color: #ffffff; border: 1px solid #e9ecef; border-radius: 0.375rem; padding: 1rem 1.25rem; }
        #fs-recentUploadsSection h6 { color: var(--app-primary); margin-bottom: 10px; font-weight: 600; }
        #fs-recentUploadsSection .list-group-item { border-bottom: 1px dashed #eee !important; padding: 8px 0 !important; background-color: transparent !important; border-top: none !important; border-left: none !important; border-right: none !important; }
        #fs-recentUploadsSection .list-group-item:last-child { border-bottom: 0 !important; }
        .fs-time-ago { font-style: normal; font-size: 0.85em; color: var(--app-secondary); }
        .fs-table { margin-bottom: 0; background-color: #ffffff; }
        .fs-table thead { background-color: var(--app-light) !important; color: var(--app-secondary); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; }
        .fs-table tbody tr td { vertical-align: middle; padding: 0.85rem 0.75rem; }
        .fs-table-hover > tbody > tr:hover > * { background-color: var(--app-hover-bg) !important; cursor: default; }
        .fs-file-name { font-weight: 500; color: var(--app-dark); }
        /* .fs-badge { font-size: 0.75em; padding: 0.35em 0.6em; font-weight: 500; } Use Bootstrap's default badges */
        .fs-upload-area { border: 2px dashed var(--app-primary); padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer; background-color: var(--app-light); border-radius: 8px; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .fs-upload-area:hover { background-color: var(--app-hover-bg); border-color: lighten(var(--app-primary), 10%); }
        .fs-upload-area i { color: var(--app-primary); }
        #fs-uploadProgressContainer .progress-bar.bg-success { background-color: var(--app-success) !important; }
        #fs-uploadProgressContainer .progress-bar.bg-danger { background-color: var(--app-danger) !important; }
        #fs-uploadProgressContainer .progress-bar { background-color: var(--app-primary); }


        /* === Reports & Analytics (Reports & Analytic.txt) Styles === */
        #reports-analytics-section .card { border: none; border-radius: 0.5rem; margin-bottom: 1.5rem; background: none; box-shadow: none;} /* Remove card bg/shadow */
        #reports-analytics-section .card-header { background-color: #ffffff; border-bottom: 1px solid #e9ecef; padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; border-radius: 0.5rem 0.5rem 0 0; /* Rounded top corners */}
        .ra-export-buttons .btn { font-size: 0.8rem; padding: 0.375rem 0.75rem; }
        .ra-export-buttons .btn i { margin-right: 5px; }
        .ra-filters-section { background-color: #ffffff; padding: 0.75rem 1.25rem; border-radius: 0.375rem; border: 1px solid #e9ecef; margin-bottom: 1.5rem; }
        .ra-filters-section .btn-group .btn { font-size: 0.85rem; padding: 0.375rem 0.85rem; }
        .ra-filters-section .form-label { font-size: 0.8rem; color: var(--app-secondary); margin-bottom: 0.25rem; font-weight: 500; }
        .ra-filters-section input[type="date"] { font-size: 0.85rem; padding: 0.375rem 0.75rem; max-width: 150px; }
        .ra-chart-container { background-color: var(--chart-background); padding: 20px; border-radius: 0.5rem; border: 1px solid #e9ecef; height: 350px; display: flex; flex-direction: column; }
        .ra-chart-container canvas { max-width: 100%; height: auto; flex-grow: 1; }
        .ra-chart-title { font-weight: 600; color: var(--app-secondary); margin-bottom: 15px; font-size: 0.9rem; text-align: center; }
        .ra-table-container { background-color: #ffffff; padding: 20px; border-radius: 0.5rem; border: 1px solid #e9ecef; }
        .ra-table-container h5 { color: var(--app-primary); margin-bottom: 15px; font-weight: 600; }
        .ra-table thead { background-color: var(--app-light) !important; color: var(--app-secondary); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; }
        .ra-table tbody td { vertical-align: middle; font-size: 0.875rem; padding-top: 0.6rem; padding-bottom: 0.6rem; }
        .ra-table .employee-name { font-weight: 500; color: var(--app-dark); padding-left: 5px; }
        .ra-table .progress { height: 14px; background-color: #e9ecef; min-width: 100px; border-radius: 7px; overflow: hidden; position: relative; }
        .ra-table .progress-bar { font-size: 0.9rem; font-weight: bold; line-height: 14px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .ra-table .progress-bar.bg-progress-high { background-color: var(--chart-green) !important; color: white; }
        .ra-table .progress-bar.bg-progress-medium { background-color: var(--chart-orange) !important; color: #212529; }
        .ra-table .progress-bar.bg-progress-low { background-color: var(--chart-red) !important; color: white; }
        .ra-table .metric-value { font-weight: 500; }
        .ra-table .text-success { color: var(--chart-green) !important; }
        .ra-table .text-danger { color: var(--chart-red) !important; }
        .ra-table .text-info { color: var(--chart-blue) !important; }
        .ra-table .text-warning { color: var(--chart-orange) !important; }
        @media (max-width: 768px) { /* RA Specific */
             .ra-chart-container { height: 300px; }
             .ra-filters-section .d-flex { flex-direction: column; align-items: stretch !important; }
             .ra-filters-section .btn-group, .ra-filters-section input[type="date"] { width: 100%; margin-bottom: 10px; }
             .ra-filters-section input[type="date"] { max-width: none; }
             .ra-filters-section button[type="submit"] { width: 100%; }
             #reports-analytics-section .card-header { flex-direction: column; align-items: flex-start; }
             .ra-export-buttons { margin-top: 10px; width: 100%; text-align: right; }
        }

    </style>
</head>
<body>

    <!-- Sidebar Navigation -->
    <nav id="sidebar">
        <div class="logo">
             <h4><i class="fas fa-tachometer-alt"></i> My Dashboard</h4>
        </div>
        <ul>
            <li><a href="#" class="nav-link active" data-section-target="dashboard"><i class="fas fa-home fa-fw"></i> Dashboard</a></li>
            <li><a href="#" class="nav-link" data-section-target="data-management"><i class="fas fa-database fa-fw"></i> Data Management</a></li>
            <li><a href="#" class="nav-link" data-section-target="project-tracking"><i class="fas fa-tasks fa-fw"></i> Project Tracking</a></li>
            <li><a href="#" class="nav-link" data-section-target="file-sharing"><i class="fas fa-folder-open fa-fw"></i> File Sharing</a></li>
            <li><a href="#" class="nav-link" data-section-target="reports-analytics"><i class="fas fa-chart-pie fa-fw"></i> Reports & Analytics</a></li>
            <!-- Add other navigation links here -->
        </ul>
    </nav>

    <!-- Main Content Area -->
    <main id="main-content">

        <!-- === Dashboard Section (Default View) === -->
        <div id="section-dashboard" class="dashboard-section active" style="display: block;"> <!-- Initial visible section -->
            <h2 class="ra-fancy-title"><i class="fas fa-home me-2"></i> Dashboard Overview</h2>
            <div class="p-4 bg-white rounded shadow-sm">
                <h4>Welcome to your Dashboard!</h4>
                <p>Select a section from the sidebar to view specific modules like Data Management, Project Tracking, File Sharing, or Reports & Analytics.</p>
                <!-- Add summary widgets or overview info here -->
                 <div class="alert alert-info" role="alert">
                   <i class="fas fa-info-circle me-2"></i> Use the navigation on the left to access different management tools.
                 </div>
            </div>
        </div>

        <!-- === Data Management Section === -->
        <div id="section-data-management" class="dashboard-section" style="display: none;">
            <!-- Content from datamanagemnt.txt (Body Content Only) -->
            <div id="data-management-section">
                <h2 class="dm-fancy-title"><i class="fas fa-database"></i> Data Management</h2>

                <!-- Toolbar -->
                <div class="dm-toolbar">
                    <div class="dm-search-filter">
                        <input type="search" id="dm-search-input" placeholder="Search data (ID, Name, etc.)...">
                        <select id="dm-filter-status">
                            <option value="">Filter by Status...</option>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <select id="dm-filter-responsible">
                            <option value="">Filter by Responsible...</option>
                            <option value="Nada Mahmoud">Nada Mahmoud</option>
                            <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                            <option value="Yousef Ahmed">Yousef Ahmed</option>
                            <option value="Esraa Lashin">Esraa Lashin</option>
                            <option value="Basssant Badr">Basssant Badr</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="dm-actions">
                        <button id="dm-add-new-btn" class="dm-add-btn"><i class="fas fa-plus"></i> Add New</button>
                        <button id="dm-import-btn" class="dm-import-btn"><i class="fas fa-file-import"></i> Import</button>
                        <button id="dm-export-btn" class="dm-export-btn"><i class="fas fa-file-export"></i> Export</button>
                    </div>
                </div>

                <!-- Table Container -->
                <div class="dm-table-container">
                    <table class="dm-table" id="dm-data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="dm-select-all" title="Select All"></th>
                                <th>ID</th>
                                <th>Record Name</th>
                                <th>Creation Date</th>
                                <th>Responsible</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dm-table-body">
                             <tr><td colspan="8" style="text-align:center; padding: 20px;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination Controls -->
                <div class="dm-pagination" id="dm-pagination-controls">
                     <!-- Pagination will be rendered by JavaScript -->
                </div>
            </div>

            <!-- Add/Edit Modal -->
            <div id="add-edit-modal" class="modal-overlay">
                <div class="modal-content">
                    <button class="modal-close-btn" data-close-modal>×</button>
                    <h3 id="modal-title">Add New Record</h3>
                    <form id="add-edit-form">
                        <input type="hidden" id="edit-record-id">
                        <div>
                            <label for="record-name">Record Name:</label>
                            <input type="text" id="record-name" name="recordName" required>
                        </div>
                         <div>
                            <label for="responsible">Responsible:</label>
                            <select id="responsible" name="responsible" required>
                                <option value="" disabled selected>-- Select Person --</option>
                                <option value="Nada Mahmoud">Nada Mahmoud</option>
                                <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                                <option value="Yousef Ahmed">Yousef Ahmed</option>
                                <option value="Esraa Lashin">Esraa Lashin</option>
                                <option value="Basssant Badr">Basssant Badr</option>
                                <option value="Other">Other</option>
                            </select>
                         </div>
                         <div>
                            <label for="status">Status:</label>
                            <select id="status" name="status" required>
                                 <option value="" disabled selected>-- Select Status --</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="inactive">Inactive</option>
                            </select>
                         </div>
                         <div class="form-actions">
                             <button type="button" class="cancel-btn" data-close-modal>Cancel</button>
                             <button type="submit" class="save-btn">Save Record</button>
                         </div>
                    </form>
                </div>
            </div>

            <!-- View Modal -->
             <div id="view-modal" class="modal-overlay">
                <div class="modal-content">
                    <button class="modal-close-btn" data-close-modal>×</button>
                    <h3>Record Details</h3>
                    <dl id="view-details">
                        <dt>ID:</dt><dd id="view-id"></dd>
                        <dt>Record Name:</dt><dd id="view-name"></dd>
                        <dt>Creation Date:</dt><dd id="view-creation-date"></dd>
                         <dt>Responsible:</dt><dd id="view-responsible"></dd>
                         <dt>Status:</dt><dd id="view-status"></dd>
                         <dt>Last Updated:</dt><dd id="view-last-updated"></dd>
                    </dl>
                     <div class="form-actions">
                         <button type="button" class="cancel-btn" data-close-modal>Close</button>
                     </div>
                </div>
            </div>

            <!-- Message Box -->
            <div id="message-box"></div>
            <!-- End Data Management Content -->
        </div>

        <!-- === Project Tracking Section === -->
        <div id="section-project-tracking" class="dashboard-section" style="display: none;">
             <!-- Content from Project Tracking.txt (Body Content Only) -->
            <div id="project-tracking-section">

                <!-- Section Header -->
                <div class="card-header bg-white border-0 mb-3">
                    <h2 class="pt-fancy-title"><i class="fas fa-tasks me-2"></i> Project Tracking</h2>
                     <!-- Header content like export can go here if needed -->
                </div>

                <!-- Filters -->
                <div class="pt-filters-section">
                    <div class="row gy-2 align-items-end">
                        <div class="col-md-4">
                            <label for="project-status-filter" class="form-label">Filter by Status:</label>
                            <select class="form-select form-select-sm" id="project-status-filter">
                                <option value="" selected>All Statuses</option>
                                <option value="Completed">Completed</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Delayed">Delayed</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="project-team-filter" class="form-label">Filter by Team/Member:</label>
                            <select class="form-select form-select-sm" id="project-team-filter">
                                <option value="" selected>All Teams/Members</option>
                                <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                                <option value="Yousef Ahmed">Yousef Ahmed</option>
                                <option value="Esraa Lashin">Esraa Lashin</option>
                                <option value="Basssant Badr">Basssant Badr</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                             <label for="project-priority-filter" class="form-label">Filter by Priority:</label>
                            <select class="form-select form-select-sm" id="project-priority-filter">
                                <option value="" selected>All Priorities</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div class="col-md-2 text-end">
                            <button class="btn btn-sm btn-outline-secondary w-100" id="resetProjectFiltersBtn" title="Reset Filters">
                                <i class="fas fa-sync-alt me-1"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Visualizations & Reminders -->
                <div class="row g-3 pt-visualizations">
                     <div class="col-lg-8">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="pt-visualizations chart-container"> <!-- Used pt-visualizations class for consistency -->
                                    <p class="chart-title">Project Status Distribution</p>
                                    <canvas id="projectStatusPieChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="pt-visualizations chart-container">
                                     <p class="chart-title">Overall Progress Trend (Simulated)</p>
                                     <canvas id="projectProgressLineChart"></canvas>
                                </div>
                            </div>
                        </div>
                     </div>
                     <div class="col-lg-4">
                         <div class="pt-reminders">
                             <h6><i class="fas fa-bell me-1 text-warning"></i> Upcoming Deadlines (Next 7 Days)</h6>
                             <ul id="upcomingDeadlinesList">
                                 <li class="text-muted text-center pt-5">Loading deadlines...</li>
                             </ul>
                         </div>
                     </div>
                </div>


                <!-- Project Table -->
                <div class="mt-4 pt-table-container">
                     <h5><i class="fas fa-list-check me-2"></i> Project Details</h5>
                     <div class="table-responsive">
                        <table class="table table-sm table-hover table-striped align-middle pt-table" id="projectTrackingTable">
                            <thead>
                                <tr>
                                    <th data-sort-by="name">Project Name <i class="fas fa-sort sort-icon"></i></th>
                                    <th data-sort-by="startDate">Start Date <i class="fas fa-sort sort-icon"></i></th>
                                    <th data-sort-by="endDate">End Date <i class="fas fa-sort sort-icon"></i></th>
                                    <th>Assigned Team</th>
                                    <th class="text-center progress-cell" data-sort-by="progress">Progress (%) <i class="fas fa-sort sort-icon"></i></th>
                                    <th class="text-center" data-sort-by="status">Status <i class="fas fa-sort sort-icon"></i></th>
                                    <th class="text-center" data-sort-by="priority">Priority <i class="fas fa-sort sort-icon"></i></th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody id="projectTableBody">
                                 <tr>
                                     <td colspan="8" class="text-center p-4 text-muted">
                                         <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                         </div>
                                         Loading project data...
                                     </td>
                                 </tr>
                            </tbody>
                        </table>
                     </div>
                     <div class="pt-pagination" id="projectPaginationControls"></div>
                </div>

            </div>
            <!-- End Project Tracking Content -->
        </div>

        <!-- === File Sharing Section === -->
        <div id="section-file-sharing" class="dashboard-section" style="display: none;">
             <!-- Content from filesharing.txt (Body Content Only) -->
             <div id="file-sharing-section"> <!-- Added wrapper ID -->
                <div class="fs-card shadow-sm"> <!-- Prefixed -->
                    <div class="fs-card-header d-flex justify-content-between align-items-center"> <!-- Prefixed -->
                         <h5 class="mb-0 fs-fancy-header-title"><i class="fas fa-folder-open me-2"></i>File Management</h5> <!-- Prefixed -->
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#fs-uploadFileModal">
                            <i class="fas fa-upload me-1"></i> Upload New File
                        </button>
                    </div>

                    <div class="card-body pt-3">

                        <!-- Filters Section -->
                        <div class="row fs-filters-section gy-2 align-items-end"> <!-- Prefixed -->
                            <div class="col-md-4">
                                 <label for="fs-fileSearchInput" class="form-label">Search by Name</label>
                                <div class="input-group input-group-sm search-input">
                                    <input type="text" class="form-control form-control-sm" placeholder="Enter file name..." id="fs-fileSearchInput">
                                     <span class="input-group-text"><i class="fas fa-search"></i></span>
                                </div>
                            </div>
                            <div class="col-md-2">
                                 <label for="fs-fileTypeFilter" class="form-label">File Type</label>
                                 <select class="form-select form-select-sm" id="fs-fileTypeFilter" title="Filter by Type">
                                    <option value="" selected>All Types</option>
                                    <option value="PDF">PDF</option>
                                    <option value="Image">Image</option>
                                    <option value="Video">Video</option>
                                    <option value="Archive">Archive</option>
                                    <option value="Document">Document</option>
                                    <option value="Spreadsheet">Spreadsheet</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="fs-uploadDateFilter" class="form-label">Upload Date</label>
                                <input type="date" class="form-control form-control-sm" id="fs-uploadDateFilter" title="Filter by Upload Date">
                            </div>
                            <div class="col-md-2" id="fs-userFilterContainer" style="display: none;">
                                <label for="fs-userFilter" class="form-label">Uploader</label>
                                 <select class="form-select form-select-sm" id="fs-userFilter" title="Filter by Uploader">
                                    <option value="" selected>All Users</option>
                                    <option value="Mohamed Elmenisy">Mohamed Elmenisy</option>
                                    <option value="Nada Mahmoud">Nada Mahmoud</option>
                                    <option value="Yoused Ahmed">Yoused Ahmed</option>
                                    <option value="Esraa Lashin">Esraa Lashin</option>
                                    <option value="Bassant Badr">Bassant Badr</option>
                                </select>
                            </div>
                             <div class="col-md-1 text-end">
                                <button class="btn btn-sm btn-outline-secondary" id="fs-resetFiltersBtn" title="Reset Filters">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                             </div>
                        </div>

                        <!-- Recent Uploads Section -->
                        <div class="mb-4 p-3" id="fs-recentUploadsSection"> <!-- Prefixed ID -->
                            <h6><i class="fas fa-history me-1"></i> Recent Uploads</h6>
                            <ul class="list-group list-group-flush">
                                <!-- Timestamps fixed and auto-updating -->
                                <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 5 * 60 * 1000).toISOString()}">
                                   <div><i class="fas fa-file-pdf fs-file-icon text-danger"></i> Quarterly_Report_Q1.pdf</div>
                                   <small class="text-muted fs-time-ago">calculating...</small> <!-- Prefixed -->
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()}">
                                   <div><i class="fas fa-file-image fs-file-icon text-success"></i> New_Company_Logo.png</div>
                                   <small class="text-muted fs-time-ago">calculating...</small> <!-- Prefixed -->
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center" data-timestamp="${new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()}">
                                   <div><i class="fas fa-file-zipper fs-file-icon text-warning"></i> Final_Project_Assets.zip</div>
                                   <small class="text-muted fs-time-ago">calculating...</small> <!-- Prefixed -->
                                </li>
                            </ul>
                        </div>

                        <!-- Files Table -->
                        <div class="table-responsive">
                            <table class="table table-hover align-middle fs-table fs-table-hover"> <!-- Prefixed -->
                                <thead>
                                    <tr>
                                        <th scope="col" style="width: 5%;">Type</th>
                                        <th scope="col" style="width: 30%;">File Name</th>
                                        <th scope="col" style="width: 18%;">Upload Date</th>
                                        <th scope="col" style="width: 17%;">Tags</th>
                                        <th scope="col" style="width: 15%;">Uploader</th>
                                        <th scope="col" class="text-center" style="width: 15%;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="fs-fileTableBody"> <!-- Prefixed -->
                                    <!-- Rows with data attributes -->
                                    <tr data-file-type="PDF" data-upload-date="2024-05-25" data-uploader="Mohamed Elmenisy">
                                        <td><i class="fas fa-file-pdf fs-file-icon text-danger" title="PDF"></i></td>
                                        <td>
                                            <strong class="fs-file-name">Monthly Performance Report.pdf</strong>
                                            <small class="d-block text-muted">Size: 2.5 MB</small>
                                        </td>
                                        <td class="upload-date">May 25, 2024, 10:30 AM</td>
                                        <td>
                                            <span class="badge text-bg-primary">Reports</span>
                                            <span class="badge text-bg-secondary">Monthly</span>
                                        </td>
                                        <td class="uploader-shared">Mohamed Elmenisy</td>
                                        <td class="text-center fs-action-buttons">
                                            <button class="btn btn-sm btn-outline-success fs-action-btn download-btn" title="Download" data-file-id="1" data-file-url="path/to/report.pdf">
                                                <i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span>
                                            </button>
                                            <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#fs-filePreviewModal" data-file-type="PDF" data-file-url="path/to/report.pdf">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger fs-action-btn delete-btn" title="Delete" data-file-id="1">
                                                <i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span>
                                            </button>
                                        </td>
                                    </tr>
                                     <tr data-file-type="Image" data-upload-date="2024-05-24" data-uploader="Nada Mahmoud">
                                        <td><i class="fas fa-file-image fs-file-icon text-success" title="Image"></i></td>
                                        <td><strong class="fs-file-name">New Product Photo.jpg</strong><small class="d-block text-muted">Size: 800 KB</small></td>
                                        <td class="upload-date">May 24, 2024, 03:15 PM</td>
                                        <td><span class="badge text-bg-warning">Products</span> <span class="badge text-bg-info">Design</span></td>
                                        <td class="uploader-shared">Nada Mahmoud</td>
                                        <td class="text-center fs-action-buttons">
                                           <button class="btn btn-sm btn-outline-success fs-action-btn download-btn" title="Download" data-file-id="2" data-file-url="path/to/image.jpg"><i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                           <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#fs-filePreviewModal" data-file-type="Image" data-file-url="path/to/image.jpg"><i class="fas fa-eye"></i></button>
                                           <button class="btn btn-sm btn-outline-danger fs-action-btn delete-btn" title="Delete" data-file-id="2"><i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                        </td>
                                    </tr>
                                     <tr data-file-type="Archive" data-upload-date="2024-05-23" data-uploader="Yoused Ahmed">
                                        <td><i class="fas fa-file-zipper fs-file-icon text-warning" title="Archive"></i></td>
                                        <td><strong class="fs-file-name">Project Resources.zip</strong><small class="d-block text-muted">Size: 15.2 MB</small></td>
                                        <td class="upload-date">May 23, 2024, 09:00 AM</td>
                                        <td><span class="badge text-bg-dark">Project X</span></td>
                                        <td class="uploader-shared">Yoused Ahmed</td>
                                        <td class="text-center fs-action-buttons">
                                            <button class="btn btn-sm btn-outline-success fs-action-btn download-btn" title="Download" data-file-id="3" data-file-url="path/to/archive.zip"><i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                           <button class="btn btn-sm btn-outline-danger fs-action-btn delete-btn" title="Delete" data-file-id="3"><i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                        </td>
                                    </tr>
                                     <tr data-file-type="PDF" data-upload-date="2024-05-22" data-uploader="Esraa Lashin">
                                        <td><i class="fas fa-file-pdf fs-file-icon text-danger" title="PDF"></i></td>
                                        <td><strong class="fs-file-name">Meeting Agenda.pdf</strong><small class="d-block text-muted">Size: 150 KB</small></td>
                                        <td class="upload-date">May 22, 2024, 11:00 AM</td>
                                        <td><span class="badge text-bg-info">Meetings</span></td>
                                        <td class="uploader-shared">Esraa Lashin</td>
                                        <td class="text-center fs-action-buttons">
                                            <button class="btn btn-sm btn-outline-success fs-action-btn download-btn" title="Download" data-file-id="4" data-file-url="path/to/agenda.pdf"><i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                            <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#fs-filePreviewModal" data-file-type="PDF" data-file-url="path/to/agenda.pdf"><i class="fas fa-eye"></i></button>
                                           <button class="btn btn-sm btn-outline-danger fs-action-btn delete-btn" title="Delete" data-file-id="4"><i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                        </td>
                                    </tr>
                                     <tr data-file-type="Image" data-upload-date="2024-05-26" data-uploader="Bassant Badr">
                                        <td><i class="fas fa-file-image fs-file-icon text-success" title="Image"></i></td>
                                        <td><strong class="fs-file-name">Team Photo.png</strong><small class="d-block text-muted">Size: 1.2 MB</small></td>
                                        <td class="upload-date">May 26, 2024, 09:00 AM</td>
                                        <td><span class="badge text-bg-secondary">Team</span></td>
                                        <td class="uploader-shared">Bassant Badr</td>
                                        <td class="text-center fs-action-buttons">
                                            <button class="btn btn-sm btn-outline-success fs-action-btn download-btn" title="Download" data-file-id="5" data-file-url="path/to/team.png"><i class="fas fa-download original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                            <button class="btn btn-sm btn-outline-info preview-btn" title="Preview" data-bs-toggle="modal" data-bs-target="#fs-filePreviewModal" data-file-type="Image" data-file-url="path/to/team.png"><i class="fas fa-eye"></i></button>
                                           <button class="btn btn-sm btn-outline-danger fs-action-btn delete-btn" title="Delete" data-file-id="5"><i class="fas fa-trash-alt original-icon"></i><span class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></span></button>
                                        </td>
                                    </tr>
                                    <tr id="fs-noResultsRow" style="display: none;"> <!-- Prefixed -->
                                         <td colspan="6" class="text-center text-muted fst-italic py-4">No files found matching your criteria.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination (Optional) -->
                        <nav aria-label="File list navigation" class="mt-3 d-flex justify-content-center">
                            <!-- Pagination items here -->
                        </nav>

                    </div> <!-- End card-body -->
                </div> <!-- End fs-card -->

                <!-- Modals -->
                 <div class="modal fade" id="fs-uploadFileModal" tabindex="-1" aria-labelledby="fs-uploadFileModalLabel" aria-hidden="true"> <!-- Prefixed -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="fs-uploadFileModalLabel"><i class="fas fa-cloud-upload-alt me-2"></i>Upload New File</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="fs-upload-area" id="fs-dropZone"> <!-- Prefixed -->
                                    <p><i class="fas fa-cloud-upload-alt fa-3x mb-2"></i></p>
                                    <p>Drag & drop files here or click to select</p>
                                    <input type="file" id="fs-fileInputHidden" multiple hidden> <!-- Prefixed -->
                                </div>
                                <div class="mb-3">
                                    <label for="fs-fileInputManual" class="form-label">Or select file(s):</label>
                                    <input class="form-control form-control-sm" type="file" id="fs-fileInputManual" multiple> <!-- Prefixed -->
                                </div>
                                <div class="mb-3">
                                    <label for="fs-fileTagsInput" class="form-label"><i class="fas fa-tags me-1"></i>Add Tags (comma-separated):</label>
                                    <input type="text" class="form-control form-control-sm" id="fs-fileTagsInput" placeholder="e.g., reports, important, 2024"> <!-- Prefixed -->
                                </div>
                                <div id="fs-uploadProgressContainer" class="mt-3" style="display: none;"> <!-- Prefixed -->
                                     <div class="d-flex justify-content-between">
                                        <small id="fs-uploadFileName" class="text-muted">Uploading file...</small> <!-- Prefixed -->
                                        <small id="fs-uploadPercentage" class="text-muted">0%</small> <!-- Prefixed -->
                                     </div>
                                    <div class="progress mt-1" style="height: 10px;">
                                        <div id="fs-uploadProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div> <!-- Prefixed -->
                                    </div>
                                    <small id="fs-uploadStatus" class="text-muted d-block mt-1"></small> <!-- Prefixed -->
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-sm btn-primary" id="fs-startUploadButton">Start Upload</button> <!-- Prefixed -->
                            </div>
                        </div>
                    </div>
                </div>

                 <div class="modal fade" id="fs-filePreviewModal" tabindex="-1" aria-labelledby="fs-filePreviewModalLabel" aria-hidden="true"> <!-- Prefixed -->
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="fs-filePreviewModalLabel">File Preview</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center" style="min-height: 400px; max-height: 80vh; overflow-y: auto;">
                                <div id="fs-previewContent"> <!-- Prefixed -->
                                     <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
                                        <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
                                     </div>
                                </div>
                            </div>
                             <div class="modal-footer justify-content-start py-2">
                                 <small class="text-muted me-3" id="fs-previewFileName">File Name: </small> <!-- Prefixed -->
                                 <small class="text-muted" id="fs-previewFileType">Type: </small> <!-- Prefixed -->
                             </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End File Sharing Content -->
        </div>

        <!-- === Reports & Analytics Section === -->
        <div id="section-reports-analytics" class="dashboard-section" style="display: none;">
             <!-- Content from Reports & Analytic.txt (Body Content Only) -->
             <div id="reports-analytics-section">

                <!-- Section Header with Export Buttons -->
                <div class="card-header bg-white border-0 mb-3">
                    <h2 class="ra-fancy-title"><i class="fas fa-chart-pie me-2"></i> Reports & Analytics</h2>
                    <div class="ra-export-buttons">
                         <button id="exportPdfBtn" class="btn btn-sm btn-outline-danger">
                             <i class="fas fa-file-pdf"></i> Export PDF
                         </button>
                         <button id="exportExcelBtn" class="btn btn-sm btn-outline-success">
                             <i class="fas fa-file-excel"></i> Export Excel
                         </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="ra-filters-section">
                    <form id="reports-filter-form">
                         <div class="row gy-2 align-items-end">
                            <div class="col-md-auto">
                                <label class="form-label">Quick Period:</label>
                                <div class="btn-group w-100" role="group" aria-label="Report Period" id="periodBtnGroup">
                                    <input type="radio" class="btn-check" name="period" id="period-day" autocomplete="off" value="day">
                                    <label class="btn btn-sm btn-outline-secondary" for="period-day">Day</label>
                                    <input type="radio" class="btn-check" name="period" id="period-week" autocomplete="off" value="week" checked>
                                    <label class="btn btn-sm btn-outline-secondary" for="period-week">Week</label>
                                    <input type="radio" class="btn-check" name="period" id="period-month" autocomplete="off" value="month">
                                    <label class="btn btn-sm btn-outline-secondary" for="period-month">Month</label>
                                </div>
                            </div>
                             <div class="col-md">
                                <label for="report-start-date" class="form-label">Start Date:</label>
                                <input type="date" class="form-control form-control-sm" id="report-start-date" name="startDate" required>
                            </div>
                             <div class="col-md">
                                <label for="report-end-date" class="form-label">End Date:</label>
                                <input type="date" class="form-control form-control-sm" id="report-end-date" name="endDate" required>
                            </div>
                             <div class="col-md-auto">
                                <button type="submit" class="btn btn-sm btn-primary w-100">
                                    <i class="fas fa-sync-alt me-1"></i> Update Report
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Charts Section -->
                <div class="row g-4">
                    <div class="col-lg-4 col-md-6">
                         <div class="ra-chart-container"> <!-- Prefixed -->
                             <p class="ra-chart-title">Task Completion Rate (%)</p> <!-- Prefixed -->
                             <canvas id="taskCompletionChart"></canvas>
                         </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                         <div class="ra-chart-container"> <!-- Prefixed -->
                             <p class="ra-chart-title">Overdue Tasks Count</p> <!-- Prefixed -->
                             <canvas id="overdueTasksChart"></canvas>
                         </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="ra-chart-container"> <!-- Prefixed -->
                             <p class="ra-chart-title">Files Uploaded by Employee</p> <!-- Prefixed -->
                             <canvas id="filesUploadedChart"></canvas>
                         </div>
                    </div>
                    <div class="col-lg-12">
                         <div class="ra-chart-container" style="height: 400px;"> <!-- Prefixed -->
                             <p class="ra-chart-title">Employee Performance Comparison</p> <!-- Prefixed -->
                             <canvas id="performanceComparisonChart"></canvas>
                         </div>
                    </div>
                </div>

                <!-- Employee Summary Table Section -->
                <div class="mt-4 ra-table-container"> <!-- Prefixed -->
                     <h5><i class="fas fa-users me-2"></i> Employee Performance Summary</h5>
                     <div class="table-responsive">
                        <table class="table table-sm table-hover table-striped align-middle ra-table" id="employeeSummaryTable"> <!-- Prefixed -->
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th class="text-center">Tasks Completed (%)</th>
                                    <th class="text-center">Overdue Tasks</th>
                                    <th class="text-center">Files Uploaded</th>
                                    <th class="text-center">Activity Score</th>
                                </tr>
                            </thead>
                            <tbody id="employeeSummaryTableBody">
                                 <tr><td colspan="5" class="text-center p-4 text-muted"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div><span class="ms-2">Loading employee data...</span></td></tr>
                            </tbody>
                        </table>
                     </div>
                </div>

            </div>
             <!-- End Reports & Analytics Content -->
        </div>

    </main>

    <!-- JS Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script defer src="https://use.fontawesome.com/releases/v6.0.0/js/all.js"></script> <!-- Font Awesome JS (if needed, might be covered by v6.4.0) -->


    <!-- Consolidated & Dashboard Control JavaScript -->
    <script>
        // --- Dashboard Navigation Logic ---
        const navLinks = document.querySelectorAll('#sidebar .nav-link');
        const sections = document.querySelectorAll('#main-content .dashboard-section');

        // Store chart instances globally ONLY IF NEEDED by reinitialize function
        // Data Management does not have charts in the provided code
        // Project Tracking chart instances (defined inside its DOMContentLoaded)
        let pt_statusPieChartInstance = null;
        let pt_progressLineChartInstance = null;
        // File Sharing does not have charts
        // Reports & Analytics chart instances (defined inside its DOMContentLoaded)
        let ra_taskCompletionChartInstance = null;
        let ra_overdueTasksChartInstance = null;
        let ra_filesUploadedChartInstance = null;
        let ra_performanceComparisonChartInstance = null;

        // Store chart rendering functions IF needed for re-initialization
        let pt_renderFunctions = {};
        let ra_renderFunctions = {};


        function showSection(targetId) {
            sections.forEach(section => {
                if (section.id === targetId) {
                    section.style.display = 'block';
                    // Trigger reflow before adding class for transition
                    void section.offsetWidth;
                    section.classList.add('active');
                     // Reinitialize charts for the now visible section
                    reinitializeCharts(targetId);
                } else {
                    section.style.display = 'none';
                    section.classList.remove('active');
                }
            });
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const targetId = 'section-' + link.getAttribute('data-section-target');

                // Update active link
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');

                // Show target section
                showSection(targetId);
            });
        });

        // --- Chart Re-initialization ---
        function reinitializeCharts(sectionId) {
            console.log(`Reinitializing charts for section: ${sectionId}`);
            // Call rendering functions specific to the section that was just made visible
            if (sectionId === 'section-project-tracking' && typeof pt_renderFunctions.renderProjectStatusPieChart === 'function') {
                 console.log('Calling Project Tracking chart renders');
                 pt_renderFunctions.renderProjectStatusPieChart(pt_renderFunctions.getCurrentFilteredData()); // Need access to data
                 pt_renderFunctions.renderProjectProgressLineChart(); // Simulated data ok
                 pt_renderFunctions.renderUpcomingDeadlines(pt_renderFunctions.getCurrentFilteredData()); // Update deadlines too
            } else if (sectionId === 'section-reports-analytics' && typeof ra_renderFunctions.renderTaskCompletionChart === 'function') {
                console.log('Calling Reports & Analytics chart renders');
                const currentData = ra_renderFunctions.getCurrentFilteredData(); // Need access to data
                ra_renderFunctions.renderTaskCompletionChart(currentData);
                ra_renderFunctions.renderOverdueTasksChart(currentData);
                ra_renderFunctions.renderFilesUploadedChart(currentData);
                ra_renderFunctions.renderPerformanceComparisonChart(currentData);
            }
            // Add other sections with charts here if needed
        }

        // --- Scripts from Data Management (datamanagemnt.txt) ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check if the relevant section exists before running the script
            if (!document.getElementById('data-management-section')) return;
            console.log("Initializing Data Management Script");

            let allData = [];
            let filteredData = [];
            let currentPage = 1;
            const rowsPerPage = 5;
            let editingRecordId = null;

            const tableBody = document.getElementById('dm-table-body');
            const searchInput = document.getElementById('dm-search-input');
            const filterStatusSelect = document.getElementById('dm-filter-status');
            const filterResponsibleSelect = document.getElementById('dm-filter-responsible');
            const paginationControls = document.getElementById('dm-pagination-controls');
            const selectAllCheckbox = document.getElementById('dm-select-all');
            const addNewBtn = document.getElementById('dm-add-new-btn');
            const importBtn = document.getElementById('dm-import-btn');
            const exportBtn = document.getElementById('dm-export-btn');
            const addEditModal = document.getElementById('add-edit-modal');
            const viewModal = document.getElementById('view-modal');
            const modalTitle = document.getElementById('modal-title');
            const addEditForm = document.getElementById('add-edit-form');
            const editRecordIdInput = document.getElementById('edit-record-id');
            const messageBox = document.getElementById('message-box');

            function generateSampleData() { return [ { id: 1001, name: "Client File - Al Amal Co.", creationDate: "2024-05-20", responsible: "Nada Mahmoud", status: "active", lastUpdated: "2024-05-21 10:30" }, { id: 1002, name: "Quarterly Performance Report", creationDate: "2024-05-18", responsible: "Mohamed Elmenisy", status: "pending", lastUpdated: "2024-05-19 14:00" }, { id: 1003, name: "New Product Data (X Headphones)", creationDate: "2024-05-15", responsible: "Yousef Ahmed", status: "active", lastUpdated: "2024-05-16 09:15" }, { id: 1004, name: "Workshop Attendance List", creationDate: "2024-05-12", responsible: "Esraa Lashin", status: "inactive", lastUpdated: "2024-05-13 11:00" }, { id: 1005, name: "Weekly Team Meeting Notes", creationDate: "2024-05-10", responsible: "Basssant Badr", status: "active", lastUpdated: "2024-05-10 16:45" }, { id: 1006, name: "Supplier Contract - Beta Inc.", creationDate: "2024-05-08", responsible: "Nada Mahmoud", status: "active", lastUpdated: "2024-05-09 15:00" }, { id: 1007, name: "Marketing Campaign Plan Q3", creationDate: "2024-05-05", responsible: "Mohamed Elmenisy", status: "pending", lastUpdated: "2024-05-06 11:30" }, { id: 1008, name: "IT Equipment Inventory", creationDate: "2024-05-01", responsible: "Yousef Ahmed", status: "active", lastUpdated: "2024-05-02 17:00" }, { id: 1009, name: "Annual Financial Statement Prep", creationDate: "2024-04-28", responsible: "Basssant Badr", status: "pending", lastUpdated: "2024-05-20 12:00" }, { id: 1010, name: "Website Content Update", creationDate: "2024-04-25", responsible: "Esraa Lashin", status: "active", lastUpdated: "2024-05-18 09:00" }, { id: 1011, name: "Internal Audit Checklist", creationDate: "2024-05-22", responsible: "Nada Mahmoud", status: "pending", lastUpdated: "2024-05-22 15:00" }, { id: 1012, name: "Onboarding Docs - New Hire", creationDate: "2024-05-21", responsible: "Esraa Lashin", status: "active", lastUpdated: "2024-05-21 16:00" }, ]; }
            function formatDate(dateString) { if (!dateString) return 'N/A'; const date = new Date(dateString.replace(' ', 'T')); if (isNaN(date.getTime())) return dateString; const optionsDate = { year: 'numeric', month: 'short', day: 'numeric' }; const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: false }; try { if (dateString.includes(':')) { return date.toLocaleDateString('en-CA', optionsDate) + ' ' + date.toLocaleTimeString('en-GB', optionsTime); } return date.toLocaleDateString('en-CA', optionsDate); } catch (e) { console.error("Error formatting date:", dateString, e); return dateString; } }
            function getCurrentDateTime() { const now = new Date(); const year = now.getFullYear(); const month = String(now.getMonth() + 1).padStart(2, '0'); const day = String(now.getDate()).padStart(2, '0'); const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0'); return `${year}-${month}-${day} ${hours}:${minutes}`; }
            function showMessage(message, type = 'info', duration = 3000) { if (!messageBox) return; messageBox.textContent = message; messageBox.className = 'message-box'; messageBox.classList.add(type, 'show'); setTimeout(() => { messageBox.classList.remove('show'); }, duration); }
            function openModal(modalElement) { if(modalElement) modalElement.classList.add('show'); }
            function closeModal(modalElement) { if(modalElement) modalElement.classList.remove('show'); }
            function renderTable() { if (!tableBody) return; tableBody.innerHTML = ''; if(selectAllCheckbox) selectAllCheckbox.checked = false; if (filteredData.length === 0) { tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center; padding: 20px;">No matching records found.</td></tr>`; renderPagination(0); return; } const totalItems = filteredData.length; const totalPages = Math.ceil(totalItems / rowsPerPage); if (currentPage > totalPages && totalPages > 0) { currentPage = totalPages; } else if (currentPage < 1) { currentPage = 1; } const startIndex = (currentPage - 1) * rowsPerPage; const endIndex = startIndex + rowsPerPage; const pageData = filteredData.slice(startIndex, endIndex); pageData.forEach(item => { const row = document.createElement('tr'); row.setAttribute('data-id', item.id); const statusClass = `dm-status-${item.status?.toLowerCase() || 'unknown'}`; row.innerHTML = `<td><input type="checkbox" class="dm-row-select" data-id="${item.id}"></td><td>#${item.id}</td><td>${item.name || 'N/A'}</td><td>${formatDate(item.creationDate)}</td><td>${item.responsible || 'N/A'}</td><td><span class="dm-status ${statusClass}">${item.status || 'N/A'}</span></td><td>${formatDate(item.lastUpdated)}</td><td class="dm-row-actions"><button class="dm-view-btn" title="View Details" data-id="${item.id}"><i class="fas fa-eye fa-fw"></i></button><button class="dm-edit-btn" title="Edit Record" data-id="${item.id}"><i class="fas fa-edit fa-fw"></i></button><button class="dm-delete-btn" title="Delete Record" data-id="${item.id}"><i class="fas fa-trash-alt fa-fw"></i></button></td>`; tableBody.appendChild(row); }); renderPagination(totalItems); attachRowEventListeners(); }
            function renderPagination(totalItems) { if (!paginationControls) return; paginationControls.innerHTML = ''; if (totalItems <= rowsPerPage) return; const totalPages = Math.ceil(totalItems / rowsPerPage); const prevButton = document.createElement('button'); prevButton.id = 'dm-prev-page'; prevButton.innerHTML = `<i class="fas fa-chevron-left"></i> Previous`; prevButton.disabled = currentPage === 1; prevButton.addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderTable(); } }); const pageInfo = document.createElement('span'); pageInfo.className = 'dm-page-info'; pageInfo.innerHTML = `Page <span class="dm-current-page">${currentPage}</span> of ${totalPages}`; const nextButton = document.createElement('button'); nextButton.id = 'dm-next-page'; nextButton.innerHTML = `Next <i class="fas fa-chevron-right"></i>`; nextButton.disabled = currentPage === totalPages; nextButton.addEventListener('click', () => { if (currentPage < totalPages) { currentPage++; renderTable(); } }); paginationControls.appendChild(prevButton); paginationControls.appendChild(pageInfo); paginationControls.appendChild(nextButton); }
            function applyFiltersAndSearch() { const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : ''; const statusFilterValue = filterStatusSelect ? filterStatusSelect.value : ''; const responsibleFilterValue = filterResponsibleSelect ? filterResponsibleSelect.value : ''; let currentData = [...allData]; if (statusFilterValue) { currentData = currentData.filter(item => item.status.toLowerCase() === statusFilterValue); } if (responsibleFilterValue) { currentData = currentData.filter(item => item.responsible === responsibleFilterValue); } if (searchTerm) { currentData = currentData.filter(item => ( item.id.toString().includes(searchTerm) || (item.name && item.name.toLowerCase().includes(searchTerm)) || (item.responsible && item.responsible.toLowerCase().includes(searchTerm)) )); } filteredData = currentData; currentPage = 1; renderTable(); }
            function attachRowEventListeners() { if (!tableBody) return; tableBody.removeEventListener('click', handleTableBodyClick); tableBody.addEventListener('click', handleTableBodyClick); tableBody.querySelectorAll('.dm-row-select').forEach(checkbox => { checkbox.removeEventListener('change', handleRowCheckboxChange); checkbox.addEventListener('change', handleRowCheckboxChange); }); }
            function handleTableBodyClick(event) { const target = event.target; const viewButton = target.closest('.dm-view-btn'); const editButton = target.closest('.dm-edit-btn'); const deleteButton = target.closest('.dm-delete-btn'); if (viewButton) { handleViewClick(viewButton); } else if (editButton) { handleEditClick(editButton); } else if (deleteButton) { handleDeleteClick(deleteButton); } }
            function handleRowCheckboxChange(event) { const checkbox = event.target; const row = checkbox.closest('tr'); if (row) { row.classList.toggle('selected-row', checkbox.checked); } if (!tableBody) return; const visibleCheckboxes = tableBody.querySelectorAll('.dm-row-select'); const allVisibleChecked = visibleCheckboxes.length > 0 && [...visibleCheckboxes].every(cb => cb.checked); if(selectAllCheckbox) selectAllCheckbox.checked = allVisibleChecked; }
            function handleViewClick(button) { const recordId = parseInt(button.getAttribute('data-id')); const record = allData.find(item => item.id === recordId); if (record) { const viewId = document.getElementById('view-id'); const viewName = document.getElementById('view-name'); const viewCreationDate = document.getElementById('view-creation-date'); const viewResponsible = document.getElementById('view-responsible'); const viewLastUpdated = document.getElementById('view-last-updated'); const statusDd = document.getElementById('view-status'); if(viewId) viewId.textContent = `#${record.id}`; if(viewName) viewName.textContent = record.name || 'N/A'; if(viewCreationDate) viewCreationDate.textContent = formatDate(record.creationDate); if(viewResponsible) viewResponsible.textContent = record.responsible || 'N/A'; if(viewLastUpdated) viewLastUpdated.textContent = formatDate(record.lastUpdated); if(statusDd) { statusDd.innerHTML = ''; if (record.status) { const statusSpan = document.createElement('span'); statusSpan.textContent = record.status; statusSpan.className = `dm-status dm-status-${record.status.toLowerCase()}`; statusDd.appendChild(statusSpan); } else { statusDd.textContent = 'N/A'; } } openModal(viewModal); } }
            function handleEditClick(button) { editingRecordId = parseInt(button.getAttribute('data-id')); const record = allData.find(item => item.id === editingRecordId); if (record && modalTitle && editRecordIdInput && addEditModal) { modalTitle.textContent = `Edit Record #${record.id}`; editRecordIdInput.value = record.id; const recordNameInput = document.getElementById('record-name'); const responsibleInput = document.getElementById('responsible'); const statusInput = document.getElementById('status'); if(recordNameInput) recordNameInput.value = record.name || ''; if(responsibleInput) responsibleInput.value = record.responsible || ''; if(statusInput) statusInput.value = record.status ? record.status.toLowerCase() : ''; openModal(addEditModal); } }
            function handleDeleteClick(button) { const recordIdToDelete = parseInt(button.getAttribute('data-id')); const record = allData.find(item => item.id === recordIdToDelete); const recordName = record ? record.name || 'No Name' : 'this item'; const recordIdText = record ? `#${record.id}` : 'this item'; Swal.fire({ title: 'Are you sure?', html: `You are about to delete:<br><strong>${recordIdText} (${recordName})</strong>`, icon: 'warning', showCancelButton: true, confirmButtonColor: '#2ecc71', cancelButtonColor: '#e74c3c', confirmButtonText: '<i class="fas fa-check me-1"></i> Confirm', cancelButtonText: '<i class="fas fa-times me-1"></i> Cancel' }).then((result) => { if (result.isConfirmed) { const initialLength = allData.length; allData = allData.filter(item => item.id !== recordIdToDelete); if (allData.length < initialLength) { Swal.fire('Deleted!', `Record ${recordIdText} (${recordName}) has been deleted.`, 'success'); } else { Swal.fire('Error!', `Could not find record ${recordIdText} to delete.`, 'error'); } applyFiltersAndSearch(); } }); }

            allData = generateSampleData();
            applyFiltersAndSearch();

            if(searchInput) searchInput.addEventListener('input', applyFiltersAndSearch);
            if(filterStatusSelect) filterStatusSelect.addEventListener('change', applyFiltersAndSearch);
            if(filterResponsibleSelect) filterResponsibleSelect.addEventListener('change', applyFiltersAndSearch);
            if(selectAllCheckbox) selectAllCheckbox.addEventListener('change', () => { const isChecked = selectAllCheckbox.checked; if (!tableBody) return; tableBody.querySelectorAll('.dm-row-select').forEach(checkbox => { if (checkbox.checked !== isChecked) { checkbox.checked = isChecked; checkbox.dispatchEvent(new Event('change')); } }); });
            if(addNewBtn) addNewBtn.addEventListener('click', () => { editingRecordId = null; if(modalTitle) modalTitle.textContent = 'Add New Record'; if(addEditForm) addEditForm.reset(); const responsibleInput = document.getElementById('responsible'); const statusInput = document.getElementById('status'); if(responsibleInput) responsibleInput.value = ""; if(statusInput) statusInput.value = ""; if(editRecordIdInput) editRecordIdInput.value = ''; openModal(addEditModal); });
            if(addEditForm) addEditForm.addEventListener('submit', (event) => { event.preventDefault(); const formData = new FormData(addEditForm); const recordName = formData.get('recordName').trim(); const responsible = formData.get('responsible'); const status = formData.get('status'); const now = getCurrentDateTime(); if (!recordName || !responsible || !status) { showMessage('Please fill in all required fields (Name, Responsible, Status).', 'error'); return; } if (editingRecordId) { const index = allData.findIndex(item => item.id === editingRecordId); if (index !== -1) { allData[index] = { ...allData[index], name: recordName, responsible: responsible, status: status, lastUpdated: now }; showMessage(`Record #${editingRecordId} updated successfully!`, 'success'); } else { showMessage('Error: Could not find record to update.', 'error'); } } else { const newId = allData.length > 0 ? Math.max(...allData.map(item => item.id)) + 1 : 1001; const newRecord = { id: newId, name: recordName, creationDate: now.split(' ')[0], responsible: responsible, status: status, lastUpdated: now }; allData.push(newRecord); showMessage(`Record #${newId} added successfully!`, 'success'); } closeModal(addEditModal); applyFiltersAndSearch(); editingRecordId = null; });

            document.body.addEventListener('click', (event) => { if (event.target.matches('[data-close-modal]')) { const modal = event.target.closest('.modal-overlay'); if (modal) { closeModal(modal); } } else if (event.target.matches('.modal-overlay')) { closeModal(event.target); } });
            if(importBtn) importBtn.addEventListener('click', () => { showMessage('Import function simulated. No file processed.', 'info'); });
            if(exportBtn) exportBtn.addEventListener('click', () => { const exportData = filteredData.length > 0 ? filteredData : allData; if (exportData.length === 0) { showMessage('No data available to export.', 'info'); return; } let csvContent = "data:text/csv;charset=utf-8,"; const headers = Object.keys(exportData[0]); csvContent += headers.join(",") + "\r\n"; exportData.forEach(row => { const values = headers.map(header => { let cellValue = row[header] === null || row[header] === undefined ? '' : row[header]; cellValue = String(cellValue).replace(/"/g, '""'); if (String(cellValue).includes(',') || String(cellValue).includes('"') || String(cellValue).includes('\n')) { cellValue = `"${cellValue}"`; } return cellValue; }); csvContent += values.join(",") + "\r\n"; }); const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); const timestamp = new Date().toISOString().replace(/[:.]/g, '-'); link.setAttribute("download", `data_export_${timestamp}.csv`); document.body.appendChild(link); link.click(); document.body.removeChild(link); showMessage(`Exported ${exportData.length} records as CSV.`, 'success'); });

        }); // End Data Management DOMContentLoaded

        // --- Scripts from Project Tracking (Project Tracking.txt) ---
        document.addEventListener('DOMContentLoaded', () => {
             if (!document.getElementById('project-tracking-section')) return;
             console.log("Initializing Project Tracking Script");

            let projectData = [];
            let filteredData = [];
            let currentPage = 1;
            const rowsPerPage = 5;
            let currentSortColumn = 'endDate';
            let currentSortDirection = 'asc';

            const statusFilter = document.getElementById('project-status-filter');
            const teamFilter = document.getElementById('project-team-filter');
            const priorityFilter = document.getElementById('project-priority-filter');
            const resetFiltersBtn = document.getElementById('resetProjectFiltersBtn');
            const tableBody = document.getElementById('projectTableBody');
            const paginationControls = document.getElementById('projectPaginationControls');
            const deadlinesList = document.getElementById('upcomingDeadlinesList');
            const tableHeaders = document.querySelectorAll("#projectTrackingTable th[data-sort-by]");

            // --- Utility Functions ---
            function formatDate(dateString) { if (!dateString) return 'N/A'; const date = new Date(dateString + 'T00:00:00'); return date.toLocaleDateString('en-CA', { year: 'numeric', month: 'short', day: 'numeric' }); }
            const getCssVar = (varName) => getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
            const rgbaColor = (c, alpha) => { if (c.startsWith('rgba')) return c.replace(/[\d\.]+\)$/g, `${alpha})`); if (c.startsWith('#')) { const bigint = parseInt(c.slice(1), 16); const r = (bigint >> 16) & 255; const g = (bigint >> 8) & 255; const b = bigint & 255; return `rgba(${r}, ${g}, ${b}, ${alpha})`; } return c; };

            function getStatusBadgeClass(status) { switch (status?.toLowerCase()) { case 'completed': return 'status-completed'; case 'in progress': return 'status-inprogress'; case 'delayed': return 'status-delayed'; case 'pending': return 'status-pending'; default: return ''; } }
            function getPriorityBadgeClass(priority) { switch (priority?.toLowerCase()) { case 'high': return 'priority-high'; case 'medium': return 'priority-medium'; case 'low': return 'priority-low'; default: return ''; } }
            function getProgressBgClass(progress) { if (progress >= 80) return 'bg-progress-high'; if (progress >= 50) return 'bg-progress-medium'; return 'bg-progress-low'; }
            function getProgressTextColor(progress) { return (progress >= 50 && progress < 80) ? '#212529' : '#fff'; }

            // --- Chart Rendering --- Make functions globally accessible within this scope for reinitialization
            pt_renderFunctions.renderProjectStatusPieChart = function(data) { // Assign to shared object
                const ctx = document.getElementById('projectStatusPieChart')?.getContext('2d');
                if (!ctx) { console.error("Pie Chart Canvas not found"); return; }
                const statusCounts = data.reduce((acc, project) => { acc[project.status] = (acc[project.status] || 0) + 1; return acc; }, {});
                const labels = Object.keys(statusCounts);
                const chartData = Object.values(statusCounts);
                const backgroundColors = labels.map(label => { switch (label.toLowerCase()) { case 'completed': return getCssVar('--chart-green'); case 'in progress': return getCssVar('--chart-blue'); case 'delayed': return getCssVar('--chart-orange'); case 'pending': return getCssVar('--chart-gray'); default: return getCssVar('--app-secondary'); } });
                const config = { type: 'pie', data: { labels: labels, datasets: [{ data: chartData, backgroundColor: backgroundColors, borderColor: '#fff', borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } };
                if (pt_statusPieChartInstance) pt_statusPieChartInstance.destroy();
                try {
                     pt_statusPieChartInstance = new Chart(ctx, config);
                     console.log("Pie Chart rendered/updated.");
                } catch(e) { console.error("Error rendering Pie Chart:", e); }
            }
            pt_renderFunctions.renderProjectProgressLineChart = function() { // Assign to shared object
                 const ctx = document.getElementById('projectProgressLineChart')?.getContext('2d');
                 if (!ctx) { console.error("Line Chart Canvas not found"); return; }
                 const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun']; const data = [20, 35, 50, 60, 75, 80]; // SIMULATED
                 const config = { type: 'line', data: { labels: labels, datasets: [{ label: 'Overall Progress %', data: data, borderColor: getCssVar('--chart-blue'), backgroundColor: rgbaColor(getCssVar('--chart-blue'), 0.1), fill: true, tension: 0.3 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100 } }, plugins: { legend: { display: false } } } };
                 if (pt_progressLineChartInstance) pt_progressLineChartInstance.destroy();
                 try {
                    pt_progressLineChartInstance = new Chart(ctx, config);
                    console.log("Line Chart rendered/updated.");
                 } catch(e) { console.error("Error rendering Line Chart:", e); }
            }
             pt_renderFunctions.renderUpcomingDeadlines = function(data) { // Assign to shared object
                 if (!deadlinesList) return;
                deadlinesList.innerHTML = ''; const today = new Date(); today.setHours(0, 0, 0, 0); const sevenDaysFromNow = new Date(today); sevenDaysFromNow.setDate(today.getDate() + 7);
                const upcoming = data.filter(project => { if (!project.endDate || project.status === 'Completed') return false; const endDate = new Date(project.endDate + 'T00:00:00'); return endDate >= today && endDate <= sevenDaysFromNow; }).sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
                if (upcoming.length === 0) { deadlinesList.innerHTML = '<li class="text-muted text-center pt-5">No upcoming deadlines found.</li>'; return; }
                upcoming.forEach(project => { const li = document.createElement('li'); const endDate = new Date(project.endDate + 'T00:00:00'); const diffTime = Math.abs(endDate - today); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); const daysLeftText = diffDays === 0 ? 'Due Today' : `${diffDays} day${diffDays > 1 ? 's' : ''} left`; li.innerHTML = `<span>${project.name}</span><span class="text-end"><span class="deadline me-2">${formatDate(project.endDate)}</span><span class="days-left">(${daysLeftText})</span></span>`; deadlinesList.appendChild(li); });
            }

            function renderTable() {
                if (!tableBody) return;
                tableBody.innerHTML = '';
                 if (filteredData.length === 0) { tableBody.innerHTML = `<tr><td colspan="8" class="text-center p-4 text-muted fst-italic">No projects found matching criteria.</td></tr>`; renderPagination(); return; }
                const totalItems = filteredData.length; const totalPages = Math.ceil(totalItems / rowsPerPage); if (currentPage > totalPages && totalPages > 0) currentPage = totalPages; else if (currentPage < 1) currentPage = 1; const startIndex = (currentPage - 1) * rowsPerPage; const endIndex = startIndex + rowsPerPage; const pageData = filteredData.slice(startIndex, endIndex);
                pageData.forEach(project => { const row = document.createElement('tr'); const statusClass = getStatusBadgeClass(project.status); const priorityClass = getPriorityBadgeClass(project.priority); const progressBg = getProgressBgClass(project.progress); const progressTextClr = getProgressTextColor(project.progress); const teamHtml = (project.assignedTeam || []).map(member => `<span>${member}</span>`).join(''); row.innerHTML = `<td><div class="project-name">${project.name}</div></td><td>${formatDate(project.startDate)}</td><td>${formatDate(project.endDate)}</td><td class="assigned-team">${teamHtml}</td><td class="text-center progress-cell"><div class="progress" role="progressbar" aria-valuenow="${project.progress}" aria-valuemin="0" aria-valuemax="100"><div class="progress-bar ${progressBg}" style="width: ${project.progress}%; color: ${progressTextClr};">${project.progress}%</div></div></td><td class="text-center"><span class="status-badge ${statusClass}">${project.status}</span></td><td class="text-center"><span class="priority-badge ${priorityClass}">${project.priority}</span></td><td class="notes-cell" title="${project.notes || ''}">${project.notes || '-'}</td>`; tableBody.appendChild(row); });
                renderPagination(); updateSortIcons();
            }
            function renderPagination() { if (!paginationControls) return; paginationControls.innerHTML = ''; const totalItems = filteredData.length; if (totalItems <= rowsPerPage) return; const totalPages = Math.ceil(totalItems / rowsPerPage); const createButton = (text, page, disabled = false) => { const button = document.createElement('button'); button.innerHTML = text; button.disabled = disabled; button.addEventListener('click', () => { currentPage = page; renderTable(); }); return button; }; paginationControls.appendChild(createButton('<i class="fas fa-chevron-left"></i> Prev', currentPage - 1, currentPage === 1)); const pageInfo = document.createElement('span'); pageInfo.className = 'pt-page-info'; pageInfo.innerHTML = `Page <span class="pt-current-page">${currentPage}</span> of ${totalPages}`; paginationControls.appendChild(pageInfo); paginationControls.appendChild(createButton('Next <i class="fas fa-chevron-right"></i>', currentPage + 1, currentPage === totalPages)); }
            function updateSortIcons() { tableHeaders.forEach(th => { const icon = th.querySelector('.sort-icon'); if (!icon) return; const columnKey = th.getAttribute('data-sort-by'); icon.classList.remove('fa-sort', 'fa-sort-up', 'fa-sort-down', 'active'); if (columnKey === currentSortColumn) { icon.classList.add(currentSortDirection === 'asc' ? 'fa-sort-up' : 'fa-sort-down'); icon.classList.add('active'); } else { icon.classList.add('fa-sort'); } }); }
            function handleSortClick(event) { const header = event.currentTarget; const columnKey = header.getAttribute('data-sort-by'); if (!columnKey) return; if (currentSortColumn === columnKey) { currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc'; } else { currentSortColumn = columnKey; currentSortDirection = 'asc'; } applyFiltersAndSort(); }

             function applyFiltersAndSort() {
                const statusValue = statusFilter ? statusFilter.value : '';
                const teamValue = teamFilter ? teamFilter.value : '';
                const priorityValue = priorityFilter ? priorityFilter.value : '';

                let tempFilteredData = projectData.filter(project => {
                    const statusMatch = !statusValue || project.status === statusValue;
                    const teamMatch = !teamValue || (project.assignedTeam && project.assignedTeam.includes(teamValue));
                    const priorityMatch = !priorityValue || project.priority === priorityValue;
                    return statusMatch && teamMatch && priorityMatch;
                });

                tempFilteredData.sort((a, b) => { let valA = a[currentSortColumn]; let valB = b[currentSortColumn]; if (currentSortColumn === 'startDate' || currentSortColumn === 'endDate') { valA = new Date(valA); valB = new Date(valB); } else if (currentSortColumn === 'progress') { valA = Number(valA); valB = Number(valB); } else if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = valB.toLowerCase(); } else if (currentSortColumn === 'priority') { const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 }; valA = priorityOrder[a.priority] || 0; valB = priorityOrder[b.priority] || 0; } if (valA < valB) return currentSortDirection === 'asc' ? -1 : 1; if (valA > valB) return currentSortDirection === 'asc' ? 1 : -1; return 0; });

                filteredData = tempFilteredData;
                pt_renderFunctions.getCurrentFilteredData = () => filteredData; // Make current data accessible

                currentPage = 1;
                renderTable();
                // Re-render charts and deadlines with the filtered/sorted data
                pt_renderFunctions.renderProjectStatusPieChart(filteredData);
                pt_renderFunctions.renderUpcomingDeadlines(filteredData);
                // Line chart is simulated, no need to pass data
                pt_renderFunctions.renderProjectProgressLineChart();
            }

            function resetFilters() { if(statusFilter) statusFilter.value = ''; if(teamFilter) teamFilter.value = ''; if(priorityFilter) priorityFilter.value = ''; applyFiltersAndSort(); }

            function fetchInitialData() {
                 setTimeout(() => {
                    // Simulated data - replace with actual fetch if needed
                    projectData = [
                        { name: "Dashboard UI Overhaul", startDate: "2024-05-01", endDate: "2024-07-15", assignedTeam: ["Mohamed Elmenisy", "Basssant Badr"], progress: 65, status: "In Progress", priority: "High", notes: "Focus on responsive design." },
                        { name: "API Integration - Phase 2", startDate: "2024-04-10", endDate: "2024-06-30", assignedTeam: ["Yousef Ahmed"], progress: 80, status: "In Progress", priority: "High", notes: "Testing endpoint security." },
                        { name: "User Documentation Update", startDate: "2024-06-01", endDate: "2024-06-20", assignedTeam: ["Esraa Lashin"], progress: 20, status: "Pending", priority: "Medium", notes: "Awaiting final feature list." },
                        { name: "Q2 Marketing Campaign Launch", startDate: "2024-03-15", endDate: "2024-05-30", assignedTeam: ["Nada Mahmoud", "Basssant Badr"], progress: 100, status: "Completed", priority: "Medium", notes: "Exceeded target KPIs." },
                        { name: "Server Migration Planning", startDate: "2024-06-10", endDate: "2024-07-05", assignedTeam: ["Yousef Ahmed"], progress: 10, status: "Pending", priority: "Low", notes: "Initial assessment phase." },
                        { name: "Onboarding Process Refinement", startDate: "2024-05-20", endDate: "2024-06-25", assignedTeam: ["Esraa Lashin", "Mohamed Elmenisy"], progress: 40, status: "In Progress", priority: "Medium", notes: "Feedback collection ongoing." },
                         { name: "Client Portal Deployment", startDate: "2024-04-01", endDate: "2024-06-10", assignedTeam: ["Basssant Badr"], progress: 95, status: "Delayed", priority: "High", notes: "Minor bug fixes remaining." }
                     ];
                     applyFiltersAndSort(); // Render with initial data
                     console.log("Initial project data processed.");
                 }, 50);
            }

            tableHeaders.forEach(th => th.addEventListener('click', handleSortClick));
            if(statusFilter) statusFilter.addEventListener('change', applyFiltersAndSort);
            if(teamFilter) teamFilter.addEventListener('change', applyFiltersAndSort);
            if(priorityFilter) priorityFilter.addEventListener('change', applyFiltersAndSort);
            if(resetFiltersBtn) resetFiltersBtn.addEventListener('click', resetFilters);

            fetchInitialData();

        }); // End Project Tracking DOMContentLoaded


        // --- Scripts from File Sharing (filesharing.txt) ---
        document.addEventListener('DOMContentLoaded', function() {
            if (!document.getElementById('file-sharing-section')) return;
            console.log("Initializing File Sharing Script");

            // Prefixed selectors
            const fileTableBody = document.getElementById('fs-fileTableBody');
            const fileSearchInput = document.getElementById('fs-fileSearchInput');
            const fileTypeFilter = document.getElementById('fs-fileTypeFilter');
            const uploadDateFilter = document.getElementById('fs-uploadDateFilter');
            const userFilter = document.getElementById('fs-userFilter');
            const userFilterContainer = document.getElementById('fs-userFilterContainer');
            const noResultsRow = document.getElementById('fs-noResultsRow');
            const resetFiltersBtn = document.getElementById('fs-resetFiltersBtn');
            const recentUploadsSection = document.getElementById('fs-recentUploadsSection');

            const isAdmin = true; // Example check
            if (isAdmin && userFilterContainer) { userFilterContainer.style.display = 'block'; }
            else if (userFilterContainer) { userFilterContainer.style.display = 'none'; }

            function applyFilters() {
                const searchTerm = fileSearchInput ? fileSearchInput.value.toLowerCase().trim() : '';
                const selectedType = fileTypeFilter ? fileTypeFilter.value : '';
                const selectedDate = uploadDateFilter ? uploadDateFilter.value : '';
                const selectedUser = userFilter ? userFilter.value : '';
                let hasVisibleRows = false;
                if (!fileTableBody) return;
                const rows = fileTableBody.querySelectorAll('tr:not(#fs-noResultsRow)'); // Use prefixed ID

                rows.forEach(row => {
                    const fileNameElement = row.querySelector('.fs-file-name'); // Prefixed class
                    const uploaderElement = row.querySelector('.uploader-shared');
                    const fileName = fileNameElement ? fileNameElement.textContent.toLowerCase() : '';
                    const fileType = row.dataset.fileType || '';
                    const uploadDate = row.dataset.uploadDate || '';
                    const uploader = row.dataset.uploader || (uploaderElement ? uploaderElement.textContent : '');
                    const nameMatch = searchTerm === '' || fileName.includes(searchTerm);
                    const typeMatch = selectedType === '' || fileType === selectedType;
                    const dateMatch = selectedDate === '' || uploadDate === selectedDate;
                    const userMatch = (!isAdmin || selectedUser === '' || uploader === selectedUser);
                    if (nameMatch && typeMatch && dateMatch && userMatch) { row.style.display = ''; hasVisibleRows = true; }
                    else { row.style.display = 'none'; }
                });
                if(noResultsRow) noResultsRow.style.display = hasVisibleRows ? 'none' : '';
            }
            function resetFiltersFS() { // Renamed to avoid conflict
                 if(fileSearchInput) fileSearchInput.value = '';
                 if(fileTypeFilter) fileTypeFilter.value = '';
                 if(uploadDateFilter) uploadDateFilter.value = '';
                 if(userFilter) userFilter.value = '';
                 applyFilters();
            }
            function timeAgo(isoTimestamp) {
                if (!isoTimestamp) return 'Invalid date';
                const past = new Date(isoTimestamp);
                if (isNaN(past.getTime())) { console.warn("Invalid date encountered:", isoTimestamp); return 'Invalid date'; }
                const now = new Date(); const diffInSeconds = Math.floor((now - past) / 1000);
                if (diffInSeconds < 5) return 'just now'; if (diffInSeconds < 60) return `${diffInSeconds} seconds ago`;
                const minutes = Math.floor(diffInSeconds / 60); if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                const hours = Math.floor(minutes / 60); if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                const days = Math.floor(hours / 24); if (days < 7) return `${days} day${days > 1 ? 's' : ''} ago`;
                return past.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            }
            function updateRelativeTimes() {
                if (!recentUploadsSection) return;
                const timeElements = recentUploadsSection.querySelectorAll('.fs-time-ago'); // Prefixed
                timeElements.forEach(el => { const timestamp = el.closest('li')?.dataset.timestamp; el.textContent = timeAgo(timestamp); });
            }
            updateRelativeTimes();
            setInterval(updateRelativeTimes, 60000);

            if (fileTableBody) {
                 fileTableBody.addEventListener('click', function(event) {
                     const button = event.target.closest('.fs-action-btn'); // Prefixed class
                     if (!button) return;
                     if (button.classList.contains('loading')) return;
                     const fileId = button.dataset.fileId; const row = button.closest('tr'); const fileNameElement = row?.querySelector('.fs-file-name'); // Prefixed class
                     const fileName = fileNameElement ? fileNameElement.textContent : 'this file';

                     if (button.classList.contains('download-btn')) {
                         const fileUrl = button.dataset.fileUrl;
                         if (!fileUrl || fileUrl === 'path/to/...') { console.error(`Download failed: File URL is missing or invalid for file ID ${fileId}.`); Swal.fire({ icon: 'error', title: 'Download Error', text: 'Could not download the file. URL is missing.', timer: 2500, showConfirmButton: false }); return; }
                         button.classList.add('loading'); button.disabled = true; console.log(`Attempting download for file ID: ${fileId}, URL: ${fileUrl}`);
                         try { const link = document.createElement('a'); link.href = fileUrl; link.setAttribute('download', fileName); document.body.appendChild(link); link.click(); document.body.removeChild(link); console.log(`Download initiated for: ${fileName}`); }
                         catch (error) { console.error('Error triggering download:', error); Swal.fire({ icon: 'error', title: 'Download Failed', text: 'An error occurred while trying to start the download.', }); }
                         finally { setTimeout(() => { button.classList.remove('loading'); button.disabled = false; }, 500); }
                     }
                     else if (button.classList.contains('delete-btn')) {
                         Swal.fire({ title: 'Are you sure?', html: `You are about to delete the file: <br><strong>${fileName}</strong>`, icon: 'warning', showCancelButton: true, confirmButtonColor: 'var(--app-success)', cancelButtonColor: 'var(--app-danger)', confirmButtonText: '<i class="fas fa-check me-1"></i> Yes, delete it!', cancelButtonText: '<i class="fas fa-times me-1"></i> Cancel' }).then((result) => {
                             if (result.isConfirmed) {
                                 button.classList.add('loading'); button.disabled = true; console.log(`Attempting delete for file ID: ${fileId}`);
                                 setTimeout(() => {
                                     const deleteSuccess = Math.random() > 0.1;
                                     if (deleteSuccess) { console.log(`Successfully deleted file ID: ${fileId}`); row.style.opacity = '0'; setTimeout(() => { row.remove(); applyFilters(); Swal.fire('Deleted!', `"${fileName}" has been deleted.`, 'success'); }, 300); }
                                     else { console.error(`Failed to delete file ID: ${fileId}`); button.classList.remove('loading'); button.disabled = false; Swal.fire('Error!', 'Could not delete the file. Please try again.', 'error'); }
                                 }, 1000);
                             }
                         });
                     }
                 });
            }

            // Prefixed Modal IDs
            const filePreviewModal = document.getElementById('fs-filePreviewModal');
            const previewContent = document.getElementById('fs-previewContent');
            const previewFileName = document.getElementById('fs-previewFileName');
            const previewFileType = document.getElementById('fs-previewFileType');

            if(filePreviewModal && previewContent && previewFileName && previewFileType) {
                filePreviewModal.addEventListener('show.bs.modal', function (event) {
                    const button = event.relatedTarget; if (!button) return; // Ensure button exists
                    const fileUrl = button.getAttribute('data-file-url'); const fileType = button.getAttribute('data-file-type'); const row = button.closest('tr'); const fileNameElement = row?.querySelector('.fs-file-name'); // Prefixed class
                    const fileName = fileNameElement ? fileNameElement.textContent : 'N/A';
                    previewFileName.textContent = `File Name: ${fileName}`; previewFileType.textContent = `Type: ${fileType ? fileType.toUpperCase() : 'N/A'}`; previewContent.innerHTML = '<div class="d-flex justify-content-center align-items-center" style="min-height: 200px;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';
                    if (fileUrl && fileUrl !== 'path/to/...') {
                        setTimeout(() => {
                            if (fileType === 'Image') { previewContent.innerHTML = `<img src="${fileUrl}" class="img-fluid" alt="Preview of ${fileName}" style="max-height: 75vh;">`; }
                            else if (fileType === 'PDF') { previewContent.innerHTML = `<object data="${fileUrl}" type="application/pdf" width="100%" height="650px"><p class="text-warning p-4">Preview not available. Your browser might not support PDF embedding or the file is inaccessible. <a href="${fileUrl}" target="_blank" class="btn btn-sm btn-primary mt-2">Download PDF</a></p></object>`; }
                            else { previewContent.innerHTML = `<p class="text-warning p-4">Preview is not available for this file type (${fileType}).</p>`; }
                        }, 300);
                    } else { previewContent.innerHTML = `<p class="text-danger p-4">Could not load preview. File URL is missing or invalid.</p>`; }
                });
                 filePreviewModal.addEventListener('hidden.bs.modal', function() { previewContent.innerHTML = ''; });
            }

            if(fileSearchInput) fileSearchInput.addEventListener('input', applyFilters);
            if(fileTypeFilter) fileTypeFilter.addEventListener('change', applyFilters);
            if(uploadDateFilter) uploadDateFilter.addEventListener('change', applyFilters);
            if(userFilter) userFilter.addEventListener('change', applyFilters);
            if(resetFiltersBtn) resetFiltersBtn.addEventListener('click', resetFiltersFS);

            // Prefixed Upload Modal Elements
            const startUploadButton = document.getElementById('fs-startUploadButton');
            const uploadProgressContainer = document.getElementById('fs-uploadProgressContainer');
            const uploadProgressBar = document.getElementById('fs-uploadProgressBar');
            const uploadStatus = document.getElementById('fs-uploadStatus');
            const uploadFileName = document.getElementById('fs-uploadFileName');
            const uploadPercentage = document.getElementById('fs-uploadPercentage');
            const fileInputManual = document.getElementById('fs-fileInputManual');
            const fileInputHidden = document.getElementById('fs-fileInputHidden');
             const dropZone = document.getElementById('fs-dropZone'); // Prefixed Drop Zone

            // Drag and Drop functionality (added)
            if (dropZone) {
                dropZone.addEventListener('click', () => fileInputHidden?.click());

                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('fs-dragover'); // Add a class for visual feedback if needed
                });

                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('fs-dragover');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('fs-dragover');
                    if (e.dataTransfer.files.length && fileInputHidden) {
                        fileInputHidden.files = e.dataTransfer.files;
                        // Optionally trigger the upload immediately or show file names
                        console.log("Files dropped:", fileInputHidden.files);
                        // Update some indicator that files are ready
                        const fileNames = Array.from(fileInputHidden.files).map(f => f.name).join(', ');
                        dropZone.querySelector('p:last-of-type').textContent = fileNames || "Drag & drop files here or click to select";

                    }
                });
                 // Update manual input if hidden input changes (and vice-versa if needed)
                 if (fileInputHidden && fileInputManual) {
                    fileInputHidden.addEventListener('change', () => {
                        if(fileInputHidden.files.length > 0) {
                           fileInputManual.files = fileInputHidden.files; // Sync files
                           const fileNames = Array.from(fileInputHidden.files).map(f => f.name).join(', ');
                            dropZone.querySelector('p:last-of-type').textContent = fileNames || "Drag & drop files here or click to select";
                        }
                    });
                     fileInputManual.addEventListener('change', () => {
                        if(fileInputManual.files.length > 0) {
                            fileInputHidden.files = fileInputManual.files; // Sync files
                        }
                    });
                 }
            }

            if(startUploadButton && uploadProgressContainer && uploadProgressBar && uploadStatus) {
                 startUploadButton.addEventListener('click', function() {
                     const filesToUpload = fileInputManual.files.length > 0 ? fileInputManual.files : fileInputHidden.files;
                     if (filesToUpload.length === 0) { Swal.fire('No File Selected', 'Please select at least one file to upload.', 'warning'); return; }
                     const firstFile = filesToUpload[0];
                     console.log("Starting upload for:", firstFile.name);
                     if(uploadFileName) uploadFileName.textContent = `Uploading: ${firstFile.name}`;
                     uploadProgressContainer.style.display = 'block';
                     uploadProgressBar.style.width = '0%';
                     uploadProgressBar.classList.remove('bg-success', 'bg-danger');
                     uploadProgressBar.classList.add('progress-bar-animated');
                     if(uploadPercentage) uploadPercentage.textContent = '0%';
                     if(uploadStatus) uploadStatus.textContent = 'Initializing...';
                     if(uploadStatus) uploadStatus.className = 'text-muted d-block mt-1';

                     let progress = 0; const interval = setInterval(() => {
                         progress += Math.random() * 15; progress = Math.min(progress, 100);
                         uploadProgressBar.style.width = progress + '%'; uploadProgressBar.setAttribute('aria-valuenow', progress);
                         if(uploadPercentage) uploadPercentage.textContent = Math.round(progress) + '%';
                         if (progress >= 100) {
                             clearInterval(interval); const uploadSuccess = Math.random() > 0.2;
                             uploadProgressBar.classList.remove('progress-bar-animated');
                             if(uploadSuccess) {
                                  if(uploadStatus) uploadStatus.textContent = 'Upload successful!'; if(uploadStatus) uploadStatus.className = 'text-success d-block mt-1 fw-bold';
                                  uploadProgressBar.classList.add('bg-success');
                                  // Add the new file to the table (requires more logic)
                                  // Optionally close modal
                                  const modalInstance = bootstrap.Modal.getInstance(document.getElementById('fs-uploadFileModal'));
                                  setTimeout(() => modalInstance?.hide(), 1500);
                             } else {
                                 if(uploadStatus) uploadStatus.textContent = 'Upload failed. Please try again.'; if(uploadStatus) uploadStatus.className = 'text-danger d-block mt-1 fw-bold';
                                 uploadProgressBar.classList.add('bg-danger');
                             }
                             if(fileInputManual) fileInputManual.value = ''; if(fileInputHidden) fileInputHidden.value = '';
                             if(dropZone) dropZone.querySelector('p:last-of-type').textContent = "Drag & drop files here or click to select"; // Reset dropzone text
                         }
                     }, 300);
                 });
            }
        }); // End File Sharing DOMContentLoaded


         // --- Scripts from Reports & Analytics (Reports & Analytic.txt) ---
        document.addEventListener('DOMContentLoaded', () => {
            if (!document.getElementById('reports-analytics-section')) return;
             console.log("Initializing Reports & Analytics Script");

            // Sample data is now defined here
             const employeePerformanceData = [ { id: 1, name: "Mohamed Elmenisy", tasksCompleted: 85, tasksOverdue: 3, filesUploaded: 15, activityScore: 9.2, performanceMetrics: [8.5, 9, 7, 9.2, 8.4] }, { id: 3, name: "Yousef Ahmed", tasksCompleted: 70, tasksOverdue: 8, filesUploaded: 8, activityScore: 7.5, performanceMetrics: [7, 6, 6, 7.5, 6.6] }, { id: 4, name: "Esraa Lashin", tasksCompleted: 45, tasksOverdue: 12, filesUploaded: 5, activityScore: 6.1, performanceMetrics: [4.5, 5, 5, 6.1, 5.1] }, { id: 5, name: "Basssant Badr", tasksCompleted: 91, tasksOverdue: 2, filesUploaded: 18, activityScore: 9.5, performanceMetrics: [9.1, 9.5, 8, 9.5, 9.0] }, ];
             let currentFilteredData = [...employeePerformanceData];
             ra_renderFunctions.getCurrentFilteredData = () => currentFilteredData; // Share current data

            const filterForm = document.getElementById('reports-filter-form');
            const startDateInput = document.getElementById('report-start-date');
            const endDateInput = document.getElementById('report-end-date');
            const periodBtnGroup = document.getElementById('periodBtnGroup');
            const tableBody = document.getElementById('employeeSummaryTableBody');
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            const exportExcelBtn = document.getElementById('exportExcelBtn');

            function formatDateInput(date) { const d = new Date(date); const month = String(d.getMonth() + 1).padStart(2, '0'); const day = String(d.getDate()).padStart(2, '0'); const year = d.getFullYear(); return `${year}-${month}-${day}`; }
            function formatReportDate(dateString) { if (!dateString) return 'N/A'; const parts = dateString.split('-'); if (parts.length === 3) { return `${parts[1]}/${parts[2]}/${parts[0]}`; } return dateString; }
            const getCssVarRA = (varName) => getComputedStyle(document.documentElement).getPropertyValue(varName).trim(); // Renamed to avoid conflict
            const rgbaColorRA = (c, alpha) => { if (c.startsWith('rgba')) return c.replace(/[\d\.]+\)$/g, `${alpha})`); if (c.startsWith('#')) { const bigint = parseInt(c.slice(1), 16); const r = (bigint >> 16) & 255; const g = (bigint >> 8) & 255; const b = bigint & 255; return `rgba(${r}, ${g}, ${b}, ${alpha})`; } return c; }; // Renamed

            // --- Chart Rendering Functions --- Assign to shared object
            ra_renderFunctions.renderTaskCompletionChart = function(data) { const ctx = document.getElementById('taskCompletionChart')?.getContext('2d'); if (!ctx) return; const avgCompletion = data.length > 0 ? Math.round(data.reduce((sum, emp) => sum + emp.tasksCompleted, 0) / data.length) : 0; const chartData = { labels: ['Completed', 'Remaining'], datasets: [{ data: [avgCompletion, 100 - avgCompletion], backgroundColor: [ getCssVarRA('--chart-green'), '#e9ecef'], borderColor: ['#ffffff'], borderWidth: 2 }] }; if (ra_taskCompletionChartInstance) ra_taskCompletionChartInstance.destroy(); ra_taskCompletionChartInstance = new Chart(ctx, { type: 'doughnut', data: chartData, options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.parsed}%` } } } } }); }
            ra_renderFunctions.renderOverdueTasksChart = function(data) { const ctx = document.getElementById('overdueTasksChart')?.getContext('2d'); if (!ctx) return; const labels = data.map(emp => emp.name); const overdueData = data.map(emp => emp.tasksOverdue); if (ra_overdueTasksChartInstance) ra_overdueTasksChartInstance.destroy(); ra_overdueTasksChartInstance = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Overdue Tasks', data: overdueData, backgroundColor: getCssVarRA('--chart-red'), borderWidth: 0, borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 2 } } }, plugins: { legend: { display: false } } } }); }
            ra_renderFunctions.renderFilesUploadedChart = function(data) { const ctx = document.getElementById('filesUploadedChart')?.getContext('2d'); if (!ctx) return; const labels = data.map(emp => emp.name); const filesData = data.map(emp => emp.filesUploaded); if (ra_filesUploadedChartInstance) ra_filesUploadedChartInstance.destroy(); ra_filesUploadedChartInstance = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Files Uploaded', data: filesData, backgroundColor: getCssVarRA('--chart-blue'), borderWidth: 0, borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true } }, plugins: { legend: { display: false } } } }); }
            ra_renderFunctions.renderPerformanceComparisonChart = function(data) { const ctx = document.getElementById('performanceComparisonChart')?.getContext('2d'); if (!ctx) return; const labels = ['Completion', 'Timeliness', 'Files Mgmt', 'Activity', 'Overall Score']; const datasets = data.map((emp, index) => { const metricsData = emp.performanceMetrics || [ emp.tasksCompleted / 10, 10 - (emp.tasksOverdue / 2), emp.filesUploaded / 2, emp.activityScore, ((emp.tasksCompleted / 10) + (10 - (emp.tasksOverdue / 2)) + (emp.filesUploaded / 2) + emp.activityScore) / 4]; const clampedData = metricsData.map(score => Math.max(0, Math.min(10, score || 0))); const colors = [getCssVarRA('--chart-blue'), getCssVarRA('--chart-green'), getCssVarRA('--chart-purple'), getCssVarRA('--chart-orange'), getCssVarRA('--chart-cyan'), getCssVarRA('--chart-red')]; const color = colors[index % colors.length]; const bgFill = rgbaColorRA(color, getCssVarRA('--chart-radar-fill-opacity')); return { label: emp.name, data: clampedData, fill: true, backgroundColor: bgFill, borderColor: color, pointBackgroundColor: color, pointBorderColor: '#fff', pointHoverBackgroundColor: '#fff', pointHoverBorderColor: color } }); if (ra_performanceComparisonChartInstance) ra_performanceComparisonChartInstance.destroy(); ra_performanceComparisonChartInstance = new Chart(ctx, { type: 'radar', data: { labels: labels, datasets: datasets }, options: { responsive: true, maintainAspectRatio: false, elements: { line: { borderWidth: 2 } }, scales: { r: { angleLines: { display: true, color: '#efefef' }, grid: { color: '#efefef'}, suggestedMin: 0, suggestedMax: 10, pointLabels: { font: { size: 10 } }, ticks: { backdropColor: 'white', stepSize: 2 } } }, plugins: { legend: { position: 'top' } } } }); }

            function renderEmployeeSummaryTable(data) {
                if (!tableBody) return;
                tableBody.innerHTML = ''; if (!data || data.length === 0) { tableBody.innerHTML = `<tr><td colspan="5" class="text-center p-4 text-muted fst-italic">No employee data found.</td></tr>`; return; }
                data.forEach((emp) => { const row = document.createElement('tr'); let scoreBadgeClass = 'text-bg-secondary'; let scoreText = 'Average'; if (emp.activityScore >= 9) { scoreBadgeClass = 'text-bg-success'; scoreText = 'Excellent'; } else if (emp.activityScore >= 7.5) { scoreBadgeClass = 'text-bg-warning'; scoreText = 'Good'; } else if (emp.activityScore < 6.5) { scoreBadgeClass = 'text-bg-danger'; scoreText = 'Needs Improv.'; } const completion = emp.tasksCompleted; let progressBgClass = ''; let progressTextColor = '#fff'; if (completion >= 80) { progressBgClass = 'bg-progress-high'; } else if (completion >= 50) { progressBgClass = 'bg-progress-medium'; progressTextColor = '#212529'; } else { progressBgClass = 'bg-progress-low'; } row.innerHTML = `<td><div class="employee-name">${emp.name}</div></td><td class="text-center"><div class="progress" role="progressbar" aria-label="Completion rate for ${emp.name}" aria-valuenow="${completion}" aria-valuemin="0" aria-valuemax="100"><div class="progress-bar ${progressBgClass}" style="width: ${completion}%; color: ${progressTextColor};">${completion}%</div></div></td><td class="text-center"><span class="metric-value ${emp.tasksOverdue === 0 ? 'text-success' : emp.tasksOverdue <= 5 ? 'text-warning' : 'text-danger'}">${emp.tasksOverdue}</span></td><td class="text-center"><span class="metric-value text-info">${emp.filesUploaded}</span></td><td class="text-center"><span class="badge ${scoreBadgeClass}">${scoreText}</span></td>`; tableBody.appendChild(row); });
            }
            function applyFiltersRA() { // Renamed
                const startDate = startDateInput ? startDateInput.value : null; const endDate = endDateInput ? endDateInput.value : null; console.log("Applying filters for period:", startDate, "to", endDate);
                // --- Filtering Simulation ---
                // In a real app, you'd filter employeePerformanceData based on dates
                // For this demo, we'll just use the full dataset regardless of date filter
                 currentFilteredData = [...employeePerformanceData]; // Re-assign potentially filtered data
                 ra_renderFunctions.getCurrentFilteredData = () => currentFilteredData; // Update shared data accessor

                // Re-render everything
                ra_renderFunctions.renderTaskCompletionChart(currentFilteredData);
                ra_renderFunctions.renderOverdueTasksChart(currentFilteredData);
                ra_renderFunctions.renderFilesUploadedChart(currentFilteredData);
                ra_renderFunctions.renderPerformanceComparisonChart(currentFilteredData);
                renderEmployeeSummaryTable(currentFilteredData);
            }
            function setPeriodDates(period) { const today = new Date(); let startDate, endDate = new Date(); switch (period) { case 'day': startDate = new Date(today); break; case 'month': startDate = new Date(today.getFullYear(), today.getMonth(), 1); break; case 'week': default: const firstDay = today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1); startDate = new Date(new Date(today).setDate(firstDay)); break; } if(startDateInput) startDateInput.value = formatDateInput(startDate); if(endDateInput) endDateInput.value = formatDateInput(endDate); applyFiltersRA(); }
            function generateCsv(tableElement, filename = 'report.csv') { let csv = []; const rows = tableElement.querySelectorAll("thead tr, tbody tr"); for (let i = 0; i < rows.length; i++) { const row = [], cols = rows[i].querySelectorAll("td, th"); for (let j = 0; j < cols.length; j++) { let data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, "").replace(/(\s\s)/gm, " ").trim(); if (cols[j].querySelector('.progress')) { const progressBar = cols[j].querySelector('.progress-bar'); data = progressBar ? progressBar.innerText.trim() : '0%'; } data = data.replace(/"/g, '""'); if (data.includes(',')) data = `"${data}"`; row.push(data); } csv.push(row.join(",")); } const csvFile = new Blob([csv.join("\n")], { type: "text/csv" }); const downloadLink = document.createElement("a"); downloadLink.download = filename; downloadLink.href = window.URL.createObjectURL(csvFile); downloadLink.style.display = "none"; document.body.appendChild(downloadLink); downloadLink.click(); document.body.removeChild(downloadLink); }
             function generatePdf(tableElement, filename = 'report.pdf') {
                if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') { alert('jsPDF library is not loaded.'); return; }
                const { jsPDF } = jspdf; const doc = new jsPDF({ orientation: 'landscape' });
                const startDateValue = startDateInput ? startDateInput.value : null; const endDateValue = endDateInput ? endDateInput.value : null; const startDateFormatted = formatReportDate(startDateValue); const endDateFormatted = formatReportDate(endDateValue); const dateRangeText = `Period: ${startDateFormatted} - ${endDateFormatted}`; const reportTitle = "Employee Performance Report";
                doc.setFontSize(16); doc.text(reportTitle, 14, 16); doc.setFontSize(10); doc.setTextColor(100); doc.text(dateRangeText, 14, 22); doc.setTextColor(0);
                if (typeof doc.autoTable !== 'function') { alert('jsPDF AutoTable plugin is not loaded.'); return; }
                const head = [['Employee', 'Completion (%)', 'Overdue', 'Files', 'Score']]; const body = []; const rows = tableElement.querySelectorAll("tbody tr");
                rows.forEach(row => { const rowData = []; const cells = row.querySelectorAll("td"); rowData.push(cells[0] ? cells[0].innerText.trim() : ''); rowData.push(cells[1] ? cells[1].querySelector('.progress-bar')?.innerText.trim() || '0%' : '0%'); rowData.push(cells[2] ? cells[2].innerText.trim() : '0'); rowData.push(cells[3] ? cells[3].innerText.trim() : '0'); rowData.push(cells[4] ? cells[4].querySelector('.badge')?.innerText.trim() || '' : ''); body.push(rowData); });
                const tableStartY = 28;
                doc.autoTable({ head: head, body: body, startY: tableStartY, theme: 'grid', styles: { fontSize: 8, cellPadding: 2 }, headStyles: { fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold' }, columnStyles: { 0: { cellWidth: 60 }, 1: { cellWidth: 'auto', halign: 'center'}, 2: { cellWidth: 'auto', halign: 'center'}, 3: { cellWidth: 'auto', halign: 'center'}, 4: { cellWidth: 'auto', halign: 'center'} } });
                doc.save(filename);
             }

            if (filterForm) { setPeriodDates('week'); filterForm.addEventListener('submit', (event) => { event.preventDefault(); applyFiltersRA(); }); }
            if (periodBtnGroup) { periodBtnGroup.addEventListener('change', (event) => { if (event.target.name === 'period') { setPeriodDates(event.target.value); } }); }
            if (exportPdfBtn) { exportPdfBtn.addEventListener('click', () => { const table = document.getElementById('employeeSummaryTable'); if (table) { generatePdf(table, `Employee_Summary_${formatDateInput(new Date())}.pdf`); } else { alert('Summary table not found.'); } }); }
            if (exportExcelBtn) { exportExcelBtn.addEventListener('click', () => { const table = document.getElementById('employeeSummaryTable'); if (table) { generateCsv(table, `Employee_Summary_${formatDateInput(new Date())}.csv`); } else { alert('Summary table not found.'); } }); }

            applyFiltersRA(); // Initial Render for this section's data

        }); // End Reports & Analytics DOMContentLoaded


    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">

    <!-- CSS الخاص بالأقسام الديناميكية (يجب أن تكون موجودة) -->
    <link rel="stylesheet" href="employee-scheduling.css">
    <!-- <link rel="stylesheet" href="projects-view.css"> -->
    <!-- <link rel="stylesheet" href="task-management.css"> -->

    <style>
        /* --- أنماط الداشبورد الأساسية (مأخوذة من الكود الأصلي) --- */
        /* --- Base Variables --- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e3a8a;
            --primary-light: #dbeafe;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;  /* Default Text Color (Dark in Light Mode) */
            --light: #f8fafc;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --white: #ffffff;
            --sidebar-width: 280px;
            --sidebar-bg: #1e3a8a;
            --sidebar-text: rgba(255,255,255,0.9);
            --sidebar-hover: rgba(255,255,255,0.1);
            --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1);
            --success: #10b981;
            --team-manager: #ef4444; /* Keep for role color */
            --compact-padding: 0.5rem;
            --normal-padding: 1rem;
            --spacious-padding: 1.5rem;
            --stat-card-bg-1: linear-gradient(135deg, #e0f2fe, #bae6fd); /* Light Blue */
            --stat-card-bg-2: linear-gradient(135deg, #dcfce7, #bbf7d0); /* Light Green */
            --stat-card-bg-3: linear-gradient(135deg, #fef3c7, #fde68a); /* Light Yellow */
            --stat-card-bg-4: linear-gradient(135deg, #fee2e2, #fecaca); /* Light Red */
            --welcome-bg-1: linear-gradient(135deg, var(--primary-dark), #172554);
            --welcome-bg-2: linear-gradient(135deg, #064e3b, #065f46);
            --welcome-bg-3: linear-gradient(135deg, #4a044e, #6b21a8);
            --welcome-bg-current: var(--welcome-bg-1); /* Default welcome bg */

            /* High Contrast Variables (Initial basic setup) */
            --hc-text: #000000;
            --hc-background: #ffffff;
            --hc-primary: #0000ff;
            --hc-secondary: #008000;
            --hc-link: #0000ee;
            --hc-border: #000000;

            /* Text Color Variable (for request ✅ 2️⃣) - Aliased to existing variables */
            --text-color: var(--dark);

             /* Schedule specific */
             --schedule-weekend-bg: #f3f4f6; /* Light gray for weekend cells */
             --schedule-weekend-text: #9ca3af; /* Muted text for weekend OFF */
        }
        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--primary-light); color: var(--text-color); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }

        /* High Contrast Mode */
        body.high-contrast {
             --dark: var(--hc-text);
             --light: var(--hc-background);
             --gray: var(--hc-text); /* Adjust as needed */
             --light-gray: var(--hc-border);
             --white: var(--hc-background);
             --primary: var(--hc-primary);
             --primary-dark: var(--hc-primary);
             --primary-light: #e0e0ff; /* Lighter blue for hc bg */
             --secondary: var(--hc-secondary);
             --sidebar-bg: var(--hc-background);
             --sidebar-text: var(--hc-text);
             --sidebar-hover: #e0e0e0;
             --sidebar-active: #c0c0c0;
             --sidebar-divider: var(--hc-border);
             --text-color: var(--hc-text); /* High contrast text */
             color: var(--text-color);
             background-color: var(--hc-background);
        }
         body.high-contrast .welcome-section,
         body.high-contrast .stat-card,
         body.high-contrast .top-nav,
         body.high-contrast .sidebar,
         body.high-contrast .activity-section,
         body.high-contrast .content-section {
             background: var(--hc-background);
             border: 1px solid var(--hc-border);
             color: var(--text-color);
         }
          body.high-contrast .btn,
          body.high-contrast .form-control,
          body.high-contrast .search-bar input {
              border: 1px solid var(--hc-border);
          }
          body.high-contrast .btn-primary { background-color: var(--hc-primary); color: var(--hc-background); }
          body.high-contrast .logo { color: var(--text-color); }
          body.high-contrast .logo-icon { color: var(--hc-primary); }
          body.high-contrast .menu-item { color: var(--text-color); border-left-color: transparent; }
          body.high-contrast .menu-item.active { background-color: #c0c0c0; border-left-color: var(--hc-primary); }
          body.high-contrast .stat-card { border-left-width: 3px; background: var(--hc-background); } /* Reset gradient */
          body.high-contrast .welcome-section { background: var(--hc-background); }


        /* --- Sidebar Styles --- */
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; cursor: pointer;}
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); font-weight: 600;}
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .connection-status { padding: 0.75rem 1.5rem; margin-top: auto; border-top: 1px solid var(--sidebar-divider); display: flex; align-items: center; gap: 0.5rem; color: rgba(16, 185, 129, 0.9); font-size: 0.85rem; flex-shrink: 0; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--success); animation: pulseStatus 2s infinite; }
        @keyframes pulseStatus { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } }

        /* --- Main Content & Top Nav Styles --- */
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; }
        body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--white); color: var(--text-color); } /* Use text-color */
        .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: calc(100% + 5px); left: 0; width: 100%; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; animation: fadeInDropdown 0.2s ease-out; }
        .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--text-color); display: flex; align-items: center; gap: 0.75rem; } /* Use text-color */
        .search-result-item i { color: var(--gray); }
        .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; animation: pulseBadge 1.5s infinite alternate; }
        @keyframes pulseBadge { from { transform: scale(1); } to { transform: scale(1.1); } }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; }
        .user-name { font-weight: 500; color: var(--text-color); } /* Use text-color */
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; animation: fadeInDropdown 0.2s ease-out; }
        @keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .user-dropdown.active { display: block; }
        .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 0.9rem; cursor: pointer; } /* Use text-color */
        .dropdown-item:hover { background-color: var(--light); }
        .dropdown-item i { width: 20px; text-align: center; color: var(--gray); }

        /* --- Content Area & Sections Styles --- */
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; } /* Adjusted height */
        body.compact .content-area { padding: 1rem; }
        body.spacious .content-area { padding: 3rem; }
        .welcome-section {
            background: var(--welcome-bg-current); /* Use variable */
            color: var(--white); /* Welcome section text is white by design */
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: padding 0.3s ease, margin-bottom 0.3s ease, background 1s ease-in-out; /* Smooth background transition */
        }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; }
        body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: inherit; }
        body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; color: inherit; }
        body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; }
        body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; border: 3px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; }
        .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: inherit;}
        body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; text-transform: capitalize; }
        .user-info-title.role-admin { color: var(--team-manager); font-weight: 700; text-shadow: 0 0 3px rgba(239, 68, 68, 0.5); }
        .user-info-title.role-supervisor { color: var(--warning); font-weight: 700; }
        .user-info-title.role-senior { color: var(--secondary); font-weight: 700; }
        body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; color: inherit; }
        .user-info-email span { color: inherit; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; }
        body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card {
            background: var(--white); /* Default */
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 5px solid var(--primary); /* Colored border instead of top gradient */
            color: var(--dark); /* Ensure text inside uses appropriate theme color */
        }
        .stat-card:nth-child(1) { border-left-color: var(--primary); background: var(--stat-card-bg-1); }
        .stat-card:nth-child(2) { border-left-color: var(--secondary); background: var(--stat-card-bg-2); }
        .stat-card:nth-child(3) { border-left-color: var(--warning); background: var(--stat-card-bg-3); }
        .stat-card:nth-child(4) { border-left-color: var(--danger); background: var(--stat-card-bg-4); }

        body.compact .stat-card { padding: 1rem; }
        body.spacious .stat-card { padding: 2rem; }
        .stat-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        /* .stat-card::before removed */
        .stat-title { font-size: 0.9rem; color: var(--text-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; } /* Use text-color */
        body.compact .stat-title { font-size: 0.8rem; }
        .stat-title i { /* Color set dynamically or removed if not needed per card */ opacity: 0.8; }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; }
        /* Stat value colors are specific and contrast should be checked manually */
        .stat-card:nth-child(1) .stat-value { color: #1e40af; }
        .stat-card:nth-child(2) .stat-value { color: #15803d; }
        .stat-card:nth-child(3) .stat-value { color: #b45309; }
        .stat-card:nth-child(4) .stat-value { color: #b91c1c; }

        body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; }
        body.compact .stat-trend { font-size: 0.8rem; }
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; }
        body.compact .activity-section { padding: 1rem; }
        body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; }
        body.compact .section-header { margin-bottom: 1rem; }
        body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--text-color); } /* Use text-color */
        body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;}
        .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
        .view-all { color: var(--primary); }
        .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); }
        .delete-all { color: var(--danger); }
        .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); }
        .activity-list { list-style: none; padding-left: 0; max-height: 400px; overflow-y: auto; } /* Added max-height and scroll */
        .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--light-gray); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; }
        body.compact .activity-item { padding: 0.75rem 0; }
        body.spacious .activity-item { padding: 1.25rem 0; }
        .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(37, 99, 235, 0.08); animation: highlightNewActivity 2.5s ease-out forwards; }
        @keyframes highlightNewActivity { 0% { background-color: rgba(37, 99, 235, 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; }
        body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; }
        .activity-message { margin-bottom: 0.25rem; color: var(--text-color); } /* Use text-color */
        body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--gray); }
        body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; }
        /* Delete icon visible by default */
        .delete-activity {
            color: var(--danger);
            cursor: pointer;
            opacity: 0.6; /* Visible by default */
            transition: opacity 0.2s, background-color 0.2s;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .activity-item:hover .delete-activity {
             opacity: 1; /* Already visible, just make fully opaque on hover */
        }
        .delete-activity:hover {
            opacity: 1; background-color: rgba(239, 68, 68, 0.1);
        }

        /* --- Profile & Settings Sections Styles --- */
        .content-section { /* Shared styles already applied */ background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease; display: none; animation: fadeInContent 0.4s ease-in-out; } /* Hidden by default */
        .content-section.active { display: block; } /* Shown when active */
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body.compact .content-section { padding: 1rem; }
        body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; }
        body.compact .section-main-header { margin-bottom: 1.5rem; }
        body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); }
        body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;}
        .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        #profileAvatarLarge::after { content: '\f0ee'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; padding: 5px 0; font-size: 1rem; opacity: 0; transition: opacity 0.3s; }
        #profileAvatarLarge:hover::after { opacity: 1; }
        #uploadPhotoButton { display: none; } /* Hide the button, use avatar click */

        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; }
        body.compact .data-form { gap: 1rem; }
        body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; }
        body.compact .form-group { margin-bottom: 0.75rem; }
        body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label, .settings-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-color); transition: margin-bottom 0.3s ease, font-size 0.3s ease; } /* Use text-color */
        body.compact .form-group label, body.compact .settings-label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; background-color: var(--white); color: var(--text-color); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; } /* Use text-color */
        body.compact .form-control { padding: 0.5rem; font-size: 0.9rem; }
        body.spacious .form-control { padding: 1rem; }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; opacity: 0.7; }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; }
        body.compact .form-actions { margin-top: 0.5rem; }
        body.spacious .form-actions { margin-top: 2rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; } /* Added justify-content */
        body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); }
        .btn-warning { background-color: var(--warning); color: var(--primary-dark); } /* Warning button style */
        .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: #dc2626; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover:not(:disabled) { background-color: #0d9f6e; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; }
        body.compact .settings-tabs { margin-bottom: 1.5rem; }
        body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; }
        body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; }
        body.spacious .settings-tab { padding: 1rem 2rem; }
        .settings-tab:hover { color: var(--primary); }
        .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}
        .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; }
        @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        /* Settings Sub-section */
        .settings-subsection {
             margin-top: 2rem;
             padding-top: 1.5rem;
             border-top: 1px solid var(--light-gray);
        }
        .settings-subsection:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        .settings-subsection h4 {
             font-size: 1.1rem;
             font-weight: 600;
             color: var(--primary-dark);
             margin-bottom: 1rem;
        }
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0; flex-wrap: wrap; } /* Added wrap */
        .setting-item > div:first-child { flex-basis: 100%; margin-bottom: 0.5rem; /* Default: Label takes full width */ }
        @media (min-width: 768px) { /* On larger screens, allow side-by-side */
            .setting-item > div:first-child { flex-basis: auto; margin-bottom: 0; }
        }
        .setting-item-label { font-weight: 500; color: var(--text-color); } /* Use text-color */
        .setting-item-description { font-size: 0.9rem; color: var(--gray); margin-top: 0.25rem;}
        .setting-item-control { flex-shrink: 0; margin-left: 1rem; }
         @media (max-width: 767px) { /* Stack control below on small screens */
            .setting-item-control { margin-left: 0; width: 100%; margin-top: 0.5rem; }
        }


        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; }
        body.compact .switch { width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        body.compact input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; }
        body.compact .team-management { margin-top: 1rem; }
        body.spacious .team-management { margin-top: 2rem; }
        .team-management h3, .add-member-form h4 { color: var(--text-color); margin-bottom: 1rem; } /* Use text-color */
        .team-list { margin-top: 1rem; }
        body.compact .team-list { margin-top: 0.75rem; }
        body.spacious .team-list { margin-top: 1.5rem; }
        .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--light-gray); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--white); }
        body.compact .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; }
        body.spacious .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; }
        .team-member-card:hover { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); border-color: var(--primary); }
        .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; }
        body.compact .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        .member-details { flex: 1; min-width: 0; }
        .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} /* Use text-color */
        body.compact .member-name { font-size: 0.9rem; }
        .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        body.compact .member-email { font-size: 0.8rem; }
        .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; text-transform: capitalize; }
        body.compact .member-role { font-size: 0.7rem; margin: 0 0.75rem; }
        .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .role-senior { background-color: rgba(37, 99, 235, 0.1); color: var(--primary); }
        .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .role-member { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
        .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        /* Invite form layout adjustment (already likely handled by this CSS) */
        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); }
        body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; }
        body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        .password-error { color: var(--danger); font-size: 0.85rem; margin-top: 0.25rem; display: none; }
        .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn .spinner { display: inline-block; /* Make spinner visible when inside button */ }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading span { margin-left: 0.5rem; } /* Space between spinner and text */

        .btn-outline .spinner { border-color: rgba(37, 99, 235, 0.3); border-top-color: var(--primary); }
        .loading-text { display: none; font-size: 0.9rem; color: var(--gray); margin-left: 0.5rem; }

        /* --- Theme Styles & Responsive --- */
        body.light-theme { --primary-light: #f1f5f9; --light: #ffffff; --white: #ffffff; --dark: #1e293b; --gray: #64748b; --light-gray: #e2e8f0; --text-color: var(--dark); background-color: var(--primary-light); }
        body.dark-theme {
            --primary: #3b82f6;
            --primary-dark: #1e40af;
            --primary-light: #1e293b;
            --light: #334155; /* Slightly lighter background for cards/sections */
            --white: #0f172a; /* Darkest background for body */
            --dark: #e2e8f0; /* Light text */
            --gray: #94a3b8; /* Lighter gray text */
            --light-gray: #475569; /* Darker borders/dividers */
            --text-color: var(--dark); /* Update text-color for dark mode */
            --schedule-weekend-bg: #262f3e; /* Darker gray for weekend cells */
            --schedule-weekend-text: #6b7280; /* Muted dark text for weekend OFF */
            background-color: var(--white); /* Use darkest for body */
            color: var(--text-color); /* Default text color */
        }
        /* Dark Theme Overrides */
        body.dark-theme .top-nav { background-color: var(--light); border-bottom-color: var(--light-gray); } /* Lighter BG for nav */
        body.dark-theme .stat-card, body.dark-theme .activity-section, body.dark-theme .content-section, body.dark-theme .team-member-card, body.dark-theme .add-member-form { background-color: var(--light); border-color: var(--light-gray); } /* Lighter BG for content cards */
        body.dark-theme .search-bar input, body.dark-theme .form-control { background-color: var(--primary-light); border-color: var(--light-gray); color: var(--text-color); } /* Even darker BG for inputs */
        body.dark-theme .form-control[readonly] { background-color: var(--light); opacity: 0.6; }
        body.dark-theme .search-results { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .search-result-item { color: var(--text-color); } /* Ensure search result text is light */
        body.dark-theme .search-result-item:hover { background-color: var(--primary-light); }
        body.dark-theme .user-dropdown { background-color: var(--light); border-color: var(--light-gray); }
        body.dark-theme .dropdown-item { color: var(--text-color); } /* Ensure dropdown text is light */
        body.dark-theme .dropdown-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notifications-container { background-color: var(--light); } /* Lighter BG for notifications panel */
        body.dark-theme .notification-list-item:hover { background-color: var(--primary-light); }
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } /* Slightly more visible unread */
        body.dark-theme .confirm-container, body.dark-theme .modal-content { background-color: var(--light); color: var(--text-color); } /* Modal background and default text */
        body.dark-theme .theme-option div { border-color: var(--light-gray); }
        body.dark-theme .theme-option.selected div { border-color: var(--primary); }
        body.dark-theme .back-button { color: var(--primary); } /* Use primary color for link */
        body.dark-theme .back-button:hover { background-color: var(--light); color: #60a5fa; border-color: var(--primary); }
        body.dark-theme .notifications-footer { background-color: var(--light); border-top-color: var(--light-gray); }
        body.dark-theme .welcome-section { background: var(--welcome-bg-current); color: var(--white); } /* Welcome section retains white text */
        body.dark-theme .welcome-subtitle { color: inherit; opacity: 0.8; } /* Inherit white */
        body.dark-theme .user-info-name { color: inherit; } /* Inherit white */
        body.dark-theme .user-info-title { color: var(--gray); } /* Role title uses gray */
        body.dark-theme .user-info-title.role-admin { color: var(--team-manager); }
        body.dark-theme .user-info-email span { color: inherit; } /* Inherit white */
        body.dark-theme .stat-card { background: var(--light); color: var(--text-color);} /* Dark theme stat card background, ensure text color */
        body.dark-theme .stat-title { color: var(--text-color); } /* Ensure stat title is light */
        /* Specific stat value colors adjusted for dark theme */
        body.dark-theme .stat-card:nth-child(1) .stat-value { color: #93c5fd; }
        body.dark-theme .stat-card:nth-child(2) .stat-value { color: #86efac; }
        body.dark-theme .stat-card:nth-child(3) .stat-value { color: #fcd34d; }
        body.dark-theme .stat-card:nth-child(4) .stat-value { color: #fca5a5; }
        body.dark-theme .activity-icon { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa; } /* Adjust icon color */
        body.dark-theme .activity-item { border-bottom-color: var(--light-gray); }
        body.dark-theme .activity-message { color: var(--text-color); } /* Activity text */
        body.dark-theme .activity-time { color: var(--gray); } /* Activity time */
        body.dark-theme .activity-item.new-activity { background-color: rgba(59, 130, 246, 0.1); }
        body.dark-theme .delete-activity:hover { background-color: rgba(239, 68, 68, 0.2); }
        body.dark-theme .profile-avatar-section label { color: var(--text-color); } /* Text label */
        body.dark-theme #profileAvatarLarge { background-color: var(--light); color: var(--text-color); border-color: var(--primary-light); }
        body.dark-theme .profile-header-text { color: var(--gray); } /* Profile intro text */
        body.dark-theme .placeholder-content { color: var(--gray); border-color: var(--light-gray); }
        body.dark-theme .placeholder-content h2 { color: var(--text-color); }
        body.dark-theme .placeholder-content p { color: var(--gray); }
        body.dark-theme .placeholder-content .error-message { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: var(--text-color); } /* Ensure error text readable */
        body.dark-theme .settings-label, body.dark-theme .form-group label { color: var(--text-color); } /* Form labels */
        body.dark-theme .settings-subsection h4 { color: #93c5fd; } /* Lighter primary */
        body.dark-theme .setting-item-label { color: var(--text-color); } /* Setting item title */
        body.dark-theme .setting-item-description { color: var(--gray); } /* Setting item description */
        body.dark-theme .theme-option span { color: var(--text-color); } /* Theme label text */
        body.dark-theme .qr-code-placeholder { border-color: var(--light-gray); color: var(--gray); }
        body.dark-theme .danger-zone-item .btn-danger { background-color: #dc2626; } /* Ensure danger button stands out */
        body.dark-theme .danger-zone-item .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        body.dark-theme .danger-zone-item p { color: var(--gray); } /* Danger zone description */

        /* Dark Theme Employee Scheduling Specifics - These are handled in employee-scheduling.css now */
        /* body.dark-theme #featureSectionsContainer.employee-scheduling ... { styles removed } */

        body.dark-theme .checkbox-group { border-color: var(--light-gray); }
        body.dark-theme .checkbox-group label { color: var(--text-color); } /* Checkbox label text */
        body.dark-theme .confirm-title { color: var(--text-color); }
        body.dark-theme .confirm-message { color: var(--gray); }
        body.dark-theme .modal-title { color: #93c5fd; } /* Lighter primary */
        body.dark-theme .team-member-card .member-name { color: var(--text-color); }
        body.dark-theme .team-member-card .member-email { color: var(--gray); }
        body.dark-theme .search-result-item strong { color: var(--text-color); } /* Ensure bold text is readable */
        body.dark-theme .user-name { color: var(--text-color); } /* Top nav user name */


        /* Theme Selection Styles */
        .theme-options-container { display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap; } /* Added wrap */
        .theme-option { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .theme-option .theme-preview { width: 60px; height: 40px; border: 2px solid var(--light-gray); border-radius: 6px; transition: border-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .theme-option .theme-label { text-align: center; display: block; margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-color); } /* Use text-color */
        .theme-option:hover .theme-preview { border-color: var(--primary); }
        .theme-option.selected .theme-preview { border-color: var(--primary); border-width: 3px; }
        /* Specific theme previews */
        .theme-preview.light-preview { background-color: #f8fafc; color: #1e293b; }
        .theme-preview.dark-preview { background-color: #0f172a; color: #e2e8f0; }
        .theme-preview.system-preview { background: linear-gradient(45deg, #f8fafc 50%, #0f172a 50%); color: var(--gray); }


        /* 2FA Setup Styles */
        .two-fa-status { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .two-fa-status .status-indicator { width: 10px; height: 10px; border-radius: 50%; }
        .two-fa-status .status-indicator.enabled { background-color: var(--success); }
        .two-fa-status .status-indicator.disabled { background-color: var(--danger); }
        .two-fa-setup { border: 1px dashed var(--light-gray); padding: 1.5rem; border-radius: 6px; margin-top: 1rem; background-color: var(--light); }
        .qr-code-placeholder { width: 150px; height: 150px; border: 2px dashed var(--light-gray); display: flex; align-items: center; justify-content: center; text-align: center; color: var(--gray); font-size: 0.9rem; margin: 1rem auto; }
        .two-fa-actions { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; } /* Added wrap */

        /* Danger Zone Styles */
         .danger-zone-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 1.5rem;
             border: 1px solid var(--danger);
             background-color: rgba(239, 68, 68, 0.05);
             border-radius: 8px;
             margin-bottom: 1rem;
             flex-wrap: wrap; /* Allow wrapping */
         }
         .danger-zone-item div { max-width: 100%; flex-grow: 1; margin-right: 1rem; /* Space before button */ }
         @media (min-width: 768px) { /* Limit width on larger screens */
            .danger-zone-item div { max-width: 70%; }
         }
         .danger-zone-item h5 { color: var(--danger); margin-bottom: 0.25rem; }
         .danger-zone-item p { color: var(--gray); font-size: 0.9rem; }
         .danger-zone-item .btn { flex-shrink: 0; /* Prevent button shrinking */ margin-top: 0.5rem; /* Space when wrapped */}


        .notifications-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; justify-content: flex-end; }
        .notifications-modal.active { display: flex; }
        .notifications-container { width: 400px; max-width: 100%; background-color: var(--white); height: 100vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .notifications-header { padding: 1.5rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; background-color: var(--primary); color: white; flex-shrink: 0; }
        .notifications-title { font-size: 1.25rem; font-weight: 600; }
        .close-notifications { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: white; }
        .notifications-body { flex-grow: 1; overflow-y: auto; }
        .notification-list-item { padding: 1rem 1.5rem; border-bottom: 1px solid var(--light-gray); transition: background-color 0.2s; display: flex; gap: 1rem; align-items: flex-start; /* Align top */ cursor: pointer; position: relative; }
        .notification-list-item:hover { background-color: var(--light); }
        .notification-list-item.unread { background-color: rgba(37, 99, 235, 0.08); font-weight: 500; } /* Adjusted unread bg slightly */
        body.dark-theme .notification-list-item.unread { background-color: rgba(59, 130, 246, 0.15); } /* Dark theme unread */
        .notification-list-item:last-child { border-bottom: none; }
        .notification-icon-wrapper { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(37, 99, 235, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        body.dark-theme .notification-icon-wrapper { background-color: rgba(59, 130, 246, 0.1); color: #60a5fa;}
        .notification-content { flex: 1; min-width: 0; }
        .notification-message { margin-bottom: 0.25rem; color: var(--text-color); line-height: 1.4; } /* Use text-color */
        .notification-time { font-size: 0.8rem; color: var(--gray); }
        .delete-notification { color: var(--danger); cursor: pointer; opacity: 0; /* Hidden by default */ transition: opacity 0.2s; position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.25rem; background: var(--white); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .notification-list-item:hover .delete-notification { opacity: 0.6; } /* Show on hover */
        .delete-notification:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        body.dark-theme .delete-notification { background: var(--light); }
        body.dark-theme .delete-notification:hover { background: rgba(239, 68, 68, 0.2); }
        .no-notifications-message { text-align: center; padding: 2rem; color: var(--gray); }
        .notifications-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; flex-shrink: 0; background-color: var(--light); flex-wrap: wrap; gap: 0.5rem; } /* Added wrap */
        .confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .confirm-modal.active { display: flex; }
        .confirm-container { background-color: var(--white); border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 400px; max-width: 90%; padding: 2rem; animation: fadeInScale 0.3s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .confirm-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-color); } /* Use text-color */
        .confirm-message { margin-bottom: 1.5rem; line-height: 1.5; color: var(--gray); }
        .confirm-actions { display: flex; justify-content: flex-end; gap: 1rem; }
        .success-message { position: fixed; top: 20px; right: 20px; background-color: var(--success); color: white; padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 0.75rem; z-index: 1200; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-message.show { transform: translateX(0); }
        .success-message i { font-size: 1.25rem; }
        .back-button { display: inline-flex; align-items: center; gap: 0.75rem; color: var(--primary); font-weight: 500; cursor: pointer; margin-bottom: 1.5rem; padding: 0.6rem 1.2rem; border-radius: 6px; transition: background-color 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .back-button:hover { background-color: var(--primary-light); border-color: var(--primary); color: var(--primary-dark); }
        .back-button i { transition: transform 0.2s; font-size: 0.8rem; }
        .back-button:hover i { transform: translateX(-3px); }
        #notificationSound { display: none; }
        .d-none { display: none !important; }
        .placeholder-content { text-align: center; padding: 4rem 2rem; color: var(--gray); border: 2px dashed var(--light-gray); border-radius: 8px; margin-top: 2rem; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: border-color 0.3s, color 0.3s; }
        .placeholder-content h2 { color: var(--text-color); margin-bottom: 1rem; } /* Use text-color */
        .placeholder-content p { color: var(--gray); } /* Ensure placeholder text uses gray */
        .placeholder-content .loading-indicator { font-size: 1.2rem; margin-top: 1rem; }
        .placeholder-content .error-message { color: var(--danger); font-weight: 500; margin-top: 1rem; white-space: pre-wrap; text-align: left; padding: 1rem; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 4px; max-width: 100%; overflow-wrap: break-word; }

        /* --- Employee Scheduling Scoped Styles --- */
        /* These styles are now moved to employee-scheduling.css */

        /* Generic Modal Styles (needed by other parts of dashboard too) */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); z-index: 1050; /* High z-index */
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: var(--white); width: 100%; max-width: 500px;
            border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 2rem; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s ease-out;
            color: var(--text-color);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--light-gray);
        }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: var(--primary-dark); }
        body.dark-theme .modal-title { color: #93c5fd; }
        .close-modal { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--gray); line-height: 1;}
        .close-modal:hover { color: var(--danger); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* Generic Toast Style */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--dark); color: var(--white); padding: 1rem 1.5rem; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1300; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 0.9rem; }
        .toast.show { opacity: 1; bottom: 30px; }
        .toast.success { background-color: var(--success); }
        .toast.error { background-color: var(--danger); }
        body.dark-theme .toast { background-color: var(--light); color: var(--text-color); }
        body.dark-theme .toast.success { background-color: var(--success); color: white; }
        body.dark-theme .toast.error { background-color: var(--danger); color: white; }

        /* Responsive Overrides */
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); width: 250px; box-shadow: none; }
            .sidebar.active { transform: translateX(0); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
            .main-content { margin-left: 0; }
            .search-bar { width: 250px; }
            .team-member-card { flex-wrap: wrap; }
            .main-content.sidebar-active { margin-left: 250px; } /* Adjust main content when sidebar is open */
            .sidebar-toggle { display: block; /* Show hamburger */ position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--primary); color: white; border: none; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
            .top-nav { padding-left: 60px; } /* Make space for hamburger */
        }
        @media (min-width: 993px) {
             .sidebar-toggle { display: none; } /* Hide hamburger on larger screens */
        }

        @media (max-width: 768px) {
            .top-nav { flex-direction: column; gap: 1rem; padding: 1rem; padding-left: 1rem; /* Reset padding */ }
            .search-bar { width: 100%; order: 2; }
            .user-menu { width: 100%; justify-content: space-between; order: 1; }
            .content-area { padding: 1.5rem; }
            .data-form { grid-template-columns: 1fr; }
            .form-actions { grid-column: span 1; }
            .user-info { flex-direction: column; text-align: center; }
            .user-info-avatar { margin-bottom: 1rem; }
            .stats-section { grid-template-columns: 1fr; }
            .settings-tabs { flex-wrap: nowrap; overflow-x: auto; } /* Prevent wrapping, allow scroll */
            .settings-tab { padding: 0.5rem 1rem; flex-shrink: 0; } /* Prevent shrinking */
            /* setting-item handled above for better wrapping */
            .confirm-container { width: 90%; }
            .team-member-card { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .member-role { margin: 0.5rem 0; }
            .member-actions { margin-top: 0.5rem; }
            .profile-avatar-section { margin-bottom: 1.5rem; }
            #profileAvatarLarge { width: 100px; height: 100px; font-size: 2.5rem; }
            /* Ensure invite form fields stack nicely */
            .add-member-form .data-form { grid-template-columns: 1fr; align-items: stretch; }
            .add-member-form .data-form > div { margin-bottom: 1rem; }
            .add-member-form .data-form > div:last-child { margin-top: 0; } /* Remove extra space above button */
            /* Mobile styles specific to schedule are now in employee-scheduling.css */
            .modal-content { width: 95%; padding: 1.5rem;}
            .notifications-container { width: 100%; max-width: 100%; }
            .sidebar-toggle { top: 10px; left: 10px; }
            .top-nav { padding-top: 60px; /* Make space for hamburger */ }
        }
        @media (max-width: 480px) {
            .section-header > div { justify-content: center; width: 100%; }
            .welcome-section { padding: 1.5rem; }
            .stats-section { gap: 0.75rem; }
            .stat-card { padding: 1rem; }
            .user-menu { gap: 1rem; }
            .user-name { display: none; } /* Hide name on very small screens */
            .user-status { margin-left: 0; }
            .notifications-footer { flex-direction: column; gap: 0.5rem; }
            .notifications-footer .btn { width: 100%; justify-content: center; }
            /* Danger zone handled above for better wrapping */
        }
         /* Checkbox Group for Notification Types */
         .checkbox-group {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
             gap: 0.75rem;
             margin-top: 0.5rem;
             padding: 0.5rem;
             border: 1px solid var(--light-gray);
             border-radius: 6px;
         }
         .checkbox-group label {
             display: flex;
             align-items: center;
             gap: 0.5rem;
             font-weight: normal; /* Override form-group label weight */
             font-size: 0.9rem;
             margin-bottom: 0; /* Override form-group label margin */
             color: var(--text-color); /* Ensure label text color */
         }
         .checkbox-group input[type="checkbox"] {
             width: auto; /* Override form-control width */
             margin-right: 0.25rem;
         }
         /* Simple link style for settings panel internal links */
         .settings-link {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
         }
         .settings-link:hover {
            text-decoration: underline;
            color: var(--primary-dark);
         }

        /* Hide close button in sidebar on larger screens */
        @media (min-width: 993px) {
            .close-sidebar { display: none !important; }
        }

    </style>
</head>
<body class=""> <!-- Theme applied by JS -->

    <!-- Audio & Message Elements -->
    <audio id="notificationSound" preload="auto">
        <source src="assets/notification.mp3" type="audio/mpeg"> <!-- Make sure this path is correct -->
    </audio>
    <div class="toast" id="toastMessage">Toast message</div>
    <div class="success-message" id="successMessage"> <i class="fas fa-check-circle"></i> <span id="successMessageText">Success!</span> </div>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo"> <i class="fas fa-users-cog logo-icon"></i> <span>TeamFlow</span> </div>
            <button class="sidebar-toggle close-sidebar" id="closeSidebar" aria-label="Close Sidebar"> <i class="fas fa-times"></i> </button>
        </div>
        <div class="sidebar-menu">
            <!-- Links use data-feature attribute for JS navigation -->
            <div class="menu-title">Navigation</div>
            <a href="#dashboard" class="menu-item active" data-feature="dashboard"> <i class="fas fa-tachometer-alt"></i><span>Dashboard</span> </a>
            <a href="#projects" class="menu-item" data-feature="projects"> <i class="fas fa-briefcase"></i><span>Projects</span> </a>
            <a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"> <i class="fas fa-chart-line"></i><span>Reports & Analytics</span> </a>
            <a href="#team-members-view" class="menu-item" data-feature="team-members-view"> <i class="fas fa-users"></i><span>Team Members</span> </a>
            <div class="menu-title">Core Features</div>
            <a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a>
            <a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a>
            <a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a>
            <a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a>
            <div class="menu-title">Team Tools</div>
            <a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a>
            <a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a>
            <a href="#deadline-tracking" class="menu-item" data-feature="deadline-tracking"><i class="fas fa-clock"></i><span>Deadline Tracking</span></a>
            <a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a>
            <div class="menu-divider"></div>
            <a href="#settings" class="menu-item" data-feature="settings"> <i class="fas fa-cog"></i><span>Settings</span> </a>
            <a href="#profile" class="menu-item" data-feature="profile"> <i class="fas fa-user-circle"></i><span>Profile</span> </a>
        </div>
        <div class="connection-status"> <div class="status-dot"></div> <span>Online</span> </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="search-bar">
                <i class="fas fa-search search-icon"></i>
                <input type="text" placeholder="Search..." id="searchInput" autocomplete="off">
                <div class="search-results" id="searchResults"></div>
            </div>
            <div class="user-menu">
                <div class="notification-icon" id="notificationIcon"> <i class="fas fa-bell"></i> <span class="notification-badge" id="notificationBadge" style="display: none;">0</span> </div>
                <div class="user-profile" id="userProfileContainer">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-profile-details"> <span class="user-name" id="userName">User</span> <span class="user-status"> • Connected</span> </div>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="#profile" class="dropdown-item" data-feature="profile"><i class="fas fa-user"></i><span>Profile</span></a>
                        <a href="#settings" class="dropdown-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a>
                        <a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Display Area -->
        <div class="content-area">
            <!-- Back Button -->
            <div class="back-button" id="backButton" style="display: none;"> <i class="fas fa-arrow-left"></i> <span id="backButtonText">Back</span> </div>

            <!-- STATIC Dashboard Content -->
            <div id="dashboardContent" class="content-section active">
                <div class="welcome-section" id="welcomeSection">
                    <h2 class="welcome-title">Welcome, <span id="welcomeName">User</span>!</h2>
                    <p class="welcome-subtitle">Overview of your team activities.</p>
                    <div class="user-info">
                        <div class="user-info-avatar" id="profileAvatar">U</div>
                        <div class="user-info-details">
                            <div class="user-info-name" id="userInfoName">Loading...</div>
                            <div class="user-info-title" id="userInfoRoleTitle">Loading...</div>
                            <div class="user-info-email"> <i class="fas fa-envelope"></i> <span id="userEmail">loading...</span> </div>
                        </div>
                    </div>
                </div>
                <div class="stats-section" id="statsSection"> <!-- Stats loaded by JS --> </div>
                <div class="activity-section">
                    <div class="section-header">
                        <h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3>
                        <div> <span class="view-all" id="viewAllActivity" style="display: none;">Show All</span> <span class="delete-all" id="deleteAllActivity" style="display: none;">Delete All</span> </div>
                    </div>
                    <ul class="activity-list" id="activityList"> <!-- Activity loaded by JS --> </ul>
                </div>
            </div>

            <!-- STATIC Profile Content -->
            <div id="profileContent" class="content-section">
                <div class="section-main-header"> <h2 class="section-main-title">Profile</h2> </div>
                 <p class="profile-header-text">Manage your personal information and avatar.</p>
                 <div class="profile-avatar-section">
                     <label class="settings-label">Avatar</label>
                     <div id="profileAvatarLarge" title="Click to upload photo">U</div>
                     <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;">
                 </div>
                 <form class="data-form" id="profileForm">
                     <div class="form-group"> <label for="firstName">First Name</label> <input type="text" id="firstName" class="form-control"> </div>
                     <div class="form-group"> <label for="lastName">Last Name</label> <input type="text" id="lastName" class="form-control"> </div>
                     <div class="form-group" style="grid-column: span 2;"> <label for="fullNameDisplay">Full Name</label> <input type="text" id="fullNameDisplay" class="form-control" readonly> </div>
                     <div class="form-group"> <label for="jobTitle">Job Title</label> <input type="text" id="jobTitle" class="form-control"> </div>
                     <div class="form-group"> <label for="email">Email</label> <input type="email" id="email" class="form-control" readonly> </div>
                     <div class="form-group"> <label for="phone">Phone Number</label> <input type="tel" id="phone" class="form-control"> </div>
                     <div class="form-group"> <label for="department">Department</label> <input type="text" id="department" class="form-control"> </div>
                     <div class="form-actions">
                         <button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button>
                         <button type="submit" class="btn btn-primary" id="saveProfileBtn"> <span class="btn-text">Save Changes</span> <span class="spinner" style="display: none;"></span> </button>
                     </div>
                 </form>
            </div>

            <!-- STATIC Settings Content Structure -->
            <div id="settingsContent" class="content-section">
                <div class="section-main-header"> <h2 class="section-main-title">System Settings</h2> </div>
                <div class="settings-tabs">
                    <div class="settings-tab active" data-tab="preferences">Preferences</div>
                    <div class="settings-tab" data-tab="account">Account</div>
                    <div class="settings-tab" data-tab="security">Security</div>
                    <div class="settings-tab" data-tab="notifications">Notifications</div>
                    <div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div>
                    <div class="settings-tab" data-tab="collaboration">Collaboration</div>
                    <div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div>
                </div>
                <!-- Settings Panels (visibility toggled by JS) -->
                 <div class="settings-panel active" id="preferencesPanel"> <!-- Preferences Content --> </div>
                 <div class="settings-panel" id="accountPanel"> <!-- Account Content --> </div>
                 <div class="settings-panel" id="securityPanel"> <!-- Security Content --> </div>
                 <div class="settings-panel" id="notificationsPanel"> <!-- Notifications Content --> </div>
                 <div class="settings-panel" id="teamPanel"> <!-- Team Management Content --> </div>
                 <div class="settings-panel" id="collaborationPanel"> <!-- Collaboration Content --> </div>
                 <div class="settings-panel" id="dangerPanel"> <!-- Danger Zone Content --> </div>
            </div>

            <!-- DYNAMIC Feature Content Area -->
            <!-- Content from external HTML files will be loaded here -->
            <div id="featureSections" class="content-section">
                <!-- Placeholder shown initially or on error -->
                <div class="placeholder-content" id="featurePlaceholder">
                    <h2 id="featureTitle">Feature Area</h2>
                    <p id="featureDescription">Select a feature from the sidebar.</p>
                    <div class="loading-indicator" style="display: none;"> <i class="fas fa-spinner fa-spin"></i> Loading... </div>
                    <div class="error-message" style="display: none;"> Error loading content. </div>
                </div>
            </div>

        </div> <!-- End .content-area -->
    </main> <!-- End .main-content -->

    <!-- Modals -->
    <div class="notifications-modal" id="notificationsModal"> <!-- Notifications Modal --> </div>
    <div class="confirm-modal" id="confirmModal"> <!-- Confirmation Modal --> </div>
    <div class="modal" id="editMemberModal"> <!-- Edit Member Modal --> </div>
    <!-- Add other general modals here if needed -->

    <!-- Dashboard Core JavaScript -->
    <script>
        // ==========================================
        //          DASHBOARD CORE SCRIPT
        // Manages Navigation, Dynamic Loading, UI
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Element References ---
            // (Simplified for brevity - assuming elements exist as per HTML structure)
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.menu-item'); // Includes sidebar & dropdown items with data-feature
            const contentSections = document.querySelectorAll('.content-area > .content-section'); // Direct children
            const featureSectionsContainer = document.getElementById('featureSections'); // The container for dynamic content
            const featurePlaceholder = document.getElementById('featurePlaceholder');
            const featureTitleEl = document.getElementById('featureTitle');
            const featureDescEl = document.getElementById('featureDescription');
            const featureLoadingEl = featurePlaceholder.querySelector('.loading-indicator');
            const featureErrorEl = featurePlaceholder.querySelector('.error-message');
            const backButton = document.getElementById('backButton');
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userDropdown = document.getElementById('userDropdown');
            const logoutLink = document.getElementById('logoutLink');
            const confirmModal = document.getElementById('confirmModal');
            const confirmTitle = document.getElementById('confirmTitle');
            const confirmMessage = document.getElementById('confirmMessage');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const toastMessage = document.getElementById('toastMessage');
            const successMessage = document.getElementById('successMessage'); // Original success message
            const successMessageText = document.getElementById('successMessageText');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationsModal = document.getElementById('notificationsModal');
            const closeNotifications = document.getElementById('closeNotifications');
            const notificationSound = document.getElementById('notificationSound');

            // --- State Variables ---
            let currentUser = null;
            let teamMembers = []; // Renamed from MOCK_USERS
            let currentFeature = 'dashboard'; // Tracks the currently active view/feature
            let currentSettingsTab = 'preferences'; // Tracks active tab within settings
            let confirmCallback = null; // Stores the action for the confirm modal
            let showToasts = true; // User preference
            let playSounds = true; // User preference
             // Holds references to dynamically loaded scripts to potentially remove them later
            let loadedFeatureScripts = {};

            // --- Constants ---
            const SIMULATED_DELAY = 300; // ms for fake loading

            // --- Mock Data (Should be replaced by API calls) ---
            const MOCK_USERS_DATA = [
                 { id: 1, name: 'Mohamed Elmenisy', email: 'm.elsayed@thechefz.co', title: 'Administrator', department: 'Management', phone: '+201234567890', avatar: '', initials: 'ME', role: 'admin', twoFaEnabled: false },
                 { id: 2, name: 'Yousef Ahmed', email: 'yousef@example.com', title: 'Supervisor', department: 'Operations', phone: '+20111222333', avatar: '', initials: 'YA', role: 'supervisor', twoFaEnabled: false },
                 { id: 3, name: 'Esraa Lashin', email: 'esraa@example.com', title: 'Senior Developer', department: 'Engineering', phone: '+20100999888', avatar: '', initials: 'EL', role: 'senior', twoFaEnabled: true },
                 { id: 4, name: 'Bassant Badr', email: 'bassant@example.com', title: 'Junior Designer', department: 'Design', phone: '+20155444333', avatar: '', initials: 'BB', role: 'member', twoFaEnabled: false },
                 { id: 5, name: 'Nada Mahmoud', email: 'nada@example.com', title: 'Member', department: 'Marketing', phone: '+20101234567', avatar: '', initials: 'NM', role: 'member', twoFaEnabled: false },
            ];

            // --- Initialization ---
            function initDashboard() {
                // Simulate loading current user data (e.g., from API or localStorage)
                currentUser = MOCK_USERS_DATA.find(u => u.role === 'admin') || MOCK_USERS_DATA[0]; // Find admin or take first user
                teamMembers = MOCK_USERS_DATA; // Load all users into teamMembers for now

                if (!currentUser) {
                    console.error("Fatal: Could not determine current user.");
                    // Handle this error appropriately, e.g., redirect to login
                    return;
                }

                console.log("Dashboard Initializing for:", currentUser.name);

                applyStoredPreferences(); // Theme, Contrast, etc.
                updateUserUI(); // Populate user-specific elements
                setupEventListeners();
                handleInitialNavigation(); // Load content based on URL hash or default
                // Dynamic updates (stats, activity) can be started here if needed
                startDynamicUpdates(); // Example
                setupResponsiveSidebar();
            }

            // --- UI Update & Preferences ---
            function updateUserUI() {
                // (Update Top Nav, Welcome Section, Profile Form etc. based on `currentUser`)
                // This function remains largely the same as in the previous provided script
                 // Example updates:
                 document.getElementById('userName').textContent = currentUser.name;
                 document.getElementById('userAvatar').textContent = currentUser.initials || '?';
                 if (currentUser.avatar) { /* Apply avatar image */ }
                 document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0];
                 // ... update other elements ...
                  // Update Account panel email display
                 const accountEmailDisplay = document.getElementById('accountEmail');
                 if (accountEmailDisplay) accountEmailDisplay.value = currentUser.email;
                 // Update phone for SMS 2FA preview
                  const userPhoneNumberForSms = document.getElementById('userPhoneNumberForSms');
                  if (userPhoneNumberForSms) userPhoneNumberForSms.textContent = currentUser.phone || 'Not Available';
            }

            function applyStoredPreferences() {
                // (Load theme, contrast, language from localStorage and apply)
                // This function remains largely the same
                 const storedTheme = localStorage.getItem('theme') || 'system';
                 setTheme(storedTheme);
                 // ... apply other preferences ...
            }

            function setTheme(theme) {
                // (Logic to apply theme class to body)
                document.body.className = ''; // Clear previous
                if (theme === 'system') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.classList.add(prefersDark ? 'dark-theme' : 'light-theme');
                } else {
                    document.body.classList.add(`${theme}-theme`);
                }
                localStorage.setItem('theme', theme);
                 // Update theme selector UI in settings if the settings panel is loaded
                 const themeOptions = document.querySelectorAll('.theme-option');
                 if (themeOptions.length > 0) {
                    themeOptions.forEach(option => {
                        option.classList.toggle('selected', option.dataset.theme === theme);
                    });
                 }
            }
            // Add other preference functions (setContrast, applyLanguage, etc.)

            // --- Navigation & Dynamic Content Loading ---

            /**
             * Sets the active feature/section in the dashboard.
             * @param {string} featureId - The identifier for the feature (e.g., 'dashboard', 'employee-scheduling').
             * @param {string|null} [settingsTab=null] - If featureId is 'settings', specifies the tab to activate.
             * @param {boolean} [skipHistory=false] - If true, doesn't update browser history.
             */
             function setActiveFeature(featureId, settingsTab = null, skipHistory = false) {
                console.log(`Activating Feature: ${featureId}${settingsTab ? ` (Tab: ${settingsTab})` : ''}`);
                currentFeature = featureId;
                currentSettingsTab = featureId === 'settings' ? (settingsTab || currentSettingsTab || 'preferences') : null;

                // --- RBAC Check (Example) ---
                if (featureId === 'settings') {
                    if (settingsTab === 'danger' && currentUser.role !== 'admin') {
                         showToast("Access Denied: Admins only.", "error");
                         setActiveFeature('dashboard', null, true); // Redirect without history loop
                         return;
                    }
                    if (settingsTab === 'team' && !['admin', 'supervisor'].includes(currentUser.role)) {
                         showToast("Access Denied: Admins/Supervisors only.", "error");
                         setActiveFeature('dashboard', null, true); // Redirect
                         return;
                    }
                }
                // Add checks for other features if needed...

                // --- Update Menu ---
                menuItems.forEach(item => {
                    item.classList.toggle('active', item.getAttribute('data-feature') === featureId);
                });

                // --- Hide All Sections ---
                contentSections.forEach(section => section.classList.remove('active'));
                 // Also hide the dynamic container explicitly
                featureSectionsContainer.style.display = 'none';
                featureSectionsContainer.classList.remove('active');


                // --- Show Target Section / Load Dynamic Content ---
                let targetSectionElement;
                const staticSections = ['dashboard', 'profile', 'settings'];

                if (staticSections.includes(featureId)) {
                    targetSectionElement = document.getElementById(`${featureId}Content`);
                    if (targetSectionElement) {
                        targetSectionElement.classList.add('active');
                        // If settings, activate the correct tab
                        if (featureId === 'settings') {
                             activateSettingsTab(currentSettingsTab);
                             // Ensure settings content is loaded if not already present
                             loadSettingsPanelsContent();
                        }
                         // If profile, update form data
                        if (featureId === 'profile') {
                            updateProfileForm();
                        }
                    } else {
                        console.error(`Static section container #${featureId}Content not found!`);
                    }
                    // Hide the dynamic container
                    featureSectionsContainer.style.display = 'none';
                } else {
                    // It's a dynamic feature, target the dynamic container
                    targetSectionElement = featureSectionsContainer;
                    targetSectionElement.style.display = 'block';
                    targetSectionElement.classList.add('active');
                    loadSection(featureId); // Load dynamic content
                }

                // --- Update Back Button ---
                const backButton = document.getElementById('backButton');
                if (backButton) {
                    backButton.style.display = featureId !== 'dashboard' ? 'flex' : 'none';
                    // Optional: Update back button text based on previous feature? Harder to track state.
                }

                 // --- Update Browser History ---
                 if (!skipHistory) {
                     updateBrowserHistory(featureId, featureId === 'settings' ? currentSettingsTab : null);
                 }

                // Close sidebar on mobile
                if (window.innerWidth <= 992 && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    mainContent.classList.remove('sidebar-active');
                    if(closeSidebar) closeSidebar.style.display = 'none';
                }
                // Close user dropdown if open
                if (userDropdown && userDropdown.classList.contains('active')) {
                    userDropdown.classList.remove('active');
                }
             }

            /**
             * Loads HTML and JS for a dynamic feature section.
             * @param {string} featureId - The feature ID (e.g., 'employee-scheduling').
             */
            function loadSection(featureId) {
                 const htmlPath = `${featureId}.html`; // Assumes file is in the same directory
                 const jsPath = `${featureId}.js`; // Assumes file is in the same directory
                 const initializerFunctionName = `initialize${capitalizeFirstLetter(toCamelCase(featureId))}`;

                 console.log(`Loading Section: ${featureId}`);
                 featureSectionsContainer.innerHTML = ''; // Clear previous content
                 featureSectionsContainer.appendChild(featurePlaceholder); // Show placeholder
                 featurePlaceholder.style.display = 'flex';
                 featureLoadingEl.style.display = 'block';
                 featureErrorEl.style.display = 'none';
                 featureTitleEl.textContent = `Loading ${featureId.replace(/-/g, ' ')}...`;
                 featureDescEl.textContent = '';
                 // Remove previously loaded dynamic script for this container if exists
                 const oldScript = document.getElementById(`dynamic-script-${featureId}`);
                 if (oldScript) {
                    oldScript.remove();
                    console.log(`Removed old script for ${featureId}`);
                 }

                 fetch(htmlPath)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status} loading ${htmlPath}`);
                        }
                        return response.text();
                    })
                    .then(html => {
                        featureSectionsContainer.innerHTML = html; // Load the HTML content
                        featureLoadingEl.style.display = 'none'; // Hide loading indicator
                        featurePlaceholder.style.display = 'none'; // Hide placeholder wrapper

                        // Now try to load the corresponding JS
                        const script = document.createElement('script');
                        script.id = `dynamic-script-${featureId}`; // Give it an ID for potential removal
                        script.src = jsPath;
                        script.async = false; // Load synchronously for simpler initialization order

                        script.onload = () => {
                            console.log(`${jsPath} loaded.`);
                            if (typeof window[initializerFunctionName] === 'function') {
                                try {
                                    console.log(`Calling ${initializerFunctionName}...`);
                                     window[initializerFunctionName](currentUser, teamMembers); // Pass necessary data
                                } catch (initError) {
                                    console.error(`Error executing ${initializerFunctionName}:`, initError);
                                    showErrorInPlaceholder(`Initialization failed for ${featureId}: ${initError.message}`);
                                }
                            } else {
                                console.warn(`Initializer function '${initializerFunctionName}' not found for ${featureId}.`);
                                // Content is loaded, but JS logic might be missing
                            }
                            // Remove script after loading and execution? Optional. Sometimes needed for cleanup.
                            // setTimeout(() => script.remove(), 100);
                        };
                        script.onerror = () => {
                            console.error(`Failed to load script: ${jsPath}`);
                            showErrorInPlaceholder(`Could not load script for ${featureId}.`);
                        };
                        document.body.appendChild(script);
                    })
                    .catch(error => {
                        console.error(`Error loading section ${featureId}:`, error);
                        showErrorInPlaceholder(`Failed to load content for ${featureId}. ${error.message}`);
                    });
            }

            function showErrorInPlaceholder(message) {
                 featureSectionsContainer.innerHTML = ''; // Clear any partial content
                 featureSectionsContainer.appendChild(featurePlaceholder); // Add placeholder back
                 featurePlaceholder.style.display = 'flex';
                 featureLoadingEl.style.display = 'none';
                 featureErrorEl.textContent = message;
                 featureErrorEl.style.display = 'block';
                 featureTitleEl.textContent = 'Loading Error';
                 featureDescEl.textContent = '';
            }

            // Utility to convert kebab-case/snake_case to PascalCase for function names
            function capitalizeFirstLetter(string) { return string.charAt(0).toUpperCase() + string.slice(1); }
            function toCamelCase(str) { return str.toLowerCase().replace(/([-_][a-z])/g, group => group.toUpperCase().replace('-', '').replace('_', '')); }

            function updateBrowserHistory(featureId, settingsTab) {
                 let hash = `#${featureId}`;
                 if (featureId === 'settings' && settingsTab) {
                     hash += `-${settingsTab}`;
                 }
                 if (window.location.hash !== hash) {
                    // Use replaceState to avoid polluting history too much during development/testing
                    // Use pushState for production if back/forward between features is desired
                     window.history.replaceState({ feature: featureId, tab: settingsTab }, '', hash);
                     // window.history.pushState({ feature: featureId, tab: settingsTab }, '', hash);
                 }
            }

            function handleInitialNavigation() {
                const hash = window.location.hash.substring(1);
                let featureId = 'dashboard';
                let settingsTab = null;
                if (hash) {
                    if (hash.startsWith('settings-')) {
                        featureId = 'settings';
                        settingsTab = hash.split('-')[1] || 'preferences';
                    } else if (document.querySelector(`.menu-item[data-feature="${hash}"]`)) {
                        featureId = hash; // Check if hash corresponds to a menu item
                    }
                }
                setActiveFeature(featureId, settingsTab, true); // Skip history on initial load
            }

            window.addEventListener('popstate', function(event) {
                handleInitialNavigation(); // Re-evaluate hash on back/forward
            });


            // --- Settings Tab Activation ---
            function activateSettingsTab(tabId) {
                // (Logic to show/hide settings panels and update tab styles)
                 console.log("Activating settings tab:", tabId);
                 currentSettingsTab = tabId; // Update state

                 document.querySelectorAll('.settings-tab').forEach(tab => {
                     tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                 });
                 document.querySelectorAll('.settings-panel').forEach(panel => {
                     panel.classList.toggle('active', panel.id === `${tabId}Panel`);
                 });

                 // Load team list if activating team tab (and user has permission)
                 if (tabId === 'team' && ['admin', 'supervisor'].includes(currentUser.role)) {
                    loadTeamMembers();
                 }
                  // Update 2FA UI if activating security tab
                 if (tabId === 'security') {
                     update2FA_UI();
                 }
                  // Update account email display if activating account tab
                 if (tabId === 'account') {
                     const accountEmailDisplay = document.getElementById('accountEmail');
                     if (accountEmailDisplay) accountEmailDisplay.value = currentUser.email;
                 }
            }

            /**
             * Loads the HTML content for settings panels if they are empty.
             * This prevents needing all settings HTML upfront.
             * NOTE: This adds complexity. For this example, we assume the panels
             * exist in the main HTML but are hidden.
             */
            function loadSettingsPanelsContent() {
                // Placeholder: In a real app, you might fetch HTML for each panel
                // only when its tab is clicked for the first time.
                // For now, we assume the panels are already in the DOM.
                console.log("Ensuring settings panels content is present (Assumed for now)");

                // Example: Load team members list when settings tab is clicked
                // (This is already handled in activateSettingsTab)
                 if (currentSettingsTab === 'team') {
                     loadTeamMembers();
                 }
                 if (currentSettingsTab === 'security') {
                     update2FA_UI();
                 }
            }


            // --- Dynamic Data Simulation ---
            function startDynamicUpdates() {
                // (Start intervals for stats, activity, notifications)
                // Example:
                // setInterval(loadDashboardStats, 30000);
                // setInterval(simulateNewActivity, 15000);
            }

            // --- Helper Functions ---
            function showToast(message, type = 'info') {
                if (!showToasts && type !== 'error') return;
                toastMessage.textContent = message;
                toastMessage.className = `toast ${type} show`; // Add type as class
                setTimeout(() => {
                    toastMessage.classList.remove('show');
                }, 3000);
            }
             function showSuccessMessage(message) { // Keep original success message if needed
                 if (!showToasts) return; // Respect toast preference
                 successMessageText.textContent = message;
                 successMessage.classList.add('show');
                 setTimeout(() => {
                     successMessage.classList.remove('show');
                 }, 3000);
             }
            function showConfirmModal(title, message, onConfirm, buttonClass = 'btn-danger') {
                confirmTitle.textContent = title;
                confirmMessage.innerHTML = message;
                confirmCallback = onConfirm;
                confirmBtn.className = `btn ${buttonClass}`;
                confirmModal.classList.add('active');
            }
            function hideConfirmModal() {
                confirmModal.classList.remove('active');
                confirmCallback = null;
            }

            // Add other helper functions (timeAgo, formatRole, etc.) here...


             // --- Event Listeners ---
             function setupEventListeners() {
                 // Sidebar Toggle
                 sidebarToggle?.addEventListener('click', () => {
                     sidebar.classList.add('active');
                     mainContent.classList.add('sidebar-active');
                     closeSidebar?.style.display = 'block';
                 });
                 closeSidebar?.addEventListener('click', () => {
                     sidebar.classList.remove('active');
                     mainContent.classList.remove('sidebar-active');
                     closeSidebar.style.display = 'none';
                 });
                 document.addEventListener('click', (event) => {
                     if (window.innerWidth <= 992 && sidebar.classList.contains('active')) {
                         if (!sidebar.contains(event.target) && !sidebarToggle?.contains(event.target)) {
                             sidebar.classList.remove('active');
                             mainContent.classList.remove('sidebar-active');
                             closeSidebar?.style.display = 'none';
                         }
                     }
                 });

                 // Menu & Dropdown Item Navigation (using delegation)
                 document.body.addEventListener('click', (e) => {
                     const menuItem = e.target.closest('.menu-item');
                     const dropdownItem = e.target.closest('.dropdown-item');

                     if (menuItem && menuItem.dataset.feature) {
                         e.preventDefault();
                         setActiveFeature(menuItem.dataset.feature);
                         // Close sidebar on mobile if an item is clicked
                         if (window.innerWidth <= 992 && sidebar.classList.contains('active')) {
                             sidebar.classList.remove('active');
                             mainContent.classList.remove('sidebar-active');
                             if (closeSidebar) closeSidebar.style.display = 'none';
                         }
                     } else if (dropdownItem && dropdownItem.dataset.feature) {
                         e.preventDefault();
                         setActiveFeature(dropdownItem.dataset.feature);
                         userDropdown.classList.remove('active'); // Close dropdown
                     }
                 });

                 // Back Button
                 backButton?.addEventListener('click', () => setActiveFeature('dashboard'));

                 // User Dropdown Toggle
                 userProfileContainer?.addEventListener('click', (e) => {
                     // Prevent clicks within the dropdown from closing it immediately
                     if (e.target.closest('.dropdown-item')) {
                         // Handled by the body listener above
                         return;
                     }
                     e.stopPropagation(); // Prevent body click listener from closing it
                     userDropdown.classList.toggle('active');
                 });
                 document.addEventListener('click', () => userDropdown.classList.remove('active')); // Close on outside click

                  // Logout Link
                 logoutLink?.addEventListener('click', handleLogout);

                  // Confirm Modal Buttons
                 cancelConfirmBtn?.addEventListener('click', hideConfirmModal);
                 confirmBtn?.addEventListener('click', () => {
                     if (confirmCallback) confirmCallback();
                     hideConfirmModal(); // Hide after action
                 });
                 confirmModal?.addEventListener('click', (e) => { // Close on backdrop click
                     if (e.target === confirmModal) hideConfirmModal();
                 });

                 // Settings Tabs (using delegation on the container)
                 const settingsTabsContainer = document.querySelector('.settings-tabs');
                 settingsTabsContainer?.addEventListener('click', (e) => {
                    const tab = e.target.closest('.settings-tab');
                    if (tab && !tab.classList.contains('active') && !tab.classList.contains('disabled')) {
                        const tabId = tab.dataset.tab;
                        activateSettingsTab(tabId);
                        updateBrowserHistory('settings', tabId); // Update history when tab changes
                    }
                 });

                 // Add other specific event listeners (profile save, settings save, etc.)
                 // These might need to be added *after* their respective panels are loaded if using dynamic panel loading
                 // Since panels are static here, we can add them now (ensure elements exist)
                 const profileForm = document.getElementById('profileForm');
                 const saveProfileBtn = document.getElementById('saveProfileBtn');
                 const cancelProfileBtn = document.getElementById('cancelProfileBtn');
                 profileForm?.addEventListener('submit', handleProfileSave); // Placeholder
                 cancelProfileBtn?.addEventListener('click', handleProfileCancel); // Placeholder

                 // Placeholder: Add listeners for settings save buttons, 2FA, etc.
                 // e.g., document.getElementById('savePreferencesBtn')?.addEventListener('click', handleSavePreferences);
            }

             // Placeholder Handlers for Save/Cancel Actions
             function handleProfileSave(e) { e.preventDefault(); showToast('Profile save action triggered (implement logic).'); }
             function handleProfileCancel() { showToast('Profile changes cancelled (implement logic).'); setActiveFeature('dashboard'); }
             function handleLogout(e) { e.preventDefault(); showConfirmModal('Confirm Logout', 'Are you sure?', () => { showToast('Logging out...', 'info'); /* Redirect */ }); }
             // Add other handlers...

            // --- Load Team Members (Example - Call when needed) ---
            function loadTeamMembers() {
                 const teamListContainer = document.getElementById('teamList');
                 if (!teamListContainer) { console.warn("Team list container not found."); return; }
                 console.log("Loading team members...");
                 teamListContainer.innerHTML = '<p>Loading...</p>';
                 setTimeout(() => { // Simulate fetch
                     teamListContainer.innerHTML = ''; // Clear loading
                     teamMembers.forEach(member => {
                         // Create and append member card HTML...
                     });
                 }, SIMULATED_DELAY);
             }
             // --- Load Activity / Notifications / Stats (Placeholders) ---
             function loadDashboardStats() { console.log("Simulating stat update"); /* Update stat cards */ }
             function loadRecentActivities() { console.log("Simulating activity update"); /* Update activity list */ }
             function loadNotifications() { console.log("Simulating notification update"); /* Update notifications modal */ }
             // --- Update 2FA UI ---
            function update2FA_UI() { console.log("Updating 2FA UI (needs implementation)");}


            // --- Start the Dashboard ---
            initDashboard();

        }); // End DOMContentLoaded
    </script>

</body>
</html>

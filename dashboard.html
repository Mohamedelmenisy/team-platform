import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, Routes, Route, Link, useNavigate, useLocation } from 'react-router-dom';
import { FaBell, FaUserCircle, FaTasks, FaUsers, FaFileUpload, FaDatabase, FaProjectDiagram, FaCalendarAlt, FaClock, FaLightbulb, FaCog, FaSignOutAlt, FaChevronDown, FaChevronUp, FaCheck, FaTrash, FaArrowUp, FaArrowDown } from 'react-icons/fa';

// Mock data
const users = [
  { id: 1, name: 'John Doe', email: 'john@example.com', role: 'Admin', position: 'Project Manager', department: 'Management', phone: '123-456-7890', avatar: 'https://randomuser.me/api/portraits/men/1.jpg' },
  { id: 2, name: 'Jane Smith', email: 'jane@example.com', role: 'Senior', position: 'Senior Developer', department: 'Development', phone: '123-456-7891', avatar: 'https://randomuser.me/api/portraits/women/1.jpg' },
  { id: 3, name: 'Mike Johnson', email: 'mike@example.com', role: 'Member', position: 'Junior Developer', department: 'Development', phone: '123-456-7892', avatar: 'https://randomuser.me/api/portraits/men/2.jpg' }
];

const tasks = [
  { id: 1, title: 'Design Dashboard', assignee: 'John Doe', status: 'In Progress', deadline: '2023-06-15', project: 'Team Management System' },
  { id: 2, title: 'Implement Authentication', assignee: 'Jane Smith', status: 'Completed', deadline: '2023-06-10', project: 'Team Management System' },
  { id: 3, title: 'Write Documentation', assignee: 'Mike Johnson', status: 'Pending', deadline: '2023-06-20', project: 'Team Management System' }
];

const projects = [
  { id: 1, name: 'Team Management System', progress: 65, deadline: '2023-07-01', manager: 'John Doe' },
  { id: 2, name: 'Client Website Redesign', progress: 30, deadline: '2023-08-15', manager: 'Jane Smith' }
];

const activities = [
  { id: 1, user: 'John Doe', action: 'created a new task', target: 'Design Dashboard', time: '2 minutes ago' },
  { id: 2, user: 'Jane Smith', action: 'completed task', target: 'Implement Authentication', time: '1 hour ago' },
  { id: 3, user: 'Mike Johnson', action: 'uploaded a file', target: 'Documentation Draft', time: '3 hours ago' }
];

const notifications = [
  { id: 1, message: 'New task assigned to you: Design Dashboard', time: '10 min ago', read: false },
  { id: 2, message: 'Jane Smith completed Implement Authentication', time: '1 hour ago', read: false },
  { id: 3, message: 'System update scheduled for tonight', time: '2 hours ago', read: true }
];

// Main App Component
function App() {
  const [currentUser, setCurrentUser] = useState(users[0]);
  const [showProfileDropdown, setShowProfileDropdown] = useState(false);
  const [showNotifications, setShowNotifications] = useState(false);
  const [unreadNotifications, setUnreadNotifications] = useState(notifications.filter(n => !n.read).length);
  const [toast, setToast] = useState(null);

  const markAsRead = (id) => {
    const updatedNotifications = notifications.map(n => 
      n.id === id ? {...n, read: true} : n
    );
    setUnreadNotifications(updatedNotifications.filter(n => !n.read).length);
  };

  const markAllAsRead = () => {
    const updatedNotifications = notifications.map(n => ({...n, read: true}));
    setUnreadNotifications(0);
  };

  const deleteNotification = (id) => {
    // Implementation for deleting a single notification
    setToast({ message: 'Notification deleted', type: 'success' });
  };

  const deleteAllNotifications = () => {
    // Implementation for deleting all notifications
    setToast({ message: 'All notifications deleted', type: 'success' });
    setShowNotifications(false);
  };

  const showToast = (message, type) => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3000);
  };

  const handleLogout = () => {
    // Implementation for logout
    showToast('Logged out successfully', 'info');
  };

  return (
    <Router>
      <div className="app">
        {/* Sidebar */}
        <div className="sidebar">
          <div className="sidebar-header">
            <h2>TeamSync</h2>
            <div className="connection-status">
              <span className="connected-dot"></span>
              <span>Connected</span>
            </div>
          </div>
          
          <nav className="sidebar-nav">
            <NavLink to="/" icon={<FaUserCircle />} label="Dashboard" exact />
            <NavLink to="/tasks" icon={<FaTasks />} label="Task Management" />
            <NavLink to="/scheduling" icon={<FaUsers />} label="Employee Scheduling" />
            <NavLink to="/files" icon={<FaFileUpload />} label="File Sharing" />
            <NavLink to="/data" icon={<FaDatabase />} label="Data Management" />
            <NavLink to="/projects" icon={<FaProjectDiagram />} label="Project Tracking" />
            <NavLink to="/calendar" icon={<FaCalendarAlt />} label="Team Calendar" />
            <NavLink to="/deadlines" icon={<FaClock />} label="Deadline Tracking" />
            <NavLink to="/innovation" icon={<FaLightbulb />} label="Innovation Hub" />
            <NavLink to="/settings" icon={<FaCog />} label="Settings" />
          </nav>
        </div>

        {/* Main Content */}
        <div className="main-content">
          {/* Topbar */}
          <header className="topbar">
            <div className="user-profile" onClick={() => setShowProfileDropdown(!showProfileDropdown)}>
              <img src={currentUser.avatar} alt={currentUser.name} className="avatar" />
              <span>{currentUser.name}</span>
              {showProfileDropdown ? <FaChevronUp /> : <FaChevronDown />}
              
              {showProfileDropdown && (
                <div className="profile-dropdown">
                  <Link to="/profile" className="dropdown-item">
                    <FaUserCircle /> Profile
                  </Link>
                  <button className="dropdown-item" onClick={handleLogout}>
                    <FaSignOutAlt /> Logout
                  </button>
                </div>
              )}
            </div>
            
            <div className="notifications">
              <button className="notification-btn" onClick={() => setShowNotifications(!showNotifications)}>
                <FaBell />
                {unreadNotifications > 0 && <span className="notification-badge">{unreadNotifications}</span>}
              </button>
              
              {showNotifications && (
                <div className="notifications-dropdown">
                  <div className="notifications-header">
                    <h4>Notifications</h4>
                    <div className="notification-actions">
                      <button onClick={markAllAsRead}>Mark all as read</button>
                      <button onClick={deleteAllNotifications}>Delete all</button>
                    </div>
                  </div>
                  
                  <div className="notifications-list">
                    {notifications.map(notification => (
                      <div key={notification.id} className={`notification-item ${notification.read ? 'read' : 'unread'}`}>
                        <p>{notification.message}</p>
                        <div className="notification-meta">
                          <span>{notification.time}</span>
                          <div className="notification-buttons">
                            {!notification.read && (
                              <button onClick={() => markAsRead(notification.id)}>
                                <FaCheck />
                              </button>
                            )}
                            <button onClick={() => deleteNotification(notification.id)}>
                              <FaTrash />
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </header>

          {/* Content Area */}
          <div className="content-area">
            {toast && (
              <div className={`toast ${toast.type}`}>
                {toast.message}
              </div>
            )}
            
            <Routes>
              <Route path="/" element={<Dashboard currentUser={currentUser} showToast={showToast} />} />
              <Route path="/profile" element={<Profile currentUser={currentUser} setCurrentUser={setCurrentUser} showToast={showToast} />} />
              <Route path="/tasks" element={<TaskManagement />} />
              <Route path="/scheduling" element={<EmployeeScheduling />} />
              <Route path="/files" element={<FileSharing />} />
              <Route path="/data" element={<DataManagement />} />
              <Route path="/projects" element={<ProjectTracking />} />
              <Route path="/calendar" element={<TeamCalendar />} />
              <Route path="/deadlines" element={<DeadlineTracking />} />
              <Route path="/innovation" element={<InnovationHub />} />
              <Route path="/settings" element={<Settings />} />
            </Routes>
          </div>
        </div>
      </div>
    </Router>
  );
}

// NavLink Component
function NavLink({ to, icon, label, exact }) {
  const location = useLocation();
  const isActive = exact ? location.pathname === to : location.pathname.startsWith(to);
  
  return (
    <Link to={to} className={`nav-link ${isActive ? 'active' : ''}`}>
      <span className="nav-icon">{icon}</span>
      <span className="nav-label">{label}</span>
    </Link>
  );
}

// Dashboard Component
function Dashboard({ currentUser, showToast }) {
  const [time, setTime] = useState(new Date().toLocaleTimeString());
  
  useEffect(() => {
    const timer = setInterval(() => {
      setTime(new Date().toLocaleTimeString());
    }, 1000);
    
    return () => clearInterval(timer);
  }, []);
  
  return (
    <div className="dashboard">
      <div className="welcome-section">
        <h1>Welcome back, {currentUser.name}!</h1>
        <p>{currentUser.email} • {currentUser.role}</p>
        <div className="current-time">{time}</div>
      </div>
      
      <div className="stats-grid">
        <StatCard title="Team Members" value={users.length} trend="up" change="2" />
        <StatCard title="Active Tasks" value={tasks.length} trend="down" change="1" />
        <StatCard title="Ongoing Projects" value={projects.length} trend="up" change="1" />
        <StatCard title="Upcoming Deadlines" value={tasks.filter(t => t.status !== 'Completed').length} trend="neutral" />
      </div>
      
      <div className="dashboard-row">
        <div className="recent-activities">
          <h3>Recent Activities</h3>
          <div className="activities-list">
            {activities.map(activity => (
              <div key={activity.id} className="activity-item">
                <div className="activity-avatar">
                  <img src={users.find(u => u.name === activity.user)?.avatar || 'https://randomuser.me/api/portraits/men/0.jpg'} alt={activity.user} />
                </div>
                <div className="activity-details">
                  <p><strong>{activity.user}</strong> {activity.action} <strong>{activity.target}</strong></p>
                  <span className="activity-time">{activity.time}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        <div className="upcoming-tasks">
          <h3>Upcoming Deadlines</h3>
          <div className="tasks-list">
            {tasks
              .filter(task => task.status !== 'Completed')
              .sort((a, b) => new Date(a.deadline) - new Date(b.deadline))
              .slice(0, 3)
              .map(task => (
                <div key={task.id} className="task-item">
                  <h4>{task.title}</h4>
                  <p>Project: {task.project}</p>
                  <p>Assignee: {task.assignee}</p>
                  <div className="task-meta">
                    <span className={`task-status ${task.status.toLowerCase().replace(' ', '-')}`}>{task.status}</span>
                    <span className="task-deadline">Due: {new Date(task.deadline).toLocaleDateString()}</span>
                  </div>
                </div>
              ))}
          </div>
        </div>
      </div>
    </div>
  );
}

// StatCard Component
function StatCard({ title, value, trend, change }) {
  return (
    <div className="stat-card">
      <h4>{title}</h4>
      <div className="stat-value">{value}</div>
      <div className={`stat-trend ${trend}`}>
        {trend === 'up' && <FaArrowUp />}
        {trend === 'down' && <FaArrowDown />}
        {trend === 'neutral' && '—'}
        {trend !== 'neutral' && `${change}%`}
      </div>
    </div>
  );
}

// Profile Component
function Profile({ currentUser, setCurrentUser, showToast }) {
  const [formData, setFormData] = useState(currentUser);
  const [avatarPreview, setAvatarPreview] = useState(currentUser.avatar);
  
  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };
  
  const handleAvatarChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setAvatarPreview(reader.result);
      };
      reader.readAsDataURL(file);
    }
  };
  
  const handleSubmit = (e) => {
    e.preventDefault();
    const updatedUser = { ...formData, avatar: avatarPreview };
    setCurrentUser(updatedUser);
    showToast('Profile updated successfully', 'success');
    
    // In a real app, you would save to backend here
    localStorage.setItem('currentUser', JSON.stringify(updatedUser));
  };
  
  return (
    <div className="profile">
      <h2>Profile Settings</h2>
      
      <form onSubmit={handleSubmit}>
        <div className="profile-header">
          <div className="avatar-upload">
            <img src={avatarPreview} alt="Profile" className="profile-avatar" />
            <label htmlFor="avatar-upload" className="avatar-upload-label">
              Change Avatar
              <input 
                id="avatar-upload" 
                type="file" 
                accept="image/*" 
                onChange={handleAvatarChange}
                style={{ display: 'none' }}
              />
            </label>
          </div>
          
          <div className="profile-info">
            <div className="form-group">
              <label>Full Name</label>
              <input 
                type="text" 
                name="name" 
                value={formData.name} 
                onChange={handleChange} 
                required 
              />
            </div>
            
            <div className="form-group">
              <label>Email</label>
              <input 
                type="email" 
                name="email" 
                value={formData.email} 
                onChange={handleChange} 
                required 
                disabled 
              />
            </div>
          </div>
        </div>
        
        <div className="form-row">
          <div className="form-group">
            <label>Position</label>
            <input 
              type="text" 
              name="position" 
              value={formData.position} 
              onChange={handleChange} 
              required 
            />
          </div>
          
          <div className="form-group">
            <label>Department</label>
            <input 
              type="text" 
              name="department" 
              value={formData.department} 
              onChange={handleChange} 
              required 
            />
          </div>
        </div>
        
        <div className="form-group">
          <label>Phone Number</label>
          <input 
            type="tel" 
            name="phone" 
            value={formData.phone} 
            onChange={handleChange} 
            required 
          />
        </div>
        
        <div className="form-actions">
          <button type="submit" className="btn-primary">Save Changes</button>
          <button type="button" className="btn-secondary">Cancel</button>
        </div>
      </form>
    </div>
  );
}

// Other Page Components (simplified for brevity)
function TaskManagement() {
  return <div className="page-content"><h2>Task Management</h2></div>;
}

function EmployeeScheduling() {
  return (
    <div className="page-content">
      <h2>Employee Scheduling</h2>
      <div className="employee-table">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Position</th>
              <th>Department</th>
              <th>Monday</th>
              <th>Tuesday</th>
              <th>Wednesday</th>
              <th>Thursday</th>
              <th>Friday</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {users.map(user => (
              <tr key={user.id}>
                <td>{user.name}</td>
                <td>{user.position}</td>
                <td>{user.department}</td>
                <td>9:00 AM - 5:00 PM</td>
                <td>9:00 AM - 5:00 PM</td>
                <td>9:00 AM - 5:00 PM</td>
                <td>9:00 AM - 5:00 PM</td>
                <td>9:00 AM - 3:00 PM</td>
                <td>
                  <button className="btn-edit">Edit</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

function FileSharing() {
  return <div className="page-content"><h2>File Sharing</h2></div>;
}

function DataManagement() {
  return <div className="page-content"><h2>Data Management</h2></div>;
}

function ProjectTracking() {
  return <div className="page-content"><h2>Project Tracking</h2></div>;
}

function TeamCalendar() {
  return <div className="page-content"><h2>Team Calendar</h2></div>;
}

function DeadlineTracking() {
  return <div className="page-content"><h2>Deadline Tracking</h2></div>;
}

function InnovationHub() {
  return <div className="page-content"><h2>Innovation Hub</h2></div>;
}

function Settings() {
  return (
    <div className="page-content">
      <h2>Settings</h2>
      <div className="settings-tabs">
        <div className="settings-section">
          <h3>Appearance</h3>
          <div className="appearance-options">
            <label>
              <input type="radio" name="theme" defaultChecked /> Light Mode
            </label>
            <label>
              <input type="radio" name="theme" /> Dark Mode
            </label>
            <label>
              <input type="radio" name="theme" /> System Default
            </label>
          </div>
        </div>
        
        <div className="settings-section">
          <h3>Change Password</h3>
          <form>
            <div className="form-group">
              <label>Current Password</label>
              <input type="password" required />
            </div>
            <div className="form-group">
              <label>New Password</label>
              <input type="password" required />
            </div>
            <div className="form-group">
              <label>Confirm New Password</label>
              <input type="password" required />
            </div>
            <button type="submit" className="btn-primary">Update Password</button>
          </form>
        </div>
        
        <div className="settings-section">
          <h3>Language</h3>
          <select className="language-selector">
            <option value="en">English</option>
            <option value="ar">Arabic</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
          </select>
        </div>
        
        <div className="settings-section">
          <h3>Notifications</h3>
          <div className="notification-options">
            <label>
              <input type="checkbox" defaultChecked /> Email Notifications
            </label>
            <label>
              <input type="checkbox" defaultChecked /> In-App Notifications
            </label>
            <label>
              <input type="checkbox" /> Push Notifications
            </label>
          </div>
        </div>
        
        <div className="settings-section">
          <h3>Team Management</h3>
          <div className="add-member-form">
            <h4>Add New Member</h4>
            <form>
              <div className="form-group">
                <label>Full Name</label>
                <input type="text" required />
              </div>
              <div className="form-group">
                <label>Email</label>
                <input type="email" required />
              </div>
              <div className="form-group">
                <label>Position</label>
                <input type="text" required />
              </div>
              <div className="form-group">
                <label>Role</label>
                <select required>
                  <option value="member">Member</option>
                  <option value="admin">Admin</option>
                  <option value="supervisor">Supervisor</option>
                  <option value="senior">Senior</option>
                </select>
              </div>
              <button type="submit" className="btn-primary">Add Member</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  );
}

export default App;

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamFlow | Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" sizes="32x32" href="https://img.icons8.com/fluency/48/000000/group-task.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://img.icons8.com/fluency/32/000000/group-task.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/000000/group-task.png">
    <style>
        :root {
            --primary: #2563eb; --primary-dark: #1e3a8a; --primary-light: #dbeafe; --secondary: #10b981;
            --danger: #ef4444; --warning: #f59e0b; --dark: #1e293b; --light: #f8fafc; --gray: #64748b;
            --light-gray: #e2e8f0; --white: #ffffff; --sidebar-width: 280px; --sidebar-bg: #1e3a8a;
            --sidebar-text: rgba(255,255,255,0.9); --sidebar-hover: rgba(255,255,255,0.1); --sidebar-active: rgba(255,255,255,0.2);
            --sidebar-divider: rgba(255,255,255,0.1); --success: #10b981; --team-manager: #ef4444;
            --compact-padding: 0.5rem; --normal-padding: 1rem; --spacious-padding: 1.5rem; --primary-rgb: 37, 99, 235;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--primary-light); color: var(--dark); display: flex; min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; }
        .sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); height: 100vh; position: fixed; overflow-y: auto; transition: all 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--sidebar-divider); display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--white); display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { color: var(--white); font-size: 1.5rem; }
        .sidebar-menu { padding: 1rem 0; flex-grow: 1; overflow-y: auto; }
        .menu-title { padding: 0.75rem 1.5rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.6); letter-spacing: 0.5px; }
        .menu-item { display: flex; align-items: center; padding: 0.75rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; margin: 0.25rem 0; }
        .menu-item:hover { background-color: var(--sidebar-hover); color: var(--white); }
        .menu-item.active { background-color: var(--sidebar-active); color: var(--white); border-left-color: var(--white); }
        .menu-item i { margin-right: 0.75rem; font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-divider { height: 1px; background-color: var(--sidebar-divider); margin: 1rem 1.5rem; }
        .main-content { flex: 1; margin-left: var(--sidebar-width); transition: all 0.3s; }
        .top-nav { background-color: var(--white); padding: var(--normal-padding) 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--light-gray); position: sticky; top: 0; z-index: 90; transition: padding 0.3s ease, background-color 0.3s ease, border-color 0.3s ease; }
        body.compact .top-nav { padding: var(--compact-padding) 1rem; } body.spacious .top-nav { padding: var(--spacious-padding) 2rem; }
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.9rem; transition: all 0.2s; background-color: var(--white); color: var(--dark); }
        .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .search-results { position: absolute; top: 100%; left: 0; width: 100%; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 0 0 6px 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 100; display: none; max-height: 300px; overflow-y: auto; }
        .search-results.active { display: block; } .search-result-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s; color: var(--dark); } .search-result-item:hover { background-color: var(--primary-light); }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .notification-icon { position: relative; color: var(--gray); cursor: pointer; font-size: 1.1rem; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600; }
        .user-profile { display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; background-size: cover; background-position: center; }
        .user-profile-details { display: flex; align-items: center; cursor: pointer; } .user-name { font-weight: 500; color: var(--dark); }
        .user-status { font-size: 0.8rem; color: var(--success); margin-left: 0.5rem; font-weight: 600; text-shadow: 0 0 4px rgba(16, 185, 129, 0.4); }
        .user-dropdown { position: absolute; top: 100%; right: 0; background-color: var(--white); border: 1px solid var(--light-gray); border-radius: 6px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); width: 200px; z-index: 100; display: none; }
        .user-dropdown.active { display: block; } .dropdown-item { padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; color: var(--dark); text-decoration: none; transition: background-color 0.2s; } .dropdown-item:hover { background-color: var(--light); } .dropdown-item i { width: 20px; text-align: center; }
        .content-area { padding: 2rem; min-height: calc(100vh - 70px); transition: padding 0.3s ease; }
        body.compact .content-area { padding: 1rem; } body.spacious .content-area { padding: 3rem; }
        .welcome-section { background-color: var(--primary-dark); color: var(--white); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: padding 0.3s ease, margin-bottom 0.3s ease, background-color 0.3s ease; }
        body.compact .welcome-section { padding: 1rem; margin-bottom: 1rem; } body.spacious .welcome-section { padding: 3rem; margin-bottom: 3rem; }
        .welcome-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; } body.compact .welcome-title { font-size: 1.25rem; }
        .welcome-subtitle { font-size: 1rem; opacity: 0.9; margin-top: 0.25rem; margin-bottom: 1.5rem; font-weight: 400; } body.compact .welcome-subtitle { font-size: 0.9rem; margin-bottom: 1rem;}
        .user-info { display: flex; align-items: center; gap: 1.5rem; margin-top: 1.5rem; } body.compact .user-info { flex-direction: column; text-align: center; gap: 1rem; margin-top: 1rem; }
        .user-info-avatar { width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.75rem; background-size: cover; background-position: center; position: relative; cursor: default; } body.compact .user-info-avatar { width: 60px; height: 60px; font-size: 1.25rem; }
        .user-info-details { flex: 1; } .user-info-name { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; } body.compact .user-info-name { font-size: 1rem; }
        .user-info-title { opacity: 0.9; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--light-gray); font-weight: 600; } .user-info-title.role-admin { color: var(--team-manager); } body.compact .user-info-title { font-size: 0.8rem; }
        .user-info-email { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; opacity: 0.9; }
        .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; transition: gap 0.3s ease, margin-bottom 0.3s ease; }
        body.compact .stats-section { gap: 1rem; margin-bottom: 1rem; } body.spacious .stats-section { gap: 2rem; margin-bottom: 3rem; }
        .stat-card { background-color: var(--white); border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); transition: transform 0.2s, box-shadow 0.2s, padding 0.3s ease, background-color 0.3s ease; position: relative; overflow: hidden; }
        body.compact .stat-card { padding: 1rem; } body.spacious .stat-card { padding: 2rem; } .stat-card:hover { transform: translateY(-4px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(90deg, var(--primary), var(--secondary)); opacity: 0.9; }
        .stat-title { font-size: 0.9rem; color: var(--gray); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; } body.compact .stat-title { font-size: 0.8rem; } .stat-title i { color: var(--primary); }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; } body.compact .stat-value { font-size: 1.5rem; }
        .stat-trend { display: flex; align-items: center; font-size: 0.9rem; font-weight: 500; } body.compact .stat-trend { font-size: 0.8rem; } .trend-up { color: var(--secondary); } .trend-down { color: var(--danger); } .trend-neutral { color: var(--gray); }
        .activity-section { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: padding 0.3s ease, background-color 0.3s ease; }
        body.compact .activity-section { padding: 1rem; } body.spacious .activity-section { padding: 2rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; transition: margin-bottom 0.3s ease; flex-wrap: wrap; gap: 0.5rem; } body.compact .section-header { margin-bottom: 1rem; } body.spacious .section-header { margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: var(--dark); } body.compact .section-title { font-size: 1.1rem; }
        .live-badge { display: inline-flex; align-items: center; background-color: var(--danger); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem; animation: pulse 2s infinite; } @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .section-header > div { display: flex; align-items: center; gap: 1rem;} .view-all, .delete-all { font-weight: 500; cursor: pointer; transition: color 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; } .view-all { color: var(--primary); } .view-all:hover { color: var(--primary-dark); text-decoration: underline; background-color: var(--primary-light); } .delete-all { color: var(--danger); } .delete-all:hover { color: #dc2626; text-decoration: underline; background-color: rgba(239, 68, 68, 0.1); }
        .activity-list { list-style: none; } .activity-item { display: flex; padding: 1rem 0; border-bottom: 1px solid var(--light-gray); align-items: center; transition: background-color 0.3s, padding 0.3s ease, border-color 0.3s ease; } body.compact .activity-item { padding: 0.75rem 0; } body.spacious .activity-item { padding: 1.25rem 0; } .activity-item:last-child { border-bottom: none; }
        .activity-item.new-activity { background-color: rgba(var(--primary-rgb), 0.08); animation: highlightNewActivity 2.5s ease-out forwards; } @keyframes highlightNewActivity { 0% { background-color: rgba(var(--primary-rgb), 0.15); } 100% { background-color: transparent; } }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(var(--primary-rgb), 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0; transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; } body.compact .activity-icon { width: 32px; height: 32px; margin-right: 0.75rem; font-size: 0.9rem; }
        .activity-content { flex: 1; } .activity-message { margin-bottom: 0.25rem; color: var(--dark); } body.compact .activity-message { font-size: 0.9rem; }
        .activity-time { font-size: 0.8rem; color: var(--gray); } body.compact .activity-time { font-size: 0.7rem; }
        .activity-actions { display: flex; gap: 0.5rem; margin-left: auto; padding-left: 1rem; } .delete-activity { color: var(--danger); cursor: pointer; opacity: 1; transition: opacity 0.2s, background-color 0.2s; padding: 0.5rem; border-radius: 4px; } .delete-activity:hover { background-color: rgba(239, 68, 68, 0.1); }
        .content-section { display: none; background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 2rem; transition: padding 0.3s ease, background-color 0.3s ease; } .content-section.active { display: block; } body.compact .content-section { padding: 1rem; } body.spacious .content-section { padding: 3rem; }
        .section-main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; transition: margin-bottom 0.3s ease; } body.compact .section-main-header { margin-bottom: 1.5rem; } body.spacious .section-main-header { margin-bottom: 3rem; }
        .section-main-title { font-size: 1.5rem; font-weight: 600; color: var(--primary-dark); } body.compact .section-main-title { font-size: 1.25rem; }
        .profile-header-text { margin-bottom: 2rem; color: var(--gray); font-size: 0.95rem;} .profile-avatar-section { text-align: center; margin-bottom: 2rem; }
        #profileAvatarLarge { width: 120px; height: 120px; border-radius: 50%; background-color: var(--primary-light); color: var(--primary-dark); display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 3rem; background-size: cover; background-position: center; margin-bottom: 1rem; border: 3px solid var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); } #uploadPhotoButton { margin-top: 0.5rem;}
        .data-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; transition: gap 0.3s ease; } body.compact .data-form { gap: 1rem; } body.spacious .data-form { gap: 2rem; }
        .form-group { margin-bottom: 1rem; transition: margin-bottom 0.3s ease; } body.compact .form-group { margin-bottom: 0.75rem; } body.spacious .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--dark); transition: margin-bottom 0.3s ease, font-size 0.3s ease; } body.compact .form-group label { margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 1rem; background-color: var(--white); color: var(--dark); transition: border-color 0.2s, box-shadow 0.2s, padding 0.3s ease, font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        body.compact .form-control { padding: 0.5rem; font-size: 0.9rem; } body.spacious .form-control { padding: 1rem; } .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1); } .form-control[readonly] { background-color: var(--light-gray); cursor: not-allowed; }
        .form-actions { grid-column: span 2; display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; transition: margin-top 0.3s ease; } body.compact .form-actions { margin-top: 0.5rem; } body.spacious .form-actions { margin-top: 2rem; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; gap: 0.5rem; } body.compact .btn { padding: 0.5rem 1rem; font-size: 0.9rem; } body.spacious .btn { padding: 1rem 2rem; }
        .btn-primary { background-color: var(--primary); color: white; } .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); } .btn-outline { background-color: transparent; border: 1px solid var(--primary); color: var(--primary); } .btn-outline:hover:not(:disabled) { background-color: var(--primary-light); } .btn-danger { background-color: var(--danger); color: white; } .btn-danger:hover:not(:disabled) { background-color: #dc2626; } .btn-success { background-color: var(--success); color: white; } .btn-success:hover:not(:disabled) { background-color: #0d9f6e; } .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--light-gray); margin-bottom: 2rem; transition: margin-bottom 0.3s ease, border-color 0.3s ease; overflow-x: auto; } body.compact .settings-tabs { margin-bottom: 1.5rem; } body.spacious .settings-tabs { margin-bottom: 3rem; }
        .settings-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; color: var(--gray); transition: all 0.2s; white-space: nowrap; } body.compact .settings-tab { padding: 0.5rem 1rem; font-size: 0.9rem; } body.spacious .settings-tab { padding: 1rem 2rem; } .settings-tab:hover { color: var(--primary); } .settings-tab.active { color: var(--primary); border-bottom-color: var(--primary); } .settings-tab.disabled { color: var(--light-gray); cursor: not-allowed; pointer-events: none; }
        .settings-panel { display: none; } .settings-panel.active { display: block; animation: fadeInPanel 0.5s ease-out; } @keyframes fadeInPanel { from { opacity: 0; } to { opacity: 1; } }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; flex-shrink: 0; } body.compact .switch { width: 40px; height: 20px; } .switch input { opacity: 0; width: 0; height: 0; } .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; } .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; } body.compact .slider:before { height: 14px; width: 14px; left: 3px; bottom: 3px; } input:checked + .slider { background-color: var(--primary); } input:checked + .slider:before { transform: translateX(26px); } body.compact input:checked + .slider:before { transform: translateX(20px); } .slider.round { border-radius: 34px; } .slider.round:before { border-radius: 50%; }
        .team-management { margin-top: 1.5rem; } body.compact .team-management { margin-top: 1rem; } body.spacious .team-management { margin-top: 2rem; } .team-management h3, .add-member-form h4 { color: var(--dark); margin-bottom: 1rem; }
        .team-list { margin-top: 1rem; } body.compact .team-list { margin-top: 0.75rem; } body.spacious .team-list { margin-top: 1.5rem; }
        .team-member-card { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--light-gray); border-radius: 8px; margin-bottom: 1rem; transition: all 0.2s; background-color: var(--white); } body.compact .team-member-card { padding: 0.75rem; margin-bottom: 0.75rem; } body.spacious .team-member-card { padding: 1.25rem; margin-bottom: 1.25rem; } .team-member-card:hover { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); border-color: var(--primary); }
        .member-avatar { width: 50px; height: 50px; border-radius: 50%; background-color: var(--light-gray); margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 600; background-size: cover; background-position: center; color: var(--primary-dark); transition: width 0.3s, height 0.3s, margin-right 0.3s, font-size 0.3s; flex-shrink: 0; } body.compact .member-avatar { width: 40px; height: 40px; margin-right: 0.75rem; font-size: 0.9rem; }
        .member-details { flex: 1; min-width: 0; } .member-name { font-weight: 500; margin-bottom: 0.25rem; color: var(--dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} body.compact .member-name { font-size: 0.9rem; } .member-email { font-size: 0.9rem; color: var(--gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;} body.compact .member-email { font-size: 0.8rem; }
        .member-role { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; margin: 0 1rem; flex-shrink: 0; } body.compact .member-role { font-size: 0.7rem; margin: 0 0.75rem; } .role-admin { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); } .role-senior { background-color: rgba(var(--primary-rgb), 0.1); color: var(--primary); } .role-supervisor { background-color: rgba(245, 158, 11, 0.1); color: var(--warning); } .role-member { background-color: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        .member-actions { display: flex; gap: 0.5rem; flex-shrink: 0; } .member-actions .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        .add-member-form { margin-top: 2rem; padding: 1.5rem; border: 1px dashed var(--light-gray); border-radius: 8px; background-color: var(--light); } body.compact .add-member-form { margin-top: 1.5rem; padding: 1rem; } body.spacious .add-member-form { margin-top: 3rem; padding: 2rem; }
        body.light-theme { /* ... */ } body.dark-theme { /* ... */ } body.blue-theme { /* ... */ }
        .theme-option { /* ... */ } .theme-option div { /* ... */ } .theme-option span { /* ... */ } .theme-option:hover div { /* ... */ } .theme-option.selected div { /* ... */ }
        .notifications-modal { /* ... */ } .notifications-container { /* ... */ } @keyframes slideIn { /* ... */ } .notifications-header { /* ... */ } .notifications-title { /* ... */ } .close-notifications { /* ... */ } .notifications-body { /* ... */ } .notification-list-item { /* ... */ } .notification-list-item:hover { /* ... */ } .notification-list-item.unread { /* ... */ } .notification-list-item:last-child { /* ... */ } .notification-icon-wrapper { /* ... */ } .notification-content { /* ... */ } .notification-message { /* ... */ } .notification-time { /* ... */ } .delete-notification { /* ... */ } .delete-notification:hover { /* ... */ } .no-notifications-message { /* ... */ } .notifications-footer { /* ... */ }
        .confirm-modal { /* ... */ } .confirm-container { /* ... */ } @keyframes fadeInScale { /* ... */ } .confirm-title { /* ... */ } .confirm-message { /* ... */ } .confirm-actions { /* ... */ }
        .success-message { /* ... */ } .success-message.show { /* ... */ } .success-message i { /* ... */ }
        @media (max-width: 992px) { /* ... */ } @media (max-width: 768px) { /* ... */ } @media (max-width: 480px) { /* ... */ }
        .back-button { /* ... */ } .back-button:hover { /* ... */ } .back-button i { /* ... */ } .back-button:hover i { /* ... */ }
        #notificationSound { display: none; } .d-none { display: none !important; }
        .connection-status { /* ... */ } .status-dot { /* ... */ } @keyframes pulseStatus { /* ... */ }
        .password-error { /* ... */ } .spinner { /* ... */ } @keyframes spin { /* ... */ } .loading-text { /* ... */ } .btn-outline .spinner { /* ... */ }
        .placeholder-content { /* ... */ } .placeholder-content h2 { /* ... */ } .placeholder-content .loading-indicator { /* ... */ } .placeholder-content .error-message { /* ... */ }
    </style>
</head>
<body class="blue-theme">
    <audio id="notificationSound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3" type="audio/mpeg"></audio>
    <div class="success-message" id="successMessage"><i class="fas fa-check-circle"></i><span id="successMessageText">Action successful!</span></div>
    <aside class="sidebar" id="sidebar"> <div class="sidebar-header"><div class="logo"><i class="fas fa-users-cog logo-icon"></i><span>TeamFlow</span></div></div> <div class="sidebar-menu"><div class="menu-title">Navigation</div><a href="#dashboard" class="menu-item active" data-feature="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a><a href="#projects" class="menu-item" data-feature="projects"><i class="fas fa-briefcase"></i><span>Projects</span></a><a href="#reports-analytics" class="menu-item" data-feature="reports-analytics"><i class="fas fa-chart-line"></i><span>Reports & Analytics</span></a><a href="#team-members-view" class="menu-item" data-feature="team-members-view"><i class="fas fa-users"></i><span>Team Members</span></a><div class="menu-title">Core Features</div><a href="#file-sharing" class="menu-item" data-feature="file-sharing"><i class="fas fa-file-upload"></i><span>File Sharing</span></a><a href="#data-management" class="menu-item" data-feature="data-management"><i class="fas fa-database"></i><span>Data Management</span></a><a href="#project-tracking" class="menu-item" data-feature="project-tracking"><i class="fas fa-project-diagram"></i><span>Project Tracking</span></a><a href="#task-management" class="menu-item" data-feature="task-management"><i class="fas fa-tasks"></i><span>Task Management</span></a><div class="menu-title">Team Tools</div><a href="#employee-scheduling" class="menu-item" data-feature="employee-scheduling"><i class="fas fa-user-clock"></i><span>Employee Scheduling</span></a><a href="#team-calendar" class="menu-item" data-feature="team-calendar"><i class="fas fa-calendar-alt"></i><span>Team Calendar</span></a><a href="#deadline-tracking" class="menu-item" data-feature="deadline-tracking"><i class="fas fa-clock"></i><span>Deadline Tracking</span></a><a href="#innovation-hub" class="menu-item" data-feature="innovation-hub"><i class="fas fa-lightbulb"></i><span>Innovation Hub</span></a><div class="menu-divider"></div><a href="#settings" class="menu-item" data-feature="settings"><i class="fas fa-cog"></i><span>Settings</span></a></div> <div class="connection-status"><div class="status-dot"></div><span>Online</span></div> </aside>
    <main class="main-content">
        <nav class="top-nav"> <div class="search-bar"><i class="fas fa-search search-icon"></i><input type="text" placeholder="Search employees, projects, tasks..." id="searchInput" autocomplete="off"><div class="search-results" id="searchResults"></div></div> <div class="user-menu"><div class="notification-icon" id="notificationIcon"><i class="fas fa-bell"></i><span class="notification-badge" style="display: none;">0</span></div><div class="user-profile"><div class="user-avatar" id="userAvatar">ME</div><div class="user-profile-details"><span class="user-name" id="userName">Mohamed Elmenisy</span><span class="user-status"> • Connected</span></div><div class="user-dropdown" id="userDropdown"><a href="#profile" class="dropdown-item" id="profileLink"><i class="fas fa-user"></i><span>Profile</span></a><a href="#settings" class="dropdown-item" id="settingsLink"><i class="fas fa-cog"></i><span>Settings</span></a><a href="#" class="dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></div></div></div> </nav>
        <div class="content-area">
            <div class="back-button" id="backButton" style="display: none;"><i class="fas fa-arrow-left"></i><span>Back to Dashboard</span></div>
            <div id="dashboardContent" class="content-section active"> <div class="welcome-section"><h2 class="welcome-title">Welcome, <span id="welcomeName">Mohamed</span>!</h2><p class="welcome-subtitle">Here's what's happening with your team today.</p><div class="user-info"><div class="user-info-avatar" id="profileAvatar">ME</div><div class="user-info-details"><div class="user-info-name">Mohamed Elmenisy</div><div class="user-info-title" id="userInfoRoleTitle">Administrator</div><div class="user-info-email"><i class="fas fa-envelope"></i><span id="userEmail">m.elsayed@thechefz.co</span></div></div></div></div> <div class="stats-section"><div class="stat-card"><div class="stat-title"><i class="fas fa-users"></i>Team Members</div><div class="stat-value"><span id="teamMembersCount">0</span><span class="stat-trend trend-neutral" id="teamMembersTrend"><i class="fas fa-minus"></i> 0%</span></div></div><div class="stat-card"><div class="stat-title"><i class="fas fa-check-circle"></i>Tasks Completed</div><div class="stat-value"><span id="tasksCompleted">0</span><span class="stat-trend trend-neutral" id="tasksCompletedTrend"><i class="fas fa-minus"></i> 0%</span></div></div><div class="stat-card"><div class="stat-title"><i class="fas fa-project-diagram"></i>Active Projects</div><div class="stat-value"><span id="activeProjects">0</span><span class="stat-trend trend-neutral" id="activeProjectsTrend"><i class="fas fa-minus"></i> 0%</span></div></div><div class="stat-card"><div class="stat-title"><i class="fas fa-calendar-times"></i>Upcoming Deadlines</div><div class="stat-value"><span id="upcomingDeadlines">0</span><span class="stat-trend trend-neutral" id="upcomingDeadlinesTrend"><i class="fas fa-minus"></i> 0%</span></div></div></div> <div class="activity-section"><div class="section-header"><h3 class="section-title">Recent Activity <span class="live-badge">LIVE</span></h3><div><span class="view-all" id="viewAllActivity" style="display: none;">Show All</span><span class="delete-all" id="deleteAllActivity" style="display: none;">Delete All</span></div></div><ul class="activity-list" id="activityList"><li style="text-align: center; padding: 2rem; color: var(--gray);">Loading activities...</li></ul></div> </div>
            <div class="content-section" id="profileContent"> <div class="section-main-header"><h2 class="section-main-title">Profile</h2></div><p class="profile-header-text">Your personal information and account security settings.</p><div class="profile-avatar-section"><label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--dark);">Avatar</label><div id="profileAvatarLarge">ME</div><button type="button" class="btn btn-outline btn-sm" id="uploadPhotoButton"><i class="fas fa-upload"></i> Upload Photo</button><input type="file" id="profileAvatarInput" accept="image/*" style="display: none;"></div><form class="data-form" id="profileForm"><div class="form-group"><label for="firstName">First Name</label><input type="text" id="firstName" class="form-control" value="Mohamed"></div><div class="form-group"><label for="lastName">Last Name</label><input type="text" id="lastName" class="form-control" value="Elmenisy"></div><div class="form-group" style="grid-column: span 2;"><label for="fullNameDisplay">Full Name</label><input type="text" id="fullNameDisplay" class="form-control" value="Mohamed Elmenisy" readonly></div><div class="form-group"><label for="jobTitle">Job Title</label><input type="text" id="jobTitle" class="form-control" value="Administrator"></div><div class="form-group"><label for="email">Email</label><input type="email" id="email" class="form-control" value="m.elsayed@thechefz.co" readonly></div><div class="form-group"><label for="phone">Phone Number</label><input type="tel" id="phone" class="form-control" value="+201234567890"></div><div class="form-group"><label for="department">Department</label><input type="text" id="department" class="form-control" value="Management"></div><div class="form-actions"><button type="button" class="btn btn-outline" id="cancelProfileBtn">Cancel</button><button type="submit" class="btn btn-primary">Save Changes</button></div></form> </div>
            <div class="content-section" id="settingsContent"> <div class="section-main-header"><h2 class="section-main-title">System Settings</h2></div><div class="settings-tabs"><div class="settings-tab active" data-tab="preferences">Preferences</div><div class="settings-tab" data-tab="account">Account</div><div class="settings-tab" data-tab="security">Security</div><div class="settings-tab" data-tab="notifications">Notifications</div><div class="settings-tab" data-tab="team" id="teamSettingsTab">Team Management</div><div class="settings-tab" data-tab="collaboration">Collaboration</div><div class="settings-tab" data-tab="danger" id="dangerZoneTab">Danger Zone</div></div> <div class="settings-panel active" id="preferencesPanel"><h3 class="section-title">Preferences</h3><form class="data-form" id="preferencesForm"><div class="form-group"><label>Theme</label><div style="display: flex; gap: 1rem; margin-top: 0.5rem;"><div class="theme-option" data-theme="light"><div style="background-color: #f1f5f9;"></div><span>Light</span></div><div class="theme-option" data-theme="dark"><div style="background-color: #0f172a;"></div><span>Dark</span></div><div class="theme-option selected" data-theme="blue"><div style="background-color: #dbeafe;"></div><span>Blue</span></div></div><input type="hidden" id="selectedTheme" value="blue"></div><div class="form-group"><label for="layoutDensity">Layout Density</label><select id="layoutDensity" class="form-control"><option value="compact">Compact</option><option value="normal" selected>Normal</option><option value="spacious">Spacious</option></select></div><div class="form-group"><label for="language">Language</label><select id="language" class="form-control"><option value="en" selected>English</option><option value="ar">Arabic (Placeholder)</option><option value="es">Spanish (Placeholder)</option></select></div><div class="form-group"><label for="dateFormat">Date Format</label><select id="dateFormat" class="form-control"><option value="mm/dd/yyyy">MM/DD/YYYY</option><option value="dd/mm/yyyy" selected>DD/MM/YYYY</option><option value="yyyy-mm-dd">YYYY-MM-DD</option></select></div><div class="form-group"><label for="region">Region</label><input type="text" id="region" class="form-control" placeholder="Cairo (Placeholder)" disabled></div><div class="form-group"><label for="weekStart">Calendar Week Start</label><select id="weekStart" class="form-control"><option value="sun" selected>Sunday</option></select></div><div class="form-group" style="grid-column: span 2;"><label for="defaultHomepage">Default Homepage (Placeholder)</label><select id="defaultHomepage" class="form-control" disabled><option selected>Dashboard</option><option>Tasks</option><option>Calendar</option></select></div><div class="form-actions"><button type="button" class="btn btn-outline" id="cancelPreferencesBtn">Cancel</button><button type="submit" class="btn btn-primary" id="savePreferencesBtn"><span class="btn-text">Save Preferences</span><div class="spinner" id="preferencesSpinner"></div><span class="loading-text" id="preferencesLoadingText">Saving...</span></button></div></form></div> <div class="settings-panel" id="accountPanel"><h3 class="section-title">Account Settings</h3><form class="data-form" id="accountForm"><div class="form-group"><label for="acc_firstName">First Name</label><input type="text" id="acc_firstName" class="form-control" readonly></div><div class="form-group"><label for="acc_lastName">Last Name</label><input type="text" id="acc_lastName" class="form-control" readonly></div><div class="form-group"><label for="acc_email">Email</label><input type="email" id="acc_email" class="form-control" readonly></div><div class="form-group"><label for="timezone">Timezone</label><select id="timezone" class="form-control"><option value="utc">UTC</option><option value="cairo" selected>Cairo (UTC+2)</option><option value="new_york">New York (UTC-5)</option></select></div><div class="form-actions"><button type="button" class="btn btn-outline" id="cancelAccountBtn">Cancel</button><button type="submit" class="btn btn-primary" id="saveAccountBtn"><span class="btn-text">Save Settings</span><div class="spinner" id="accountSpinner"></div><span class="loading-text" id="accountLoadingText">Saving...</span></button></div><div class="form-group" style="grid-column: span 2; margin-top: 2rem;"><label style="color: var(--danger);">Account Deletion</label><p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Permanently delete your account and all associated data. This action cannot be undone.</p><button type="button" class="btn btn-danger" id="deleteAccountBtn" disabled>Delete Account (Placeholder)</button></div></form></div> <div class="settings-panel" id="securityPanel"><h3 class="section-title">Security Settings</h3><form class="data-form" id="securityForm"><div class="form-group" style="grid-column: span 2;"><label>Two-Factor Authentication (2FA)</label><div style="display: flex; align-items: center; gap: 1rem;"><label class="switch"><input type="checkbox" id="twoFactorAuth" checked><span class="slider round"></span></label><span>Enabled</span></div><p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.5rem;">Requires authentication code from your app upon login.</p></div><div class="form-group"><label for="currentPassword">Current Password</label><input type="password" id="currentPassword" class="form-control" autocomplete="current-password"><div class="password-error" id="currentPasswordError">Current password is incorrect</div></div><div class="form-group"><label for="newPassword">New Password</label><input type="password" id="newPassword" class="form-control" autocomplete="new-password"><small style="color: var(--gray);">Minimum 8 characters required.</small></div><div class="form-group"><label for="confirmPassword">Confirm New Password</label><input type="password" id="confirmPassword" class="form-control" autocomplete="new-password"><div class="password-error" id="passwordMatchError">Passwords do not match</div></div><div class="form-actions"><button type="button" class="btn btn-outline" id="cancelSecurityBtn">Cancel</button><button type="submit" class="btn btn-primary" id="saveSecurityBtn"><span class="btn-text">Update Password</span><div class="spinner" id="securitySpinner"></div><span class="loading-text" id="securityLoadingText">Updating...</span></button></div><div class="form-group" style="grid-column: span 2; margin-top: 2rem;"><label>Integrations (Placeholders)</label><div style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 0;"><span>Slack Integration</span><button class="btn btn-outline" disabled>Connect</button></div><div style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 0;"><span>Single Sign-On (SSO)</span><button class="btn btn-outline" disabled>Configure</button></div></div></form></div> <div class="settings-panel" id="notificationsPanel"><h3 class="section-title">Notification Settings</h3><form class="data-form" id="notificationsForm"><div class="form-group"><label>Email Notifications</label><div style="margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.75rem;"><div style="display: flex; align-items: center; justify-content: space-between;"><span>Task Assignments & Updates</span><label class="switch"><input type="checkbox" id="emailTasks" checked><span class="slider round"></span></label></div><div style="display: flex; align-items: center; justify-content: space-between;"><span>Deadline Reminders</span><label class="switch"><input type="checkbox" id="emailDeadlines" checked><span class="slider round"></span></label></div><div style="display: flex; align-items: center; justify-content: space-between;"><span>System Updates & Announcements</span><label class="switch"><input type="checkbox" id="emailUpdates"><span class="slider round"></span></label></div><div style="display: flex; align-items: center; justify-content: space-between;"><span>Weekly Summary (Placeholder)</span><label class="switch"><input type="checkbox" id="emailSummary" disabled><span class="slider round"></span></label></div></div></div><div class="form-group"><label>In-App Push Notifications</label><div style="margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.75rem;"><div style="display: flex; align-items: center; justify-content: space-between;"><span>New Messages & Mentions</span><label class="switch"><input type="checkbox" id="pushMessages" checked><span class="slider round"></span></label></div><div style="display: flex; align-items: center; justify-content: space-between;"><span>Team & Project Updates</span><label class="switch"><input type="checkbox" id="pushTeamUpdates"><span class="slider round"></span></label></div><div style="display: flex; align-items: center; justify-content: space-between;"><span>Sound Notifications</span><label class="switch"><input type="checkbox" id="soundNotifications" checked><span class="slider round"></span></label></div></div></div><div class="form-actions"><button type="button" class="btn btn-outline" id="cancelNotificationsBtn">Cancel</button><button type="submit" class="btn btn-primary" id="saveNotificationsBtn"><span class="btn-text">Save Settings</span><div class="spinner" id="notificationsSpinner"></div><span class="loading-text" id="notificationsLoadingText">Saving...</span></button></div></form></div> <div class="settings-panel" id="teamPanel"><div class="team-management"><h3>Team Members</h3><div class="team-list" id="teamList"><div style="text-align: center; padding: 2rem; color: var(--gray);">Loading team members...</div></div><div class="add-member-form"><h4>Invite New Member</h4><form id="inviteMemberForm" class="data-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: 1rem;"><div class="form-group" style="margin-bottom: 0;"><label for="inviteMemberEmail">Email</label><input type="email" id="inviteMemberEmail" class="form-control" placeholder="user@example.com" required></div><div class="form-group" style="margin-bottom: 0;"><label for="inviteMemberRole">Role</label><select id="inviteMemberRole" class="form-control" required><option value="member">Member</option><option value="senior">Senior</option><option value="supervisor">Supervisor</option><option value="admin">Admin</option></select></div><div style="grid-column: 1 / -1; margin-top: 1rem;"><button type="submit" class="btn btn-primary">Send Invite</button></div></form></div></div></div> <div class="settings-panel" id="collaborationPanel"><h3 class="section-title">Collaboration Settings</h3><form class="data-form" id="collaborationForm"><div class="form-group" style="grid-column: span 2;"><label>Shared Calendar Access (Placeholder)</label><p style="color: var(--gray); font-size: 0.9rem;">Control who can view or edit the team calendar.</p><button type="button" class="btn btn-outline" disabled>Manage Permissions</button></div><div class="form-group" style="grid-column: span 2;"><label>Team Chat Integration (Placeholder)</label><p style="color: var(--gray); font-size: 0.9rem;">Connect to your preferred team chat platform.</p><button type="button" class="btn btn-outline" disabled>Configure Chat</button></div><div class="form-actions"><button type="button" class="btn btn-outline" disabled>Cancel</button><button type="submit" class="btn btn-primary" disabled>Save Collaboration Settings</button></div></form></div> <div class="settings-panel" id="dangerPanel"><h3 class="section-title" style="color: var(--danger);">Danger Zone</h3><p style="color: var(--gray);">Actions in this section are permanent and cannot be undone. (Visible to Admins only)</p><div style="margin-top: 1.5rem; border: 1px solid var(--danger); border-radius: 6px; padding: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem;"><div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;"><div><strong style="color: var(--dark);">Delete Team Data (Placeholder)</strong><p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.25rem;">Permanently delete all projects, tasks, and files associated with this team.</p></div><button class="btn btn-danger" disabled>Delete All Team Data</button></div><div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;"><div><strong style="color: var(--dark);">Transfer Ownership (Placeholder)</strong><p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.25rem;">Transfer administrative control of this workspace to another user.</p></div><button class="btn btn-warning" disabled>Transfer Ownership</button></div><div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;"><div><strong style="color: var(--dark);">Delete Workspace (Placeholder)</strong><p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.25rem;">Permanently delete this entire workspace, including all users and data.</p></div><button class="btn btn-danger" disabled>Delete Workspace</button></div></div></div> </div>
            <div id="featureSectionsContainer" style="display: none;"><div id="featureSections" class="content-section"><div class="placeholder-content" id="featurePlaceholder"><h2 id="featureTitle">Feature Loading...</h2><p id="featureDescription"></p><div class="loading-indicator"><i class="fas fa-spinner fa-spin"></i> Loading...</div><div class="error-message" style="display: none;"></div></div></div></div>
        </div>
    </main>
    <div class="notifications-modal" id="notificationsModal"> <div class="notifications-container"><div class="notifications-header"><h3 class="notifications-title">Notifications</h3><button class="close-notifications" id="closeNotifications">×</button></div><div class="notifications-body" id="notificationsBody"><div class="no-notifications-message">Loading notifications...</div></div><div class="notifications-footer"><button class="btn btn-outline btn-sm" id="markAllReadBtn">Mark All as Read</button><button class="btn btn-danger btn-sm" id="deleteAllNotificationsBtn">Delete All</button></div></div> </div>
    <div class="confirm-modal" id="confirmModal"> <div class="confirm-container"><h3 class="confirm-title" id="confirmTitle">Confirm Action</h3><div class="confirm-message" id="confirmMessage">Are you sure you want to proceed?</div><div class="confirm-actions"><button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button><button class="btn btn-danger" id="confirmBtn">Confirm</button></div></div> </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CORE DASHBOARD ELEMENTS & STATE ---
            const sidebar = document.getElementById('sidebar');
            const menuItems = document.querySelectorAll('.menu-item');
            const contentSections = document.querySelectorAll('.content-section:not(#featureSections)');
            const dashboardContent = document.getElementById('dashboardContent');
            const profileContent = document.getElementById('profileContent');
            const settingsContent = document.getElementById('settingsContent');
            const featureSectionsContainer = document.getElementById('featureSectionsContainer');
            const featureSections = document.getElementById('featureSections');
            const featurePlaceholder = document.getElementById('featurePlaceholder');
             const teamList = document.getElementById('teamList');
             const backButton = document.getElementById('backButton');
             // Add other necessary dashboard element variables here
             const searchInput = document.getElementById('searchInput');
             const searchResults = document.getElementById('searchResults');
             const notificationIcon = document.getElementById('notificationIcon');
             const notificationBadge = document.querySelector('.notification-badge');
             const userAvatar = document.getElementById('userAvatar');
             const userProfileDetails = document.querySelector('.user-profile-details');
             const userName = document.getElementById('userName');
             const userEmail = document.getElementById('userEmail');
             const welcomeName = document.getElementById('welcomeName');
             const userDropdown = document.getElementById('userDropdown');
             const profileLink = document.getElementById('profileLink');
             const settingsLink = document.getElementById('settingsLink');
             const logoutLink = document.getElementById('logoutLink');
             const activityList = document.getElementById('activityList');
             const viewAllActivity = document.getElementById('viewAllActivity');
             const deleteAllActivity = document.getElementById('deleteAllActivity');
             const settingsTabs = document.querySelectorAll('.settings-tab');
             const settingsPanels = document.querySelectorAll('.settings-panel');
             const teamMembersCount = document.getElementById('teamMembersCount');
             const tasksCompleted = document.getElementById('tasksCompleted');
             const activeProjects = document.getElementById('activeProjects');
             const upcomingDeadlines = document.getElementById('upcomingDeadlines');
             const userInfoRoleTitle = document.getElementById('userInfoRoleTitle');
             const notificationSound = document.getElementById('notificationSound');
             const successMessage = document.getElementById('successMessage');
             const successMessageText = document.getElementById('successMessageText');
             const teamMembersTrend = document.getElementById('teamMembersTrend');
             const tasksCompletedTrend = document.getElementById('tasksCompletedTrend');
             const activeProjectsTrend = document.getElementById('activeProjectsTrend');
             const upcomingDeadlinesTrend = document.getElementById('upcomingDeadlinesTrend');
             // ... etc.

            let currentUser = {}; let teamMembers = []; let activities = []; let notifications = [];
            let currentFeature = 'dashboard'; let currentSettingsTab = 'preferences';
            let scheduleLogicInitialized = false; let scheduleCurrentWeekStart = null; let scheduleSavedData = {};
            const scheduleLocalStorageKey = 'employeeSchedule_May2025_final';
            const DEFAULT_USER = { id: 1, name: 'Default User', email: 'user@test.com', role: 'member', preferences: {}, stats: {} /* ... */ }; // Define Default User
            let confirmBtn = document.getElementById('confirmBtn'); let cancelConfirmBtn = document.getElementById('cancelConfirmBtn');

            // ============================================================
            // === DEFINE ALL FUNCTIONS (Core + Schedule) ===
            // ============================================================

            // --- CORE DASHBOARD HELPER FUNCTIONS ---
            function setPlaceholderState(state, title = '', description = '') {
                 const featureLoadingIndicator = featurePlaceholder?.querySelector('.loading-indicator');
                 const featureErrorMessage = featurePlaceholder?.querySelector('.error-message');
                 const featureTitleEl = featurePlaceholder?.querySelector('#featureTitle');
                 const featureDescEl = featurePlaceholder?.querySelector('#featureDescription');
                 if (!featurePlaceholder || !featureLoadingIndicator || !featureErrorMessage || !featureTitleEl || !featureDescEl) return;
                 featureLoadingIndicator.style.display = (state === 'loading') ? 'block' : 'none';
                 featureErrorMessage.style.display = (state === 'error') ? 'block' : 'none';
                 featureTitleEl.textContent = title;
                 featureDescEl.innerHTML = description;
                 featurePlaceholder.style.display = (state === 'hidden') ? 'none' : 'flex';
            }
            function showConfirmModal(config) {
                 const confirmModal = document.getElementById('confirmModal');
                 const confirmTitle = document.getElementById('confirmTitle');
                 const confirmMessage = document.getElementById('confirmMessage');
                 if (!confirmModal || !confirmTitle || !confirmMessage || !confirmBtn || !cancelConfirmBtn) return;
                 confirmTitle.textContent = config.title || 'Confirm'; confirmMessage.innerHTML = config.message || 'Are you sure?'; confirmBtn.textContent = config.confirmText || 'Confirm'; cancelConfirmBtn.textContent = config.cancelText || 'Cancel'; confirmBtn.className = `btn ${config.confirmClass || 'btn-danger'}`; cancelConfirmBtn.className = 'btn btn-outline';
                 const newConfirmBtn = confirmBtn.cloneNode(true); confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn); confirmBtn = newConfirmBtn;
                 const newCancelBtn = cancelConfirmBtn.cloneNode(true); cancelConfirmBtn.parentNode.replaceChild(newCancelBtn, cancelConfirmBtn); cancelConfirmBtn = newCancelBtn;
                 const confirmHandler = () => { if (config.onConfirm) config.onConfirm(); hideConfirmModal(); }; const cancelHandler = () => { if (config.onCancel) config.onCancel(); hideConfirmModal(); };
                 confirmBtn.addEventListener('click', confirmHandler, { once: true }); cancelConfirmBtn.addEventListener('click', cancelHandler, { once: true });
                 confirmModal.style.display = 'flex'; confirmBtn.focus();
            }
            function hideConfirmModal() { const m = document.getElementById('confirmModal'); if(m) m.style.display = 'none'; }
            function showSuccessMessage(message) { if(successMessage && successMessageText){ successMessageText.textContent = message; successMessage.classList.add('show'); setTimeout(() => { successMessage.classList.remove('show'); }, 3000); } }
            function addActivity(icon, message) { activities.push({id:Date.now(),icon,message,timestamp:new Date().toISOString(),isNew:true}); activities.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp)); saveData(); if(currentFeature==='dashboard')loadActivities(viewAllActivity?.style.display==='none'&&activities.length>5); }
            const dashboardGlobals = { showConfirmModal, hideConfirmModal, showSuccessMessage, showErrorMessage: (msg) => showConfirmModal({title:"Error", message:msg, confirmText:"OK", confirmClass:"btn-warning", cancelText:""}), addActivity, getCurrentUser: () => JSON.parse(JSON.stringify(currentUser || {})), getTeamMembers: () => JSON.parse(JSON.stringify(teamMembers || [])), updateTeamMembers: (newTeam) => {if(Array.isArray(newTeam)){teamMembers=newTeam; saveData(); loadTeamMembers(); updateStats();}} };
            window.dashboardApp = dashboardGlobals;
            // ... other core helpers like loadData, saveData, updateUserUI, etc. ...
             function loadData() { /* ... */ const storedUser=JSON.parse(localStorage.getItem('currentUser'));currentUser={...DEFAULT_USER,...storedUser};currentUser.preferences={...DEFAULT_USER.preferences,...(storedUser?.preferences||{})};/*...merge others...*/ teamMembers=JSON.parse(localStorage.getItem('teamMembers'))||[]; activities=JSON.parse(localStorage.getItem('activities'))||[]; notifications=JSON.parse(localStorage.getItem('notifications'))||[]; }
             function saveData() { /* ... */ localStorage.setItem('currentUser',JSON.stringify(currentUser));localStorage.setItem('teamMembers',JSON.stringify(teamMembers));localStorage.setItem('activities',JSON.stringify(activities));localStorage.setItem('notifications',JSON.stringify(notifications)); }
             function updateUserUI() { /* ... */ }
             function applyUserPreferences() { /* ... */ }
             function applyRBAC() { /* ... */ }
             function loadSettingsFormData() { /* ... */ }
             function updateStats() { /* ... */ }
             function updateTrendIndicator(element, trend) { /* ... */ }
             function updateNotificationBadge() { /* ... */ }
             function loadActivities(showAll = false) { /* ... */ }
             function loadNotifications() { /* ... */ }
             function getTimeAgo(timestamp) { /* ... */ }
             function updateActivityTimes() { /* ... */ }
             function startActivityTimeUpdater() { /* ... */ }
             function loadTeamMembers() { /* ... */ }
             function handleProfileSave(e) { /* ... */ }
             function handleProfileCancel() { /* ... */ }
             function handleSettingsSave(formId, panelId, successMsg) { /* ... */ }
             function handleSettingsCancel(panelId) { /* ... */ }
             function handleInviteMember(e) { /* ... */ }
             function handleEditMemberClick(e) { /* ... */ }
             function handleDeleteMemberClick(e) { /* ... */ }
             function handleDeleteActivityClick(e) { /* ... */ }
             function handleDeleteAllActivities() { /* ... */ }
             function markNotificationAsRead(notificationId, itemElement) { /* ... */ }
             function handleMarkAllNotificationsRead() { /* ... */ }
             function handleDeleteNotificationClick(notificationId) { /* ... */ }
             function handleDeleteAllNotifications() { /* ... */ }
             function handleAvatarUpload(e) { /* ... */ }
             function handleLogout() { /* ... */ }
             function addNotification(icon, message) { /* ... */ }
             function playNotificationSound() { /* ... */ }
             function handleSearch() { /* ... */ }
             function activateSettingsTab(tabId) { /* ... */ }

            // --- EMPLOYEE SCHEDULING FUNCTIONS (Defined Here) ---
            function formatDateKey_schedule(date) { if (!date?.getTime) return null; const y=date.getFullYear(); const m=(date.getMonth()+1).toString().padStart(2,'0'); const d=date.getDate().toString().padStart(2,'0'); return `${y}-${m}-${d}`; }
            function getLocalDateFromKey_schedule(dateKey) { if (!dateKey?.match) return null; const p=dateKey.split('-'); return new Date(parseInt(p[0]), parseInt(p[1])-1, parseInt(p[2])); }
            function updateWeekDisplay_schedule() { /* ... (Code from previous response) ... */ }
            function renderScheduleTable_schedule() { /* ... (Code from previous response, uses global teamMembers) ... */ }
            function updateShiftDisplayUI_schedule(empId, dateKey, shiftText, shiftClass, notes = '') { /* ... (Code from previous response) ... */ }
            function handleWeekChange_schedule(direction) { /* ... (Code from previous response) ... */ }
            function handleAddEmployeeClick_schedule() { /* ... (Code from previous response) ... */ }
            function handleSendRemindersClick_schedule() { /* ... (Code from previous response) ... */ }
            function handleSaveScheduleClick_schedule() { /* ... (Code from previous response) ... */ }
            function handleEmployeeFormSubmit_schedule(e) { /* ... (Code from previous response) ... */ }
            function handleEditShiftClick_schedule(event) { /* ... (Code from previous response) ... */ }
            function handleShiftFormSubmit_schedule(e) { /* ... (Code from previous response) ... */ }
            function handleDeleteShiftClick_schedule() { /* ... (Code from previous response) ... */ }
            const shiftTypeChangeHandler_schedule = (e) => { /* ... (Code from previous response) ... */ };
            const editShiftKeydownHandler_schedule = (e) => { /* ... (Code from previous response) ... */ };
            function setupDynamicScheduleListeners_schedule() { /* ... (Code from previous response) ... */ }
            function setupScheduleEventListeners_schedule_static() { /* ... (Code from previous response) ... */ }

             // --- Integrated Initialization Function for Schedule ---
             function initializeScheduleFeature_integrated() {
                 if (scheduleLogicInitialized) { console.log("Re-rendering schedule."); updateWeekDisplay_schedule(); renderScheduleTable_schedule(); return; }
                 console.log("--- Initializing Employee Scheduling Feature (Integrated) ---");
                 scheduleLogicInitialized = true;
                 // Load schedule data (different key)
                 const savedDataString = localStorage.getItem(scheduleLocalStorageKey); scheduleSavedData = savedDataString ? JSON.parse(savedDataString) : {}; if(typeof scheduleSavedData !== 'object') scheduleSavedData = {};
                 // Set initial week if needed
                 if (!scheduleCurrentWeekStart) { const today=new Date(); const dow=today.getDay(); const diff=today.getDate()-dow+(dow===0?-6:1); scheduleCurrentWeekStart=new Date(today.getFullYear(),today.getMonth(),diff); /* Add clamping */ }
                 try {
                     console.log("Running initial schedule UI setup...");
                     updateWeekDisplay_schedule();
                     renderScheduleTable_schedule(); // Renders table & calls dynamic listener setup
                     setupScheduleEventListeners_schedule_static(); // Setup static listeners
                     // Show/hide admin buttons
                     const addEmpBtn=document.getElementById('schedule-addEmployeeBtn'); const sendRemBtn=document.getElementById('schedule-sendRemindersBtn'); const saveBtn=document.getElementById('schedule-saveScheduleBtn');
                     const isAdmin = currentUser.role === 'admin' || currentUser.role === 'supervisor';
                     if(addEmpBtn) addEmpBtn.style.display = isAdmin ? 'inline-flex' : 'none'; if(sendRemBtn) sendRemBtn.style.display = isAdmin ? 'inline-flex' : 'none'; if(saveBtn) saveBtn.style.display = isAdmin ? 'inline-flex' : 'none';
                     console.log("--- Employee Scheduling Feature Initialized (Integrated) ---");
                 } catch(error) { /* ... error handling ... */ }
            }

            // --- setActiveFeature (Loads HTML, calls initializer) ---
            function setActiveFeature(featureId, settingsTab = null) {
                 console.log(`setActiveFeature: ${featureId}`);
                 if (currentFeature === 'employee-scheduling' && featureId !== 'employee-scheduling') { scheduleLogicInitialized = false; console.log("Reset schedule init flag."); }
                 currentFeature = featureId; currentSettingsTab = settingsTab || (featureId === 'settings' ? currentSettingsTab : null);
                 let hash = `#${featureId}`; if (featureId === 'settings' && currentSettingsTab) hash += `-${currentSettingsTab}`;
                 if (window.location.hash !== hash) history.pushState({ feature: featureId, tab: currentSettingsTab }, '', hash);
                 menuItems.forEach(item => item.classList.remove('active')); document.querySelector(`.menu-item[data-feature="${featureId}"]`)?.classList.add('active');
                 contentSections.forEach(section => section.classList.remove('active')); featureSectionsContainer.style.display = 'none';

                 if (featureId === 'dashboard' || featureId === 'profile' || featureId === 'settings') {
                     const staticSection = document.getElementById(`${featureId}Content`);
                     if (staticSection) { staticSection.classList.add('active'); /* ... updates ... */ } setPlaceholderState('hidden');
                 } else {
                     featureSectionsContainer.style.display = 'block'; featureSections.innerHTML = ''; featureSections.appendChild(featurePlaceholder); setPlaceholderState('loading', `Loading ${featureId}...`);
                     const htmlFilePath = `sections/${featureId}.html`;
                     fetch(htmlFilePath)
                         .then(response => { if (!response.ok) throw new Error(`HTTP ${response.status}`); return response.text(); })
                         .then(html => {
                             featureSections.innerHTML = html; featureSections.classList.add('active'); setPlaceholderState('hidden');
                             // Initialize after loading HTML
                             if (featureId === 'employee-scheduling') {
                                 initializeScheduleFeature_integrated(); // Call the *integrated* function
                             }
                             // else if (featureId === 'otherFeature') { initializeOtherFeature(); }
                         })
                         .catch(error => { console.error(`Error loading ${featureId}:`, error); setPlaceholderState('error', `Error Loading ${featureId}`, `Could not load. ${error.message}`); });
                 }
                 backButton.style.display = featureId !== 'dashboard' ? 'inline-flex' : 'none'; window.scrollTo(0, 0);
            }

             // --- handleInitialNavigation (Defined BEFORE initDashboard) ---
            function handleInitialNavigation() {
                 const hash = window.location.hash.substring(1); let featureId = 'dashboard'; let settingsTab = null;
                 if (hash) { if (hash.startsWith('settings-')) { featureId = 'settings'; settingsTab = hash.split('-')[1] || 'preferences'; } else { const vf = [...menuItems].some(i=>i.dataset.feature===hash) || hash === 'profile'; if(vf) featureId=hash; } }
                 console.log(`Initial navigation: feature='${featureId}', tab='${settingsTab}'`);
                 setActiveFeature(featureId, settingsTab); // Load initial content
            }

            // --- INIT DASHBOARD (Calls the now-defined handleInitialNavigation) ---
             function initDashboard() {
                 loadData(); updateUserUI(); loadTeamMembers(); loadActivities(); loadNotifications(); updateStats(); applyUserPreferences(); applyRBAC(); setupEventListeners();
                 handleInitialNavigation(); // CALL handleInitialNavigation HERE
                 startActivityTimeUpdater();
                 console.log("Dashboard Initialized");
             }

             // --- Setup Core Event Listeners (Defined) ---
             function setupEventListeners() {
                  console.log("Setting up CORE dashboard listeners...");
                  // Helper to safely add listener
                  const safeAddListener = (element, event, handler) => {
                      if (element) { element.addEventListener(event, handler); }
                      else { console.warn(`setupEventListeners: Element not found for ${event} listener.`, element); } // Log warning if element not found
                  };

                  // Sidebar Navigation
                  menuItems.forEach(item => safeAddListener(item, 'click', (e) => { e.preventDefault(); setActiveFeature(item.dataset.feature); }));
                  // Back Button
                  safeAddListener(backButton, 'click', () => setActiveFeature('dashboard'));
                  // Browser Back/Forward Navigation
                  window.addEventListener('popstate', (event) => { if (event.state?.feature) { setActiveFeature(event.state.feature, event.state.tab); } else { handleInitialNavigation(); } });
                  // Search
                  safeAddListener(searchInput, 'input', handleSearch);
                  safeAddListener(searchInput, 'focus', handleSearch);
                  document.addEventListener('click', (e) => { if (!e.target.closest('.search-bar')) { searchResults.classList.remove('active'); searchResults.innerHTML = ''; } });
                  // User Dropdown
                  safeAddListener(userAvatar, 'click', () => userDropdown.classList.toggle('active'));
                  safeAddListener(userProfileDetails, 'click', () => userDropdown.classList.toggle('active'));
                  safeAddListener(profileLink, 'click', (e) => { e.preventDefault(); userDropdown.classList.remove('active'); setActiveFeature('profile'); });
                  safeAddListener(settingsLink, 'click', (e) => { e.preventDefault(); userDropdown.classList.remove('active'); setActiveFeature('settings'); });
                  safeAddListener(logoutLink, 'click', (e) => { e.preventDefault(); userDropdown.classList.remove('active'); handleLogout(); });
                  document.addEventListener('click', (e) => { if (!e.target.closest('.user-profile')) userDropdown.classList.remove('active'); });
                  // Notifications Modal
                  const notificationsModal = document.getElementById('notificationsModal'); const closeNotifications = document.getElementById('closeNotifications'); const markAllReadBtn = document.getElementById('markAllReadBtn'); const deleteAllNotificationsBtn = document.getElementById('deleteAllNotificationsBtn');
                  safeAddListener(notificationIcon, 'click', () => { if (notificationsModal) notificationsModal.style.display = 'flex'; loadNotifications(); });
                  safeAddListener(closeNotifications, 'click', () => { if (notificationsModal) notificationsModal.style.display = 'none'; });
                  safeAddListener(notificationsModal, 'click', (e) => { if (e.target === notificationsModal) notificationsModal.style.display = 'none'; });
                  safeAddListener(markAllReadBtn, 'click', handleMarkAllNotificationsRead);
                  safeAddListener(deleteAllNotificationsBtn, 'click', handleDeleteAllNotifications);
                  // Activity List Actions
                  safeAddListener(viewAllActivity, 'click', () => loadActivities(true));
                  safeAddListener(deleteAllActivity, 'click', handleDeleteAllActivities);
                  // Profile Form Actions
                  safeAddListener(profileForm, 'submit', handleProfileSave);
                  safeAddListener(cancelProfileBtn, 'click', handleProfileCancel);
                  const uploadPhotoButton = document.getElementById('uploadPhotoButton'); const profileAvatarInput = document.getElementById('profileAvatarInput');
                  safeAddListener(uploadPhotoButton, 'click', () => profileAvatarInput?.click());
                  safeAddListener(profileAvatarInput, 'change', handleAvatarUpload);
                  // Settings Tabs
                  settingsTabs.forEach(tab => { safeAddListener(tab, 'click', () => { if (!tab.classList.contains('disabled')) activateSettingsTab(tab.dataset.tab); }); });
                  // Settings Forms Save/Cancel
                  const preferencesForm = document.getElementById('preferencesForm'); const cancelPreferencesBtn = document.getElementById('cancelPreferencesBtn');
                  safeAddListener(preferencesForm, 'submit', (e) => { e.preventDefault(); handleSettingsSave('preferencesForm', 'preferencesPanel', 'Preferences saved.'); });
                  safeAddListener(cancelPreferencesBtn, 'click', () => handleSettingsCancel('preferencesPanel'));
                  const accountForm = document.getElementById('accountForm'); const cancelAccountBtn = document.getElementById('cancelAccountBtn');
                  safeAddListener(accountForm, 'submit', (e) => { e.preventDefault(); handleSettingsSave('accountForm', 'accountPanel', 'Account settings saved.'); });
                  safeAddListener(cancelAccountBtn, 'click', () => handleSettingsCancel('accountPanel'));
                  const securityForm = document.getElementById('securityForm'); const cancelSecurityBtn = document.getElementById('cancelSecurityBtn');
                  safeAddListener(securityForm, 'submit', (e) => { e.preventDefault(); handleSettingsSave('securityForm', 'securityPanel', 'Security settings updated.'); });
                  safeAddListener(cancelSecurityBtn, 'click', () => handleSettingsCancel('securityPanel'));
                  const notificationsForm = document.getElementById('notificationsForm'); const cancelNotificationsBtn = document.getElementById('cancelNotificationsBtn');
                  safeAddListener(notificationsForm, 'submit', (e) => { e.preventDefault(); handleSettingsSave('notificationsForm', 'notificationsPanel', 'Notification settings saved.'); });
                  safeAddListener(cancelNotificationsBtn, 'click', () => handleSettingsCancel('notificationsPanel'));
                  // Theme/Layout Direct Apply
                  const themeOptions = document.querySelectorAll('.theme-option'); const layoutDensitySelect = document.getElementById('layoutDensity');
                  themeOptions.forEach(option => { safeAddListener(option, 'click', function() { /* ... theme logic ... */ }); });
                  safeAddListener(layoutDensitySelect, 'change', function() { /* ... layout logic ... */ });
                  // Team Management - Invite Member
                  const inviteMemberForm = document.getElementById('inviteMemberForm');
                  safeAddListener(inviteMemberForm, 'submit', handleInviteMember);
                  // Confirm Modal Buttons & Escape key
                  const confirmModal = document.getElementById('confirmModal');
                  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && confirmModal?.style.display === 'flex') hideConfirmModal(); });
                  safeAddListener(confirmModal, 'click', (e) => { if (e.target === confirmModal) hideConfirmModal(); });

                  console.log("CORE dashboard listeners attached/verified.");
             }

            // ============================================================
            // === RUN INITIALIZATION ===
            // ============================================================
            initDashboard();

        }); // End DOMContentLoaded
    </script>
</body>
</html>
